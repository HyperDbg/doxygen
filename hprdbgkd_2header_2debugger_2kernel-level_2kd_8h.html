<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.7"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>HyperDbg Debugger: hyperdbg/hprdbgkd/header/debugger/kernel-level/Kd.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">HyperDbg Debugger
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.7 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('hprdbgkd_2header_2debugger_2kernel-level_2kd_8h.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#typedef-members">Typedefs</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle"><div class="title">Kd.h File Reference</div></div>
</div><!--header-->
<div class="contents">

<p>Header for routines related to kernel mode debugging.  
<a href="#details">More...</a></p>

<p><a href="hprdbgkd_2header_2debugger_2kernel-level_2kd_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="nested-classes" name="nested-classes"></a>
Classes</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="struct___d_e_b_u_g_g_e_e___r_e_q_u_e_s_t___t_o___c_h_a_n_g_e___p_r_o_c_e_s_s.html">_DEBUGGEE_REQUEST_TO_CHANGE_PROCESS</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">request to change the process  <a href="struct___d_e_b_u_g_g_e_e___r_e_q_u_e_s_t___t_o___c_h_a_n_g_e___p_r_o_c_e_s_s.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="struct___d_e_b_u_g_g_e_e___r_e_q_u_e_s_t___t_o___c_h_a_n_g_e___t_h_r_e_a_d.html">_DEBUGGEE_REQUEST_TO_CHANGE_THREAD</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">request to change the thread  <a href="struct___d_e_b_u_g_g_e_e___r_e_q_u_e_s_t___t_o___c_h_a_n_g_e___t_h_r_e_a_d.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="struct___d_e_b_u_g_g_e_e___r_e_q_u_e_s_t___t_o___i_g_n_o_r_e___b_r_e_a_k_s___u_n_t_i_l___a_n___e_v_e_n_t.html">_DEBUGGEE_REQUEST_TO_IGNORE_BREAKS_UNTIL_AN_EVENT</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">request to pause and halt the system  <a href="struct___d_e_b_u_g_g_e_e___r_e_q_u_e_s_t___t_o___i_g_n_o_r_e___b_r_e_a_k_s___u_n_t_i_l___a_n___e_v_e_n_t.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="struct___h_a_r_d_w_a_r_e___d_e_b_u_g___r_e_g_i_s_t_e_r___d_e_t_a_i_l_s.html">_HARDWARE_DEBUG_REGISTER_DETAILS</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">store the details of a hardware debug register to ignore any trigger for other threads  <a href="struct___h_a_r_d_w_a_r_e___d_e_b_u_g___r_e_g_i_s_t_e_r___d_e_t_a_i_l_s.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="typedef-members" name="typedef-members"></a>
Typedefs</h2></td></tr>
<tr class="memitem:a1ad4ae8cc604353c84f45d060c15e641"><td class="memItemLeft" align="right" valign="top">typedef struct <a class="el" href="struct___d_e_b_u_g_g_e_e___r_e_q_u_e_s_t___t_o___c_h_a_n_g_e___p_r_o_c_e_s_s.html">_DEBUGGEE_REQUEST_TO_CHANGE_PROCESS</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="hprdbgkd_2header_2debugger_2kernel-level_2kd_8h.html#a1ad4ae8cc604353c84f45d060c15e641">DEBUGGEE_REQUEST_TO_CHANGE_PROCESS</a></td></tr>
<tr class="memdesc:a1ad4ae8cc604353c84f45d060c15e641"><td class="mdescLeft">&#160;</td><td class="mdescRight">request to change the process  <br /></td></tr>
<tr class="separator:a1ad4ae8cc604353c84f45d060c15e641"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a75462fddb22aeb284e09a0465e8e6929"><td class="memItemLeft" align="right" valign="top">typedef struct <a class="el" href="struct___d_e_b_u_g_g_e_e___r_e_q_u_e_s_t___t_o___c_h_a_n_g_e___p_r_o_c_e_s_s.html">_DEBUGGEE_REQUEST_TO_CHANGE_PROCESS</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="hprdbgkd_2header_2debugger_2kernel-level_2kd_8h.html#a75462fddb22aeb284e09a0465e8e6929">PDEBUGGEE_REQUEST_TO_CHANGE_PROCESS</a></td></tr>
<tr class="separator:a75462fddb22aeb284e09a0465e8e6929"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5fd44542909b860301b2b95fbfbca8ea"><td class="memItemLeft" align="right" valign="top">typedef struct <a class="el" href="struct___d_e_b_u_g_g_e_e___r_e_q_u_e_s_t___t_o___c_h_a_n_g_e___t_h_r_e_a_d.html">_DEBUGGEE_REQUEST_TO_CHANGE_THREAD</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="hprdbgkd_2header_2debugger_2kernel-level_2kd_8h.html#a5fd44542909b860301b2b95fbfbca8ea">DEBUGGEE_REQUEST_TO_CHANGE_THREAD</a></td></tr>
<tr class="memdesc:a5fd44542909b860301b2b95fbfbca8ea"><td class="mdescLeft">&#160;</td><td class="mdescRight">request to change the thread  <br /></td></tr>
<tr class="separator:a5fd44542909b860301b2b95fbfbca8ea"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acd076187998184fbf980d03949ad4eb9"><td class="memItemLeft" align="right" valign="top">typedef struct <a class="el" href="struct___d_e_b_u_g_g_e_e___r_e_q_u_e_s_t___t_o___c_h_a_n_g_e___t_h_r_e_a_d.html">_DEBUGGEE_REQUEST_TO_CHANGE_THREAD</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="hprdbgkd_2header_2debugger_2kernel-level_2kd_8h.html#acd076187998184fbf980d03949ad4eb9">PDEBUGGEE_REQUEST_TO_CHANGE_THREAD</a></td></tr>
<tr class="separator:acd076187998184fbf980d03949ad4eb9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aedf0b19343dd23c43662c511b9ef14f3"><td class="memItemLeft" align="right" valign="top">typedef struct <a class="el" href="struct___d_e_b_u_g_g_e_e___r_e_q_u_e_s_t___t_o___i_g_n_o_r_e___b_r_e_a_k_s___u_n_t_i_l___a_n___e_v_e_n_t.html">_DEBUGGEE_REQUEST_TO_IGNORE_BREAKS_UNTIL_AN_EVENT</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="hprdbgkd_2header_2debugger_2kernel-level_2kd_8h.html#aedf0b19343dd23c43662c511b9ef14f3">DEBUGGEE_REQUEST_TO_IGNORE_BREAKS_UNTIL_AN_EVENT</a></td></tr>
<tr class="memdesc:aedf0b19343dd23c43662c511b9ef14f3"><td class="mdescLeft">&#160;</td><td class="mdescRight">request to pause and halt the system  <br /></td></tr>
<tr class="separator:aedf0b19343dd23c43662c511b9ef14f3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2cf4b7231fd2b6d0250c9ffc8cacdc0c"><td class="memItemLeft" align="right" valign="top">typedef struct <a class="el" href="struct___d_e_b_u_g_g_e_e___r_e_q_u_e_s_t___t_o___i_g_n_o_r_e___b_r_e_a_k_s___u_n_t_i_l___a_n___e_v_e_n_t.html">_DEBUGGEE_REQUEST_TO_IGNORE_BREAKS_UNTIL_AN_EVENT</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="hprdbgkd_2header_2debugger_2kernel-level_2kd_8h.html#a2cf4b7231fd2b6d0250c9ffc8cacdc0c">PDEBUGGEE_REQUEST_TO_IGNORE_BREAKS_UNTIL_AN_EVENT</a></td></tr>
<tr class="separator:a2cf4b7231fd2b6d0250c9ffc8cacdc0c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2caac9dcb648b3b97f9b1bc150ffa078"><td class="memItemLeft" align="right" valign="top">typedef struct <a class="el" href="struct___h_a_r_d_w_a_r_e___d_e_b_u_g___r_e_g_i_s_t_e_r___d_e_t_a_i_l_s.html">_HARDWARE_DEBUG_REGISTER_DETAILS</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="hprdbgkd_2header_2debugger_2kernel-level_2kd_8h.html#a2caac9dcb648b3b97f9b1bc150ffa078">HARDWARE_DEBUG_REGISTER_DETAILS</a></td></tr>
<tr class="memdesc:a2caac9dcb648b3b97f9b1bc150ffa078"><td class="mdescLeft">&#160;</td><td class="mdescRight">store the details of a hardware debug register to ignore any trigger for other threads  <br /></td></tr>
<tr class="separator:a2caac9dcb648b3b97f9b1bc150ffa078"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac138c71071baa0775fc179a9b25eb114"><td class="memItemLeft" align="right" valign="top">typedef struct <a class="el" href="struct___h_a_r_d_w_a_r_e___d_e_b_u_g___r_e_g_i_s_t_e_r___d_e_t_a_i_l_s.html">_HARDWARE_DEBUG_REGISTER_DETAILS</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="hprdbgkd_2header_2debugger_2kernel-level_2kd_8h.html#ac138c71071baa0775fc179a9b25eb114">PHARDWARE_DEBUG_REGISTER_DETAILS</a></td></tr>
<tr class="separator:ac138c71071baa0775fc179a9b25eb114"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ac7a7e5c80ccd8650a1b4e6c9e9193845"><td class="memItemLeft" align="right" valign="top"><a class="el" href="_basic_types_8h.html#a7f319bfc2492a2136964194204e7a8cf">VOID</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="hprdbgkd_2header_2debugger_2kernel-level_2kd_8h.html#ac7a7e5c80ccd8650a1b4e6c9e9193845">KdHaltSystem</a> (<a class="el" href="_data_types_8h.html#a76ef165d19b9e825f9bced11160f1049">PDEBUGGER_PAUSE_PACKET_RECEIVED</a> PausePacket)</td></tr>
<tr class="memdesc:ac7a7e5c80ccd8650a1b4e6c9e9193845"><td class="mdescLeft">&#160;</td><td class="mdescRight">Halt the system.  <br /></td></tr>
<tr class="separator:ac7a7e5c80ccd8650a1b4e6c9e9193845"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a471c63b8db9a487f132923dcaf13b0cc"><td class="memItemLeft" align="right" valign="top"><a class="el" href="_basic_types_8h.html#a7f319bfc2492a2136964194204e7a8cf">VOID</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="hprdbgkd_2header_2debugger_2kernel-level_2kd_8h.html#a471c63b8db9a487f132923dcaf13b0cc">KdHandleDebugEventsWhenKernelDebuggerIsAttached</a> (<a class="el" href="hprdbgkd_2header_2debugger_2core_2_state_8h.html#aa35afece6adc9a29a7bf7a2e76476037">PROCESSOR_DEBUGGING_STATE</a> *DbgState)</td></tr>
<tr class="memdesc:a471c63b8db9a487f132923dcaf13b0cc"><td class="mdescLeft">&#160;</td><td class="mdescRight">Handles debug events when kernel-debugger is attached.  <br /></td></tr>
<tr class="separator:a471c63b8db9a487f132923dcaf13b0cc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a81ec660b5db2e1b3a1677661c23b51d0"><td class="memItemLeft" align="right" valign="top"><a class="el" href="_basic_types_8h.html#a7f319bfc2492a2136964194204e7a8cf">VOID</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="hprdbgkd_2header_2debugger_2kernel-level_2kd_8h.html#a81ec660b5db2e1b3a1677661c23b51d0">KdManageSystemHaltOnVmxRoot</a> (<a class="el" href="hprdbgkd_2header_2debugger_2core_2_state_8h.html#aa35afece6adc9a29a7bf7a2e76476037">PROCESSOR_DEBUGGING_STATE</a> *DbgState, <a class="el" href="_basic_types_8h.html#ad502772c412e6f5dd67d557fdc3a4322">PDEBUGGER_TRIGGERED_EVENT_DETAILS</a> EventDetails)</td></tr>
<tr class="memdesc:a81ec660b5db2e1b3a1677661c23b51d0"><td class="mdescLeft">&#160;</td><td class="mdescRight">manage system halt on vmx-root mode  <br /></td></tr>
<tr class="separator:a81ec660b5db2e1b3a1677661c23b51d0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a874c5a260b2ad0704e92c2b68b6a97af"><td class="memItemLeft" align="right" valign="top"><a class="el" href="_basic_types_8h.html#a1cb18096b299d23458d3c7b85fd86555">BOOLEAN</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="hprdbgkd_2header_2debugger_2kernel-level_2kd_8h.html#a874c5a260b2ad0704e92c2b68b6a97af">KdCheckAndHandleNmiCallback</a> (_In_ <a class="el" href="_basic_types_8h.html#ae1e6edbbc26d6fbc71a90190d0266018">UINT32</a> CoreId)</td></tr>
<tr class="separator:a874c5a260b2ad0704e92c2b68b6a97af"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4ea35c78a7ce042d1fa92e31cc86e3c3"><td class="memItemLeft" align="right" valign="top"><a class="el" href="_basic_types_8h.html#a7f319bfc2492a2136964194204e7a8cf">VOID</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="hprdbgkd_2header_2debugger_2kernel-level_2kd_8h.html#a4ea35c78a7ce042d1fa92e31cc86e3c3">KdHandleNmi</a> (_Inout_ <a class="el" href="hprdbgkd_2header_2debugger_2core_2_state_8h.html#aa35afece6adc9a29a7bf7a2e76476037">PROCESSOR_DEBUGGING_STATE</a> *DbgState)</td></tr>
<tr class="separator:a4ea35c78a7ce042d1fa92e31cc86e3c3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa6327269502f58fa975905189894eb48"><td class="memItemLeft" align="right" valign="top"><a class="el" href="_basic_types_8h.html#a7f319bfc2492a2136964194204e7a8cf">VOID</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="hprdbgkd_2header_2debugger_2kernel-level_2kd_8h.html#aa6327269502f58fa975905189894eb48">KdInitializeKernelDebugger</a> ()</td></tr>
<tr class="memdesc:aa6327269502f58fa975905189894eb48"><td class="mdescLeft">&#160;</td><td class="mdescRight">initialize kernel debugger  <br /></td></tr>
<tr class="separator:aa6327269502f58fa975905189894eb48"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a93b5f11529ccadc52cc47bccb072ed27"><td class="memItemLeft" align="right" valign="top"><a class="el" href="_basic_types_8h.html#a7f319bfc2492a2136964194204e7a8cf">VOID</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="hprdbgkd_2header_2debugger_2kernel-level_2kd_8h.html#a93b5f11529ccadc52cc47bccb072ed27">KdUninitializeKernelDebugger</a> ()</td></tr>
<tr class="memdesc:a93b5f11529ccadc52cc47bccb072ed27"><td class="mdescLeft">&#160;</td><td class="mdescRight">uninitialize kernel debugger  <br /></td></tr>
<tr class="separator:a93b5f11529ccadc52cc47bccb072ed27"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0af968467072898abb6bbd25495a06eb"><td class="memItemLeft" align="right" valign="top"><a class="el" href="_basic_types_8h.html#a7f319bfc2492a2136964194204e7a8cf">VOID</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="hprdbgkd_2header_2debugger_2kernel-level_2kd_8h.html#a0af968467072898abb6bbd25495a06eb">KdSendFormatsFunctionResult</a> (<a class="el" href="_basic_types_8h.html#aae17ebb9ef7279d026817fb22f8aebe9">UINT64</a> Value)</td></tr>
<tr class="memdesc:a0af968467072898abb6bbd25495a06eb"><td class="mdescLeft">&#160;</td><td class="mdescRight">Notify user-mode to unload the debuggee and close the connections.  <br /></td></tr>
<tr class="separator:a0af968467072898abb6bbd25495a06eb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a38ba4b9350674375c024a9f2b63c7907"><td class="memItemLeft" align="right" valign="top"><a class="el" href="_basic_types_8h.html#a7f319bfc2492a2136964194204e7a8cf">VOID</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="hprdbgkd_2header_2debugger_2kernel-level_2kd_8h.html#a38ba4b9350674375c024a9f2b63c7907">KdSendCommandFinishedSignal</a> (<a class="el" href="_basic_types_8h.html#ae1e6edbbc26d6fbc71a90190d0266018">UINT32</a> CoreId)</td></tr>
<tr class="memdesc:a38ba4b9350674375c024a9f2b63c7907"><td class="mdescLeft">&#160;</td><td class="mdescRight">Notify debugger that the execution of command finished.  <br /></td></tr>
<tr class="separator:a38ba4b9350674375c024a9f2b63c7907"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a66ae5d7ad1daa1d2516238d1f6f8d96d"><td class="memItemLeft" align="right" valign="top"><a class="el" href="_basic_types_8h.html#a7f319bfc2492a2136964194204e7a8cf">VOID</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="hprdbgkd_2header_2debugger_2kernel-level_2kd_8h.html#a66ae5d7ad1daa1d2516238d1f6f8d96d">KdHandleBreakpointAndDebugBreakpointsCallback</a> (_In_ <a class="el" href="_basic_types_8h.html#ae1e6edbbc26d6fbc71a90190d0266018">UINT32</a> CoreId, _In_ <a class="el" href="_connection_8h.html#ac834b5b60f3a3213636632ea482a26a3">DEBUGGEE_PAUSING_REASON</a> Reason, <a class="el" href="_basic_types_8h.html#ad502772c412e6f5dd67d557fdc3a4322">PDEBUGGER_TRIGGERED_EVENT_DETAILS</a> EventDetails)</td></tr>
<tr class="separator:a66ae5d7ad1daa1d2516238d1f6f8d96d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aed037f4430a6dec6d52f38a799394e7e"><td class="memItemLeft" align="right" valign="top"><a class="el" href="_basic_types_8h.html#a7f319bfc2492a2136964194204e7a8cf">VOID</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="hprdbgkd_2header_2debugger_2kernel-level_2kd_8h.html#aed037f4430a6dec6d52f38a799394e7e">KdHandleBreakpointAndDebugBreakpoints</a> (_Inout_ <a class="el" href="hprdbgkd_2header_2debugger_2core_2_state_8h.html#aa35afece6adc9a29a7bf7a2e76476037">PROCESSOR_DEBUGGING_STATE</a> *DbgState, _In_ <a class="el" href="_connection_8h.html#ac834b5b60f3a3213636632ea482a26a3">DEBUGGEE_PAUSING_REASON</a> Reason, <a class="el" href="_basic_types_8h.html#ad502772c412e6f5dd67d557fdc3a4322">PDEBUGGER_TRIGGERED_EVENT_DETAILS</a> EventDetails)</td></tr>
<tr class="separator:aed037f4430a6dec6d52f38a799394e7e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a36cd156d7513f5bb5f119b5e05fb4206"><td class="memItemLeft" align="right" valign="top"><a class="el" href="_basic_types_8h.html#a7f319bfc2492a2136964194204e7a8cf">VOID</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="hprdbgkd_2header_2debugger_2kernel-level_2kd_8h.html#a36cd156d7513f5bb5f119b5e05fb4206">KdHandleRegisteredMtfCallback</a> (_In_ <a class="el" href="_basic_types_8h.html#ae1e6edbbc26d6fbc71a90190d0266018">UINT32</a> CoreId)</td></tr>
<tr class="separator:a36cd156d7513f5bb5f119b5e05fb4206"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1dfff40dfc7fe7e837164f8eb7bc9c7f"><td class="memItemLeft" align="right" valign="top"><a class="el" href="_basic_types_8h.html#a7f319bfc2492a2136964194204e7a8cf">VOID</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="hprdbgkd_2header_2debugger_2kernel-level_2kd_8h.html#a1dfff40dfc7fe7e837164f8eb7bc9c7f">KdHandleHaltsWhenNmiReceivedFromVmxRoot</a> (_Inout_ <a class="el" href="hprdbgkd_2header_2debugger_2core_2_state_8h.html#aa35afece6adc9a29a7bf7a2e76476037">PROCESSOR_DEBUGGING_STATE</a> *DbgState)</td></tr>
<tr class="separator:a1dfff40dfc7fe7e837164f8eb7bc9c7f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a054ac5a2eacb043709217c38c8a17b2e"><td class="memItemLeft" align="right" valign="top"><a class="el" href="_basic_types_8h.html#a1cb18096b299d23458d3c7b85fd86555">BOOLEAN</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="hprdbgkd_2header_2debugger_2kernel-level_2kd_8h.html#a054ac5a2eacb043709217c38c8a17b2e">KdCheckImmediateMessagingMechanism</a> (<a class="el" href="_basic_types_8h.html#ae1e6edbbc26d6fbc71a90190d0266018">UINT32</a> OperationCode)</td></tr>
<tr class="memdesc:a054ac5a2eacb043709217c38c8a17b2e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Checks whether the immediate messaging mechism is needed or not.  <br /></td></tr>
<tr class="separator:a054ac5a2eacb043709217c38c8a17b2e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae67a719083cf8982cdf9c0283c8779bd"><td class="memItemLeft" align="right" valign="top"><a class="el" href="_basic_types_8h.html#a1cb18096b299d23458d3c7b85fd86555">BOOLEAN</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="hprdbgkd_2header_2debugger_2kernel-level_2kd_8h.html#ae67a719083cf8982cdf9c0283c8779bd">KdResponsePacketToDebugger</a> (_In_ _Strict_type_match_ <a class="el" href="_connection_8h.html#a4924566aaf12e93c1e2a037d12bc32fe">DEBUGGER_REMOTE_PACKET_TYPE</a> PacketType, _In_ _Strict_type_match_ <a class="el" href="_connection_8h.html#a4c14c05a1e67ce2b3fcf780d0e622424">DEBUGGER_REMOTE_PACKET_REQUESTED_ACTION</a> Response, _In_reads_bytes_opt_(OptionalBufferLength) <a class="el" href="_basic_types_8h.html#aebb9e13210d88d43e32e735ada43a425">CHAR</a> *OptionalBuffer, _In_ <a class="el" href="_basic_types_8h.html#ae1e6edbbc26d6fbc71a90190d0266018">UINT32</a> OptionalBufferLength)</td></tr>
<tr class="separator:ae67a719083cf8982cdf9c0283c8779bd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a23ed778c716160ee79236f62556b41c7"><td class="memItemLeft" align="right" valign="top"><a class="el" href="_basic_types_8h.html#a1cb18096b299d23458d3c7b85fd86555">BOOLEAN</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="hprdbgkd_2header_2debugger_2kernel-level_2kd_8h.html#a23ed778c716160ee79236f62556b41c7">KdLoggingResponsePacketToDebugger</a> (_In_reads_bytes_opt_(OptionalBufferLength) <a class="el" href="_basic_types_8h.html#aebb9e13210d88d43e32e735ada43a425">CHAR</a> *OptionalBuffer, _In_ <a class="el" href="_basic_types_8h.html#ae1e6edbbc26d6fbc71a90190d0266018">UINT32</a> OptionalBufferLength, _In_ <a class="el" href="_basic_types_8h.html#ae1e6edbbc26d6fbc71a90190d0266018">UINT32</a> OperationCode)</td></tr>
<tr class="separator:a23ed778c716160ee79236f62556b41c7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a741a955565e9e421cb67d11ccd51b0d4"><td class="memItemLeft" align="right" valign="top"><a class="el" href="_basic_types_8h.html#a1cb18096b299d23458d3c7b85fd86555">BOOLEAN</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="hprdbgkd_2header_2debugger_2kernel-level_2kd_8h.html#a741a955565e9e421cb67d11ccd51b0d4">KdCheckGuestOperatingModeChanges</a> (<a class="el" href="_basic_types_8h.html#a09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> PreviousCsSelector, <a class="el" href="_basic_types_8h.html#a09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> CurrentCsSelector)</td></tr>
<tr class="memdesc:a741a955565e9e421cb67d11ccd51b0d4"><td class="mdescLeft">&#160;</td><td class="mdescRight">Check if the execution mode (kernel-mode to user-mode or user-mode to kernel-mode) changed.  <br /></td></tr>
<tr class="separator:a741a955565e9e421cb67d11ccd51b0d4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a814437795a9e923d352b848630625a56"><td class="memItemLeft" align="right" valign="top"><a class="el" href="_basic_types_8h.html#a1cb18096b299d23458d3c7b85fd86555">BOOLEAN</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="hprdbgkd_2header_2debugger_2kernel-level_2kd_8h.html#a814437795a9e923d352b848630625a56">KdIsGuestOnUsermode32Bit</a> ()</td></tr>
<tr class="memdesc:a814437795a9e923d352b848630625a56"><td class="mdescLeft">&#160;</td><td class="mdescRight">determines if the guest was in 32-bit user-mode or 64-bit (long mode)  <br /></td></tr>
<tr class="separator:a814437795a9e923d352b848630625a56"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab7d47bab2ada4c9c4f1f5cfbd2e0852f"><td class="memItemLeft" align="right" valign="top"><a class="el" href="_basic_types_8h.html#a7f319bfc2492a2136964194204e7a8cf">VOID</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="hprdbgkd_2header_2debugger_2kernel-level_2kd_8h.html#ab7d47bab2ada4c9c4f1f5cfbd2e0852f">KdHandleNmiBroadcastDebugBreaks</a> (<a class="el" href="_basic_types_8h.html#ae1e6edbbc26d6fbc71a90190d0266018">UINT32</a> CoreId, <a class="el" href="_basic_types_8h.html#a1cb18096b299d23458d3c7b85fd86555">BOOLEAN</a> IsOnVmxNmiHandler)</td></tr>
<tr class="memdesc:ab7d47bab2ada4c9c4f1f5cfbd2e0852f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Handle broadcast NMIs for halting cores in vmx-root mode.  <br /></td></tr>
<tr class="separator:ab7d47bab2ada4c9c4f1f5cfbd2e0852f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acc12878954fd8a1118d83f2cfe08052f"><td class="memItemLeft" align="right" valign="top"><a class="el" href="_basic_types_8h.html#a1cb18096b299d23458d3c7b85fd86555">BOOLEAN</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="hprdbgkd_2header_2debugger_2kernel-level_2kd_8h.html#acc12878954fd8a1118d83f2cfe08052f">KdQueryDebuggerQueryThreadOrProcessTracingDetailsByCoreId</a> (<a class="el" href="_basic_types_8h.html#ae1e6edbbc26d6fbc71a90190d0266018">UINT32</a> CoreId, <a class="el" href="_data_types_8h.html#ad6e74aca70f1102548c8fbe12b407384">DEBUGGER_THREAD_PROCESS_TRACING</a> TracingType)</td></tr>
<tr class="memdesc:acc12878954fd8a1118d83f2cfe08052f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Query for process/thread interception status.  <br /></td></tr>
<tr class="separator:acc12878954fd8a1118d83f2cfe08052f"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="var-members" name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:ac9e9a8a58602b96c760514fbe7a268d4"><td class="memItemLeft" align="right" valign="top">volatile LONG&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="hprdbgkd_2header_2debugger_2kernel-level_2kd_8h.html#ac9e9a8a58602b96c760514fbe7a268d4">DebuggerResponseLock</a></td></tr>
<tr class="memdesc:ac9e9a8a58602b96c760514fbe7a268d4"><td class="mdescLeft">&#160;</td><td class="mdescRight">Vmx-root lock for sending response of debugger.  <br /></td></tr>
<tr class="separator:ac9e9a8a58602b96c760514fbe7a268d4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa8f0690057ff0d1c6f2f42dbbdb3ee96"><td class="memItemLeft" align="right" valign="top">volatile LONG&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="hprdbgkd_2header_2debugger_2kernel-level_2kd_8h.html#aa8f0690057ff0d1c6f2f42dbbdb3ee96">DebuggerHandleBreakpointLock</a></td></tr>
<tr class="memdesc:aa8f0690057ff0d1c6f2f42dbbdb3ee96"><td class="mdescLeft">&#160;</td><td class="mdescRight">Vmx-root lock for handling breaks to debugger.  <br /></td></tr>
<tr class="separator:aa8f0690057ff0d1c6f2f42dbbdb3ee96"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Header for routines related to kernel mode debugging. </p>
<dl class="section author"><dt>Author</dt><dd>Sina Karvandi (<a href="#" onclick="location.href='mai'+'lto:'+'sin'+'a@'+'hyp'+'er'+'dbg'+'.o'+'rg'; return false;">sina@<span class="obfuscator">.nosp@m.</span>hype<span class="obfuscator">.nosp@m.</span>rdbg.<span class="obfuscator">.nosp@m.</span>org</a>)</dd></dl>
<dl class="section version"><dt>Version</dt><dd>0.1 </dd></dl>
<dl class="section date"><dt>Date</dt><dd>2020-12-20</dd></dl>
<dl class="section copyright"><dt>Copyright</dt><dd>This project is released under the GNU Public License v3. </dd></dl>
</div><h2 class="groupheader">Typedef Documentation</h2>
<a id="a1ad4ae8cc604353c84f45d060c15e641" name="a1ad4ae8cc604353c84f45d060c15e641"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1ad4ae8cc604353c84f45d060c15e641">&#9670;&#160;</a></span>DEBUGGEE_REQUEST_TO_CHANGE_PROCESS</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef struct <a class="el" href="struct___d_e_b_u_g_g_e_e___r_e_q_u_e_s_t___t_o___c_h_a_n_g_e___p_r_o_c_e_s_s.html">_DEBUGGEE_REQUEST_TO_CHANGE_PROCESS</a> <a class="el" href="hprdbgkd_2header_2debugger_2kernel-level_2kd_8h.html#a1ad4ae8cc604353c84f45d060c15e641">DEBUGGEE_REQUEST_TO_CHANGE_PROCESS</a></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>request to change the process </p>

</div>
</div>
<a id="a5fd44542909b860301b2b95fbfbca8ea" name="a5fd44542909b860301b2b95fbfbca8ea"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5fd44542909b860301b2b95fbfbca8ea">&#9670;&#160;</a></span>DEBUGGEE_REQUEST_TO_CHANGE_THREAD</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef struct <a class="el" href="struct___d_e_b_u_g_g_e_e___r_e_q_u_e_s_t___t_o___c_h_a_n_g_e___t_h_r_e_a_d.html">_DEBUGGEE_REQUEST_TO_CHANGE_THREAD</a> <a class="el" href="hprdbgkd_2header_2debugger_2kernel-level_2kd_8h.html#a5fd44542909b860301b2b95fbfbca8ea">DEBUGGEE_REQUEST_TO_CHANGE_THREAD</a></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>request to change the thread </p>

</div>
</div>
<a id="aedf0b19343dd23c43662c511b9ef14f3" name="aedf0b19343dd23c43662c511b9ef14f3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aedf0b19343dd23c43662c511b9ef14f3">&#9670;&#160;</a></span>DEBUGGEE_REQUEST_TO_IGNORE_BREAKS_UNTIL_AN_EVENT</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef struct <a class="el" href="struct___d_e_b_u_g_g_e_e___r_e_q_u_e_s_t___t_o___i_g_n_o_r_e___b_r_e_a_k_s___u_n_t_i_l___a_n___e_v_e_n_t.html">_DEBUGGEE_REQUEST_TO_IGNORE_BREAKS_UNTIL_AN_EVENT</a> <a class="el" href="hprdbgkd_2header_2debugger_2kernel-level_2kd_8h.html#aedf0b19343dd23c43662c511b9ef14f3">DEBUGGEE_REQUEST_TO_IGNORE_BREAKS_UNTIL_AN_EVENT</a></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>request to pause and halt the system </p>

</div>
</div>
<a id="a2caac9dcb648b3b97f9b1bc150ffa078" name="a2caac9dcb648b3b97f9b1bc150ffa078"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2caac9dcb648b3b97f9b1bc150ffa078">&#9670;&#160;</a></span>HARDWARE_DEBUG_REGISTER_DETAILS</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef struct <a class="el" href="struct___h_a_r_d_w_a_r_e___d_e_b_u_g___r_e_g_i_s_t_e_r___d_e_t_a_i_l_s.html">_HARDWARE_DEBUG_REGISTER_DETAILS</a> <a class="el" href="hprdbgkd_2header_2debugger_2kernel-level_2kd_8h.html#a2caac9dcb648b3b97f9b1bc150ffa078">HARDWARE_DEBUG_REGISTER_DETAILS</a></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>store the details of a hardware debug register to ignore any trigger for other threads </p>

</div>
</div>
<a id="a75462fddb22aeb284e09a0465e8e6929" name="a75462fddb22aeb284e09a0465e8e6929"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a75462fddb22aeb284e09a0465e8e6929">&#9670;&#160;</a></span>PDEBUGGEE_REQUEST_TO_CHANGE_PROCESS</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef struct <a class="el" href="struct___d_e_b_u_g_g_e_e___r_e_q_u_e_s_t___t_o___c_h_a_n_g_e___p_r_o_c_e_s_s.html">_DEBUGGEE_REQUEST_TO_CHANGE_PROCESS</a> * <a class="el" href="hprdbgkd_2header_2debugger_2kernel-level_2kd_8h.html#a75462fddb22aeb284e09a0465e8e6929">PDEBUGGEE_REQUEST_TO_CHANGE_PROCESS</a></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="acd076187998184fbf980d03949ad4eb9" name="acd076187998184fbf980d03949ad4eb9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#acd076187998184fbf980d03949ad4eb9">&#9670;&#160;</a></span>PDEBUGGEE_REQUEST_TO_CHANGE_THREAD</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef struct <a class="el" href="struct___d_e_b_u_g_g_e_e___r_e_q_u_e_s_t___t_o___c_h_a_n_g_e___t_h_r_e_a_d.html">_DEBUGGEE_REQUEST_TO_CHANGE_THREAD</a> * <a class="el" href="hprdbgkd_2header_2debugger_2kernel-level_2kd_8h.html#acd076187998184fbf980d03949ad4eb9">PDEBUGGEE_REQUEST_TO_CHANGE_THREAD</a></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a2cf4b7231fd2b6d0250c9ffc8cacdc0c" name="a2cf4b7231fd2b6d0250c9ffc8cacdc0c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2cf4b7231fd2b6d0250c9ffc8cacdc0c">&#9670;&#160;</a></span>PDEBUGGEE_REQUEST_TO_IGNORE_BREAKS_UNTIL_AN_EVENT</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef struct <a class="el" href="struct___d_e_b_u_g_g_e_e___r_e_q_u_e_s_t___t_o___i_g_n_o_r_e___b_r_e_a_k_s___u_n_t_i_l___a_n___e_v_e_n_t.html">_DEBUGGEE_REQUEST_TO_IGNORE_BREAKS_UNTIL_AN_EVENT</a> * <a class="el" href="hprdbgkd_2header_2debugger_2kernel-level_2kd_8h.html#a2cf4b7231fd2b6d0250c9ffc8cacdc0c">PDEBUGGEE_REQUEST_TO_IGNORE_BREAKS_UNTIL_AN_EVENT</a></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="ac138c71071baa0775fc179a9b25eb114" name="ac138c71071baa0775fc179a9b25eb114"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac138c71071baa0775fc179a9b25eb114">&#9670;&#160;</a></span>PHARDWARE_DEBUG_REGISTER_DETAILS</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef struct <a class="el" href="struct___h_a_r_d_w_a_r_e___d_e_b_u_g___r_e_g_i_s_t_e_r___d_e_t_a_i_l_s.html">_HARDWARE_DEBUG_REGISTER_DETAILS</a> * <a class="el" href="hprdbgkd_2header_2debugger_2kernel-level_2kd_8h.html#ac138c71071baa0775fc179a9b25eb114">PHARDWARE_DEBUG_REGISTER_DETAILS</a></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="a874c5a260b2ad0704e92c2b68b6a97af" name="a874c5a260b2ad0704e92c2b68b6a97af"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a874c5a260b2ad0704e92c2b68b6a97af">&#9670;&#160;</a></span>KdCheckAndHandleNmiCallback()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="_basic_types_8h.html#a1cb18096b299d23458d3c7b85fd86555">BOOLEAN</a> KdCheckAndHandleNmiCallback </td>
          <td>(</td>
          <td class="paramtype">_In_ <a class="el" href="_basic_types_8h.html#ae1e6edbbc26d6fbc71a90190d0266018">UINT32</a>&#160;</td>
          <td class="paramname"><em>CoreId</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a741a955565e9e421cb67d11ccd51b0d4" name="a741a955565e9e421cb67d11ccd51b0d4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a741a955565e9e421cb67d11ccd51b0d4">&#9670;&#160;</a></span>KdCheckGuestOperatingModeChanges()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="_basic_types_8h.html#a1cb18096b299d23458d3c7b85fd86555">BOOLEAN</a> KdCheckGuestOperatingModeChanges </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="_basic_types_8h.html#a09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a>&#160;</td>
          <td class="paramname"><em>PreviousCsSelector</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="_basic_types_8h.html#a09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a>&#160;</td>
          <td class="paramname"><em>CurrentCsSelector</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Check if the execution mode (kernel-mode to user-mode or user-mode to kernel-mode) changed. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">PreviousCsSelector</td><td></td></tr>
    <tr><td class="paramname">CurrentCsSelector</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>BOOLEAN </dd></dl>
<div class="fragment"><div class="line"><span class="lineno"> 1380</span>{</div>
<div class="line"><span class="lineno"> 1381</span>    PreviousCsSelector = PreviousCsSelector &amp; ~3;</div>
<div class="line"><span class="lineno"> 1382</span>    CurrentCsSelector  = CurrentCsSelector &amp; ~3;</div>
<div class="line"><span class="lineno"> 1383</span> </div>
<div class="line"><span class="lineno"> 1384</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1385</span>    <span class="comment">// Check if the execution modes are the same or not</span></div>
<div class="line"><span class="lineno"> 1386</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1387</span>    <span class="keywordflow">if</span> (PreviousCsSelector == CurrentCsSelector)</div>
<div class="line"><span class="lineno"> 1388</span>    {</div>
<div class="line"><span class="lineno"> 1389</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1390</span>        <span class="comment">// Execution modes are not changed</span></div>
<div class="line"><span class="lineno"> 1391</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1392</span>        <span class="keywordflow">return</span> <a class="code hl_define" href="_basic_types_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div>
<div class="line"><span class="lineno"> 1393</span>    }</div>
<div class="line"><span class="lineno"> 1394</span> </div>
<div class="line"><span class="lineno"> 1395</span>    <span class="keywordflow">if</span> ((PreviousCsSelector == <a class="code hl_define" href="hprdbghv_2header_2common_2common_8h.html#a3566c0de563735de786e1052440226a1">KGDT64_R3_CODE</a> || PreviousCsSelector == <a class="code hl_define" href="hprdbghv_2header_2common_2common_8h.html#a8b6aab65ae2c0a4e02ac1069d4ac46ad">KGDT64_R3_CMCODE</a>) &amp;&amp; CurrentCsSelector == <a class="code hl_define" href="hprdbghv_2header_2common_2common_8h.html#a5bc1b920e0b1b8a1b35327b5f89ab6ac">KGDT64_R0_CODE</a>)</div>
<div class="line"><span class="lineno"> 1396</span>    {</div>
<div class="line"><span class="lineno"> 1397</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1398</span>        <span class="comment">// User-mode -&gt; Kernel-mode</span></div>
<div class="line"><span class="lineno"> 1399</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1400</span>        <a class="code hl_define" href="_hyper_dbg_hyper_log_intrinsics_8h.html#a97b0adbd65790fb90734daa8e5245a04">LogInfo</a>(<span class="stringliteral">&quot;User-mode -&gt; Kernel-mode\n&quot;</span>);</div>
<div class="line"><span class="lineno"> 1401</span>    }</div>
<div class="line"><span class="lineno"> 1402</span>    <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((CurrentCsSelector == <a class="code hl_define" href="hprdbghv_2header_2common_2common_8h.html#a3566c0de563735de786e1052440226a1">KGDT64_R3_CODE</a> || CurrentCsSelector == <a class="code hl_define" href="hprdbghv_2header_2common_2common_8h.html#a8b6aab65ae2c0a4e02ac1069d4ac46ad">KGDT64_R3_CMCODE</a>) &amp;&amp; PreviousCsSelector == <a class="code hl_define" href="hprdbghv_2header_2common_2common_8h.html#a5bc1b920e0b1b8a1b35327b5f89ab6ac">KGDT64_R0_CODE</a>)</div>
<div class="line"><span class="lineno"> 1403</span>    {</div>
<div class="line"><span class="lineno"> 1404</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1405</span>        <span class="comment">// Kernel-mode to user-mode</span></div>
<div class="line"><span class="lineno"> 1406</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1407</span>        <a class="code hl_define" href="_hyper_dbg_hyper_log_intrinsics_8h.html#a97b0adbd65790fb90734daa8e5245a04">LogInfo</a>(<span class="stringliteral">&quot;Kernel-mode -&gt; User-mode\n&quot;</span>);</div>
<div class="line"><span class="lineno"> 1408</span>    }</div>
<div class="line"><span class="lineno"> 1409</span>    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (CurrentCsSelector == <a class="code hl_define" href="hprdbghv_2header_2common_2common_8h.html#a3566c0de563735de786e1052440226a1">KGDT64_R3_CODE</a> &amp;&amp; PreviousCsSelector == <a class="code hl_define" href="hprdbghv_2header_2common_2common_8h.html#a8b6aab65ae2c0a4e02ac1069d4ac46ad">KGDT64_R3_CMCODE</a>)</div>
<div class="line"><span class="lineno"> 1410</span>    {</div>
<div class="line"><span class="lineno"> 1411</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1412</span>        <span class="comment">// A heaven&#39;s gate (User-mode 32-bit code -&gt; User-mode 64-bit code)</span></div>
<div class="line"><span class="lineno"> 1413</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1414</span>        <a class="code hl_define" href="_hyper_dbg_hyper_log_intrinsics_8h.html#a97b0adbd65790fb90734daa8e5245a04">LogInfo</a>(<span class="stringliteral">&quot;32-bit User-mode -&gt; 64-bit User-mode (Heaven&#39;s gate)\n&quot;</span>);</div>
<div class="line"><span class="lineno"> 1415</span>    }</div>
<div class="line"><span class="lineno"> 1416</span>    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (PreviousCsSelector == <a class="code hl_define" href="hprdbghv_2header_2common_2common_8h.html#a3566c0de563735de786e1052440226a1">KGDT64_R3_CODE</a> &amp;&amp; CurrentCsSelector == <a class="code hl_define" href="hprdbghv_2header_2common_2common_8h.html#a8b6aab65ae2c0a4e02ac1069d4ac46ad">KGDT64_R3_CMCODE</a>)</div>
<div class="line"><span class="lineno"> 1417</span>    {</div>
<div class="line"><span class="lineno"> 1418</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1419</span>        <span class="comment">// A heaven&#39;s gate (User-mode 64-bit code -&gt; User-mode 32-bit code)</span></div>
<div class="line"><span class="lineno"> 1420</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1421</span>        <a class="code hl_define" href="_hyper_dbg_hyper_log_intrinsics_8h.html#a97b0adbd65790fb90734daa8e5245a04">LogInfo</a>(<span class="stringliteral">&quot;64-bit User-mode -&gt; 32-bit User-mode (Return from Heaven&#39;s gate)\n&quot;</span>);</div>
<div class="line"><span class="lineno"> 1422</span>    }</div>
<div class="line"><span class="lineno"> 1423</span>    <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno"> 1424</span>    {</div>
<div class="line"><span class="lineno"> 1425</span>        <a class="code hl_define" href="_hyper_dbg_hyper_log_intrinsics_8h.html#a459b19922fecfbb9438dd56b66930d16">LogError</a>(<span class="stringliteral">&quot;Err, unknown changes in cs selector during the instrumentation step-in\n&quot;</span>);</div>
<div class="line"><span class="lineno"> 1426</span>    }</div>
<div class="line"><span class="lineno"> 1427</span> </div>
<div class="line"><span class="lineno"> 1428</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1429</span>    <span class="comment">// Execution modes are changed</span></div>
<div class="line"><span class="lineno"> 1430</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1431</span>    <span class="keywordflow">return</span> <a class="code hl_define" href="_basic_types_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;</div>
<div class="line"><span class="lineno"> 1432</span>}</div>
<div class="ttc" id="a_basic_types_8h_html_aa8cecfc5c5c054d2875c03e77b7be15d"><div class="ttname"><a href="_basic_types_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a></div><div class="ttdeci">#define TRUE</div><div class="ttdef"><b>Definition</b> BasicTypes.h:50</div></div>
<div class="ttc" id="a_basic_types_8h_html_aa93f0eb578d23995850d61f7d61c55c1"><div class="ttname"><a href="_basic_types_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a></div><div class="ttdeci">#define FALSE</div><div class="ttdef"><b>Definition</b> BasicTypes.h:49</div></div>
<div class="ttc" id="a_hyper_dbg_hyper_log_intrinsics_8h_html_a459b19922fecfbb9438dd56b66930d16"><div class="ttname"><a href="_hyper_dbg_hyper_log_intrinsics_8h.html#a459b19922fecfbb9438dd56b66930d16">LogError</a></div><div class="ttdeci">#define LogError(format,...)</div><div class="ttdoc">Log in the case of error.</div><div class="ttdef"><b>Definition</b> HyperDbgHyperLogIntrinsics.h:113</div></div>
<div class="ttc" id="a_hyper_dbg_hyper_log_intrinsics_8h_html_a97b0adbd65790fb90734daa8e5245a04"><div class="ttname"><a href="_hyper_dbg_hyper_log_intrinsics_8h.html#a97b0adbd65790fb90734daa8e5245a04">LogInfo</a></div><div class="ttdeci">#define LogInfo(format,...)</div><div class="ttdoc">Define log variables.</div><div class="ttdef"><b>Definition</b> HyperDbgHyperLogIntrinsics.h:71</div></div>
<div class="ttc" id="ahprdbghv_2header_2common_2common_8h_html_a3566c0de563735de786e1052440226a1"><div class="ttname"><a href="hprdbghv_2header_2common_2common_8h.html#a3566c0de563735de786e1052440226a1">KGDT64_R3_CODE</a></div><div class="ttdeci">#define KGDT64_R3_CODE</div><div class="ttdef"><b>Definition</b> Common.h:127</div></div>
<div class="ttc" id="ahprdbghv_2header_2common_2common_8h_html_a5bc1b920e0b1b8a1b35327b5f89ab6ac"><div class="ttname"><a href="hprdbghv_2header_2common_2common_8h.html#a5bc1b920e0b1b8a1b35327b5f89ab6ac">KGDT64_R0_CODE</a></div><div class="ttdeci">#define KGDT64_R0_CODE</div><div class="ttdef"><b>Definition</b> Common.h:123</div></div>
<div class="ttc" id="ahprdbghv_2header_2common_2common_8h_html_a8b6aab65ae2c0a4e02ac1069d4ac46ad"><div class="ttname"><a href="hprdbghv_2header_2common_2common_8h.html#a8b6aab65ae2c0a4e02ac1069d4ac46ad">KGDT64_R3_CMCODE</a></div><div class="ttdeci">#define KGDT64_R3_CMCODE</div><div class="ttdef"><b>Definition</b> Common.h:125</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a054ac5a2eacb043709217c38c8a17b2e" name="a054ac5a2eacb043709217c38c8a17b2e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a054ac5a2eacb043709217c38c8a17b2e">&#9670;&#160;</a></span>KdCheckImmediateMessagingMechanism()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="_basic_types_8h.html#a1cb18096b299d23458d3c7b85fd86555">BOOLEAN</a> KdCheckImmediateMessagingMechanism </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="_basic_types_8h.html#ae1e6edbbc26d6fbc71a90190d0266018">UINT32</a>&#160;</td>
          <td class="paramname"><em>OperationCode</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Checks whether the immediate messaging mechism is needed or not. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">OperationCode</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>BOOLEAN </dd></dl>
<div class="fragment"><div class="line"><span class="lineno">  119</span>{</div>
<div class="line"><span class="lineno">  120</span>    <span class="keywordflow">return</span> (<a class="code hl_variable" href="hprdbgkd_2header_2globals_2_global_8h.html#ae4b5afa957e3e26377135b91b60eda4e">g_KernelDebuggerState</a> &amp;&amp; !(OperationCode &amp; <a class="code hl_define" href="_constants_8h.html#a7337b6a99c8d8f595d658a4c59cf3bb0">OPERATION_MANDATORY_DEBUGGEE_BIT</a>));</div>
<div class="line"><span class="lineno">  121</span>}</div>
<div class="ttc" id="a_constants_8h_html_a7337b6a99c8d8f595d658a4c59cf3bb0"><div class="ttname"><a href="_constants_8h.html#a7337b6a99c8d8f595d658a4c59cf3bb0">OPERATION_MANDATORY_DEBUGGEE_BIT</a></div><div class="ttdeci">#define OPERATION_MANDATORY_DEBUGGEE_BIT</div><div class="ttdoc">If a operation use this bit in its Operation code, then it means that the operation should be perform...</div><div class="ttdef"><b>Definition</b> Constants.h:329</div></div>
<div class="ttc" id="ahprdbgkd_2header_2globals_2_global_8h_html_ae4b5afa957e3e26377135b91b60eda4e"><div class="ttname"><a href="hprdbgkd_2header_2globals_2_global_8h.html#ae4b5afa957e3e26377135b91b60eda4e">g_KernelDebuggerState</a></div><div class="ttdeci">BOOLEAN g_KernelDebuggerState</div><div class="ttdoc">shows whether the kernel debugger is enabled or disabled</div><div class="ttdef"><b>Definition</b> Global.h:103</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ac7a7e5c80ccd8650a1b4e6c9e9193845" name="ac7a7e5c80ccd8650a1b4e6c9e9193845"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac7a7e5c80ccd8650a1b4e6c9e9193845">&#9670;&#160;</a></span>KdHaltSystem()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="_basic_types_8h.html#a7f319bfc2492a2136964194204e7a8cf">VOID</a> KdHaltSystem </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="_data_types_8h.html#a76ef165d19b9e825f9bced11160f1049">PDEBUGGER_PAUSE_PACKET_RECEIVED</a>&#160;</td>
          <td class="paramname"><em>PausePacket</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Halt the system. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">PausePacket</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>VOID </dd></dl>
<div class="fragment"><div class="line"><span class="lineno"> 2900</span>{</div>
<div class="line"><span class="lineno"> 2901</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 2902</span>    <span class="comment">// Broadcast to halt everything</span></div>
<div class="line"><span class="lineno"> 2903</span>    <span class="comment">// Instead of broadcasting we will just send one vmcall and</span></div>
<div class="line"><span class="lineno"> 2904</span>    <span class="comment">// from that point, we halt all the other cores by NMIs, this</span></div>
<div class="line"><span class="lineno"> 2905</span>    <span class="comment">// way we are sure that we get all the other cores at the middle</span></div>
<div class="line"><span class="lineno"> 2906</span>    <span class="comment">// of their execution codes and not on HyperDbg routines</span></div>
<div class="line"><span class="lineno"> 2907</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 2908</span>    <span class="comment">// KdBroadcastHaltOnAllCores();</span></div>
<div class="line"><span class="lineno"> 2909</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 2910</span> </div>
<div class="line"><span class="lineno"> 2911</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 2912</span>    <span class="comment">// vm-exit and halt current core</span></div>
<div class="line"><span class="lineno"> 2913</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 2914</span>    <a class="code hl_function" href="_export_8c.html#af16fd54ae187e7da12defa57d45568ba">VmFuncVmxVmcall</a>(<a class="code hl_define" href="_debugger_vmcalls_8h.html#a995b2bb03835e5c569e4ea3fca385d9a">DEBUGGER_VMCALL_VM_EXIT_HALT_SYSTEM</a>, 0, 0, 0);</div>
<div class="line"><span class="lineno"> 2915</span> </div>
<div class="line"><span class="lineno"> 2916</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 2917</span>    <span class="comment">// Set the status</span></div>
<div class="line"><span class="lineno"> 2918</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 2919</span>    PausePacket-&gt;<a class="code hl_variable" href="struct___d_e_b_u_g_g_e_r___p_a_u_s_e___p_a_c_k_e_t___r_e_c_e_i_v_e_d.html#a2982924464dbc80791d36cd9b1097063">Result</a> = <a class="code hl_define" href="_error_codes_8h.html#aed656c58434eecb2d7e8c10e93aecff4">DEBUGGER_OPERATION_WAS_SUCCESSFUL</a>;</div>
<div class="line"><span class="lineno"> 2920</span>}</div>
<div class="ttc" id="a_debugger_vmcalls_8h_html_a995b2bb03835e5c569e4ea3fca385d9a"><div class="ttname"><a href="_debugger_vmcalls_8h.html#a995b2bb03835e5c569e4ea3fca385d9a">DEBUGGER_VMCALL_VM_EXIT_HALT_SYSTEM</a></div><div class="ttdeci">#define DEBUGGER_VMCALL_VM_EXIT_HALT_SYSTEM</div><div class="ttdoc">VMCALL to cause vm-exit and halt the system.</div><div class="ttdef"><b>Definition</b> DebuggerVmcalls.h:22</div></div>
<div class="ttc" id="a_error_codes_8h_html_aed656c58434eecb2d7e8c10e93aecff4"><div class="ttname"><a href="_error_codes_8h.html#aed656c58434eecb2d7e8c10e93aecff4">DEBUGGER_OPERATION_WAS_SUCCESSFUL</a></div><div class="ttdeci">#define DEBUGGER_OPERATION_WAS_SUCCESSFUL</div><div class="ttdoc">General value to indicate that the operation or request was successful.</div><div class="ttdef"><b>Definition</b> ErrorCodes.h:23</div></div>
<div class="ttc" id="a_export_8c_html_af16fd54ae187e7da12defa57d45568ba"><div class="ttname"><a href="_export_8c.html#af16fd54ae187e7da12defa57d45568ba">VmFuncVmxVmcall</a></div><div class="ttdeci">NTSTATUS VmFuncVmxVmcall(unsigned long long VmcallNumber, unsigned long long OptionalParam1, unsigned long long OptionalParam2, long long OptionalParam3)</div><div class="ttdoc">Export for running VMX VMCALLs.</div><div class="ttdef"><b>Definition</b> Export.c:629</div></div>
<div class="ttc" id="astruct___d_e_b_u_g_g_e_r___p_a_u_s_e___p_a_c_k_e_t___r_e_c_e_i_v_e_d_html_a2982924464dbc80791d36cd9b1097063"><div class="ttname"><a href="struct___d_e_b_u_g_g_e_r___p_a_u_s_e___p_a_c_k_e_t___r_e_c_e_i_v_e_d.html#a2982924464dbc80791d36cd9b1097063">_DEBUGGER_PAUSE_PACKET_RECEIVED::Result</a></div><div class="ttdeci">UINT32 Result</div><div class="ttdef"><b>Definition</b> DataTypes.h:145</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="aed037f4430a6dec6d52f38a799394e7e" name="aed037f4430a6dec6d52f38a799394e7e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aed037f4430a6dec6d52f38a799394e7e">&#9670;&#160;</a></span>KdHandleBreakpointAndDebugBreakpoints()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="_basic_types_8h.html#a7f319bfc2492a2136964194204e7a8cf">VOID</a> KdHandleBreakpointAndDebugBreakpoints </td>
          <td>(</td>
          <td class="paramtype">_Inout_ <a class="el" href="hprdbgkd_2header_2debugger_2core_2_state_8h.html#aa35afece6adc9a29a7bf7a2e76476037">PROCESSOR_DEBUGGING_STATE</a> *&#160;</td>
          <td class="paramname"><em>DbgState</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">_In_ <a class="el" href="_connection_8h.html#ac834b5b60f3a3213636632ea482a26a3">DEBUGGEE_PAUSING_REASON</a>&#160;</td>
          <td class="paramname"><em>Reason</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="_basic_types_8h.html#ad502772c412e6f5dd67d557fdc3a4322">PDEBUGGER_TRIGGERED_EVENT_DETAILS</a>&#160;</td>
          <td class="paramname"><em>EventDetails</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a66ae5d7ad1daa1d2516238d1f6f8d96d" name="a66ae5d7ad1daa1d2516238d1f6f8d96d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a66ae5d7ad1daa1d2516238d1f6f8d96d">&#9670;&#160;</a></span>KdHandleBreakpointAndDebugBreakpointsCallback()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="_basic_types_8h.html#a7f319bfc2492a2136964194204e7a8cf">VOID</a> KdHandleBreakpointAndDebugBreakpointsCallback </td>
          <td>(</td>
          <td class="paramtype">_In_ <a class="el" href="_basic_types_8h.html#ae1e6edbbc26d6fbc71a90190d0266018">UINT32</a>&#160;</td>
          <td class="paramname"><em>CoreId</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">_In_ <a class="el" href="_connection_8h.html#ac834b5b60f3a3213636632ea482a26a3">DEBUGGEE_PAUSING_REASON</a>&#160;</td>
          <td class="paramname"><em>Reason</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="_basic_types_8h.html#ad502772c412e6f5dd67d557fdc3a4322">PDEBUGGER_TRIGGERED_EVENT_DETAILS</a>&#160;</td>
          <td class="paramname"><em>EventDetails</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a471c63b8db9a487f132923dcaf13b0cc" name="a471c63b8db9a487f132923dcaf13b0cc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a471c63b8db9a487f132923dcaf13b0cc">&#9670;&#160;</a></span>KdHandleDebugEventsWhenKernelDebuggerIsAttached()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="_basic_types_8h.html#a7f319bfc2492a2136964194204e7a8cf">VOID</a> KdHandleDebugEventsWhenKernelDebuggerIsAttached </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="hprdbgkd_2header_2debugger_2core_2_state_8h.html#aa35afece6adc9a29a7bf7a2e76476037">PROCESSOR_DEBUGGING_STATE</a> *&#160;</td>
          <td class="paramname"><em>DbgState</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Handles debug events when kernel-debugger is attached. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">DbgState</td><td>The state of the debugger on the current core</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>VOID </dd></dl>
<div class="fragment"><div class="line"><span class="lineno">  374</span>{</div>
<div class="line"><span class="lineno">  375</span>    <a class="code hl_struct" href="struct___d_e_b_u_g_g_e_r___t_r_i_g_g_e_r_e_d___e_v_e_n_t___d_e_t_a_i_l_s.html">DEBUGGER_TRIGGERED_EVENT_DETAILS</a> ContextAndTag    = {0};</div>
<div class="line"><span class="lineno">  376</span>    <a class="code hl_typedef" href="_basic_types_8h.html#a1cb18096b299d23458d3c7b85fd86555">BOOLEAN</a>                          IgnoreDebugEvent = <a class="code hl_define" href="_basic_types_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div>
<div class="line"><span class="lineno">  377</span>    <a class="code hl_typedef" href="_basic_types_8h.html#aae17ebb9ef7279d026817fb22f8aebe9">UINT64</a>                           LastVmexitRip    = <a class="code hl_function" href="_export_8c.html#ab49740d6ce5d1c5f90828b66496dcb4c">VmFuncGetLastVmexitRip</a>(DbgState-&gt;<a class="code hl_variable" href="struct___p_r_o_c_e_s_s_o_r___d_e_b_u_g_g_i_n_g___s_t_a_t_e.html#a090832a74d330cde891a17bdd5b236e3">CoreId</a>);</div>
<div class="line"><span class="lineno">  378</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">  379</span>    <span class="comment">// It&#39;s a breakpoint and should be handled by the kernel debugger</span></div>
<div class="line"><span class="lineno">  380</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">  381</span>    ContextAndTag.<a class="code hl_variable" href="struct___d_e_b_u_g_g_e_r___t_r_i_g_g_e_r_e_d___e_v_e_n_t___d_e_t_a_i_l_s.html#aed232a35a0d0d95aa4ca77dc50fc6fae">Context</a> = LastVmexitRip;</div>
<div class="line"><span class="lineno">  382</span> </div>
<div class="line"><span class="lineno">  383</span>    <span class="keywordflow">if</span> (DbgState-&gt;<a class="code hl_variable" href="struct___p_r_o_c_e_s_s_o_r___d_e_b_u_g_g_i_n_g___s_t_a_t_e.html#a5e86d5aa3e12b7bbfd3b021262959a7a">WaitForStepTrap</a>)</div>
<div class="line"><span class="lineno">  384</span>    {</div>
<div class="line"><span class="lineno">  385</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno">  386</span>        <span class="comment">// *** Handle a regular step ***</span></div>
<div class="line"><span class="lineno">  387</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno">  388</span> </div>
<div class="line"><span class="lineno">  389</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno">  390</span>        <span class="comment">// Unset to show that we&#39;re no longer looking for a trap</span></div>
<div class="line"><span class="lineno">  391</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno">  392</span>        DbgState-&gt;<a class="code hl_variable" href="struct___p_r_o_c_e_s_s_o_r___d_e_b_u_g_g_i_n_g___s_t_a_t_e.html#a5e86d5aa3e12b7bbfd3b021262959a7a">WaitForStepTrap</a> = <a class="code hl_define" href="_basic_types_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div>
<div class="line"><span class="lineno">  393</span> </div>
<div class="line"><span class="lineno">  394</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno">  395</span>        <span class="comment">// Check if we should disable RFLAGS.TF in this core or not</span></div>
<div class="line"><span class="lineno">  396</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno">  397</span>        <span class="keywordflow">if</span> (DbgState-&gt;<a class="code hl_variable" href="struct___p_r_o_c_e_s_s_o_r___d_e_b_u_g_g_i_n_g___s_t_a_t_e.html#abec12156c3d1d4a4a3c76d7cee2ee254">DisableTrapFlagOnContinue</a>)</div>
<div class="line"><span class="lineno">  398</span>        {</div>
<div class="line"><span class="lineno">  399</span>            <a class="code hl_function" href="_export_8c.html#a8f68fa306b093e98466bd4f16cd16035">VmFuncSetRflagTrapFlag</a>(<a class="code hl_define" href="_basic_types_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>);</div>
<div class="line"><span class="lineno">  400</span> </div>
<div class="line"><span class="lineno">  401</span>            DbgState-&gt;<a class="code hl_variable" href="struct___p_r_o_c_e_s_s_o_r___d_e_b_u_g_g_i_n_g___s_t_a_t_e.html#abec12156c3d1d4a4a3c76d7cee2ee254">DisableTrapFlagOnContinue</a> = <a class="code hl_define" href="_basic_types_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div>
<div class="line"><span class="lineno">  402</span>        }</div>
<div class="line"><span class="lineno">  403</span> </div>
<div class="line"><span class="lineno">  404</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno">  405</span>        <span class="comment">// Check and handle if there is a software defined breakpoint</span></div>
<div class="line"><span class="lineno">  406</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno">  407</span>        <span class="keywordflow">if</span> (!<a class="code hl_function" href="_breakpoint_commands_8c.html#af249a8d277f3fe6fdeeb1796e537572b">BreakpointCheckAndHandleDebuggerDefinedBreakpoints</a>(DbgState,</div>
<div class="line"><span class="lineno">  408</span>                                                                LastVmexitRip,</div>
<div class="line"><span class="lineno">  409</span>                                                                <a class="code hl_enumvalue" href="_connection_8h.html#a6e2be89205e735ebae644cf4850ac21ba2e4a9051f91b8dd308c56566d57bbd19">DEBUGGEE_PAUSING_REASON_DEBUGGEE_STEPPED</a>,</div>
<div class="line"><span class="lineno">  410</span>                                                                <a class="code hl_define" href="_basic_types_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>))</div>
<div class="line"><span class="lineno">  411</span>        {</div>
<div class="line"><span class="lineno">  412</span>            <span class="keywordflow">if</span> (<a class="code hl_variable" href="hprdbgkd_2header_2globals_2_global_8h.html#aa18646fd48487bbd6d28a61f575afe4e">g_HardwareDebugRegisterDetailsForStepOver</a>.<a class="code hl_variable" href="struct___h_a_r_d_w_a_r_e___d_e_b_u_g___r_e_g_i_s_t_e_r___d_e_t_a_i_l_s.html#ad6283c78aa0a3e8a33a7629bf71accb9">Address</a> != NULL)</div>
<div class="line"><span class="lineno">  413</span>            {</div>
<div class="line"><span class="lineno">  414</span>                <span class="comment">//</span></div>
<div class="line"><span class="lineno">  415</span>                <span class="comment">// Check if it&#39;s caused by a step-over hardware debug breakpoint or not</span></div>
<div class="line"><span class="lineno">  416</span>                <span class="comment">//</span></div>
<div class="line"><span class="lineno">  417</span>                <span class="keywordflow">if</span> (LastVmexitRip == <a class="code hl_variable" href="hprdbgkd_2header_2globals_2_global_8h.html#aa18646fd48487bbd6d28a61f575afe4e">g_HardwareDebugRegisterDetailsForStepOver</a>.<a class="code hl_variable" href="struct___h_a_r_d_w_a_r_e___d_e_b_u_g___r_e_g_i_s_t_e_r___d_e_t_a_i_l_s.html#ad6283c78aa0a3e8a33a7629bf71accb9">Address</a>)</div>
<div class="line"><span class="lineno">  418</span>                {</div>
<div class="line"><span class="lineno">  419</span>                    <span class="keywordflow">if</span> (<a class="code hl_variable" href="hprdbgkd_2header_2globals_2_global_8h.html#aa18646fd48487bbd6d28a61f575afe4e">g_HardwareDebugRegisterDetailsForStepOver</a>.<a class="code hl_variable" href="struct___h_a_r_d_w_a_r_e___d_e_b_u_g___r_e_g_i_s_t_e_r___d_e_t_a_i_l_s.html#afc21368e7a0be9dc359747ca96b7c17f">ProcessId</a> == PsGetCurrentProcessId() &amp;&amp; <a class="code hl_variable" href="hprdbgkd_2header_2globals_2_global_8h.html#aa18646fd48487bbd6d28a61f575afe4e">g_HardwareDebugRegisterDetailsForStepOver</a>.<a class="code hl_variable" href="struct___h_a_r_d_w_a_r_e___d_e_b_u_g___r_e_g_i_s_t_e_r___d_e_t_a_i_l_s.html#a2ff9ff153a2d64da6969c24d58949eb3">ThreadId</a> == PsGetCurrentThreadId())</div>
<div class="line"><span class="lineno">  420</span>                    {</div>
<div class="line"><span class="lineno">  421</span>                        <span class="comment">//</span></div>
<div class="line"><span class="lineno">  422</span>                        <span class="comment">// It&#39;s a step caused by a debug register breakpoint step-over</span></div>
<div class="line"><span class="lineno">  423</span>                        <span class="comment">//</span></div>
<div class="line"><span class="lineno">  424</span>                        RtlZeroMemory(&amp;<a class="code hl_variable" href="hprdbgkd_2header_2globals_2_global_8h.html#aa18646fd48487bbd6d28a61f575afe4e">g_HardwareDebugRegisterDetailsForStepOver</a>, <span class="keyword">sizeof</span>(<a class="code hl_struct" href="struct___h_a_r_d_w_a_r_e___d_e_b_u_g___r_e_g_i_s_t_e_r___d_e_t_a_i_l_s.html">HARDWARE_DEBUG_REGISTER_DETAILS</a>));</div>
<div class="line"><span class="lineno">  425</span>                    }</div>
<div class="line"><span class="lineno">  426</span>                    <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno">  427</span>                    {</div>
<div class="line"><span class="lineno">  428</span>                        <span class="comment">//</span></div>
<div class="line"><span class="lineno">  429</span>                        <span class="comment">// Should be ignored because it&#39;s a hardware debug register that is</span></div>
<div class="line"><span class="lineno">  430</span>                        <span class="comment">// likely triggered by other thread</span></div>
<div class="line"><span class="lineno">  431</span>                        <span class="comment">//</span></div>
<div class="line"><span class="lineno">  432</span>                        IgnoreDebugEvent = <a class="code hl_define" href="_basic_types_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;</div>
<div class="line"><span class="lineno">  433</span> </div>
<div class="line"><span class="lineno">  434</span>                        <span class="comment">//</span></div>
<div class="line"><span class="lineno">  435</span>                        <span class="comment">// Also, we should re-apply the hardware debug breakpoint on this thread</span></div>
<div class="line"><span class="lineno">  436</span>                        <span class="comment">//</span></div>
<div class="line"><span class="lineno">  437</span>                        <a class="code hl_function" href="_debug_registers_8c.html#aaaab32c0c14718eb2283f9b3069043a8">SetDebugRegisters</a>(<a class="code hl_define" href="hprdbgkd_2header_2debugger_2core_2debugger_8h.html#a658b2dec7e55b47e8b8b1f2b57747953">DEBUGGER_DEBUG_REGISTER_FOR_STEP_OVER</a>,</div>
<div class="line"><span class="lineno">  438</span>                                          <a class="code hl_enumvalue" href="_data_types_8h.html#acbbc04b3f929bcff66333b5968b3a796af2a12e7545d187d63fe4e165e852b15b">BREAK_ON_INSTRUCTION_FETCH</a>,</div>
<div class="line"><span class="lineno">  439</span>                                          <a class="code hl_define" href="_basic_types_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>,</div>
<div class="line"><span class="lineno">  440</span>                                          <a class="code hl_variable" href="hprdbgkd_2header_2globals_2_global_8h.html#aa18646fd48487bbd6d28a61f575afe4e">g_HardwareDebugRegisterDetailsForStepOver</a>.<a class="code hl_variable" href="struct___h_a_r_d_w_a_r_e___d_e_b_u_g___r_e_g_i_s_t_e_r___d_e_t_a_i_l_s.html#ad6283c78aa0a3e8a33a7629bf71accb9">Address</a>);</div>
<div class="line"><span class="lineno">  441</span>                    }</div>
<div class="line"><span class="lineno">  442</span>                }</div>
<div class="line"><span class="lineno">  443</span>            }</div>
<div class="line"><span class="lineno">  444</span> </div>
<div class="line"><span class="lineno">  445</span>            <span class="keywordflow">if</span> (!IgnoreDebugEvent)</div>
<div class="line"><span class="lineno">  446</span>            {</div>
<div class="line"><span class="lineno">  447</span>                <span class="comment">//</span></div>
<div class="line"><span class="lineno">  448</span>                <span class="comment">// Handle a regular step</span></div>
<div class="line"><span class="lineno">  449</span>                <span class="comment">//</span></div>
<div class="line"><span class="lineno">  450</span>                ContextAndTag.<a class="code hl_variable" href="struct___d_e_b_u_g_g_e_r___t_r_i_g_g_e_r_e_d___e_v_e_n_t___d_e_t_a_i_l_s.html#aed232a35a0d0d95aa4ca77dc50fc6fae">Context</a> = LastVmexitRip;</div>
<div class="line"><span class="lineno">  451</span>                <a class="code hl_function" href="_kd_8c.html#a732bca2051e444c16d2d9a5080978981">KdHandleBreakpointAndDebugBreakpoints</a>(DbgState,</div>
<div class="line"><span class="lineno">  452</span>                                                      <a class="code hl_enumvalue" href="_connection_8h.html#a6e2be89205e735ebae644cf4850ac21ba2e4a9051f91b8dd308c56566d57bbd19">DEBUGGEE_PAUSING_REASON_DEBUGGEE_STEPPED</a>,</div>
<div class="line"><span class="lineno">  453</span>                                                      &amp;ContextAndTag);</div>
<div class="line"><span class="lineno">  454</span>            }</div>
<div class="line"><span class="lineno">  455</span>        }</div>
<div class="line"><span class="lineno">  456</span>    }</div>
<div class="line"><span class="lineno">  457</span>    <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno">  458</span>    {</div>
<div class="line"><span class="lineno">  459</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno">  460</span>        <span class="comment">// It&#39;s a regular breakpoint</span></div>
<div class="line"><span class="lineno">  461</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno">  462</span>        <a class="code hl_function" href="_kd_8c.html#a732bca2051e444c16d2d9a5080978981">KdHandleBreakpointAndDebugBreakpoints</a>(DbgState,</div>
<div class="line"><span class="lineno">  463</span>                                              <a class="code hl_enumvalue" href="_connection_8h.html#a6e2be89205e735ebae644cf4850ac21badffddec7e865c30fb1c520d1a469ca82">DEBUGGEE_PAUSING_REASON_DEBUGGEE_HARDWARE_DEBUG_REGISTER_HIT</a>,</div>
<div class="line"><span class="lineno">  464</span>                                              &amp;ContextAndTag);</div>
<div class="line"><span class="lineno">  465</span>    }</div>
<div class="line"><span class="lineno">  466</span>}</div>
<div class="ttc" id="a_basic_types_8h_html_a1cb18096b299d23458d3c7b85fd86555"><div class="ttname"><a href="_basic_types_8h.html#a1cb18096b299d23458d3c7b85fd86555">BOOLEAN</a></div><div class="ttdeci">UCHAR BOOLEAN</div><div class="ttdef"><b>Definition</b> BasicTypes.h:37</div></div>
<div class="ttc" id="a_basic_types_8h_html_aae17ebb9ef7279d026817fb22f8aebe9"><div class="ttname"><a href="_basic_types_8h.html#aae17ebb9ef7279d026817fb22f8aebe9">UINT64</a></div><div class="ttdeci">unsigned __int64 UINT64</div><div class="ttdef"><b>Definition</b> BasicTypes.h:19</div></div>
<div class="ttc" id="a_breakpoint_commands_8c_html_af249a8d277f3fe6fdeeb1796e537572b"><div class="ttname"><a href="_breakpoint_commands_8c.html#af249a8d277f3fe6fdeeb1796e537572b">BreakpointCheckAndHandleDebuggerDefinedBreakpoints</a></div><div class="ttdeci">BOOLEAN BreakpointCheckAndHandleDebuggerDefinedBreakpoints(PROCESSOR_DEBUGGING_STATE *DbgState, UINT64 GuestRip, DEBUGGEE_PAUSING_REASON Reason, BOOLEAN ChangeMtfState)</div><div class="ttdoc">Check if the breakpoint vm-exit relates to 'bp' command or not.</div><div class="ttdef"><b>Definition</b> BreakpointCommands.c:272</div></div>
<div class="ttc" id="a_connection_8h_html_a6e2be89205e735ebae644cf4850ac21ba2e4a9051f91b8dd308c56566d57bbd19"><div class="ttname"><a href="_connection_8h.html#a6e2be89205e735ebae644cf4850ac21ba2e4a9051f91b8dd308c56566d57bbd19">DEBUGGEE_PAUSING_REASON_DEBUGGEE_STEPPED</a></div><div class="ttdeci">@ DEBUGGEE_PAUSING_REASON_DEBUGGEE_STEPPED</div><div class="ttdef"><b>Definition</b> Connection.h:27</div></div>
<div class="ttc" id="a_connection_8h_html_a6e2be89205e735ebae644cf4850ac21badffddec7e865c30fb1c520d1a469ca82"><div class="ttname"><a href="_connection_8h.html#a6e2be89205e735ebae644cf4850ac21badffddec7e865c30fb1c520d1a469ca82">DEBUGGEE_PAUSING_REASON_DEBUGGEE_HARDWARE_DEBUG_REGISTER_HIT</a></div><div class="ttdeci">@ DEBUGGEE_PAUSING_REASON_DEBUGGEE_HARDWARE_DEBUG_REGISTER_HIT</div><div class="ttdef"><b>Definition</b> Connection.h:30</div></div>
<div class="ttc" id="a_data_types_8h_html_acbbc04b3f929bcff66333b5968b3a796af2a12e7545d187d63fe4e165e852b15b"><div class="ttname"><a href="_data_types_8h.html#acbbc04b3f929bcff66333b5968b3a796af2a12e7545d187d63fe4e165e852b15b">BREAK_ON_INSTRUCTION_FETCH</a></div><div class="ttdeci">@ BREAK_ON_INSTRUCTION_FETCH</div><div class="ttdef"><b>Definition</b> DataTypes.h:56</div></div>
<div class="ttc" id="a_debug_registers_8c_html_aaaab32c0c14718eb2283f9b3069043a8"><div class="ttname"><a href="_debug_registers_8c.html#aaaab32c0c14718eb2283f9b3069043a8">SetDebugRegisters</a></div><div class="ttdeci">BOOLEAN SetDebugRegisters(UINT32 DebugRegNum, DEBUG_REGISTER_TYPE ActionType, BOOLEAN ApplyToVmcs, UINT64 TargetAddress)</div><div class="ttdoc">Configure hardware debug register for access, write and fetch breakpoints.</div><div class="ttdef"><b>Definition</b> DebugRegisters.c:37</div></div>
<div class="ttc" id="a_export_8c_html_a8f68fa306b093e98466bd4f16cd16035"><div class="ttname"><a href="_export_8c.html#a8f68fa306b093e98466bd4f16cd16035">VmFuncSetRflagTrapFlag</a></div><div class="ttdeci">VOID VmFuncSetRflagTrapFlag(BOOLEAN Set)</div><div class="ttdoc">Set Rflag's trap flag.</div><div class="ttdef"><b>Definition</b> Export.c:110</div></div>
<div class="ttc" id="a_export_8c_html_ab49740d6ce5d1c5f90828b66496dcb4c"><div class="ttname"><a href="_export_8c.html#ab49740d6ce5d1c5f90828b66496dcb4c">VmFuncGetLastVmexitRip</a></div><div class="ttdeci">UINT64 VmFuncGetLastVmexitRip(UINT32 CoreId)</div><div class="ttdoc">get the last vm-exit RIP</div><div class="ttdef"><b>Definition</b> Export.c:318</div></div>
<div class="ttc" id="a_kd_8c_html_a732bca2051e444c16d2d9a5080978981"><div class="ttname"><a href="_kd_8c.html#a732bca2051e444c16d2d9a5080978981">KdHandleBreakpointAndDebugBreakpoints</a></div><div class="ttdeci">_Use_decl_annotations_ VOID KdHandleBreakpointAndDebugBreakpoints(PROCESSOR_DEBUGGING_STATE *DbgState, DEBUGGEE_PAUSING_REASON Reason, PDEBUGGER_TRIGGERED_EVENT_DETAILS EventDetails)</div><div class="ttdoc">Handle #DBs and #BPs for kernel debugger.</div><div class="ttdef"><b>Definition</b> Kd.c:1137</div></div>
<div class="ttc" id="ahprdbgkd_2header_2debugger_2core_2debugger_8h_html_a658b2dec7e55b47e8b8b1f2b57747953"><div class="ttname"><a href="hprdbgkd_2header_2debugger_2core_2debugger_8h.html#a658b2dec7e55b47e8b8b1f2b57747953">DEBUGGER_DEBUG_REGISTER_FOR_STEP_OVER</a></div><div class="ttdeci">#define DEBUGGER_DEBUG_REGISTER_FOR_STEP_OVER</div><div class="ttdoc">debug register for step-over</div><div class="ttdef"><b>Definition</b> Debugger.h:21</div></div>
<div class="ttc" id="ahprdbgkd_2header_2globals_2_global_8h_html_aa18646fd48487bbd6d28a61f575afe4e"><div class="ttname"><a href="hprdbgkd_2header_2globals_2_global_8h.html#aa18646fd48487bbd6d28a61f575afe4e">g_HardwareDebugRegisterDetailsForStepOver</a></div><div class="ttdeci">HARDWARE_DEBUG_REGISTER_DETAILS g_HardwareDebugRegisterDetailsForStepOver</div><div class="ttdoc">Holds the state of hardware debug register for step-over.</div><div class="ttdef"><b>Definition</b> Global.h:61</div></div>
<div class="ttc" id="astruct___d_e_b_u_g_g_e_r___t_r_i_g_g_e_r_e_d___e_v_e_n_t___d_e_t_a_i_l_s_html"><div class="ttname"><a href="struct___d_e_b_u_g_g_e_r___t_r_i_g_g_e_r_e_d___e_v_e_n_t___d_e_t_a_i_l_s.html">_DEBUGGER_TRIGGERED_EVENT_DETAILS</a></div><div class="ttdoc">The structure of detail of a triggered event in HyperDbg.</div><div class="ttdef"><b>Definition</b> BasicTypes.h:114</div></div>
<div class="ttc" id="astruct___d_e_b_u_g_g_e_r___t_r_i_g_g_e_r_e_d___e_v_e_n_t___d_e_t_a_i_l_s_html_aed232a35a0d0d95aa4ca77dc50fc6fae"><div class="ttname"><a href="struct___d_e_b_u_g_g_e_r___t_r_i_g_g_e_r_e_d___e_v_e_n_t___d_e_t_a_i_l_s.html#aed232a35a0d0d95aa4ca77dc50fc6fae">_DEBUGGER_TRIGGERED_EVENT_DETAILS::Context</a></div><div class="ttdeci">PVOID Context</div><div class="ttdef"><b>Definition</b> BasicTypes.h:116</div></div>
<div class="ttc" id="astruct___h_a_r_d_w_a_r_e___d_e_b_u_g___r_e_g_i_s_t_e_r___d_e_t_a_i_l_s_html"><div class="ttname"><a href="struct___h_a_r_d_w_a_r_e___d_e_b_u_g___r_e_g_i_s_t_e_r___d_e_t_a_i_l_s.html">_HARDWARE_DEBUG_REGISTER_DETAILS</a></div><div class="ttdoc">store the details of a hardware debug register to ignore any trigger for other threads</div><div class="ttdef"><b>Definition</b> Kd.h:73</div></div>
<div class="ttc" id="astruct___h_a_r_d_w_a_r_e___d_e_b_u_g___r_e_g_i_s_t_e_r___d_e_t_a_i_l_s_html_a2ff9ff153a2d64da6969c24d58949eb3"><div class="ttname"><a href="struct___h_a_r_d_w_a_r_e___d_e_b_u_g___r_e_g_i_s_t_e_r___d_e_t_a_i_l_s.html#a2ff9ff153a2d64da6969c24d58949eb3">_HARDWARE_DEBUG_REGISTER_DETAILS::ThreadId</a></div><div class="ttdeci">UINT32 ThreadId</div><div class="ttdef"><b>Definition</b> Kd.h:76</div></div>
<div class="ttc" id="astruct___h_a_r_d_w_a_r_e___d_e_b_u_g___r_e_g_i_s_t_e_r___d_e_t_a_i_l_s_html_ad6283c78aa0a3e8a33a7629bf71accb9"><div class="ttname"><a href="struct___h_a_r_d_w_a_r_e___d_e_b_u_g___r_e_g_i_s_t_e_r___d_e_t_a_i_l_s.html#ad6283c78aa0a3e8a33a7629bf71accb9">_HARDWARE_DEBUG_REGISTER_DETAILS::Address</a></div><div class="ttdeci">UINT64 Address</div><div class="ttdef"><b>Definition</b> Kd.h:74</div></div>
<div class="ttc" id="astruct___h_a_r_d_w_a_r_e___d_e_b_u_g___r_e_g_i_s_t_e_r___d_e_t_a_i_l_s_html_afc21368e7a0be9dc359747ca96b7c17f"><div class="ttname"><a href="struct___h_a_r_d_w_a_r_e___d_e_b_u_g___r_e_g_i_s_t_e_r___d_e_t_a_i_l_s.html#afc21368e7a0be9dc359747ca96b7c17f">_HARDWARE_DEBUG_REGISTER_DETAILS::ProcessId</a></div><div class="ttdeci">UINT32 ProcessId</div><div class="ttdef"><b>Definition</b> Kd.h:75</div></div>
<div class="ttc" id="astruct___p_r_o_c_e_s_s_o_r___d_e_b_u_g_g_i_n_g___s_t_a_t_e_html_a090832a74d330cde891a17bdd5b236e3"><div class="ttname"><a href="struct___p_r_o_c_e_s_s_o_r___d_e_b_u_g_g_i_n_g___s_t_a_t_e.html#a090832a74d330cde891a17bdd5b236e3">_PROCESSOR_DEBUGGING_STATE::CoreId</a></div><div class="ttdeci">UINT32 CoreId</div><div class="ttdef"><b>Definition</b> State.h:124</div></div>
<div class="ttc" id="astruct___p_r_o_c_e_s_s_o_r___d_e_b_u_g_g_i_n_g___s_t_a_t_e_html_a5e86d5aa3e12b7bbfd3b021262959a7a"><div class="ttname"><a href="struct___p_r_o_c_e_s_s_o_r___d_e_b_u_g_g_i_n_g___s_t_a_t_e.html#a5e86d5aa3e12b7bbfd3b021262959a7a">_PROCESSOR_DEBUGGING_STATE::WaitForStepTrap</a></div><div class="ttdeci">BOOLEAN WaitForStepTrap</div><div class="ttdef"><b>Definition</b> State.h:126</div></div>
<div class="ttc" id="astruct___p_r_o_c_e_s_s_o_r___d_e_b_u_g_g_i_n_g___s_t_a_t_e_html_abec12156c3d1d4a4a3c76d7cee2ee254"><div class="ttname"><a href="struct___p_r_o_c_e_s_s_o_r___d_e_b_u_g_g_i_n_g___s_t_a_t_e.html#abec12156c3d1d4a4a3c76d7cee2ee254">_PROCESSOR_DEBUGGING_STATE::DisableTrapFlagOnContinue</a></div><div class="ttdeci">BOOLEAN DisableTrapFlagOnContinue</div><div class="ttdef"><b>Definition</b> State.h:131</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a1dfff40dfc7fe7e837164f8eb7bc9c7f" name="a1dfff40dfc7fe7e837164f8eb7bc9c7f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1dfff40dfc7fe7e837164f8eb7bc9c7f">&#9670;&#160;</a></span>KdHandleHaltsWhenNmiReceivedFromVmxRoot()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="_basic_types_8h.html#a7f319bfc2492a2136964194204e7a8cf">VOID</a> KdHandleHaltsWhenNmiReceivedFromVmxRoot </td>
          <td>(</td>
          <td class="paramtype">_Inout_ <a class="el" href="hprdbgkd_2header_2debugger_2core_2_state_8h.html#aa35afece6adc9a29a7bf7a2e76476037">PROCESSOR_DEBUGGING_STATE</a> *&#160;</td>
          <td class="paramname"><em>DbgState</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a4ea35c78a7ce042d1fa92e31cc86e3c3" name="a4ea35c78a7ce042d1fa92e31cc86e3c3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4ea35c78a7ce042d1fa92e31cc86e3c3">&#9670;&#160;</a></span>KdHandleNmi()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="_basic_types_8h.html#a7f319bfc2492a2136964194204e7a8cf">VOID</a> KdHandleNmi </td>
          <td>(</td>
          <td class="paramtype">_Inout_ <a class="el" href="hprdbgkd_2header_2debugger_2core_2_state_8h.html#aa35afece6adc9a29a7bf7a2e76476037">PROCESSOR_DEBUGGING_STATE</a> *&#160;</td>
          <td class="paramname"><em>DbgState</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="ab7d47bab2ada4c9c4f1f5cfbd2e0852f" name="ab7d47bab2ada4c9c4f1f5cfbd2e0852f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab7d47bab2ada4c9c4f1f5cfbd2e0852f">&#9670;&#160;</a></span>KdHandleNmiBroadcastDebugBreaks()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="_basic_types_8h.html#a7f319bfc2492a2136964194204e7a8cf">VOID</a> KdHandleNmiBroadcastDebugBreaks </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="_basic_types_8h.html#ae1e6edbbc26d6fbc71a90190d0266018">UINT32</a>&#160;</td>
          <td class="paramname"><em>CoreId</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="_basic_types_8h.html#a1cb18096b299d23458d3c7b85fd86555">BOOLEAN</a>&#160;</td>
          <td class="paramname"><em>IsOnVmxNmiHandler</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Handle broadcast NMIs for halting cores in vmx-root mode. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">CoreId</td><td></td></tr>
    <tr><td class="paramname">IsOnVmxNmiHandler</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>VOID </dd></dl>
<div class="fragment"><div class="line"><span class="lineno"> 1000</span>{</div>
<div class="line"><span class="lineno"> 1001</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1002</span>    <span class="comment">// Get the current debugging state</span></div>
<div class="line"><span class="lineno"> 1003</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1004</span>    <a class="code hl_struct" href="struct___p_r_o_c_e_s_s_o_r___d_e_b_u_g_g_i_n_g___s_t_a_t_e.html">PROCESSOR_DEBUGGING_STATE</a> * DbgState = &amp;<a class="code hl_variable" href="hprdbgkd_2header_2globals_2_global_8h.html#a349ee1adc363d2e4323a35a68fae5646">g_DbgState</a>[CoreId];</div>
<div class="line"><span class="lineno"> 1005</span> </div>
<div class="line"><span class="lineno"> 1006</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1007</span>    <span class="comment">// We use it as a global flag (for both vmx-root and vmx non-root), because</span></div>
<div class="line"><span class="lineno"> 1008</span>    <span class="comment">// generally it doesn&#39;t have any use case in vmx-root (IsOnVmxNmiHandler == FALSE)</span></div>
<div class="line"><span class="lineno"> 1009</span>    <span class="comment">// but in some cases, we might set the MTF but another vm-exit receives before</span></div>
<div class="line"><span class="lineno"> 1010</span>    <span class="comment">// MTF and in that place if it tries to trigger and event, then the MTF is not</span></div>
<div class="line"><span class="lineno"> 1011</span>    <span class="comment">// handled and the core is not locked properly, just waits to get the handle</span></div>
<div class="line"><span class="lineno"> 1012</span>    <span class="comment">// of the &quot;DebuggerHandleBreakpointLock&quot;, so we check this flag there</span></div>
<div class="line"><span class="lineno"> 1013</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1014</span>    DbgState-&gt;<a class="code hl_variable" href="struct___p_r_o_c_e_s_s_o_r___d_e_b_u_g_g_i_n_g___s_t_a_t_e.html#a0d22e0340ffa5de9190c09683fdfccf2">NmiState</a>.<a class="code hl_variable" href="struct___k_d___n_m_i___s_t_a_t_e.html#a6359e6a5d2e428c7dfc299e69592b9ef">WaitingToBeLocked</a> = <a class="code hl_define" href="_basic_types_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;</div>
<div class="line"><span class="lineno"> 1015</span> </div>
<div class="line"><span class="lineno"> 1016</span>    <span class="keywordflow">if</span> (IsOnVmxNmiHandler)</div>
<div class="line"><span class="lineno"> 1017</span>    {</div>
<div class="line"><span class="lineno"> 1018</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1019</span>        <span class="comment">// Indicate that it&#39;s called from NMI handle, and it relates to</span></div>
<div class="line"><span class="lineno"> 1020</span>        <span class="comment">// halting the debuggee</span></div>
<div class="line"><span class="lineno"> 1021</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1022</span>        DbgState-&gt;<a class="code hl_variable" href="struct___p_r_o_c_e_s_s_o_r___d_e_b_u_g_g_i_n_g___s_t_a_t_e.html#a0d22e0340ffa5de9190c09683fdfccf2">NmiState</a>.<a class="code hl_variable" href="struct___k_d___n_m_i___s_t_a_t_e.html#aee467e0975f8b0c6d71a727e3790e27e">NmiCalledInVmxRootRelatedToHaltDebuggee</a> = <a class="code hl_define" href="_basic_types_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;</div>
<div class="line"><span class="lineno"> 1023</span> </div>
<div class="line"><span class="lineno"> 1024</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1025</span>        <span class="comment">// If the core was in the middle of spinning on the spinlock</span></div>
<div class="line"><span class="lineno"> 1026</span>        <span class="comment">// of getting the debug lock, this mechansim is not needed,</span></div>
<div class="line"><span class="lineno"> 1027</span>        <span class="comment">// but if the core is not spinning there or the core is processing</span></div>
<div class="line"><span class="lineno"> 1028</span>        <span class="comment">// a random vm-exit, then we inject an immediate vm-exit after vm-entry</span></div>
<div class="line"><span class="lineno"> 1029</span>        <span class="comment">// or inject a DPC</span></div>
<div class="line"><span class="lineno"> 1030</span>        <span class="comment">// this is used for two reasons.</span></div>
<div class="line"><span class="lineno"> 1031</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1032</span>        <span class="comment">//      1. first, we will get the registers (context) to halt the core</span></div>
<div class="line"><span class="lineno"> 1033</span>        <span class="comment">//      2. second, it guarantees that if the NMI arrives within any</span></div>
<div class="line"><span class="lineno"> 1034</span>        <span class="comment">//         instruction in vmx-root mode, then we injected an immediate</span></div>
<div class="line"><span class="lineno"> 1035</span>        <span class="comment">//         vm-exit and we won&#39;t miss any cpu cycle in the guest</span></div>
<div class="line"><span class="lineno"> 1036</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1037</span>        <span class="comment">// KdFireDpc(KdHaltCoreInTheCaseOfHaltedFromNmiInVmxRoot, NULL);</span></div>
<div class="line"><span class="lineno"> 1038</span>        <a class="code hl_function" href="_export_8c.html#a85480760316ec7682996e98898d3a611">VmFuncSetMonitorTrapFlag</a>(<a class="code hl_define" href="_basic_types_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);</div>
<div class="line"><span class="lineno"> 1039</span>    }</div>
<div class="line"><span class="lineno"> 1040</span>    <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno"> 1041</span>    {</div>
<div class="line"><span class="lineno"> 1042</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1043</span>        <span class="comment">// Handle core break</span></div>
<div class="line"><span class="lineno"> 1044</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1045</span>        <a class="code hl_function" href="_kd_8c.html#ab1cdd12912e4384ef4d5659c76a6da35">KdHandleNmi</a>(DbgState);</div>
<div class="line"><span class="lineno"> 1046</span>    }</div>
<div class="line"><span class="lineno"> 1047</span>}</div>
<div class="ttc" id="a_export_8c_html_a85480760316ec7682996e98898d3a611"><div class="ttname"><a href="_export_8c.html#a85480760316ec7682996e98898d3a611">VmFuncSetMonitorTrapFlag</a></div><div class="ttdeci">VOID VmFuncSetMonitorTrapFlag(BOOLEAN Set)</div><div class="ttdoc">Set the monitor trap flag.</div><div class="ttdef"><b>Definition</b> Export.c:98</div></div>
<div class="ttc" id="a_kd_8c_html_ab1cdd12912e4384ef4d5659c76a6da35"><div class="ttname"><a href="_kd_8c.html#ab1cdd12912e4384ef4d5659c76a6da35">KdHandleNmi</a></div><div class="ttdeci">_Use_decl_annotations_ VOID KdHandleNmi(PROCESSOR_DEBUGGING_STATE *DbgState)</div><div class="ttdoc">Handle NMI Vm-exits.</div><div class="ttdef"><b>Definition</b> Kd.c:1290</div></div>
<div class="ttc" id="ahprdbgkd_2header_2globals_2_global_8h_html_a349ee1adc363d2e4323a35a68fae5646"><div class="ttname"><a href="hprdbgkd_2header_2globals_2_global_8h.html#a349ee1adc363d2e4323a35a68fae5646">g_DbgState</a></div><div class="ttdeci">PROCESSOR_DEBUGGING_STATE * g_DbgState</div><div class="ttdoc">Save the state and variables related to debugging on each to logical core.</div><div class="ttdef"><b>Definition</b> Global.h:23</div></div>
<div class="ttc" id="astruct___k_d___n_m_i___s_t_a_t_e_html_a6359e6a5d2e428c7dfc299e69592b9ef"><div class="ttname"><a href="struct___k_d___n_m_i___s_t_a_t_e.html#a6359e6a5d2e428c7dfc299e69592b9ef">_KD_NMI_STATE::WaitingToBeLocked</a></div><div class="ttdeci">volatile BOOLEAN WaitingToBeLocked</div><div class="ttdef"><b>Definition</b> State.h:96</div></div>
<div class="ttc" id="astruct___k_d___n_m_i___s_t_a_t_e_html_aee467e0975f8b0c6d71a727e3790e27e"><div class="ttname"><a href="struct___k_d___n_m_i___s_t_a_t_e.html#aee467e0975f8b0c6d71a727e3790e27e">_KD_NMI_STATE::NmiCalledInVmxRootRelatedToHaltDebuggee</a></div><div class="ttdeci">volatile BOOLEAN NmiCalledInVmxRootRelatedToHaltDebuggee</div><div class="ttdef"><b>Definition</b> State.h:95</div></div>
<div class="ttc" id="astruct___p_r_o_c_e_s_s_o_r___d_e_b_u_g_g_i_n_g___s_t_a_t_e_html"><div class="ttname"><a href="struct___p_r_o_c_e_s_s_o_r___d_e_b_u_g_g_i_n_g___s_t_a_t_e.html">_PROCESSOR_DEBUGGING_STATE</a></div><div class="ttdoc">Saves the debugger state.</div><div class="ttdef"><b>Definition</b> State.h:120</div></div>
<div class="ttc" id="astruct___p_r_o_c_e_s_s_o_r___d_e_b_u_g_g_i_n_g___s_t_a_t_e_html_a0d22e0340ffa5de9190c09683fdfccf2"><div class="ttname"><a href="struct___p_r_o_c_e_s_s_o_r___d_e_b_u_g_g_i_n_g___s_t_a_t_e.html#a0d22e0340ffa5de9190c09683fdfccf2">_PROCESSOR_DEBUGGING_STATE::NmiState</a></div><div class="ttdeci">KD_NMI_STATE NmiState</div><div class="ttdef"><b>Definition</b> State.h:134</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a36cd156d7513f5bb5f119b5e05fb4206" name="a36cd156d7513f5bb5f119b5e05fb4206"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a36cd156d7513f5bb5f119b5e05fb4206">&#9670;&#160;</a></span>KdHandleRegisteredMtfCallback()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="_basic_types_8h.html#a7f319bfc2492a2136964194204e7a8cf">VOID</a> KdHandleRegisteredMtfCallback </td>
          <td>(</td>
          <td class="paramtype">_In_ <a class="el" href="_basic_types_8h.html#ae1e6edbbc26d6fbc71a90190d0266018">UINT32</a>&#160;</td>
          <td class="paramname"><em>CoreId</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="aa6327269502f58fa975905189894eb48" name="aa6327269502f58fa975905189894eb48"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa6327269502f58fa975905189894eb48">&#9670;&#160;</a></span>KdInitializeKernelDebugger()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="_basic_types_8h.html#a7f319bfc2492a2136964194204e7a8cf">VOID</a> KdInitializeKernelDebugger </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>initialize kernel debugger </p>
<p>this function should be called on vmx non-root</p>
<dl class="section return"><dt>Returns</dt><dd>VOID </dd></dl>
<div class="fragment"><div class="line"><span class="lineno">   23</span>{</div>
<div class="line"><span class="lineno">   24</span>    <a class="code hl_typedef" href="_basic_types_8h.html#af632da489ebc3708ec3ab6791ee53fa4">ULONG</a> CoreCount = KeQueryActiveProcessorCount(0);</div>
<div class="line"><span class="lineno">   25</span> </div>
<div class="line"><span class="lineno">   26</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">   27</span>    <span class="comment">// Allocate DPC routine</span></div>
<div class="line"><span class="lineno">   28</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">   29</span>    <span class="comment">// for (size_t i = 0; i &lt; CoreCount; i++)</span></div>
<div class="line"><span class="lineno">   30</span>    <span class="comment">// {</span></div>
<div class="line"><span class="lineno">   31</span>    <span class="comment">//     g_DbgState[i].KdDpcObject = ExAllocatePoolWithTag(NonPagedPool, sizeof(KDPC), POOLTAG);</span></div>
<div class="line"><span class="lineno">   32</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">   33</span>    <span class="comment">//     if (g_DbgState[i].KdDpcObject == NULL)</span></div>
<div class="line"><span class="lineno">   34</span>    <span class="comment">//     {</span></div>
<div class="line"><span class="lineno">   35</span>    <span class="comment">//         LogError(&quot;Err, allocating dpc holder for debuggee&quot;);</span></div>
<div class="line"><span class="lineno">   36</span>    <span class="comment">//         return;</span></div>
<div class="line"><span class="lineno">   37</span>    <span class="comment">//     }</span></div>
<div class="line"><span class="lineno">   38</span>    <span class="comment">// }</span></div>
<div class="line"><span class="lineno">   39</span> </div>
<div class="line"><span class="lineno">   40</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">   41</span>    <span class="comment">// Request pages for breakpoint detail</span></div>
<div class="line"><span class="lineno">   42</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">   43</span>    <a class="code hl_function" href="_pool_manager_8c.html#a3660fd340db1240d410e847fb1ffe3d8">PoolManagerRequestAllocation</a>(<span class="keyword">sizeof</span>(<a class="code hl_struct" href="struct___d_e_b_u_g_g_e_e___b_p___d_e_s_c_r_i_p_t_o_r.html">DEBUGGEE_BP_DESCRIPTOR</a>),</div>
<div class="line"><span class="lineno">   44</span>                                 <a class="code hl_define" href="_constants_8h.html#a2b58d9ed6c9313bad1ec12d9b8506453">MAXIMUM_BREAKPOINTS_WITHOUT_CONTINUE</a>,</div>
<div class="line"><span class="lineno">   45</span>                                 <a class="code hl_enumvalue" href="_data_types_8h.html#ad130f0bae4db97169873223d0aad9a63ab8948b7a3ee40226d0f76b7fccf90b9a">BREAKPOINT_DEFINITION_STRUCTURE</a>);</div>
<div class="line"><span class="lineno">   46</span> </div>
<div class="line"><span class="lineno">   47</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">   48</span>    <span class="comment">// Enable vm-exit on Hardware debug exceptions and breakpoints</span></div>
<div class="line"><span class="lineno">   49</span>    <span class="comment">// so, intercept #DBs and #BP by changing exception bitmap (one core)</span></div>
<div class="line"><span class="lineno">   50</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">   51</span>    <a class="code hl_function" href="_broadcast_8c.html#a74d9c313b40b008235ca3ca0e40628d3">BroadcastEnableDbAndBpExitingAllCores</a>();</div>
<div class="line"><span class="lineno">   52</span> </div>
<div class="line"><span class="lineno">   53</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">   54</span>    <span class="comment">// Reset pause break requests</span></div>
<div class="line"><span class="lineno">   55</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">   56</span>    RtlZeroMemory(&amp;<a class="code hl_variable" href="hprdbgkd_2header_2globals_2_global_8h.html#a0c50a3971433f95430249d30dfc9856b">g_IgnoreBreaksToDebugger</a>, <span class="keyword">sizeof</span>(<a class="code hl_struct" href="struct___d_e_b_u_g_g_e_e___r_e_q_u_e_s_t___t_o___i_g_n_o_r_e___b_r_e_a_k_s___u_n_t_i_l___a_n___e_v_e_n_t.html">DEBUGGEE_REQUEST_TO_IGNORE_BREAKS_UNTIL_AN_EVENT</a>));</div>
<div class="line"><span class="lineno">   57</span> </div>
<div class="line"><span class="lineno">   58</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">   59</span>    <span class="comment">// Initialize list of breakpoints and breakpoint id</span></div>
<div class="line"><span class="lineno">   60</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">   61</span>    <a class="code hl_variable" href="hprdbgkd_2header_2globals_2_global_8h.html#ad09616266c993d19a27d9f414073c0a7">g_MaximumBreakpointId</a> = 0;</div>
<div class="line"><span class="lineno">   62</span> </div>
<div class="line"><span class="lineno">   63</span>    <a class="code hl_function" href="list_8h.html#a71fd97aa8bac50a2f3a1d98cf680b2f4">InitializeListHead</a>(&amp;<a class="code hl_variable" href="hprdbgkd_2header_2globals_2_global_8h.html#abca944290c6a683f0821a9096472f7d4">g_BreakpointsListHead</a>);</div>
<div class="line"><span class="lineno">   64</span> </div>
<div class="line"><span class="lineno">   65</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">   66</span>    <span class="comment">// Indicate that the kernel debugger is active</span></div>
<div class="line"><span class="lineno">   67</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">   68</span>    <a class="code hl_variable" href="hprdbgkd_2header_2globals_2_global_8h.html#ae4b5afa957e3e26377135b91b60eda4e">g_KernelDebuggerState</a> = <a class="code hl_define" href="_basic_types_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;</div>
<div class="line"><span class="lineno">   69</span>}</div>
<div class="ttc" id="a_basic_types_8h_html_af632da489ebc3708ec3ab6791ee53fa4"><div class="ttname"><a href="_basic_types_8h.html#af632da489ebc3708ec3ab6791ee53fa4">ULONG</a></div><div class="ttdeci">unsigned long ULONG</div><div class="ttdef"><b>Definition</b> BasicTypes.h:35</div></div>
<div class="ttc" id="a_broadcast_8c_html_a74d9c313b40b008235ca3ca0e40628d3"><div class="ttname"><a href="_broadcast_8c.html#a74d9c313b40b008235ca3ca0e40628d3">BroadcastEnableDbAndBpExitingAllCores</a></div><div class="ttdeci">VOID BroadcastEnableDbAndBpExitingAllCores()</div><div class="ttdoc">routines to set vm-exit on all #DBs and #BP on all cores</div><div class="ttdef"><b>Definition</b> Broadcast.c:35</div></div>
<div class="ttc" id="a_constants_8h_html_a2b58d9ed6c9313bad1ec12d9b8506453"><div class="ttname"><a href="_constants_8h.html#a2b58d9ed6c9313bad1ec12d9b8506453">MAXIMUM_BREAKPOINTS_WITHOUT_CONTINUE</a></div><div class="ttdeci">#define MAXIMUM_BREAKPOINTS_WITHOUT_CONTINUE</div><div class="ttdoc">maximum number of buffers to be allocated for a single breakpoint</div><div class="ttdef"><b>Definition</b> Constants.h:367</div></div>
<div class="ttc" id="a_data_types_8h_html_ad130f0bae4db97169873223d0aad9a63ab8948b7a3ee40226d0f76b7fccf90b9a"><div class="ttname"><a href="_data_types_8h.html#ad130f0bae4db97169873223d0aad9a63ab8948b7a3ee40226d0f76b7fccf90b9a">BREAKPOINT_DEFINITION_STRUCTURE</a></div><div class="ttdeci">@ BREAKPOINT_DEFINITION_STRUCTURE</div><div class="ttdef"><b>Definition</b> DataTypes.h:45</div></div>
<div class="ttc" id="a_pool_manager_8c_html_a3660fd340db1240d410e847fb1ffe3d8"><div class="ttname"><a href="_pool_manager_8c.html#a3660fd340db1240d410e847fb1ffe3d8">PoolManagerRequestAllocation</a></div><div class="ttdeci">BOOLEAN PoolManagerRequestAllocation(SIZE_T Size, UINT32 Count, POOL_ALLOCATION_INTENTION Intention)</div><div class="ttdoc">Request to allocate new buffers.</div><div class="ttdef"><b>Definition</b> PoolManager.c:443</div></div>
<div class="ttc" id="ahprdbgkd_2header_2globals_2_global_8h_html_a0c50a3971433f95430249d30dfc9856b"><div class="ttname"><a href="hprdbgkd_2header_2globals_2_global_8h.html#a0c50a3971433f95430249d30dfc9856b">g_IgnoreBreaksToDebugger</a></div><div class="ttdeci">DEBUGGEE_REQUEST_TO_IGNORE_BREAKS_UNTIL_AN_EVENT g_IgnoreBreaksToDebugger</div><div class="ttdoc">Holds the requests to pause the break of debuggee until a special event happens.</div><div class="ttdef"><b>Definition</b> Global.h:55</div></div>
<div class="ttc" id="ahprdbgkd_2header_2globals_2_global_8h_html_abca944290c6a683f0821a9096472f7d4"><div class="ttname"><a href="hprdbgkd_2header_2globals_2_global_8h.html#abca944290c6a683f0821a9096472f7d4">g_BreakpointsListHead</a></div><div class="ttdeci">LIST_ENTRY g_BreakpointsListHead</div><div class="ttdoc">List header of breakpoints for debugger-mode.</div><div class="ttdef"><b>Definition</b> Global.h:91</div></div>
<div class="ttc" id="ahprdbgkd_2header_2globals_2_global_8h_html_ad09616266c993d19a27d9f414073c0a7"><div class="ttname"><a href="hprdbgkd_2header_2globals_2_global_8h.html#ad09616266c993d19a27d9f414073c0a7">g_MaximumBreakpointId</a></div><div class="ttdeci">UINT64 g_MaximumBreakpointId</div><div class="ttdoc">Seed for setting id of breakpoints.</div><div class="ttdef"><b>Definition</b> Global.h:97</div></div>
<div class="ttc" id="alist_8h_html_a71fd97aa8bac50a2f3a1d98cf680b2f4"><div class="ttname"><a href="list_8h.html#a71fd97aa8bac50a2f3a1d98cf680b2f4">InitializeListHead</a></div><div class="ttdeci">void InitializeListHead(PLIST_ENTRY ListHead)</div></div>
<div class="ttc" id="astruct___d_e_b_u_g_g_e_e___b_p___d_e_s_c_r_i_p_t_o_r_html"><div class="ttname"><a href="struct___d_e_b_u_g_g_e_e___b_p___d_e_s_c_r_i_p_t_o_r.html">_DEBUGGEE_BP_DESCRIPTOR</a></div><div class="ttdoc">The structure of storing breakpoints.</div><div class="ttdef"><b>Definition</b> State.h:72</div></div>
<div class="ttc" id="astruct___d_e_b_u_g_g_e_e___r_e_q_u_e_s_t___t_o___i_g_n_o_r_e___b_r_e_a_k_s___u_n_t_i_l___a_n___e_v_e_n_t_html"><div class="ttname"><a href="struct___d_e_b_u_g_g_e_e___r_e_q_u_e_s_t___t_o___i_g_n_o_r_e___b_r_e_a_k_s___u_n_t_i_l___a_n___e_v_e_n_t.html">_DEBUGGEE_REQUEST_TO_IGNORE_BREAKS_UNTIL_AN_EVENT</a></div><div class="ttdoc">request to pause and halt the system</div><div class="ttdef"><b>Definition</b> Kd.h:61</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a814437795a9e923d352b848630625a56" name="a814437795a9e923d352b848630625a56"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a814437795a9e923d352b848630625a56">&#9670;&#160;</a></span>KdIsGuestOnUsermode32Bit()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="_basic_types_8h.html#a1cb18096b299d23458d3c7b85fd86555">BOOLEAN</a> KdIsGuestOnUsermode32Bit </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>determines if the guest was in 32-bit user-mode or 64-bit (long mode) </p>
<p>this function should be called from vmx-root</p>
<dl class="section return"><dt>Returns</dt><dd>BOOLEAN </dd></dl>
<div class="fragment"><div class="line"><span class="lineno"> 2665</span>{</div>
<div class="line"><span class="lineno"> 2666</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 2667</span>    <span class="comment">// Only 16 bit is needed howerver, vmwrite might write on other bits</span></div>
<div class="line"><span class="lineno"> 2668</span>    <span class="comment">// and corrupt other variables, that&#39;s why we get 64bit</span></div>
<div class="line"><span class="lineno"> 2669</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 2670</span>    <a class="code hl_typedef" href="_basic_types_8h.html#aae17ebb9ef7279d026817fb22f8aebe9">UINT64</a> CsSel = NULL;</div>
<div class="line"><span class="lineno"> 2671</span> </div>
<div class="line"><span class="lineno"> 2672</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 2673</span>    <span class="comment">// Read guest&#39;s cs selector</span></div>
<div class="line"><span class="lineno"> 2674</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 2675</span>    CsSel = <a class="code hl_function" href="_export_8c.html#a08e9402c406068d70419121099c455cf">VmFuncGetCsSelector</a>();</div>
<div class="line"><span class="lineno"> 2676</span> </div>
<div class="line"><span class="lineno"> 2677</span>    <span class="keywordflow">if</span> (CsSel == <a class="code hl_define" href="hprdbghv_2header_2common_2common_8h.html#a5bc1b920e0b1b8a1b35327b5f89ab6ac">KGDT64_R0_CODE</a>)</div>
<div class="line"><span class="lineno"> 2678</span>    {</div>
<div class="line"><span class="lineno"> 2679</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 2680</span>        <span class="comment">// 64-bit kernel-mode</span></div>
<div class="line"><span class="lineno"> 2681</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 2682</span>        <span class="keywordflow">return</span> <a class="code hl_define" href="_basic_types_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div>
<div class="line"><span class="lineno"> 2683</span>    }</div>
<div class="line"><span class="lineno"> 2684</span>    <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((CsSel &amp; ~3) == <a class="code hl_define" href="hprdbghv_2header_2common_2common_8h.html#a3566c0de563735de786e1052440226a1">KGDT64_R3_CODE</a>)</div>
<div class="line"><span class="lineno"> 2685</span>    {</div>
<div class="line"><span class="lineno"> 2686</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 2687</span>        <span class="comment">// 64-bit user-mode</span></div>
<div class="line"><span class="lineno"> 2688</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 2689</span>        <span class="keywordflow">return</span> <a class="code hl_define" href="_basic_types_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div>
<div class="line"><span class="lineno"> 2690</span>    }</div>
<div class="line"><span class="lineno"> 2691</span>    <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((CsSel &amp; ~3) == <a class="code hl_define" href="hprdbghv_2header_2common_2common_8h.html#a8b6aab65ae2c0a4e02ac1069d4ac46ad">KGDT64_R3_CMCODE</a>)</div>
<div class="line"><span class="lineno"> 2692</span>    {</div>
<div class="line"><span class="lineno"> 2693</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 2694</span>        <span class="comment">// 32-bit user-mode</span></div>
<div class="line"><span class="lineno"> 2695</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 2696</span>        <span class="keywordflow">return</span> <a class="code hl_define" href="_basic_types_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;</div>
<div class="line"><span class="lineno"> 2697</span>    }</div>
<div class="line"><span class="lineno"> 2698</span>    <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno"> 2699</span>    {</div>
<div class="line"><span class="lineno"> 2700</span>        <a class="code hl_define" href="_hyper_dbg_hyper_log_intrinsics_8h.html#a459b19922fecfbb9438dd56b66930d16">LogError</a>(<span class="stringliteral">&quot;Err, unknown value for cs, cannot determine wow64 mode&quot;</span>);</div>
<div class="line"><span class="lineno"> 2701</span>    }</div>
<div class="line"><span class="lineno"> 2702</span> </div>
<div class="line"><span class="lineno"> 2703</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 2704</span>    <span class="comment">// By default, 64-bit</span></div>
<div class="line"><span class="lineno"> 2705</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 2706</span>    <span class="keywordflow">return</span> <a class="code hl_define" href="_basic_types_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div>
<div class="line"><span class="lineno"> 2707</span>}</div>
<div class="ttc" id="a_export_8c_html_a08e9402c406068d70419121099c455cf"><div class="ttname"><a href="_export_8c.html#a08e9402c406068d70419121099c455cf">VmFuncGetCsSelector</a></div><div class="ttdeci">UINT16 VmFuncGetCsSelector()</div><div class="ttdoc">Read CS selector.</div><div class="ttdef"><b>Definition</b> Export.c:341</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a23ed778c716160ee79236f62556b41c7" name="a23ed778c716160ee79236f62556b41c7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a23ed778c716160ee79236f62556b41c7">&#9670;&#160;</a></span>KdLoggingResponsePacketToDebugger()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="_basic_types_8h.html#a1cb18096b299d23458d3c7b85fd86555">BOOLEAN</a> KdLoggingResponsePacketToDebugger </td>
          <td>(</td>
          <td class="paramtype">_In_reads_bytes_opt_(OptionalBufferLength) <a class="el" href="_basic_types_8h.html#aebb9e13210d88d43e32e735ada43a425">CHAR</a> *&#160;</td>
          <td class="paramname"><em>OptionalBuffer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">_In_ <a class="el" href="_basic_types_8h.html#ae1e6edbbc26d6fbc71a90190d0266018">UINT32</a>&#160;</td>
          <td class="paramname"><em>OptionalBufferLength</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">_In_ <a class="el" href="_basic_types_8h.html#ae1e6edbbc26d6fbc71a90190d0266018">UINT32</a>&#160;</td>
          <td class="paramname"><em>OperationCode</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a81ec660b5db2e1b3a1677661c23b51d0" name="a81ec660b5db2e1b3a1677661c23b51d0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a81ec660b5db2e1b3a1677661c23b51d0">&#9670;&#160;</a></span>KdManageSystemHaltOnVmxRoot()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="_basic_types_8h.html#a7f319bfc2492a2136964194204e7a8cf">VOID</a> KdManageSystemHaltOnVmxRoot </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="hprdbgkd_2header_2debugger_2core_2_state_8h.html#aa35afece6adc9a29a7bf7a2e76476037">PROCESSOR_DEBUGGING_STATE</a> *&#160;</td>
          <td class="paramname"><em>DbgState</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="_basic_types_8h.html#ad502772c412e6f5dd67d557fdc3a4322">PDEBUGGER_TRIGGERED_EVENT_DETAILS</a>&#160;</td>
          <td class="paramname"><em>EventDetails</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>manage system halt on vmx-root mode </p>
<p>This function should only be called from KdHandleBreakpointAndDebugBreakpoints </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">DbgState</td><td>The state of the debugger on the current core </td></tr>
    <tr><td class="paramname">EventDetails</td><td></td></tr>
    <tr><td class="paramname">MainCore</td><td>the core that triggered the event</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>VOID </dd></dl>
<div class="fragment"><div class="line"><span class="lineno"> 2721</span>{</div>
<div class="line"><span class="lineno"> 2722</span>    <a class="code hl_struct" href="struct___d_e_b_u_g_g_e_e___k_d___p_a_u_s_e_d___p_a_c_k_e_t.html">DEBUGGEE_KD_PAUSED_PACKET</a> PausePacket;</div>
<div class="line"><span class="lineno"> 2723</span>    <a class="code hl_typedef" href="_basic_types_8h.html#af632da489ebc3708ec3ab6791ee53fa4">ULONG</a>                     ExitInstructionLength = 0;</div>
<div class="line"><span class="lineno"> 2724</span>    RFLAGS                    Rflags                = {0};</div>
<div class="line"><span class="lineno"> 2725</span>    <a class="code hl_typedef" href="_basic_types_8h.html#aae17ebb9ef7279d026817fb22f8aebe9">UINT64</a>                    LastVmexitRip         = 0;</div>
<div class="line"><span class="lineno"> 2726</span> </div>
<div class="line"><span class="lineno"> 2727</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 2728</span>    <span class="comment">// Perform Pre-halt tasks</span></div>
<div class="line"><span class="lineno"> 2729</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 2730</span>    <a class="code hl_function" href="_kd_8c.html#a26ca81a35a0a6e96b7067f59e97d657f">KdApplyTasksPreHaltCore</a>(DbgState);</div>
<div class="line"><span class="lineno"> 2731</span> </div>
<div class="line"><span class="lineno"> 2732</span>StartAgain:</div>
<div class="line"><span class="lineno"> 2733</span> </div>
<div class="line"><span class="lineno"> 2734</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 2735</span>    <span class="comment">// We check for receiving buffer (unhalting) only on the</span></div>
<div class="line"><span class="lineno"> 2736</span>    <span class="comment">// first core and not on every cores</span></div>
<div class="line"><span class="lineno"> 2737</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 2738</span>    <span class="keywordflow">if</span> (DbgState-&gt;<a class="code hl_variable" href="struct___p_r_o_c_e_s_s_o_r___d_e_b_u_g_g_i_n_g___s_t_a_t_e.html#a4c041c2d74937318d15c2736dc95f661">MainDebuggingCore</a>)</div>
<div class="line"><span class="lineno"> 2739</span>    {</div>
<div class="line"><span class="lineno"> 2740</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 2741</span>        <span class="comment">// *** Current Operating Core  ***</span></div>
<div class="line"><span class="lineno"> 2742</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 2743</span>        RtlZeroMemory(&amp;PausePacket, <span class="keyword">sizeof</span>(<a class="code hl_struct" href="struct___d_e_b_u_g_g_e_e___k_d___p_a_u_s_e_d___p_a_c_k_e_t.html">DEBUGGEE_KD_PAUSED_PACKET</a>));</div>
<div class="line"><span class="lineno"> 2744</span> </div>
<div class="line"><span class="lineno"> 2745</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 2746</span>        <span class="comment">// Get the last RIP for vm-exit handler</span></div>
<div class="line"><span class="lineno"> 2747</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 2748</span>        LastVmexitRip = <a class="code hl_function" href="_export_8c.html#ab49740d6ce5d1c5f90828b66496dcb4c">VmFuncGetLastVmexitRip</a>(DbgState-&gt;<a class="code hl_variable" href="struct___p_r_o_c_e_s_s_o_r___d_e_b_u_g_g_i_n_g___s_t_a_t_e.html#a090832a74d330cde891a17bdd5b236e3">CoreId</a>);</div>
<div class="line"><span class="lineno"> 2749</span> </div>
<div class="line"><span class="lineno"> 2750</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 2751</span>        <span class="comment">// Set the halt reason</span></div>
<div class="line"><span class="lineno"> 2752</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 2753</span>        PausePacket.<a class="code hl_variable" href="struct___d_e_b_u_g_g_e_e___k_d___p_a_u_s_e_d___p_a_c_k_e_t.html#a44c1a04de19a49588f1dbaa6d2302294">PausingReason</a> = <a class="code hl_variable" href="hprdbgkd_2header_2globals_2_global_8h.html#acf21790b2fc221ed28789a132d509cb7">g_DebuggeeHaltReason</a>;</div>
<div class="line"><span class="lineno"> 2754</span> </div>
<div class="line"><span class="lineno"> 2755</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 2756</span>        <span class="comment">// Set the current core</span></div>
<div class="line"><span class="lineno"> 2757</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 2758</span>        PausePacket.<a class="code hl_variable" href="struct___d_e_b_u_g_g_e_e___k_d___p_a_u_s_e_d___p_a_c_k_e_t.html#a908147ed36f20636e8dfc9238c2dd451">CurrentCore</a> = DbgState-&gt;<a class="code hl_variable" href="struct___p_r_o_c_e_s_s_o_r___d_e_b_u_g_g_i_n_g___s_t_a_t_e.html#a090832a74d330cde891a17bdd5b236e3">CoreId</a>;</div>
<div class="line"><span class="lineno"> 2759</span> </div>
<div class="line"><span class="lineno"> 2760</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 2761</span>        <span class="comment">// Set the RIP and mode of execution</span></div>
<div class="line"><span class="lineno"> 2762</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 2763</span>        PausePacket.<a class="code hl_variable" href="struct___d_e_b_u_g_g_e_e___k_d___p_a_u_s_e_d___p_a_c_k_e_t.html#a24ab04316c8cbfa77a9eb389181de510">Rip</a>            = LastVmexitRip;</div>
<div class="line"><span class="lineno"> 2764</span>        PausePacket.<a class="code hl_variable" href="struct___d_e_b_u_g_g_e_e___k_d___p_a_u_s_e_d___p_a_c_k_e_t.html#a4a0dce84ba049eb3503b3a138b73cba1">Is32BitAddress</a> = <a class="code hl_function" href="_kd_8c.html#a814437795a9e923d352b848630625a56">KdIsGuestOnUsermode32Bit</a>();</div>
<div class="line"><span class="lineno"> 2765</span> </div>
<div class="line"><span class="lineno"> 2766</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 2767</span>        <span class="comment">// Set disassembly state</span></div>
<div class="line"><span class="lineno"> 2768</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 2769</span>        PausePacket.<a class="code hl_variable" href="struct___d_e_b_u_g_g_e_e___k_d___p_a_u_s_e_d___p_a_c_k_e_t.html#aded4b1fae8826baefdfb11ebabc76c24">IgnoreDisassembling</a>    = DbgState-&gt;<a class="code hl_variable" href="struct___p_r_o_c_e_s_s_o_r___d_e_b_u_g_g_i_n_g___s_t_a_t_e.html#a2cde0a767eadada91cab15f3a0db5dbb">IgnoreDisasmInNextPacket</a>;</div>
<div class="line"><span class="lineno"> 2770</span>        DbgState-&gt;<a class="code hl_variable" href="struct___p_r_o_c_e_s_s_o_r___d_e_b_u_g_g_i_n_g___s_t_a_t_e.html#a2cde0a767eadada91cab15f3a0db5dbb">IgnoreDisasmInNextPacket</a> = <a class="code hl_define" href="_basic_types_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div>
<div class="line"><span class="lineno"> 2771</span> </div>
<div class="line"><span class="lineno"> 2772</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 2773</span>        <span class="comment">// Set rflags for finding the results of conditional jumps</span></div>
<div class="line"><span class="lineno"> 2774</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 2775</span>        Rflags.AsUInt      = <a class="code hl_function" href="_export_8c.html#a65a0cf94fa34ebb1f4150ed97fa7abc0">VmFuncGetRflags</a>();</div>
<div class="line"><span class="lineno"> 2776</span>        PausePacket.<a class="code hl_variable" href="struct___d_e_b_u_g_g_e_e___k_d___p_a_u_s_e_d___p_a_c_k_e_t.html#a29e674840f7cab9cbe3267bf8bef572e">Rflags</a> = Rflags.AsUInt;</div>
<div class="line"><span class="lineno"> 2777</span> </div>
<div class="line"><span class="lineno"> 2778</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 2779</span>        <span class="comment">// Set the event tag (if it&#39;s an event)</span></div>
<div class="line"><span class="lineno"> 2780</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 2781</span>        <span class="keywordflow">if</span> (EventDetails != NULL)</div>
<div class="line"><span class="lineno"> 2782</span>        {</div>
<div class="line"><span class="lineno"> 2783</span>            PausePacket.<a class="code hl_variable" href="struct___d_e_b_u_g_g_e_e___k_d___p_a_u_s_e_d___p_a_c_k_e_t.html#a6bc867f46b9b8a81950d10a0307734fe">EventTag</a> = EventDetails-&gt;<a class="code hl_variable" href="struct___d_e_b_u_g_g_e_r___t_r_i_g_g_e_r_e_d___e_v_e_n_t___d_e_t_a_i_l_s.html#a4eed19d8d35fa2c8378db39e95dd9ef2">Tag</a>;</div>
<div class="line"><span class="lineno"> 2784</span>        }</div>
<div class="line"><span class="lineno"> 2785</span> </div>
<div class="line"><span class="lineno"> 2786</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 2787</span>        <span class="comment">// Read the instruction len hint</span></div>
<div class="line"><span class="lineno"> 2788</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 2789</span>        <span class="keywordflow">if</span> (DbgState-&gt;<a class="code hl_variable" href="struct___p_r_o_c_e_s_s_o_r___d_e_b_u_g_g_i_n_g___s_t_a_t_e.html#ac0735b6e84ce3ae397f74cfd5b4eabb4">InstructionLengthHint</a> != 0)</div>
<div class="line"><span class="lineno"> 2790</span>        {</div>
<div class="line"><span class="lineno"> 2791</span>            ExitInstructionLength = DbgState-&gt;<a class="code hl_variable" href="struct___p_r_o_c_e_s_s_o_r___d_e_b_u_g_g_i_n_g___s_t_a_t_e.html#ac0735b6e84ce3ae397f74cfd5b4eabb4">InstructionLengthHint</a>;</div>
<div class="line"><span class="lineno"> 2792</span>        }</div>
<div class="line"><span class="lineno"> 2793</span>        <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno"> 2794</span>        {</div>
<div class="line"><span class="lineno"> 2795</span>            <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 2796</span>            <span class="comment">// Reading instruction length (VMCS_VMEXIT_INSTRUCTION_LENGTH) won&#39;t work for anything that is not instruction exiting,</span></div>
<div class="line"><span class="lineno"> 2797</span>            <span class="comment">// so we won&#39;t use it anymore</span></div>
<div class="line"><span class="lineno"> 2798</span>            <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 2799</span> </div>
<div class="line"><span class="lineno"> 2800</span>            <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 2801</span>            <span class="comment">// Set the length to notify debuggee</span></div>
<div class="line"><span class="lineno"> 2802</span>            <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 2803</span>            ExitInstructionLength = <a class="code hl_function" href="_address_check_8c.html#ad7237183f690522bfbc5caee88370eae">CheckAddressMaximumInstructionLength</a>(LastVmexitRip);</div>
<div class="line"><span class="lineno"> 2804</span>        }</div>
<div class="line"><span class="lineno"> 2805</span> </div>
<div class="line"><span class="lineno"> 2806</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 2807</span>        <span class="comment">// Set the reading length of bytes (for instruction disassembling)</span></div>
<div class="line"><span class="lineno"> 2808</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 2809</span>        PausePacket.<a class="code hl_variable" href="struct___d_e_b_u_g_g_e_e___k_d___p_a_u_s_e_d___p_a_c_k_e_t.html#a0f796658e06e2e73b3fea4390192b79d">ReadInstructionLen</a> = ExitInstructionLength;</div>
<div class="line"><span class="lineno"> 2810</span> </div>
<div class="line"><span class="lineno"> 2811</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 2812</span>        <span class="comment">// Find the current instruction</span></div>
<div class="line"><span class="lineno"> 2813</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 2814</span>        <a class="code hl_function" href="_memory_mapper_8c.html#a4b9c8387e09821a8668975ec6119782e">MemoryMapperReadMemorySafeOnTargetProcess</a>(LastVmexitRip,</div>
<div class="line"><span class="lineno"> 2815</span>                                                  &amp;PausePacket.<a class="code hl_variable" href="struct___d_e_b_u_g_g_e_e___k_d___p_a_u_s_e_d___p_a_c_k_e_t.html#a2e7f707431030c6f8f509b68015efb1b">InstructionBytesOnRip</a>,</div>
<div class="line"><span class="lineno"> 2816</span>                                                  ExitInstructionLength);</div>
<div class="line"><span class="lineno"> 2817</span> </div>
<div class="line"><span class="lineno"> 2818</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 2819</span>        <span class="comment">// Send the pause packet, along with RIP and an indication</span></div>
<div class="line"><span class="lineno"> 2820</span>        <span class="comment">// to pause to the debugger</span></div>
<div class="line"><span class="lineno"> 2821</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 2822</span>        <a class="code hl_function" href="_kd_8c.html#af5ce9948d5b3e6e5bb0246a42fb9e33f">KdResponsePacketToDebugger</a>(<a class="code hl_enumvalue" href="_connection_8h.html#a3b63482b33f70cef2d569a3628e842d8a2745713725bcc259626fc019fca4c1d8">DEBUGGER_REMOTE_PACKET_TYPE_DEBUGGEE_TO_DEBUGGER</a>,</div>
<div class="line"><span class="lineno"> 2823</span>                                   <a class="code hl_enumvalue" href="_connection_8h.html#ac0e6db4051893271cfa53c365980c7c7a964486510276b655bcf43e66f28e3f7f">DEBUGGER_REMOTE_PACKET_REQUESTED_ACTION_DEBUGGEE_PAUSED_AND_CURRENT_INSTRUCTION</a>,</div>
<div class="line"><span class="lineno"> 2824</span>                                   &amp;PausePacket,</div>
<div class="line"><span class="lineno"> 2825</span>                                   <span class="keyword">sizeof</span>(<a class="code hl_struct" href="struct___d_e_b_u_g_g_e_e___k_d___p_a_u_s_e_d___p_a_c_k_e_t.html">DEBUGGEE_KD_PAUSED_PACKET</a>));</div>
<div class="line"><span class="lineno"> 2826</span> </div>
<div class="line"><span class="lineno"> 2827</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 2828</span>        <span class="comment">// Perform Commands from the debugger</span></div>
<div class="line"><span class="lineno"> 2829</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 2830</span>        <a class="code hl_function" href="_kd_8c.html#a8a8ff209696d894e938f4ad71dbef9d3">KdDispatchAndPerformCommandsFromDebugger</a>(DbgState);</div>
<div class="line"><span class="lineno"> 2831</span> </div>
<div class="line"><span class="lineno"> 2832</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 2833</span>        <span class="comment">// Check if it&#39;s a change core event or not, otherwise finish the execution</span></div>
<div class="line"><span class="lineno"> 2834</span>        <span class="comment">// and continue debuggee</span></div>
<div class="line"><span class="lineno"> 2835</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 2836</span>        <span class="keywordflow">if</span> (!DbgState-&gt;<a class="code hl_variable" href="struct___p_r_o_c_e_s_s_o_r___d_e_b_u_g_g_i_n_g___s_t_a_t_e.html#a4c041c2d74937318d15c2736dc95f661">MainDebuggingCore</a>)</div>
<div class="line"><span class="lineno"> 2837</span>        {</div>
<div class="line"><span class="lineno"> 2838</span>            <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 2839</span>            <span class="comment">// It&#39;s a core switch, start again</span></div>
<div class="line"><span class="lineno"> 2840</span>            <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 2841</span>            <span class="keywordflow">goto</span> StartAgain;</div>
<div class="line"><span class="lineno"> 2842</span>        }</div>
<div class="line"><span class="lineno"> 2843</span>    }</div>
<div class="line"><span class="lineno"> 2844</span>    <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno"> 2845</span>    {</div>
<div class="line"><span class="lineno"> 2846</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 2847</span>        <span class="comment">// All cores except operating core</span></div>
<div class="line"><span class="lineno"> 2848</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 2849</span> </div>
<div class="line"><span class="lineno"> 2850</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 2851</span>        <span class="comment">// Lock and unlock the lock so all core can get the lock</span></div>
<div class="line"><span class="lineno"> 2852</span>        <span class="comment">// and continue their normal execution</span></div>
<div class="line"><span class="lineno"> 2853</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 2854</span>        DbgState-&gt;<a class="code hl_variable" href="struct___p_r_o_c_e_s_s_o_r___d_e_b_u_g_g_i_n_g___s_t_a_t_e.html#a0d22e0340ffa5de9190c09683fdfccf2">NmiState</a>.<a class="code hl_variable" href="struct___k_d___n_m_i___s_t_a_t_e.html#a6359e6a5d2e428c7dfc299e69592b9ef">WaitingToBeLocked</a> = <a class="code hl_define" href="_basic_types_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div>
<div class="line"><span class="lineno"> 2855</span> </div>
<div class="line"><span class="lineno"> 2856</span>        <a class="code hl_define" href="_spinlock_8h.html#ab7d1adaa816383a963ebae38e41f2f63">ScopedSpinlock</a>(</div>
<div class="line"><span class="lineno"> 2857</span>            DbgState-&gt;<a class="code hl_variable" href="struct___p_r_o_c_e_s_s_o_r___d_e_b_u_g_g_i_n_g___s_t_a_t_e.html#a5cb1b3e0fee150e30f93529efdcb324b">Lock</a>,</div>
<div class="line"><span class="lineno"> 2858</span>            <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 2859</span>            <span class="comment">// Check if it&#39;s a change core event or not</span></div>
<div class="line"><span class="lineno"> 2860</span>            <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 2861</span>            if (DbgState-&gt;<a class="code hl_variable" href="struct___p_r_o_c_e_s_s_o_r___d_e_b_u_g_g_i_n_g___s_t_a_t_e.html#a4c041c2d74937318d15c2736dc95f661">MainDebuggingCore</a>) {</div>
<div class="line"><span class="lineno"> 2862</span>                <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 2863</span>                <span class="comment">// It&#39;s a core change event</span></div>
<div class="line"><span class="lineno"> 2864</span>                <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 2865</span>                g_DebuggeeHaltReason = DEBUGGEE_PAUSING_REASON_DEBUGGEE_CORE_SWITCHED;</div>
<div class="line"><span class="lineno"> 2866</span> </div>
<div class="line"><span class="lineno"> 2867</span>                goto StartAgain;</div>
<div class="line"><span class="lineno"> 2868</span>            }</div>
<div class="line"><span class="lineno"> 2869</span> </div>
<div class="line"><span class="lineno"> 2870</span>        );</div>
<div class="line"><span class="lineno"> 2871</span>    }</div>
<div class="line"><span class="lineno"> 2872</span> </div>
<div class="line"><span class="lineno"> 2873</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 2874</span>    <span class="comment">// Apply the basic task for the core before continue</span></div>
<div class="line"><span class="lineno"> 2875</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 2876</span>    <a class="code hl_function" href="_kd_8c.html#aefe9d84bf256f6624b2c9c2376479514">KdApplyTasksPostContinueCore</a>(DbgState);</div>
<div class="line"><span class="lineno"> 2877</span>}</div>
<div class="ttc" id="a_address_check_8c_html_ad7237183f690522bfbc5caee88370eae"><div class="ttname"><a href="_address_check_8c.html#ad7237183f690522bfbc5caee88370eae">CheckAddressMaximumInstructionLength</a></div><div class="ttdeci">UINT32 CheckAddressMaximumInstructionLength(PVOID Address)</div><div class="ttdoc">This function returns the maximum instruction length that can be read from this address.</div><div class="ttdef"><b>Definition</b> AddressCheck.c:270</div></div>
<div class="ttc" id="a_connection_8h_html_a3b63482b33f70cef2d569a3628e842d8a2745713725bcc259626fc019fca4c1d8"><div class="ttname"><a href="_connection_8h.html#a3b63482b33f70cef2d569a3628e842d8a2745713725bcc259626fc019fca4c1d8">DEBUGGER_REMOTE_PACKET_TYPE_DEBUGGEE_TO_DEBUGGER</a></div><div class="ttdeci">@ DEBUGGER_REMOTE_PACKET_TYPE_DEBUGGEE_TO_DEBUGGER</div><div class="ttdef"><b>Definition</b> Connection.h:155</div></div>
<div class="ttc" id="a_connection_8h_html_ac0e6db4051893271cfa53c365980c7c7a964486510276b655bcf43e66f28e3f7f"><div class="ttname"><a href="_connection_8h.html#ac0e6db4051893271cfa53c365980c7c7a964486510276b655bcf43e66f28e3f7f">DEBUGGER_REMOTE_PACKET_REQUESTED_ACTION_DEBUGGEE_PAUSED_AND_CURRENT_INSTRUCTION</a></div><div class="ttdeci">@ DEBUGGER_REMOTE_PACKET_REQUESTED_ACTION_DEBUGGEE_PAUSED_AND_CURRENT_INSTRUCTION</div><div class="ttdef"><b>Definition</b> Connection.h:99</div></div>
<div class="ttc" id="a_export_8c_html_a65a0cf94fa34ebb1f4150ed97fa7abc0"><div class="ttname"><a href="_export_8c.html#a65a0cf94fa34ebb1f4150ed97fa7abc0">VmFuncGetRflags</a></div><div class="ttdeci">UINT64 VmFuncGetRflags()</div><div class="ttdoc">Read guest's RFLAGS.</div><div class="ttdef"><b>Definition</b> Export.c:352</div></div>
<div class="ttc" id="a_kd_8c_html_a26ca81a35a0a6e96b7067f59e97d657f"><div class="ttname"><a href="_kd_8c.html#a26ca81a35a0a6e96b7067f59e97d657f">KdApplyTasksPreHaltCore</a></div><div class="ttdeci">VOID KdApplyTasksPreHaltCore(PROCESSOR_DEBUGGING_STATE *DbgState)</div><div class="ttdoc">before halting any core, all the tasks will be applied to all cores including the main core</div><div class="ttdef"><b>Definition</b> Kd.c:478</div></div>
<div class="ttc" id="a_kd_8c_html_a814437795a9e923d352b848630625a56"><div class="ttname"><a href="_kd_8c.html#a814437795a9e923d352b848630625a56">KdIsGuestOnUsermode32Bit</a></div><div class="ttdeci">BOOLEAN KdIsGuestOnUsermode32Bit()</div><div class="ttdoc">determines if the guest was in 32-bit user-mode or 64-bit (long mode)</div><div class="ttdef"><b>Definition</b> Kd.c:2664</div></div>
<div class="ttc" id="a_kd_8c_html_a8a8ff209696d894e938f4ad71dbef9d3"><div class="ttname"><a href="_kd_8c.html#a8a8ff209696d894e938f4ad71dbef9d3">KdDispatchAndPerformCommandsFromDebugger</a></div><div class="ttdeci">VOID KdDispatchAndPerformCommandsFromDebugger(PROCESSOR_DEBUGGING_STATE *DbgState)</div><div class="ttdoc">This function applies commands from the debugger to the debuggee.</div><div class="ttdef"><b>Definition</b> Kd.c:1826</div></div>
<div class="ttc" id="a_kd_8c_html_aefe9d84bf256f6624b2c9c2376479514"><div class="ttname"><a href="_kd_8c.html#aefe9d84bf256f6624b2c9c2376479514">KdApplyTasksPostContinueCore</a></div><div class="ttdeci">VOID KdApplyTasksPostContinueCore(PROCESSOR_DEBUGGING_STATE *DbgState)</div><div class="ttdoc">before continue any core, all the tasks will be applied to all cores including the main core</div><div class="ttdef"><b>Definition</b> Kd.c:525</div></div>
<div class="ttc" id="a_kd_8c_html_af5ce9948d5b3e6e5bb0246a42fb9e33f"><div class="ttname"><a href="_kd_8c.html#af5ce9948d5b3e6e5bb0246a42fb9e33f">KdResponsePacketToDebugger</a></div><div class="ttdeci">_Use_decl_annotations_ BOOLEAN KdResponsePacketToDebugger(DEBUGGER_REMOTE_PACKET_TYPE PacketType, DEBUGGER_REMOTE_PACKET_REQUESTED_ACTION Response, CHAR *OptionalBuffer, UINT32 OptionalBufferLength)</div><div class="ttdoc">Sends a HyperDbg response packet to the debugger.</div><div class="ttdef"><b>Definition</b> Kd.c:243</div></div>
<div class="ttc" id="a_memory_mapper_8c_html_a4b9c8387e09821a8668975ec6119782e"><div class="ttname"><a href="_memory_mapper_8c.html#a4b9c8387e09821a8668975ec6119782e">MemoryMapperReadMemorySafeOnTargetProcess</a></div><div class="ttdeci">_Use_decl_annotations_ BOOLEAN MemoryMapperReadMemorySafeOnTargetProcess(UINT64 VaAddressToRead, PVOID BufferToSaveMemory, SIZE_T SizeToRead)</div><div class="ttdoc">Read memory safely by mapping the buffer on the target process memory (It's a wrapper)</div><div class="ttdef"><b>Definition</b> MemoryMapper.c:1076</div></div>
<div class="ttc" id="a_spinlock_8h_html_ab7d1adaa816383a963ebae38e41f2f63"><div class="ttname"><a href="_spinlock_8h.html#ab7d1adaa816383a963ebae38e41f2f63">ScopedSpinlock</a></div><div class="ttdeci">#define ScopedSpinlock(LockObject, CodeToRun)</div><div class="ttdef"><b>Definition</b> Spinlock.h:36</div></div>
<div class="ttc" id="ahprdbgkd_2header_2globals_2_global_8h_html_acf21790b2fc221ed28789a132d509cb7"><div class="ttname"><a href="hprdbgkd_2header_2globals_2_global_8h.html#acf21790b2fc221ed28789a132d509cb7">g_DebuggeeHaltReason</a></div><div class="ttdeci">DEBUGGEE_PAUSING_REASON g_DebuggeeHaltReason</div><div class="ttdoc">Reason that the debuggee is halted.</div><div class="ttdef"><b>Definition</b> Global.h:121</div></div>
<div class="ttc" id="astruct___d_e_b_u_g_g_e_e___k_d___p_a_u_s_e_d___p_a_c_k_e_t_html"><div class="ttname"><a href="struct___d_e_b_u_g_g_e_e___k_d___p_a_u_s_e_d___p_a_c_k_e_t.html">_DEBUGGEE_KD_PAUSED_PACKET</a></div><div class="ttdoc">The structure of pausing packet in kHyperDbg.</div><div class="ttdef"><b>Definition</b> DataTypes.h:157</div></div>
<div class="ttc" id="astruct___d_e_b_u_g_g_e_e___k_d___p_a_u_s_e_d___p_a_c_k_e_t_html_a0f796658e06e2e73b3fea4390192b79d"><div class="ttname"><a href="struct___d_e_b_u_g_g_e_e___k_d___p_a_u_s_e_d___p_a_c_k_e_t.html#a0f796658e06e2e73b3fea4390192b79d">_DEBUGGEE_KD_PAUSED_PACKET::ReadInstructionLen</a></div><div class="ttdeci">UINT16 ReadInstructionLen</div><div class="ttdef"><b>Definition</b> DataTypes.h:166</div></div>
<div class="ttc" id="astruct___d_e_b_u_g_g_e_e___k_d___p_a_u_s_e_d___p_a_c_k_e_t_html_a24ab04316c8cbfa77a9eb389181de510"><div class="ttname"><a href="struct___d_e_b_u_g_g_e_e___k_d___p_a_u_s_e_d___p_a_c_k_e_t.html#a24ab04316c8cbfa77a9eb389181de510">_DEBUGGEE_KD_PAUSED_PACKET::Rip</a></div><div class="ttdeci">UINT64 Rip</div><div class="ttdef"><b>Definition</b> DataTypes.h:158</div></div>
<div class="ttc" id="astruct___d_e_b_u_g_g_e_e___k_d___p_a_u_s_e_d___p_a_c_k_e_t_html_a29e674840f7cab9cbe3267bf8bef572e"><div class="ttname"><a href="struct___d_e_b_u_g_g_e_e___k_d___p_a_u_s_e_d___p_a_c_k_e_t.html#a29e674840f7cab9cbe3267bf8bef572e">_DEBUGGEE_KD_PAUSED_PACKET::Rflags</a></div><div class="ttdeci">UINT64 Rflags</div><div class="ttdef"><b>Definition</b> DataTypes.h:164</div></div>
<div class="ttc" id="astruct___d_e_b_u_g_g_e_e___k_d___p_a_u_s_e_d___p_a_c_k_e_t_html_a2e7f707431030c6f8f509b68015efb1b"><div class="ttname"><a href="struct___d_e_b_u_g_g_e_e___k_d___p_a_u_s_e_d___p_a_c_k_e_t.html#a2e7f707431030c6f8f509b68015efb1b">_DEBUGGEE_KD_PAUSED_PACKET::InstructionBytesOnRip</a></div><div class="ttdeci">BYTE InstructionBytesOnRip[MAXIMUM_INSTR_SIZE]</div><div class="ttdef"><b>Definition</b> DataTypes.h:165</div></div>
<div class="ttc" id="astruct___d_e_b_u_g_g_e_e___k_d___p_a_u_s_e_d___p_a_c_k_e_t_html_a44c1a04de19a49588f1dbaa6d2302294"><div class="ttname"><a href="struct___d_e_b_u_g_g_e_e___k_d___p_a_u_s_e_d___p_a_c_k_e_t.html#a44c1a04de19a49588f1dbaa6d2302294">_DEBUGGEE_KD_PAUSED_PACKET::PausingReason</a></div><div class="ttdeci">DEBUGGEE_PAUSING_REASON PausingReason</div><div class="ttdef"><b>Definition</b> DataTypes.h:161</div></div>
<div class="ttc" id="astruct___d_e_b_u_g_g_e_e___k_d___p_a_u_s_e_d___p_a_c_k_e_t_html_a4a0dce84ba049eb3503b3a138b73cba1"><div class="ttname"><a href="struct___d_e_b_u_g_g_e_e___k_d___p_a_u_s_e_d___p_a_c_k_e_t.html#a4a0dce84ba049eb3503b3a138b73cba1">_DEBUGGEE_KD_PAUSED_PACKET::Is32BitAddress</a></div><div class="ttdeci">BOOLEAN Is32BitAddress</div><div class="ttdef"><b>Definition</b> DataTypes.h:159</div></div>
<div class="ttc" id="astruct___d_e_b_u_g_g_e_e___k_d___p_a_u_s_e_d___p_a_c_k_e_t_html_a6bc867f46b9b8a81950d10a0307734fe"><div class="ttname"><a href="struct___d_e_b_u_g_g_e_e___k_d___p_a_u_s_e_d___p_a_c_k_e_t.html#a6bc867f46b9b8a81950d10a0307734fe">_DEBUGGEE_KD_PAUSED_PACKET::EventTag</a></div><div class="ttdeci">UINT64 EventTag</div><div class="ttdef"><b>Definition</b> DataTypes.h:163</div></div>
<div class="ttc" id="astruct___d_e_b_u_g_g_e_e___k_d___p_a_u_s_e_d___p_a_c_k_e_t_html_a908147ed36f20636e8dfc9238c2dd451"><div class="ttname"><a href="struct___d_e_b_u_g_g_e_e___k_d___p_a_u_s_e_d___p_a_c_k_e_t.html#a908147ed36f20636e8dfc9238c2dd451">_DEBUGGEE_KD_PAUSED_PACKET::CurrentCore</a></div><div class="ttdeci">ULONG CurrentCore</div><div class="ttdef"><b>Definition</b> DataTypes.h:162</div></div>
<div class="ttc" id="astruct___d_e_b_u_g_g_e_e___k_d___p_a_u_s_e_d___p_a_c_k_e_t_html_aded4b1fae8826baefdfb11ebabc76c24"><div class="ttname"><a href="struct___d_e_b_u_g_g_e_e___k_d___p_a_u_s_e_d___p_a_c_k_e_t.html#aded4b1fae8826baefdfb11ebabc76c24">_DEBUGGEE_KD_PAUSED_PACKET::IgnoreDisassembling</a></div><div class="ttdeci">BOOLEAN IgnoreDisassembling</div><div class="ttdef"><b>Definition</b> DataTypes.h:160</div></div>
<div class="ttc" id="astruct___d_e_b_u_g_g_e_r___t_r_i_g_g_e_r_e_d___e_v_e_n_t___d_e_t_a_i_l_s_html_a4eed19d8d35fa2c8378db39e95dd9ef2"><div class="ttname"><a href="struct___d_e_b_u_g_g_e_r___t_r_i_g_g_e_r_e_d___e_v_e_n_t___d_e_t_a_i_l_s.html#a4eed19d8d35fa2c8378db39e95dd9ef2">_DEBUGGER_TRIGGERED_EVENT_DETAILS::Tag</a></div><div class="ttdeci">UINT64 Tag</div><div class="ttdef"><b>Definition</b> BasicTypes.h:115</div></div>
<div class="ttc" id="astruct___p_r_o_c_e_s_s_o_r___d_e_b_u_g_g_i_n_g___s_t_a_t_e_html_a2cde0a767eadada91cab15f3a0db5dbb"><div class="ttname"><a href="struct___p_r_o_c_e_s_s_o_r___d_e_b_u_g_g_i_n_g___s_t_a_t_e.html#a2cde0a767eadada91cab15f3a0db5dbb">_PROCESSOR_DEBUGGING_STATE::IgnoreDisasmInNextPacket</a></div><div class="ttdeci">BOOLEAN IgnoreDisasmInNextPacket</div><div class="ttdef"><b>Definition</b> State.h:127</div></div>
<div class="ttc" id="astruct___p_r_o_c_e_s_s_o_r___d_e_b_u_g_g_i_n_g___s_t_a_t_e_html_a4c041c2d74937318d15c2736dc95f661"><div class="ttname"><a href="struct___p_r_o_c_e_s_s_o_r___d_e_b_u_g_g_i_n_g___s_t_a_t_e.html#a4c041c2d74937318d15c2736dc95f661">_PROCESSOR_DEBUGGING_STATE::MainDebuggingCore</a></div><div class="ttdeci">volatile BOOLEAN MainDebuggingCore</div><div class="ttdef"><b>Definition</b> State.h:122</div></div>
<div class="ttc" id="astruct___p_r_o_c_e_s_s_o_r___d_e_b_u_g_g_i_n_g___s_t_a_t_e_html_a5cb1b3e0fee150e30f93529efdcb324b"><div class="ttname"><a href="struct___p_r_o_c_e_s_s_o_r___d_e_b_u_g_g_i_n_g___s_t_a_t_e.html#a5cb1b3e0fee150e30f93529efdcb324b">_PROCESSOR_DEBUGGING_STATE::Lock</a></div><div class="ttdeci">volatile LONG Lock</div><div class="ttdef"><b>Definition</b> State.h:121</div></div>
<div class="ttc" id="astruct___p_r_o_c_e_s_s_o_r___d_e_b_u_g_g_i_n_g___s_t_a_t_e_html_ac0735b6e84ce3ae397f74cfd5b4eabb4"><div class="ttname"><a href="struct___p_r_o_c_e_s_s_o_r___d_e_b_u_g_g_i_n_g___s_t_a_t_e.html#ac0735b6e84ce3ae397f74cfd5b4eabb4">_PROCESSOR_DEBUGGING_STATE::InstructionLengthHint</a></div><div class="ttdeci">UINT16 InstructionLengthHint</div><div class="ttdef"><b>Definition</b> State.h:136</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="acc12878954fd8a1118d83f2cfe08052f" name="acc12878954fd8a1118d83f2cfe08052f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#acc12878954fd8a1118d83f2cfe08052f">&#9670;&#160;</a></span>KdQueryDebuggerQueryThreadOrProcessTracingDetailsByCoreId()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="_basic_types_8h.html#a1cb18096b299d23458d3c7b85fd86555">BOOLEAN</a> KdQueryDebuggerQueryThreadOrProcessTracingDetailsByCoreId </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="_basic_types_8h.html#ae1e6edbbc26d6fbc71a90190d0266018">UINT32</a>&#160;</td>
          <td class="paramname"><em>CoreId</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="_data_types_8h.html#ad6e74aca70f1102548c8fbe12b407384">DEBUGGER_THREAD_PROCESS_TRACING</a>&#160;</td>
          <td class="paramname"><em>TracingType</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Query for process/thread interception status. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">CoreId</td><td></td></tr>
    <tr><td class="paramname">TracingType</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>BOOLEAN whether it's activated or not </dd></dl>
<div class="fragment"><div class="line"><span class="lineno">  170</span>{</div>
<div class="line"><span class="lineno">  171</span>    <a class="code hl_typedef" href="_basic_types_8h.html#a1cb18096b299d23458d3c7b85fd86555">BOOLEAN</a>                     Result   = <a class="code hl_define" href="_basic_types_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div>
<div class="line"><span class="lineno">  172</span>    <a class="code hl_struct" href="struct___p_r_o_c_e_s_s_o_r___d_e_b_u_g_g_i_n_g___s_t_a_t_e.html">PROCESSOR_DEBUGGING_STATE</a> * DbgState = &amp;<a class="code hl_variable" href="hprdbgkd_2header_2globals_2_global_8h.html#a349ee1adc363d2e4323a35a68fae5646">g_DbgState</a>[CoreId];</div>
<div class="line"><span class="lineno">  173</span> </div>
<div class="line"><span class="lineno">  174</span>    <span class="keywordflow">switch</span> (TracingType)</div>
<div class="line"><span class="lineno">  175</span>    {</div>
<div class="line"><span class="lineno">  176</span>    <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="_data_types_8h.html#acfd6753933f87f36dcdc4ca89a98c2bba6fcabe7730de54788ae979fd117e10da">DEBUGGER_THREAD_PROCESS_TRACING_INTERCEPT_CLOCK_INTERRUPTS_FOR_THREAD_CHANGE</a>:</div>
<div class="line"><span class="lineno">  177</span> </div>
<div class="line"><span class="lineno">  178</span>        Result = DbgState-&gt;<a class="code hl_variable" href="struct___p_r_o_c_e_s_s_o_r___d_e_b_u_g_g_i_n_g___s_t_a_t_e.html#a8f17ce3238c1b7fcd0e8a53040cba548">ThreadOrProcessTracingDetails</a>.<a class="code hl_variable" href="struct___d_e_b_u_g_g_e_e___p_r_o_c_e_s_s___o_r___t_h_r_e_a_d___t_r_a_c_i_n_g___d_e_t_a_i_l_s.html#abed37561390beafa280eb6b67b357c41">InterceptClockInterruptsForThreadChange</a>;</div>
<div class="line"><span class="lineno">  179</span> </div>
<div class="line"><span class="lineno">  180</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  181</span> </div>
<div class="line"><span class="lineno">  182</span>    <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="_data_types_8h.html#acfd6753933f87f36dcdc4ca89a98c2bba86c07de6df8f91fb9bdcacafef9cf97e">DEBUGGER_THREAD_PROCESS_TRACING_INTERCEPT_CLOCK_INTERRUPTS_FOR_PROCESS_CHANGE</a>:</div>
<div class="line"><span class="lineno">  183</span> </div>
<div class="line"><span class="lineno">  184</span>        Result = DbgState-&gt;<a class="code hl_variable" href="struct___p_r_o_c_e_s_s_o_r___d_e_b_u_g_g_i_n_g___s_t_a_t_e.html#a8f17ce3238c1b7fcd0e8a53040cba548">ThreadOrProcessTracingDetails</a>.<a class="code hl_variable" href="struct___d_e_b_u_g_g_e_e___p_r_o_c_e_s_s___o_r___t_h_r_e_a_d___t_r_a_c_i_n_g___d_e_t_a_i_l_s.html#a20a517035c8a845e5d3fd60012b1acf5">InterceptClockInterruptsForProcessChange</a>;</div>
<div class="line"><span class="lineno">  185</span> </div>
<div class="line"><span class="lineno">  186</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  187</span> </div>
<div class="line"><span class="lineno">  188</span>    <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="_data_types_8h.html#acfd6753933f87f36dcdc4ca89a98c2bba8a119c7a070b95e9637dde60782d0efd">DEBUGGER_THREAD_PROCESS_TRACING_INTERCEPT_CLOCK_DEBUG_REGISTER_INTERCEPTION</a>:</div>
<div class="line"><span class="lineno">  189</span> </div>
<div class="line"><span class="lineno">  190</span>        Result = DbgState-&gt;<a class="code hl_variable" href="struct___p_r_o_c_e_s_s_o_r___d_e_b_u_g_g_i_n_g___s_t_a_t_e.html#a8f17ce3238c1b7fcd0e8a53040cba548">ThreadOrProcessTracingDetails</a>.<a class="code hl_variable" href="struct___d_e_b_u_g_g_e_e___p_r_o_c_e_s_s___o_r___t_h_r_e_a_d___t_r_a_c_i_n_g___d_e_t_a_i_l_s.html#a828cb9812e870d901c9397930c02a451">DebugRegisterInterceptionState</a>;</div>
<div class="line"><span class="lineno">  191</span> </div>
<div class="line"><span class="lineno">  192</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  193</span> </div>
<div class="line"><span class="lineno">  194</span>    <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="_data_types_8h.html#acfd6753933f87f36dcdc4ca89a98c2bbaa42dc9a9650eab4092275352044c1091">DEBUGGER_THREAD_PROCESS_TRACING_INTERCEPT_CLOCK_WAITING_FOR_MOV_CR3_VM_EXITS</a>:</div>
<div class="line"><span class="lineno">  195</span> </div>
<div class="line"><span class="lineno">  196</span>        Result = DbgState-&gt;<a class="code hl_variable" href="struct___p_r_o_c_e_s_s_o_r___d_e_b_u_g_g_i_n_g___s_t_a_t_e.html#a8f17ce3238c1b7fcd0e8a53040cba548">ThreadOrProcessTracingDetails</a>.<a class="code hl_variable" href="struct___d_e_b_u_g_g_e_e___p_r_o_c_e_s_s___o_r___t_h_r_e_a_d___t_r_a_c_i_n_g___d_e_t_a_i_l_s.html#a8d5059c7d9400a075fa5dcb1499ea40f">IsWatingForMovCr3VmExits</a>;</div>
<div class="line"><span class="lineno">  197</span> </div>
<div class="line"><span class="lineno">  198</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  199</span> </div>
<div class="line"><span class="lineno">  200</span>    <span class="keywordflow">default</span>:</div>
<div class="line"><span class="lineno">  201</span> </div>
<div class="line"><span class="lineno">  202</span>        <a class="code hl_define" href="_hyper_dbg_hyper_log_intrinsics_8h.html#a459b19922fecfbb9438dd56b66930d16">LogError</a>(<span class="stringliteral">&quot;Err, debugger encountered an unknown query type for querying process or thread interception details&quot;</span>);</div>
<div class="line"><span class="lineno">  203</span> </div>
<div class="line"><span class="lineno">  204</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  205</span>    }</div>
<div class="line"><span class="lineno">  206</span> </div>
<div class="line"><span class="lineno">  207</span>    <span class="keywordflow">return</span> Result;</div>
<div class="line"><span class="lineno">  208</span>}</div>
<div class="ttc" id="a_data_types_8h_html_acfd6753933f87f36dcdc4ca89a98c2bba6fcabe7730de54788ae979fd117e10da"><div class="ttname"><a href="_data_types_8h.html#acfd6753933f87f36dcdc4ca89a98c2bba6fcabe7730de54788ae979fd117e10da">DEBUGGER_THREAD_PROCESS_TRACING_INTERCEPT_CLOCK_INTERRUPTS_FOR_THREAD_CHANGE</a></div><div class="ttdeci">@ DEBUGGER_THREAD_PROCESS_TRACING_INTERCEPT_CLOCK_INTERRUPTS_FOR_THREAD_CHANGE</div><div class="ttdef"><b>Definition</b> DataTypes.h:79</div></div>
<div class="ttc" id="a_data_types_8h_html_acfd6753933f87f36dcdc4ca89a98c2bba86c07de6df8f91fb9bdcacafef9cf97e"><div class="ttname"><a href="_data_types_8h.html#acfd6753933f87f36dcdc4ca89a98c2bba86c07de6df8f91fb9bdcacafef9cf97e">DEBUGGER_THREAD_PROCESS_TRACING_INTERCEPT_CLOCK_INTERRUPTS_FOR_PROCESS_CHANGE</a></div><div class="ttdeci">@ DEBUGGER_THREAD_PROCESS_TRACING_INTERCEPT_CLOCK_INTERRUPTS_FOR_PROCESS_CHANGE</div><div class="ttdef"><b>Definition</b> DataTypes.h:80</div></div>
<div class="ttc" id="a_data_types_8h_html_acfd6753933f87f36dcdc4ca89a98c2bba8a119c7a070b95e9637dde60782d0efd"><div class="ttname"><a href="_data_types_8h.html#acfd6753933f87f36dcdc4ca89a98c2bba8a119c7a070b95e9637dde60782d0efd">DEBUGGER_THREAD_PROCESS_TRACING_INTERCEPT_CLOCK_DEBUG_REGISTER_INTERCEPTION</a></div><div class="ttdeci">@ DEBUGGER_THREAD_PROCESS_TRACING_INTERCEPT_CLOCK_DEBUG_REGISTER_INTERCEPTION</div><div class="ttdef"><b>Definition</b> DataTypes.h:81</div></div>
<div class="ttc" id="a_data_types_8h_html_acfd6753933f87f36dcdc4ca89a98c2bbaa42dc9a9650eab4092275352044c1091"><div class="ttname"><a href="_data_types_8h.html#acfd6753933f87f36dcdc4ca89a98c2bbaa42dc9a9650eab4092275352044c1091">DEBUGGER_THREAD_PROCESS_TRACING_INTERCEPT_CLOCK_WAITING_FOR_MOV_CR3_VM_EXITS</a></div><div class="ttdeci">@ DEBUGGER_THREAD_PROCESS_TRACING_INTERCEPT_CLOCK_WAITING_FOR_MOV_CR3_VM_EXITS</div><div class="ttdef"><b>Definition</b> DataTypes.h:82</div></div>
<div class="ttc" id="astruct___d_e_b_u_g_g_e_e___p_r_o_c_e_s_s___o_r___t_h_r_e_a_d___t_r_a_c_i_n_g___d_e_t_a_i_l_s_html_a20a517035c8a845e5d3fd60012b1acf5"><div class="ttname"><a href="struct___d_e_b_u_g_g_e_e___p_r_o_c_e_s_s___o_r___t_h_r_e_a_d___t_r_a_c_i_n_g___d_e_t_a_i_l_s.html#a20a517035c8a845e5d3fd60012b1acf5">_DEBUGGEE_PROCESS_OR_THREAD_TRACING_DETAILS::InterceptClockInterruptsForProcessChange</a></div><div class="ttdeci">BOOLEAN InterceptClockInterruptsForProcessChange</div><div class="ttdef"><b>Definition</b> State.h:63</div></div>
<div class="ttc" id="astruct___d_e_b_u_g_g_e_e___p_r_o_c_e_s_s___o_r___t_h_r_e_a_d___t_r_a_c_i_n_g___d_e_t_a_i_l_s_html_a828cb9812e870d901c9397930c02a451"><div class="ttname"><a href="struct___d_e_b_u_g_g_e_e___p_r_o_c_e_s_s___o_r___t_h_r_e_a_d___t_r_a_c_i_n_g___d_e_t_a_i_l_s.html#a828cb9812e870d901c9397930c02a451">_DEBUGGEE_PROCESS_OR_THREAD_TRACING_DETAILS::DebugRegisterInterceptionState</a></div><div class="ttdeci">BOOLEAN DebugRegisterInterceptionState</div><div class="ttdef"><b>Definition</b> State.h:56</div></div>
<div class="ttc" id="astruct___d_e_b_u_g_g_e_e___p_r_o_c_e_s_s___o_r___t_h_r_e_a_d___t_r_a_c_i_n_g___d_e_t_a_i_l_s_html_a8d5059c7d9400a075fa5dcb1499ea40f"><div class="ttname"><a href="struct___d_e_b_u_g_g_e_e___p_r_o_c_e_s_s___o_r___t_h_r_e_a_d___t_r_a_c_i_n_g___d_e_t_a_i_l_s.html#a8d5059c7d9400a075fa5dcb1499ea40f">_DEBUGGEE_PROCESS_OR_THREAD_TRACING_DETAILS::IsWatingForMovCr3VmExits</a></div><div class="ttdeci">BOOLEAN IsWatingForMovCr3VmExits</div><div class="ttdef"><b>Definition</b> State.h:62</div></div>
<div class="ttc" id="astruct___d_e_b_u_g_g_e_e___p_r_o_c_e_s_s___o_r___t_h_r_e_a_d___t_r_a_c_i_n_g___d_e_t_a_i_l_s_html_abed37561390beafa280eb6b67b357c41"><div class="ttname"><a href="struct___d_e_b_u_g_g_e_e___p_r_o_c_e_s_s___o_r___t_h_r_e_a_d___t_r_a_c_i_n_g___d_e_t_a_i_l_s.html#abed37561390beafa280eb6b67b357c41">_DEBUGGEE_PROCESS_OR_THREAD_TRACING_DETAILS::InterceptClockInterruptsForThreadChange</a></div><div class="ttdeci">BOOLEAN InterceptClockInterruptsForThreadChange</div><div class="ttdef"><b>Definition</b> State.h:57</div></div>
<div class="ttc" id="astruct___p_r_o_c_e_s_s_o_r___d_e_b_u_g_g_i_n_g___s_t_a_t_e_html_a8f17ce3238c1b7fcd0e8a53040cba548"><div class="ttname"><a href="struct___p_r_o_c_e_s_s_o_r___d_e_b_u_g_g_i_n_g___s_t_a_t_e.html#a8f17ce3238c1b7fcd0e8a53040cba548">_PROCESSOR_DEBUGGING_STATE::ThreadOrProcessTracingDetails</a></div><div class="ttdeci">DEBUGGEE_PROCESS_OR_THREAD_TRACING_DETAILS ThreadOrProcessTracingDetails</div><div class="ttdef"><b>Definition</b> State.h:133</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ae67a719083cf8982cdf9c0283c8779bd" name="ae67a719083cf8982cdf9c0283c8779bd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae67a719083cf8982cdf9c0283c8779bd">&#9670;&#160;</a></span>KdResponsePacketToDebugger()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="_basic_types_8h.html#a1cb18096b299d23458d3c7b85fd86555">BOOLEAN</a> KdResponsePacketToDebugger </td>
          <td>(</td>
          <td class="paramtype">_In_ _Strict_type_match_ <a class="el" href="_connection_8h.html#a4924566aaf12e93c1e2a037d12bc32fe">DEBUGGER_REMOTE_PACKET_TYPE</a>&#160;</td>
          <td class="paramname"><em>PacketType</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">_In_ _Strict_type_match_ <a class="el" href="_connection_8h.html#a4c14c05a1e67ce2b3fcf780d0e622424">DEBUGGER_REMOTE_PACKET_REQUESTED_ACTION</a>&#160;</td>
          <td class="paramname"><em>Response</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">_In_reads_bytes_opt_(OptionalBufferLength) <a class="el" href="_basic_types_8h.html#aebb9e13210d88d43e32e735ada43a425">CHAR</a> *&#160;</td>
          <td class="paramname"><em>OptionalBuffer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">_In_ <a class="el" href="_basic_types_8h.html#ae1e6edbbc26d6fbc71a90190d0266018">UINT32</a>&#160;</td>
          <td class="paramname"><em>OptionalBufferLength</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a38ba4b9350674375c024a9f2b63c7907" name="a38ba4b9350674375c024a9f2b63c7907"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a38ba4b9350674375c024a9f2b63c7907">&#9670;&#160;</a></span>KdSendCommandFinishedSignal()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="_basic_types_8h.html#a7f319bfc2492a2136964194204e7a8cf">VOID</a> KdSendCommandFinishedSignal </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="_basic_types_8h.html#ae1e6edbbc26d6fbc71a90190d0266018">UINT32</a>&#160;</td>
          <td class="paramname"><em>CoreId</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Notify debugger that the execution of command finished. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">CoreId</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>VOID </dd></dl>
<div class="fragment"><div class="line"><span class="lineno">  862</span>{</div>
<div class="line"><span class="lineno">  863</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">  864</span>    <span class="comment">// Halt other cores again</span></div>
<div class="line"><span class="lineno">  865</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">  866</span>    <a class="code hl_function" href="_kd_8c.html#a3dd81f890bc081d3920c2f8ed8dcaf58">KdHandleBreakpointAndDebugBreakpointsCallback</a>(CoreId,</div>
<div class="line"><span class="lineno">  867</span>                                                  <a class="code hl_enumvalue" href="_connection_8h.html#a6e2be89205e735ebae644cf4850ac21bad6ffb5d5b6e53c2a257cb389e131ff4b">DEBUGGEE_PAUSING_REASON_DEBUGGEE_COMMAND_EXECUTION_FINISHED</a>,</div>
<div class="line"><span class="lineno">  868</span>                                                  NULL);</div>
<div class="line"><span class="lineno">  869</span>}</div>
<div class="ttc" id="a_connection_8h_html_a6e2be89205e735ebae644cf4850ac21bad6ffb5d5b6e53c2a257cb389e131ff4b"><div class="ttname"><a href="_connection_8h.html#a6e2be89205e735ebae644cf4850ac21bad6ffb5d5b6e53c2a257cb389e131ff4b">DEBUGGEE_PAUSING_REASON_DEBUGGEE_COMMAND_EXECUTION_FINISHED</a></div><div class="ttdeci">@ DEBUGGEE_PAUSING_REASON_DEBUGGEE_COMMAND_EXECUTION_FINISHED</div><div class="ttdef"><b>Definition</b> Connection.h:34</div></div>
<div class="ttc" id="a_kd_8c_html_a3dd81f890bc081d3920c2f8ed8dcaf58"><div class="ttname"><a href="_kd_8c.html#a3dd81f890bc081d3920c2f8ed8dcaf58">KdHandleBreakpointAndDebugBreakpointsCallback</a></div><div class="ttdeci">_Use_decl_annotations_ VOID KdHandleBreakpointAndDebugBreakpointsCallback(UINT32 CoreId, DEBUGGEE_PAUSING_REASON Reason, PDEBUGGER_TRIGGERED_EVENT_DETAILS EventDetails)</div><div class="ttdoc">Handle #DBs and #BPs for kernel debugger.</div><div class="ttdef"><b>Definition</b> Kd.c:1061</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a0af968467072898abb6bbd25495a06eb" name="a0af968467072898abb6bbd25495a06eb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0af968467072898abb6bbd25495a06eb">&#9670;&#160;</a></span>KdSendFormatsFunctionResult()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="_basic_types_8h.html#a7f319bfc2492a2136964194204e7a8cf">VOID</a> KdSendFormatsFunctionResult </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="_basic_types_8h.html#aae17ebb9ef7279d026817fb22f8aebe9">UINT64</a>&#160;</td>
          <td class="paramname"><em>Value</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Notify user-mode to unload the debuggee and close the connections. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">Value</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>VOID </dd></dl>
<div class="fragment"><div class="line"><span class="lineno">  838</span>{</div>
<div class="line"><span class="lineno">  839</span>    <a class="code hl_struct" href="struct___d_e_b_u_g_g_e_e___f_o_r_m_a_t_s___p_a_c_k_e_t.html">DEBUGGEE_FORMATS_PACKET</a> FormatsPacket = {0};</div>
<div class="line"><span class="lineno">  840</span> </div>
<div class="line"><span class="lineno">  841</span>    FormatsPacket.<a class="code hl_variable" href="struct___d_e_b_u_g_g_e_e___f_o_r_m_a_t_s___p_a_c_k_e_t.html#aa78cacc685a1832051a48d2591ff4d32">Result</a> = <a class="code hl_define" href="_error_codes_8h.html#aed656c58434eecb2d7e8c10e93aecff4">DEBUGGER_OPERATION_WAS_SUCCESSFUL</a>;</div>
<div class="line"><span class="lineno">  842</span>    FormatsPacket.<a class="code hl_variable" href="struct___d_e_b_u_g_g_e_e___f_o_r_m_a_t_s___p_a_c_k_e_t.html#ab2aca2b76d083f1882f41597bd8dae87">Value</a>  = Value;</div>
<div class="line"><span class="lineno">  843</span> </div>
<div class="line"><span class="lineno">  844</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">  845</span>    <span class="comment">// Kernel debugger is active, we should send the bytes over serial</span></div>
<div class="line"><span class="lineno">  846</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">  847</span>    <a class="code hl_function" href="_kd_8c.html#af5ce9948d5b3e6e5bb0246a42fb9e33f">KdResponsePacketToDebugger</a>(</div>
<div class="line"><span class="lineno">  848</span>        <a class="code hl_enumvalue" href="_connection_8h.html#a3b63482b33f70cef2d569a3628e842d8a2745713725bcc259626fc019fca4c1d8">DEBUGGER_REMOTE_PACKET_TYPE_DEBUGGEE_TO_DEBUGGER</a>,</div>
<div class="line"><span class="lineno">  849</span>        <a class="code hl_enumvalue" href="_connection_8h.html#ac0e6db4051893271cfa53c365980c7c7afe4d1a15fd8ee7a9679e08c80c4eecfb">DEBUGGER_REMOTE_PACKET_REQUESTED_ACTION_DEBUGGEE_RESULT_OF_FORMATS</a>,</div>
<div class="line"><span class="lineno">  850</span>        &amp;FormatsPacket,</div>
<div class="line"><span class="lineno">  851</span>        <span class="keyword">sizeof</span>(<a class="code hl_struct" href="struct___d_e_b_u_g_g_e_e___f_o_r_m_a_t_s___p_a_c_k_e_t.html">DEBUGGEE_FORMATS_PACKET</a>));</div>
<div class="line"><span class="lineno">  852</span>}</div>
<div class="ttc" id="a_connection_8h_html_ac0e6db4051893271cfa53c365980c7c7afe4d1a15fd8ee7a9679e08c80c4eecfb"><div class="ttname"><a href="_connection_8h.html#ac0e6db4051893271cfa53c365980c7c7afe4d1a15fd8ee7a9679e08c80c4eecfb">DEBUGGER_REMOTE_PACKET_REQUESTED_ACTION_DEBUGGEE_RESULT_OF_FORMATS</a></div><div class="ttdeci">@ DEBUGGER_REMOTE_PACKET_REQUESTED_ACTION_DEBUGGEE_RESULT_OF_FORMATS</div><div class="ttdef"><b>Definition</b> Connection.h:104</div></div>
<div class="ttc" id="astruct___d_e_b_u_g_g_e_e___f_o_r_m_a_t_s___p_a_c_k_e_t_html"><div class="ttname"><a href="struct___d_e_b_u_g_g_e_e___f_o_r_m_a_t_s___p_a_c_k_e_t.html">_DEBUGGEE_FORMATS_PACKET</a></div><div class="ttdoc">The structure of .formats result packet in HyperDbg.</div><div class="ttdef"><b>Definition</b> RequestStructures.h:1002</div></div>
<div class="ttc" id="astruct___d_e_b_u_g_g_e_e___f_o_r_m_a_t_s___p_a_c_k_e_t_html_aa78cacc685a1832051a48d2591ff4d32"><div class="ttname"><a href="struct___d_e_b_u_g_g_e_e___f_o_r_m_a_t_s___p_a_c_k_e_t.html#aa78cacc685a1832051a48d2591ff4d32">_DEBUGGEE_FORMATS_PACKET::Result</a></div><div class="ttdeci">UINT32 Result</div><div class="ttdef"><b>Definition</b> RequestStructures.h:1004</div></div>
<div class="ttc" id="astruct___d_e_b_u_g_g_e_e___f_o_r_m_a_t_s___p_a_c_k_e_t_html_ab2aca2b76d083f1882f41597bd8dae87"><div class="ttname"><a href="struct___d_e_b_u_g_g_e_e___f_o_r_m_a_t_s___p_a_c_k_e_t.html#ab2aca2b76d083f1882f41597bd8dae87">_DEBUGGEE_FORMATS_PACKET::Value</a></div><div class="ttdeci">UINT64 Value</div><div class="ttdef"><b>Definition</b> RequestStructures.h:1003</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a93b5f11529ccadc52cc47bccb072ed27" name="a93b5f11529ccadc52cc47bccb072ed27"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a93b5f11529ccadc52cc47bccb072ed27">&#9670;&#160;</a></span>KdUninitializeKernelDebugger()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="_basic_types_8h.html#a7f319bfc2492a2136964194204e7a8cf">VOID</a> KdUninitializeKernelDebugger </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>uninitialize kernel debugger </p>
<p>this function should be called on vmx non-root</p>
<dl class="section return"><dt>Returns</dt><dd>VOID </dd></dl>
<div class="fragment"><div class="line"><span class="lineno">   80</span>{</div>
<div class="line"><span class="lineno">   81</span>    <a class="code hl_typedef" href="_basic_types_8h.html#af632da489ebc3708ec3ab6791ee53fa4">ULONG</a> CoreCount;</div>
<div class="line"><span class="lineno">   82</span> </div>
<div class="line"><span class="lineno">   83</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="hprdbgkd_2header_2globals_2_global_8h.html#ae4b5afa957e3e26377135b91b60eda4e">g_KernelDebuggerState</a>)</div>
<div class="line"><span class="lineno">   84</span>    {</div>
<div class="line"><span class="lineno">   85</span>        CoreCount = KeQueryActiveProcessorCount(0);</div>
<div class="line"><span class="lineno">   86</span> </div>
<div class="line"><span class="lineno">   87</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno">   88</span>        <span class="comment">// Indicate that the kernel debugger is not active</span></div>
<div class="line"><span class="lineno">   89</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno">   90</span>        <a class="code hl_variable" href="hprdbgkd_2header_2globals_2_global_8h.html#ae4b5afa957e3e26377135b91b60eda4e">g_KernelDebuggerState</a> = <a class="code hl_define" href="_basic_types_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div>
<div class="line"><span class="lineno">   91</span> </div>
<div class="line"><span class="lineno">   92</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno">   93</span>        <span class="comment">// Reset pause break requests</span></div>
<div class="line"><span class="lineno">   94</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno">   95</span>        RtlZeroMemory(&amp;<a class="code hl_variable" href="hprdbgkd_2header_2globals_2_global_8h.html#a0c50a3971433f95430249d30dfc9856b">g_IgnoreBreaksToDebugger</a>, <span class="keyword">sizeof</span>(<a class="code hl_struct" href="struct___d_e_b_u_g_g_e_e___r_e_q_u_e_s_t___t_o___i_g_n_o_r_e___b_r_e_a_k_s___u_n_t_i_l___a_n___e_v_e_n_t.html">DEBUGGEE_REQUEST_TO_IGNORE_BREAKS_UNTIL_AN_EVENT</a>));</div>
<div class="line"><span class="lineno">   96</span> </div>
<div class="line"><span class="lineno">   97</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno">   98</span>        <span class="comment">// Remove all active breakpoints</span></div>
<div class="line"><span class="lineno">   99</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno">  100</span>        <a class="code hl_function" href="_breakpoint_commands_8c.html#af5a28890d7cdeb6e697ba8c41d2bbbe7">BreakpointRemoveAllBreakpoints</a>();</div>
<div class="line"><span class="lineno">  101</span> </div>
<div class="line"><span class="lineno">  102</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno">  103</span>        <span class="comment">// Disable vm-exit on Hardware debug exceptions and breakpoints</span></div>
<div class="line"><span class="lineno">  104</span>        <span class="comment">// so, not intercept #DBs and #BP by changing exception bitmap (one core)</span></div>
<div class="line"><span class="lineno">  105</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno">  106</span>        <a class="code hl_function" href="_broadcast_8c.html#ab1152780541f8b9d3685259e3c294b01">BroadcastDisableDbAndBpExitingAllCores</a>();</div>
<div class="line"><span class="lineno">  107</span>    }</div>
<div class="line"><span class="lineno">  108</span>}</div>
<div class="ttc" id="a_breakpoint_commands_8c_html_af5a28890d7cdeb6e697ba8c41d2bbbe7"><div class="ttname"><a href="_breakpoint_commands_8c.html#af5a28890d7cdeb6e697ba8c41d2bbbe7">BreakpointRemoveAllBreakpoints</a></div><div class="ttdeci">VOID BreakpointRemoveAllBreakpoints()</div><div class="ttdoc">Remove all the breakpoints if possible.</div><div class="ttdef"><b>Definition</b> BreakpointCommands.c:549</div></div>
<div class="ttc" id="a_broadcast_8c_html_ab1152780541f8b9d3685259e3c294b01"><div class="ttname"><a href="_broadcast_8c.html#ab1152780541f8b9d3685259e3c294b01">BroadcastDisableDbAndBpExitingAllCores</a></div><div class="ttdeci">VOID BroadcastDisableDbAndBpExitingAllCores()</div><div class="ttdoc">routines to unset vm-exit on all #DBs and #BP on all cores</div><div class="ttdef"><b>Definition</b> Broadcast.c:49</div></div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a id="aa8f0690057ff0d1c6f2f42dbbdb3ee96" name="aa8f0690057ff0d1c6f2f42dbbdb3ee96"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa8f0690057ff0d1c6f2f42dbbdb3ee96">&#9670;&#160;</a></span>DebuggerHandleBreakpointLock</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">volatile LONG DebuggerHandleBreakpointLock</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Vmx-root lock for handling breaks to debugger. </p>

</div>
</div>
<a id="ac9e9a8a58602b96c760514fbe7a268d4" name="ac9e9a8a58602b96c760514fbe7a268d4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac9e9a8a58602b96c760514fbe7a268d4">&#9670;&#160;</a></span>DebuggerResponseLock</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">volatile LONG DebuggerResponseLock</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Vmx-root lock for sending response of debugger. </p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_53a6cdbae347618e9ee76d4be5c6ea96.html">hyperdbg</a></li><li class="navelem"><a class="el" href="dir_0f75a8685de99980df6b10136f072ea3.html">hprdbgkd</a></li><li class="navelem"><a class="el" href="dir_a49bef8785c3fd81042e69d2866eb23c.html">header</a></li><li class="navelem"><a class="el" href="dir_c5c32dbaf8d06eb5e35478b4712c2bd5.html">debugger</a></li><li class="navelem"><a class="el" href="dir_a4560ab6759fbcbef2a05937d6236f05.html">kernel-level</a></li><li class="navelem"><a class="el" href="hprdbgkd_2header_2debugger_2kernel-level_2kd_8h.html">Kd.h</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.7 </li>
  </ul>
</div>
</body>
</html>
