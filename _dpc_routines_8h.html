<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>HyperDbg Debugger: hyperdbg/hprdbghv/DpcRoutines.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">HyperDbg Debugger
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('_dpc_routines_8h.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">DpcRoutines.h File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>headers of all the dpc routines which relates to executing on a single core  
<a href="#details">More...</a></p>

<p><a href="_dpc_routines_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a860d1d5fbe8605d03eda7327935c799e"><td class="memItemLeft" align="right" valign="top">NTSTATUS&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_dpc_routines_8h.html#a860d1d5fbe8605d03eda7327935c799e">DpcRoutineRunTaskOnSingleCore</a> (UINT32 CoreNumber, PVOID Routine, PVOID DeferredContext)</td></tr>
<tr class="memdesc:a860d1d5fbe8605d03eda7327935c799e"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function synchronize the function execution for a single core You should only used it for one core, not in multiple threads simultaneously The function that needs to use this featue (Routine parameter function) should have the when it ends :  <a href="_dpc_routines_8h.html#a860d1d5fbe8605d03eda7327935c799e">More...</a><br /></td></tr>
<tr class="separator:a860d1d5fbe8605d03eda7327935c799e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5db83f6e1cbc79c9147fabc0c3b97744"><td class="memItemLeft" align="right" valign="top">VOID&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_dpc_routines_8h.html#a5db83f6e1cbc79c9147fabc0c3b97744">DpcRoutinePerformWriteMsr</a> (KDPC *Dpc, PVOID DeferredContext, PVOID SystemArgument1, PVOID SystemArgument2)</td></tr>
<tr class="memdesc:a5db83f6e1cbc79c9147fabc0c3b97744"><td class="mdescLeft">&#160;</td><td class="mdescRight">Broadcast msr write.  <a href="_dpc_routines_8h.html#a5db83f6e1cbc79c9147fabc0c3b97744">More...</a><br /></td></tr>
<tr class="separator:a5db83f6e1cbc79c9147fabc0c3b97744"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6b602a352170d025aa12387207214382"><td class="memItemLeft" align="right" valign="top">VOID&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_dpc_routines_8h.html#a6b602a352170d025aa12387207214382">DpcRoutinePerformReadMsr</a> (KDPC *Dpc, PVOID DeferredContext, PVOID SystemArgument1, PVOID SystemArgument2)</td></tr>
<tr class="memdesc:a6b602a352170d025aa12387207214382"><td class="mdescLeft">&#160;</td><td class="mdescRight">Broadcast msr read.  <a href="_dpc_routines_8h.html#a6b602a352170d025aa12387207214382">More...</a><br /></td></tr>
<tr class="separator:a6b602a352170d025aa12387207214382"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a64193ff039021b05cfee8e048af68c31"><td class="memItemLeft" align="right" valign="top">VOID&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_dpc_routines_8h.html#a64193ff039021b05cfee8e048af68c31">DpcRoutinePerformChangeMsrBitmapReadOnSingleCore</a> (KDPC *Dpc, PVOID DeferredContext, PVOID SystemArgument1, PVOID SystemArgument2)</td></tr>
<tr class="memdesc:a64193ff039021b05cfee8e048af68c31"><td class="mdescLeft">&#160;</td><td class="mdescRight">change msr bitmap read on a single core  <a href="_dpc_routines_8h.html#a64193ff039021b05cfee8e048af68c31">More...</a><br /></td></tr>
<tr class="separator:a64193ff039021b05cfee8e048af68c31"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7b111e2caa07e0259a61102db2ba61af"><td class="memItemLeft" align="right" valign="top">VOID&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_dpc_routines_8h.html#a7b111e2caa07e0259a61102db2ba61af">DpcRoutinePerformChangeMsrBitmapWriteOnSingleCore</a> (KDPC *Dpc, PVOID DeferredContext, PVOID SystemArgument1, PVOID SystemArgument2)</td></tr>
<tr class="memdesc:a7b111e2caa07e0259a61102db2ba61af"><td class="mdescLeft">&#160;</td><td class="mdescRight">change msr bitmap write on a single core  <a href="_dpc_routines_8h.html#a7b111e2caa07e0259a61102db2ba61af">More...</a><br /></td></tr>
<tr class="separator:a7b111e2caa07e0259a61102db2ba61af"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a508772fcbdb9d34fd81501639eb996e1"><td class="memItemLeft" align="right" valign="top">VOID&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_dpc_routines_8h.html#a508772fcbdb9d34fd81501639eb996e1">DpcRoutinePerformEnableRdtscExitingOnSingleCore</a> (KDPC *Dpc, PVOID DeferredContext, PVOID SystemArgument1, PVOID SystemArgument2)</td></tr>
<tr class="memdesc:a508772fcbdb9d34fd81501639eb996e1"><td class="mdescLeft">&#160;</td><td class="mdescRight">set rdtsc/rdtscp exiting  <a href="_dpc_routines_8h.html#a508772fcbdb9d34fd81501639eb996e1">More...</a><br /></td></tr>
<tr class="separator:a508772fcbdb9d34fd81501639eb996e1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6fe8d23e3fd81eecba6f28a50f454222"><td class="memItemLeft" align="right" valign="top">VOID&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_dpc_routines_8h.html#a6fe8d23e3fd81eecba6f28a50f454222">DpcRoutinePerformEnableRdpmcExitingOnSingleCore</a> (KDPC *Dpc, PVOID DeferredContext, PVOID SystemArgument1, PVOID SystemArgument2)</td></tr>
<tr class="memdesc:a6fe8d23e3fd81eecba6f28a50f454222"><td class="mdescLeft">&#160;</td><td class="mdescRight">set rdpmc exiting  <a href="_dpc_routines_8h.html#a6fe8d23e3fd81eecba6f28a50f454222">More...</a><br /></td></tr>
<tr class="separator:a6fe8d23e3fd81eecba6f28a50f454222"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae81da9f18268df6f043f0f715099bdce"><td class="memItemLeft" align="right" valign="top">VOID&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_dpc_routines_8h.html#ae81da9f18268df6f043f0f715099bdce">DpcRoutinePerformSetExceptionBitmapOnSingleCore</a> (KDPC *Dpc, PVOID DeferredContext, PVOID SystemArgument1, PVOID SystemArgument2)</td></tr>
<tr class="memdesc:ae81da9f18268df6f043f0f715099bdce"><td class="mdescLeft">&#160;</td><td class="mdescRight">change exception bitmap on a single core  <a href="_dpc_routines_8h.html#ae81da9f18268df6f043f0f715099bdce">More...</a><br /></td></tr>
<tr class="separator:ae81da9f18268df6f043f0f715099bdce"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aef7db7dd1e1f564dd5db438db232c4ef"><td class="memItemLeft" align="right" valign="top">VOID&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_dpc_routines_8h.html#aef7db7dd1e1f564dd5db438db232c4ef">DpcRoutinePerformEnableMovToDebugRegistersExiting</a> (KDPC *Dpc, PVOID DeferredContext, PVOID SystemArgument1, PVOID SystemArgument2)</td></tr>
<tr class="memdesc:aef7db7dd1e1f564dd5db438db232c4ef"><td class="mdescLeft">&#160;</td><td class="mdescRight">Set the Mov to Debug Registers Exitings.  <a href="_dpc_routines_8h.html#aef7db7dd1e1f564dd5db438db232c4ef">More...</a><br /></td></tr>
<tr class="separator:aef7db7dd1e1f564dd5db438db232c4ef"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acb4f0c4f4fc5c02f54f30cff5f4c8192"><td class="memItemLeft" align="right" valign="top">VOID&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_dpc_routines_8h.html#acb4f0c4f4fc5c02f54f30cff5f4c8192">DpcRoutinePerformSetExternalInterruptExitingOnSingleCore</a> (KDPC *Dpc, PVOID DeferredContext, PVOID SystemArgument1, PVOID SystemArgument2)</td></tr>
<tr class="memdesc:acb4f0c4f4fc5c02f54f30cff5f4c8192"><td class="mdescLeft">&#160;</td><td class="mdescRight">Enable external interrupt exiting on a single core.  <a href="_dpc_routines_8h.html#acb4f0c4f4fc5c02f54f30cff5f4c8192">More...</a><br /></td></tr>
<tr class="separator:acb4f0c4f4fc5c02f54f30cff5f4c8192"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3aecac4c6c92d962339067855d42795a"><td class="memItemLeft" align="right" valign="top">VOID&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_dpc_routines_8h.html#a3aecac4c6c92d962339067855d42795a">DpcRoutinePerformEnableEferSyscallHookOnSingleCore</a> (KDPC *Dpc, PVOID DeferredContext, PVOID SystemArgument1, PVOID SystemArgument2)</td></tr>
<tr class="memdesc:a3aecac4c6c92d962339067855d42795a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Enable syscall hook EFER on a single core.  <a href="_dpc_routines_8h.html#a3aecac4c6c92d962339067855d42795a">More...</a><br /></td></tr>
<tr class="separator:a3aecac4c6c92d962339067855d42795a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4ce952e8ebd61cde6d6dcc118fb77541"><td class="memItemLeft" align="right" valign="top">VOID&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_dpc_routines_8h.html#a4ce952e8ebd61cde6d6dcc118fb77541">DpcRoutinePerformChangeIoBitmapOnSingleCore</a> (KDPC *Dpc, PVOID DeferredContext, PVOID SystemArgument1, PVOID SystemArgument2)</td></tr>
<tr class="memdesc:a4ce952e8ebd61cde6d6dcc118fb77541"><td class="mdescLeft">&#160;</td><td class="mdescRight">change I/O bitmap on a single core  <a href="_dpc_routines_8h.html#a4ce952e8ebd61cde6d6dcc118fb77541">More...</a><br /></td></tr>
<tr class="separator:a4ce952e8ebd61cde6d6dcc118fb77541"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>headers of all the dpc routines which relates to executing on a single core </p>
<dl class="section author"><dt>Author</dt><dd>Sina Karvandi (<a href="#" onclick="location.href='mai'+'lto:'+'sin'+'a@'+'ray'+'an'+'fam'+'.c'+'om'; return false;">sina@<span style="display: none;">.nosp@m.</span>raya<span style="display: none;">.nosp@m.</span>nfam.<span style="display: none;">.nosp@m.</span>com</a>) </dd></dl>
<dl class="section version"><dt>Version</dt><dd>0.1 </dd></dl>
<dl class="section date"><dt>Date</dt><dd>2020-04-29</dd></dl>
<dl class="section copyright"><dt>Copyright</dt><dd>This project is released under the GNU Public License v3. </dd></dl>
</div><h2 class="groupheader">Function Documentation</h2>
<a id="a4ce952e8ebd61cde6d6dcc118fb77541"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4ce952e8ebd61cde6d6dcc118fb77541">&#9670;&nbsp;</a></span>DpcRoutinePerformChangeIoBitmapOnSingleCore()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">VOID DpcRoutinePerformChangeIoBitmapOnSingleCore </td>
          <td>(</td>
          <td class="paramtype">KDPC *&#160;</td>
          <td class="paramname"><em>Dpc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PVOID&#160;</td>
          <td class="paramname"><em>DeferredContext</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PVOID&#160;</td>
          <td class="paramname"><em>SystemArgument1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PVOID&#160;</td>
          <td class="paramname"><em>SystemArgument2</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>change I/O bitmap on a single core </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">Dpc</td><td></td></tr>
    <tr><td class="paramname">DeferredContext</td><td></td></tr>
    <tr><td class="paramname">SystemArgument1</td><td></td></tr>
    <tr><td class="paramname">SystemArgument2</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>VOID </dd></dl>
<div class="fragment"><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;{</div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;    <span class="comment">// change I/O bitmap</span></div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;    <a class="code" href="_inline_asm_8h.html#a0fd87b88c03b3c10883f0ad70239bf6c">AsmVmxVmcall</a>(<a class="code" href="_vmcall_8h.html#a8779c1a5dc3675bd60df12b85e9fc5a3">VMCALL_CHANGE_IO_BITMAP</a>, DeferredContext, 0, 0);</div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160; </div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;    <span class="comment">// As this function is designed for a single,</span></div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;    <span class="comment">// we have to release the synchronization lock here</span></div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;    <a class="code" href="hprdbghv_2_common_8h.html#a529db917026601c47af458af0154bfa1">SpinlockUnlock</a>(&amp;<a class="code" href="_dpc_routines_8c.html#ad770b621bcb6287f068300a85ba36233">OneCoreLock</a>);</div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a id="a64193ff039021b05cfee8e048af68c31"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a64193ff039021b05cfee8e048af68c31">&#9670;&nbsp;</a></span>DpcRoutinePerformChangeMsrBitmapReadOnSingleCore()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">VOID DpcRoutinePerformChangeMsrBitmapReadOnSingleCore </td>
          <td>(</td>
          <td class="paramtype">KDPC *&#160;</td>
          <td class="paramname"><em>Dpc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PVOID&#160;</td>
          <td class="paramname"><em>DeferredContext</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PVOID&#160;</td>
          <td class="paramname"><em>SystemArgument1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PVOID&#160;</td>
          <td class="paramname"><em>SystemArgument2</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>change msr bitmap read on a single core </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">Dpc</td><td></td></tr>
    <tr><td class="paramname">DeferredContext</td><td></td></tr>
    <tr><td class="paramname">SystemArgument1</td><td></td></tr>
    <tr><td class="paramname">SystemArgument2</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>VOID </dd></dl>
<div class="fragment"><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;{</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;    <span class="comment">// change msr bitmap (read)</span></div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;    <a class="code" href="_inline_asm_8h.html#a0fd87b88c03b3c10883f0ad70239bf6c">AsmVmxVmcall</a>(<a class="code" href="_vmcall_8h.html#affdc952605558fc2311612448745464f">VMCALL_CHANGE_MSR_BITMAP_READ</a>, DeferredContext, 0, 0);</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160; </div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;    <span class="comment">// As this function is designed for a single,</span></div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;    <span class="comment">// we have to release the synchronization lock here</span></div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;    <a class="code" href="hprdbghv_2_common_8h.html#a529db917026601c47af458af0154bfa1">SpinlockUnlock</a>(&amp;<a class="code" href="_dpc_routines_8c.html#ad770b621bcb6287f068300a85ba36233">OneCoreLock</a>);</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a id="a7b111e2caa07e0259a61102db2ba61af"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7b111e2caa07e0259a61102db2ba61af">&#9670;&nbsp;</a></span>DpcRoutinePerformChangeMsrBitmapWriteOnSingleCore()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">VOID DpcRoutinePerformChangeMsrBitmapWriteOnSingleCore </td>
          <td>(</td>
          <td class="paramtype">KDPC *&#160;</td>
          <td class="paramname"><em>Dpc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PVOID&#160;</td>
          <td class="paramname"><em>DeferredContext</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PVOID&#160;</td>
          <td class="paramname"><em>SystemArgument1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PVOID&#160;</td>
          <td class="paramname"><em>SystemArgument2</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>change msr bitmap write on a single core </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">Dpc</td><td></td></tr>
    <tr><td class="paramname">DeferredContext</td><td></td></tr>
    <tr><td class="paramname">SystemArgument1</td><td></td></tr>
    <tr><td class="paramname">SystemArgument2</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>VOID </dd></dl>
<div class="fragment"><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;{</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;    <span class="comment">// change msr bitmap (write)</span></div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;    <a class="code" href="_inline_asm_8h.html#a0fd87b88c03b3c10883f0ad70239bf6c">AsmVmxVmcall</a>(<a class="code" href="_vmcall_8h.html#a5d3db56f2450003c021cbeb98f11ae89">VMCALL_CHANGE_MSR_BITMAP_WRITE</a>, DeferredContext, 0, 0);</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160; </div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;    <span class="comment">// As this function is designed for a single,</span></div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;    <span class="comment">// we have to release the synchronization lock here</span></div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;    <a class="code" href="hprdbghv_2_common_8h.html#a529db917026601c47af458af0154bfa1">SpinlockUnlock</a>(&amp;<a class="code" href="_dpc_routines_8c.html#ad770b621bcb6287f068300a85ba36233">OneCoreLock</a>);</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a id="a3aecac4c6c92d962339067855d42795a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3aecac4c6c92d962339067855d42795a">&#9670;&nbsp;</a></span>DpcRoutinePerformEnableEferSyscallHookOnSingleCore()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">VOID DpcRoutinePerformEnableEferSyscallHookOnSingleCore </td>
          <td>(</td>
          <td class="paramtype">KDPC *&#160;</td>
          <td class="paramname"><em>Dpc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PVOID&#160;</td>
          <td class="paramname"><em>DeferredContext</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PVOID&#160;</td>
          <td class="paramname"><em>SystemArgument1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PVOID&#160;</td>
          <td class="paramname"><em>SystemArgument2</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Enable syscall hook EFER on a single core. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">Dpc</td><td></td></tr>
    <tr><td class="paramname">DeferredContext</td><td></td></tr>
    <tr><td class="paramname">SystemArgument1</td><td></td></tr>
    <tr><td class="paramname">SystemArgument2</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>VOID </dd></dl>
<div class="fragment"><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;{</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;    <span class="comment">// Enable syscall hook EFER</span></div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;    <a class="code" href="_inline_asm_8h.html#a0fd87b88c03b3c10883f0ad70239bf6c">AsmVmxVmcall</a>(<a class="code" href="_vmcall_8h.html#abbb3d99ced0391c88b695b06603b31dd">VMCALL_ENABLE_SYSCALL_HOOK_EFER</a>, NULL, 0, 0);</div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160; </div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;    <span class="comment">// As this function is designed for a single,</span></div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;    <span class="comment">// we have to release the synchronization lock here</span></div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;    <a class="code" href="hprdbghv_2_common_8h.html#a529db917026601c47af458af0154bfa1">SpinlockUnlock</a>(&amp;<a class="code" href="_dpc_routines_8c.html#ad770b621bcb6287f068300a85ba36233">OneCoreLock</a>);</div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a id="aef7db7dd1e1f564dd5db438db232c4ef"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aef7db7dd1e1f564dd5db438db232c4ef">&#9670;&nbsp;</a></span>DpcRoutinePerformEnableMovToDebugRegistersExiting()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">VOID DpcRoutinePerformEnableMovToDebugRegistersExiting </td>
          <td>(</td>
          <td class="paramtype">KDPC *&#160;</td>
          <td class="paramname"><em>Dpc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PVOID&#160;</td>
          <td class="paramname"><em>DeferredContext</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PVOID&#160;</td>
          <td class="paramname"><em>SystemArgument1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PVOID&#160;</td>
          <td class="paramname"><em>SystemArgument2</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Set the Mov to Debug Registers Exitings. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">Dpc</td><td></td></tr>
    <tr><td class="paramname">DeferredContext</td><td></td></tr>
    <tr><td class="paramname">SystemArgument1</td><td></td></tr>
    <tr><td class="paramname">SystemArgument2</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>VOID </dd></dl>
<div class="fragment"><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;{</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;    <span class="comment">// enable Mov to Debug Registers Exitings</span></div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;    <a class="code" href="_inline_asm_8h.html#a0fd87b88c03b3c10883f0ad70239bf6c">AsmVmxVmcall</a>(<a class="code" href="_vmcall_8h.html#ac61778ddf78383144987deb0e48cddf1">VMCALL_ENABLE_MOV_TO_DEBUG_REGS_EXITING</a>, 0, 0, 0);</div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160; </div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;    <span class="comment">// As this function is designed for a single,</span></div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;    <span class="comment">// we have to release the synchronization lock here</span></div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;    <a class="code" href="hprdbghv_2_common_8h.html#a529db917026601c47af458af0154bfa1">SpinlockUnlock</a>(&amp;<a class="code" href="_dpc_routines_8c.html#ad770b621bcb6287f068300a85ba36233">OneCoreLock</a>);</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a id="a6fe8d23e3fd81eecba6f28a50f454222"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6fe8d23e3fd81eecba6f28a50f454222">&#9670;&nbsp;</a></span>DpcRoutinePerformEnableRdpmcExitingOnSingleCore()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">VOID DpcRoutinePerformEnableRdpmcExitingOnSingleCore </td>
          <td>(</td>
          <td class="paramtype">KDPC *&#160;</td>
          <td class="paramname"><em>Dpc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PVOID&#160;</td>
          <td class="paramname"><em>DeferredContext</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PVOID&#160;</td>
          <td class="paramname"><em>SystemArgument1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PVOID&#160;</td>
          <td class="paramname"><em>SystemArgument2</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>set rdpmc exiting </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">Dpc</td><td></td></tr>
    <tr><td class="paramname">DeferredContext</td><td></td></tr>
    <tr><td class="paramname">SystemArgument1</td><td></td></tr>
    <tr><td class="paramname">SystemArgument2</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>VOID </dd></dl>
<div class="fragment"><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;{</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;    <span class="comment">// enable rdtsc/rdtscp exiting</span></div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;    <a class="code" href="_inline_asm_8h.html#a0fd87b88c03b3c10883f0ad70239bf6c">AsmVmxVmcall</a>(<a class="code" href="_vmcall_8h.html#a1e7f57f4bbbbb320e00e7d1533e15228">VMCALL_SET_RDPMC_EXITING</a>, 0, 0, 0);</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160; </div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;    <span class="comment">// As this function is designed for a single,</span></div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;    <span class="comment">// we have to release the synchronization lock here</span></div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;    <a class="code" href="hprdbghv_2_common_8h.html#a529db917026601c47af458af0154bfa1">SpinlockUnlock</a>(&amp;<a class="code" href="_dpc_routines_8c.html#ad770b621bcb6287f068300a85ba36233">OneCoreLock</a>);</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a id="a508772fcbdb9d34fd81501639eb996e1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a508772fcbdb9d34fd81501639eb996e1">&#9670;&nbsp;</a></span>DpcRoutinePerformEnableRdtscExitingOnSingleCore()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">VOID DpcRoutinePerformEnableRdtscExitingOnSingleCore </td>
          <td>(</td>
          <td class="paramtype">KDPC *&#160;</td>
          <td class="paramname"><em>Dpc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PVOID&#160;</td>
          <td class="paramname"><em>DeferredContext</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PVOID&#160;</td>
          <td class="paramname"><em>SystemArgument1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PVOID&#160;</td>
          <td class="paramname"><em>SystemArgument2</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>set rdtsc/rdtscp exiting </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">Dpc</td><td></td></tr>
    <tr><td class="paramname">DeferredContext</td><td></td></tr>
    <tr><td class="paramname">SystemArgument1</td><td></td></tr>
    <tr><td class="paramname">SystemArgument2</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>VOID </dd></dl>
<div class="fragment"><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;{</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;    <span class="comment">// enable rdtsc/rdtscp exiting</span></div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;    <a class="code" href="_inline_asm_8h.html#a0fd87b88c03b3c10883f0ad70239bf6c">AsmVmxVmcall</a>(<a class="code" href="_vmcall_8h.html#a84bc6a52b61013c70607768974cf38e3">VMCALL_SET_RDTSC_EXITING</a>, 0, 0, 0);</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160; </div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;    <span class="comment">// As this function is designed for a single,</span></div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;    <span class="comment">// we have to release the synchronization lock here</span></div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;    <a class="code" href="hprdbghv_2_common_8h.html#a529db917026601c47af458af0154bfa1">SpinlockUnlock</a>(&amp;<a class="code" href="_dpc_routines_8c.html#ad770b621bcb6287f068300a85ba36233">OneCoreLock</a>);</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a id="a6b602a352170d025aa12387207214382"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6b602a352170d025aa12387207214382">&#9670;&nbsp;</a></span>DpcRoutinePerformReadMsr()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">VOID DpcRoutinePerformReadMsr </td>
          <td>(</td>
          <td class="paramtype">KDPC *&#160;</td>
          <td class="paramname"><em>Dpc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PVOID&#160;</td>
          <td class="paramname"><em>DeferredContext</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PVOID&#160;</td>
          <td class="paramname"><em>SystemArgument1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PVOID&#160;</td>
          <td class="paramname"><em>SystemArgument2</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Broadcast msr read. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">Dpc</td><td></td></tr>
    <tr><td class="paramname">DeferredContext</td><td></td></tr>
    <tr><td class="paramname">SystemArgument1</td><td></td></tr>
    <tr><td class="paramname">SystemArgument2</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>VOID </dd></dl>
<div class="fragment"><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;{</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;    ULONG CurrentProcessorIndex = 0;</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160; </div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;    CurrentProcessorIndex = KeGetCurrentProcessorNumber();</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160; </div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;    <span class="comment">// read on MSR</span></div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;    <a class="code" href="_global_variables_8h.html#a04bac1f4beef0dcf1ce1a4d9ce72ea76">g_GuestState</a>[CurrentProcessorIndex].<a class="code" href="struct___v_i_r_t_u_a_l___m_a_c_h_i_n_e___s_t_a_t_e.html#abeaf053196e625ac00ab12a5dc38c8f1">DebuggingState</a>.<a class="code" href="struct___p_r_o_c_e_s_s_o_r___d_e_b_u_g_g_i_n_g___s_t_a_t_e.html#a5d5c22183a428958358e19d6434db8a7">MsrState</a>.<a class="code" href="struct___p_r_o_c_e_s_s_o_r___d_e_b_u_g_g_i_n_g___m_s_r___r_e_a_d___o_r___w_r_i_t_e.html#af0a7d72554edcca419674fb5dbf3608d">Value</a> = __readmsr(<a class="code" href="_global_variables_8h.html#a04bac1f4beef0dcf1ce1a4d9ce72ea76">g_GuestState</a>[CurrentProcessorIndex].DebuggingState.MsrState.Msr);</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160; </div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;    <span class="comment">// As this function is designed for a single,</span></div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;    <span class="comment">// we have to release the synchronization lock here</span></div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;    <a class="code" href="hprdbghv_2_common_8h.html#a529db917026601c47af458af0154bfa1">SpinlockUnlock</a>(&amp;<a class="code" href="_dpc_routines_8c.html#ad770b621bcb6287f068300a85ba36233">OneCoreLock</a>);</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a id="ae81da9f18268df6f043f0f715099bdce"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae81da9f18268df6f043f0f715099bdce">&#9670;&nbsp;</a></span>DpcRoutinePerformSetExceptionBitmapOnSingleCore()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">VOID DpcRoutinePerformSetExceptionBitmapOnSingleCore </td>
          <td>(</td>
          <td class="paramtype">KDPC *&#160;</td>
          <td class="paramname"><em>Dpc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PVOID&#160;</td>
          <td class="paramname"><em>DeferredContext</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PVOID&#160;</td>
          <td class="paramname"><em>SystemArgument1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PVOID&#160;</td>
          <td class="paramname"><em>SystemArgument2</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>change exception bitmap on a single core </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">Dpc</td><td></td></tr>
    <tr><td class="paramname">DeferredContext</td><td></td></tr>
    <tr><td class="paramname">SystemArgument1</td><td></td></tr>
    <tr><td class="paramname">SystemArgument2</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>VOID </dd></dl>
<div class="fragment"><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;{</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;    <span class="comment">// change msr exception bitmap</span></div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;    <a class="code" href="_inline_asm_8h.html#a0fd87b88c03b3c10883f0ad70239bf6c">AsmVmxVmcall</a>(<a class="code" href="_vmcall_8h.html#a95a7f87dabddcb74056419965555608d">VMCALL_SET_EXCEPTION_BITMAP</a>, DeferredContext, 0, 0);</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160; </div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;    <span class="comment">// As this function is designed for a single,</span></div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;    <span class="comment">// we have to release the synchronization lock here</span></div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;    <a class="code" href="hprdbghv_2_common_8h.html#a529db917026601c47af458af0154bfa1">SpinlockUnlock</a>(&amp;<a class="code" href="_dpc_routines_8c.html#ad770b621bcb6287f068300a85ba36233">OneCoreLock</a>);</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a id="acb4f0c4f4fc5c02f54f30cff5f4c8192"></a>
<h2 class="memtitle"><span class="permalink"><a href="#acb4f0c4f4fc5c02f54f30cff5f4c8192">&#9670;&nbsp;</a></span>DpcRoutinePerformSetExternalInterruptExitingOnSingleCore()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">VOID DpcRoutinePerformSetExternalInterruptExitingOnSingleCore </td>
          <td>(</td>
          <td class="paramtype">KDPC *&#160;</td>
          <td class="paramname"><em>Dpc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PVOID&#160;</td>
          <td class="paramname"><em>DeferredContext</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PVOID&#160;</td>
          <td class="paramname"><em>SystemArgument1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PVOID&#160;</td>
          <td class="paramname"><em>SystemArgument2</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Enable external interrupt exiting on a single core. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">Dpc</td><td></td></tr>
    <tr><td class="paramname">DeferredContext</td><td></td></tr>
    <tr><td class="paramname">SystemArgument1</td><td></td></tr>
    <tr><td class="paramname">SystemArgument2</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>VOID </dd></dl>
<div class="fragment"><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;{</div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;    <span class="comment">// Enable external interrupt exiting</span></div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;    <a class="code" href="_inline_asm_8h.html#a0fd87b88c03b3c10883f0ad70239bf6c">AsmVmxVmcall</a>(<a class="code" href="_vmcall_8h.html#acaa5481bef551455b84d24e6888a162a">VMCALL_ENABLE_EXTERNAL_INTERRUPT_EXITING</a>, NULL, 0, 0);</div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160; </div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;    <span class="comment">// As this function is designed for a single,</span></div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;    <span class="comment">// we have to release the synchronization lock here</span></div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;    <a class="code" href="hprdbghv_2_common_8h.html#a529db917026601c47af458af0154bfa1">SpinlockUnlock</a>(&amp;<a class="code" href="_dpc_routines_8c.html#ad770b621bcb6287f068300a85ba36233">OneCoreLock</a>);</div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a id="a5db83f6e1cbc79c9147fabc0c3b97744"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5db83f6e1cbc79c9147fabc0c3b97744">&#9670;&nbsp;</a></span>DpcRoutinePerformWriteMsr()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">VOID DpcRoutinePerformWriteMsr </td>
          <td>(</td>
          <td class="paramtype">KDPC *&#160;</td>
          <td class="paramname"><em>Dpc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PVOID&#160;</td>
          <td class="paramname"><em>DeferredContext</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PVOID&#160;</td>
          <td class="paramname"><em>SystemArgument1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PVOID&#160;</td>
          <td class="paramname"><em>SystemArgument2</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Broadcast msr write. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">Dpc</td><td></td></tr>
    <tr><td class="paramname">DeferredContext</td><td></td></tr>
    <tr><td class="paramname">SystemArgument1</td><td></td></tr>
    <tr><td class="paramname">SystemArgument2</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>VOID </dd></dl>
<div class="fragment"><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;{</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;    ULONG CurrentProcessorIndex = 0;</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160; </div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;    CurrentProcessorIndex = KeGetCurrentProcessorNumber();</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160; </div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;    <span class="comment">// write on MSR</span></div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;    __writemsr(<a class="code" href="_global_variables_8h.html#a04bac1f4beef0dcf1ce1a4d9ce72ea76">g_GuestState</a>[CurrentProcessorIndex].DebuggingState.MsrState.Msr, <a class="code" href="_global_variables_8h.html#a04bac1f4beef0dcf1ce1a4d9ce72ea76">g_GuestState</a>[CurrentProcessorIndex].<a class="code" href="struct___v_i_r_t_u_a_l___m_a_c_h_i_n_e___s_t_a_t_e.html#abeaf053196e625ac00ab12a5dc38c8f1">DebuggingState</a>.<a class="code" href="struct___p_r_o_c_e_s_s_o_r___d_e_b_u_g_g_i_n_g___s_t_a_t_e.html#a5d5c22183a428958358e19d6434db8a7">MsrState</a>.<a class="code" href="struct___p_r_o_c_e_s_s_o_r___d_e_b_u_g_g_i_n_g___m_s_r___r_e_a_d___o_r___w_r_i_t_e.html#af0a7d72554edcca419674fb5dbf3608d">Value</a>);</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160; </div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;    <span class="comment">// As this function is designed for a single,</span></div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;    <span class="comment">// we have to release the synchronization lock here</span></div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;    <a class="code" href="hprdbghv_2_common_8h.html#a529db917026601c47af458af0154bfa1">SpinlockUnlock</a>(&amp;<a class="code" href="_dpc_routines_8c.html#ad770b621bcb6287f068300a85ba36233">OneCoreLock</a>);</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a id="a860d1d5fbe8605d03eda7327935c799e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a860d1d5fbe8605d03eda7327935c799e">&#9670;&nbsp;</a></span>DpcRoutineRunTaskOnSingleCore()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">NTSTATUS DpcRoutineRunTaskOnSingleCore </td>
          <td>(</td>
          <td class="paramtype">UINT32&#160;</td>
          <td class="paramname"><em>CoreNumber</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PVOID&#160;</td>
          <td class="paramname"><em>Routine</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PVOID&#160;</td>
          <td class="paramname"><em>DeferredContext</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function synchronize the function execution for a single core You should only used it for one core, not in multiple threads simultaneously The function that needs to use this featue (Routine parameter function) should have the when it ends : </p>
<pre class="fragment">         SpinlockUnlock(&amp;OneCoreLock); 
</pre><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">CoreNumber</td><td>core number that the target function should run on it </td></tr>
    <tr><td class="paramname">Routine</td><td>the target function that should be runned </td></tr>
    <tr><td class="paramname">DeferredContext</td><td>an optional parameter to Routine </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>NTSTATUS </dd></dl>
<div class="fragment"><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;{</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;    PRKDPC Dpc;</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;    UINT32 ProcessorCount;</div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160; </div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;    ProcessorCount = KeQueryActiveProcessorCount(0);</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160; </div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;    <span class="comment">// Check if the core number is not invalid</span></div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;    <span class="keywordflow">if</span> (CoreNumber &gt;= ProcessorCount)</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;    {</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;        <span class="keywordflow">return</span> STATUS_INVALID_PARAMETER;</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;    }</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160; </div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;    <span class="comment">// Allocate Memory for DPC</span></div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;    Dpc = ExAllocatePoolWithTag(NonPagedPool, <span class="keyword">sizeof</span>(KDPC), <a class="code" href="hprdbghv_2_common_8h.html#ab7f91e71074ce1488e61869adbc44d8d">POOLTAG</a>);</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160; </div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;    <span class="keywordflow">if</span> (!Dpc)</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;    {</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;        <span class="keywordflow">return</span> STATUS_INSUFFICIENT_RESOURCES;</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;    }</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160; </div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;    <span class="comment">// Creating a DPC that will run on the target process</span></div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;    KeInitializeDpc(Dpc,            <span class="comment">// Dpc</span></div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;                    Routine,        <span class="comment">// DeferredRoutine</span></div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;                    DeferredContext <span class="comment">// DeferredContext</span></div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;    );</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160; </div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;    <span class="comment">// Set the target core</span></div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;    KeSetTargetProcessorDpc(Dpc, CoreNumber);</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160; </div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;    <span class="comment">// it&#39;s sure will be executed, but we want to free the above</span></div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;    <span class="comment">// pool, so we have to wait on a spinlock that will be release</span></div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;    <span class="comment">// by the the DPC routine, actually Affinity Thread but that</span></div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;    <span class="comment">// won&#39;t support more than 64 logical cores, I create a discussion</span></div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;    <span class="comment">// here, and explained the problem, but no one answers</span></div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;    <span class="comment">// link: https://community.osr.com/discussion/292064/putting-a-barrier-for-dpc-before-continuing-the-rest-of-code</span></div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;    <span class="comment">// we also can&#39;t use the spinlock routine of Windows as this function</span></div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;    <span class="comment">// raises the IRQL to DPC and we want to execute at DPC, means that</span></div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;    <span class="comment">// If we&#39;re currently on the right core, we never find a chance to</span></div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;    <span class="comment">// release the spinlock so a deadlock happens, all in all it&#39;s complicated :)</span></div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160; </div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;    <span class="comment">// Set the lock to be freed by the other DPC routine</span></div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="hprdbghv_2_common_8h.html#a442b1a10c7275a6764621203970a68fa">SpinlockTryLock</a>(&amp;<a class="code" href="_dpc_routines_8c.html#ad770b621bcb6287f068300a85ba36233">OneCoreLock</a>))</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;    {</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;        <span class="comment">//</span></div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;        <span class="comment">// We can&#39;t get the lock, probably sth goes wrong !</span></div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;        <span class="comment">//</span></div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;        <span class="keywordflow">return</span> STATUS_UNSUCCESSFUL;</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;    }</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160; </div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;    <span class="comment">// Fire the DPC</span></div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;    KeInsertQueueDpc(Dpc, NULL, NULL);</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160; </div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;    <span class="comment">// spin on lock to be release, immediately after we get the lock, we&#39;ll</span></div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;    <span class="comment">// release it for because there is no need to it anymore and DPC is finished</span></div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;    <a class="code" href="hprdbghv_2_common_8h.html#a08984f739349991eab67c45376a990bc">SpinlockLock</a>(&amp;<a class="code" href="_dpc_routines_8c.html#ad770b621bcb6287f068300a85ba36233">OneCoreLock</a>);</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;    <a class="code" href="hprdbghv_2_common_8h.html#a529db917026601c47af458af0154bfa1">SpinlockUnlock</a>(&amp;<a class="code" href="_dpc_routines_8c.html#ad770b621bcb6287f068300a85ba36233">OneCoreLock</a>);</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160; </div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;    <span class="comment">// Now it&#39;s safe to deallocate the bugger</span></div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;    ExFreePoolWithTag(Dpc, <a class="code" href="hprdbghv_2_common_8h.html#ab7f91e71074ce1488e61869adbc44d8d">POOLTAG</a>);</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160; </div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;    <span class="keywordflow">return</span> STATUS_SUCCESS;</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<div class="ttc" id="astruct___p_r_o_c_e_s_s_o_r___d_e_b_u_g_g_i_n_g___s_t_a_t_e_html_a5d5c22183a428958358e19d6434db8a7"><div class="ttname"><a href="struct___p_r_o_c_e_s_s_o_r___d_e_b_u_g_g_i_n_g___s_t_a_t_e.html#a5d5c22183a428958358e19d6434db8a7">_PROCESSOR_DEBUGGING_STATE::MsrState</a></div><div class="ttdeci">PROCESSOR_DEBUGGING_MSR_READ_OR_WRITE MsrState</div><div class="ttdef"><b>Definition:</b> Debugger.h:97</div></div>
<div class="ttc" id="astruct___v_i_r_t_u_a_l___m_a_c_h_i_n_e___s_t_a_t_e_html_abeaf053196e625ac00ab12a5dc38c8f1"><div class="ttname"><a href="struct___v_i_r_t_u_a_l___m_a_c_h_i_n_e___s_t_a_t_e.html#abeaf053196e625ac00ab12a5dc38c8f1">_VIRTUAL_MACHINE_STATE::DebuggingState</a></div><div class="ttdeci">PROCESSOR_DEBUGGING_STATE DebuggingState</div><div class="ttdef"><b>Definition:</b> Vmx.h:557</div></div>
<div class="ttc" id="a_dpc_routines_8c_html_ad770b621bcb6287f068300a85ba36233"><div class="ttname"><a href="_dpc_routines_8c.html#ad770b621bcb6287f068300a85ba36233">OneCoreLock</a></div><div class="ttdeci">volatile LONG OneCoreLock</div><div class="ttdoc">lock for one core execution</div><div class="ttdef"><b>Definition:</b> DpcRoutines.c:19</div></div>
<div class="ttc" id="a_vmcall_8h_html_acaa5481bef551455b84d24e6888a162a"><div class="ttname"><a href="_vmcall_8h.html#acaa5481bef551455b84d24e6888a162a">VMCALL_ENABLE_EXTERNAL_INTERRUPT_EXITING</a></div><div class="ttdeci">#define VMCALL_ENABLE_EXTERNAL_INTERRUPT_EXITING</div><div class="ttdoc">VMCALL to enable external interrupt exiting.</div><div class="ttdef"><b>Definition:</b> Vmcall.h:112</div></div>
<div class="ttc" id="a_global_variables_8h_html_a04bac1f4beef0dcf1ce1a4d9ce72ea76"><div class="ttname"><a href="_global_variables_8h.html#a04bac1f4beef0dcf1ce1a4d9ce72ea76">g_GuestState</a></div><div class="ttdeci">VIRTUAL_MACHINE_STATE * g_GuestState</div><div class="ttdoc">Save the state and variables related to each to logical core.</div><div class="ttdef"><b>Definition:</b> GlobalVariables.h:25</div></div>
<div class="ttc" id="a_inline_asm_8h_html_a0fd87b88c03b3c10883f0ad70239bf6c"><div class="ttname"><a href="_inline_asm_8h.html#a0fd87b88c03b3c10883f0ad70239bf6c">AsmVmxVmcall</a></div><div class="ttdeci">NTSTATUS AsmVmxVmcall(unsigned long long VmcallNumber, unsigned long long OptionalParam1, unsigned long long OptionalParam2, long long OptionalParam3)</div><div class="ttdoc">Request Vmcall.</div></div>
<div class="ttc" id="a_vmcall_8h_html_a1e7f57f4bbbbb320e00e7d1533e15228"><div class="ttname"><a href="_vmcall_8h.html#a1e7f57f4bbbbb320e00e7d1533e15228">VMCALL_SET_RDPMC_EXITING</a></div><div class="ttdeci">#define VMCALL_SET_RDPMC_EXITING</div><div class="ttdoc">VMCALL to enable rdpmc exiting in primary cpu-based controls.</div><div class="ttdef"><b>Definition:</b> Vmcall.h:94</div></div>
<div class="ttc" id="astruct___p_r_o_c_e_s_s_o_r___d_e_b_u_g_g_i_n_g___m_s_r___r_e_a_d___o_r___w_r_i_t_e_html_af0a7d72554edcca419674fb5dbf3608d"><div class="ttname"><a href="struct___p_r_o_c_e_s_s_o_r___d_e_b_u_g_g_i_n_g___m_s_r___r_e_a_d___o_r___w_r_i_t_e.html#af0a7d72554edcca419674fb5dbf3608d">_PROCESSOR_DEBUGGING_MSR_READ_OR_WRITE::Value</a></div><div class="ttdeci">UINT64 Value</div><div class="ttdef"><b>Definition:</b> Debugger.h:85</div></div>
<div class="ttc" id="ahprdbghv_2_common_8h_html_ab7f91e71074ce1488e61869adbc44d8d"><div class="ttname"><a href="hprdbghv_2_common_8h.html#ab7f91e71074ce1488e61869adbc44d8d">POOLTAG</a></div><div class="ttdeci">#define POOLTAG</div><div class="ttdoc">Pool tag.</div><div class="ttdef"><b>Definition:</b> Common.h:161</div></div>
<div class="ttc" id="a_vmcall_8h_html_a5d3db56f2450003c021cbeb98f11ae89"><div class="ttname"><a href="_vmcall_8h.html#a5d3db56f2450003c021cbeb98f11ae89">VMCALL_CHANGE_MSR_BITMAP_WRITE</a></div><div class="ttdeci">#define VMCALL_CHANGE_MSR_BITMAP_WRITE</div><div class="ttdoc">VMCALL to change MSR Bitmap Write.</div><div class="ttdef"><b>Definition:</b> Vmcall.h:82</div></div>
<div class="ttc" id="ahprdbghv_2_common_8h_html_a529db917026601c47af458af0154bfa1"><div class="ttname"><a href="hprdbghv_2_common_8h.html#a529db917026601c47af458af0154bfa1">SpinlockUnlock</a></div><div class="ttdeci">void SpinlockUnlock(volatile LONG *Lock)</div><div class="ttdoc">Release the lock.</div><div class="ttdef"><b>Definition:</b> Spinlock.c:86</div></div>
<div class="ttc" id="a_vmcall_8h_html_abbb3d99ced0391c88b695b06603b31dd"><div class="ttname"><a href="_vmcall_8h.html#abbb3d99ced0391c88b695b06603b31dd">VMCALL_ENABLE_SYSCALL_HOOK_EFER</a></div><div class="ttdeci">#define VMCALL_ENABLE_SYSCALL_HOOK_EFER</div><div class="ttdoc">VMCALL to enable syscall hook using EFER SCE bit.</div><div class="ttdef"><b>Definition:</b> Vmcall.h:64</div></div>
<div class="ttc" id="a_vmcall_8h_html_a84bc6a52b61013c70607768974cf38e3"><div class="ttname"><a href="_vmcall_8h.html#a84bc6a52b61013c70607768974cf38e3">VMCALL_SET_RDTSC_EXITING</a></div><div class="ttdeci">#define VMCALL_SET_RDTSC_EXITING</div><div class="ttdoc">VMCALL to enable rdtsc/rdtscp exiting in primary cpu-based controls.</div><div class="ttdef"><b>Definition:</b> Vmcall.h:88</div></div>
<div class="ttc" id="a_vmcall_8h_html_a8779c1a5dc3675bd60df12b85e9fc5a3"><div class="ttname"><a href="_vmcall_8h.html#a8779c1a5dc3675bd60df12b85e9fc5a3">VMCALL_CHANGE_IO_BITMAP</a></div><div class="ttdeci">#define VMCALL_CHANGE_IO_BITMAP</div><div class="ttdoc">VMCALL to change I/O Bitmaps (A &amp; B)</div><div class="ttdef"><b>Definition:</b> Vmcall.h:118</div></div>
<div class="ttc" id="a_vmcall_8h_html_a95a7f87dabddcb74056419965555608d"><div class="ttname"><a href="_vmcall_8h.html#a95a7f87dabddcb74056419965555608d">VMCALL_SET_EXCEPTION_BITMAP</a></div><div class="ttdeci">#define VMCALL_SET_EXCEPTION_BITMAP</div><div class="ttdoc">VMCALL to set exception bitmap on VMCS.</div><div class="ttdef"><b>Definition:</b> Vmcall.h:100</div></div>
<div class="ttc" id="ahprdbghv_2_common_8h_html_a442b1a10c7275a6764621203970a68fa"><div class="ttname"><a href="hprdbghv_2_common_8h.html#a442b1a10c7275a6764621203970a68fa">SpinlockTryLock</a></div><div class="ttdeci">BOOLEAN SpinlockTryLock(volatile LONG *Lock)</div><div class="ttdoc">Tries to get the lock otherwise returns.</div><div class="ttdef"><b>Definition:</b> Spinlock.c:41</div></div>
<div class="ttc" id="a_vmcall_8h_html_affdc952605558fc2311612448745464f"><div class="ttname"><a href="_vmcall_8h.html#affdc952605558fc2311612448745464f">VMCALL_CHANGE_MSR_BITMAP_READ</a></div><div class="ttdeci">#define VMCALL_CHANGE_MSR_BITMAP_READ</div><div class="ttdoc">VMCALL to change MSR Bitmap Read.</div><div class="ttdef"><b>Definition:</b> Vmcall.h:76</div></div>
<div class="ttc" id="a_vmcall_8h_html_ac61778ddf78383144987deb0e48cddf1"><div class="ttname"><a href="_vmcall_8h.html#ac61778ddf78383144987deb0e48cddf1">VMCALL_ENABLE_MOV_TO_DEBUG_REGS_EXITING</a></div><div class="ttdeci">#define VMCALL_ENABLE_MOV_TO_DEBUG_REGS_EXITING</div><div class="ttdoc">VMCALL to enable mov to debug registers exiting.</div><div class="ttdef"><b>Definition:</b> Vmcall.h:106</div></div>
<div class="ttc" id="ahprdbghv_2_common_8h_html_a08984f739349991eab67c45376a990bc"><div class="ttname"><a href="hprdbghv_2_common_8h.html#a08984f739349991eab67c45376a990bc">SpinlockLock</a></div><div class="ttdeci">void SpinlockLock(volatile LONG *Lock)</div><div class="ttdoc">Tries to get the lock and won't return until successfully get the lock.</div><div class="ttdef"><b>Definition:</b> Spinlock.c:52</div></div>
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_53a6cdbae347618e9ee76d4be5c6ea96.html">hyperdbg</a></li><li class="navelem"><a class="el" href="dir_19054a674c4bd5cb8fceb6542228579c.html">hprdbghv</a></li><li class="navelem"><a class="el" href="_dpc_routines_8h.html">DpcRoutines.h</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.17 </li>
  </ul>
</div>
</body>
</html>
