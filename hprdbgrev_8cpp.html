<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.6"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>HyperDbg: hyperdbg/hprdbgrev/code/hprdbgrev.cpp File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">HyperDbg
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.6 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('hprdbgrev_8cpp.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle"><div class="title">hprdbgrev.cpp File Reference</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &quot;pch.h&quot;</code><br />
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ac2c9a7d831c0d9fb7a7331906cc0ee07"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="hprdbgrev_8cpp.html#ac2c9a7d831c0d9fb7a7331906cc0ee07">__declspec</a> (dllexport) int <a class="el" href="hprdbgrev_8cpp.html#a2ff72ed249e972213ed31fc4a3b93644">ReversingMachineStart</a>()</td></tr>
<tr class="separator:ac2c9a7d831c0d9fb7a7331906cc0ee07"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a21c3c06b34d716c4680695c2b28127da"><td class="memItemLeft" align="right" valign="top"><a class="el" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#a7f319bfc2492a2136964194204e7a8cf">VOID</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="hprdbgrev_8cpp.html#a21c3c06b34d716c4680695c2b28127da">ShowMessages</a> (const char *Fmt,...)</td></tr>
<tr class="memdesc:a21c3c06b34d716c4680695c2b28127da"><td class="mdescLeft">&#160;</td><td class="mdescRight">Show messages.  <br /></td></tr>
<tr class="separator:a21c3c06b34d716c4680695c2b28127da"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa938a4b4c74b96fbb1608d40cd729473"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="hprdbgrev_8cpp.html#aa938a4b4c74b96fbb1608d40cd729473">ReadIrpBasedBuffer</a> ()</td></tr>
<tr class="memdesc:aa938a4b4c74b96fbb1608d40cd729473"><td class="mdescLeft">&#160;</td><td class="mdescRight">Read kernel buffers using IRP Pending.  <br /></td></tr>
<tr class="separator:aa938a4b4c74b96fbb1608d40cd729473"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0564d081cfcdf97817d77dc998e81034"><td class="memItemLeft" align="right" valign="top"><a class="el" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#ad342ac907eb044443153a22f964bf0af">DWORD</a> WINAPI&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="hprdbgrev_8cpp.html#a0564d081cfcdf97817d77dc998e81034">IrpBasedBufferThread</a> (void *data)</td></tr>
<tr class="memdesc:a0564d081cfcdf97817d77dc998e81034"><td class="mdescLeft">&#160;</td><td class="mdescRight">Create a thread for pending buffers.  <br /></td></tr>
<tr class="separator:a0564d081cfcdf97817d77dc998e81034"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad202733584341409fdf5cce4b62bbfd1"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="hprdbgrev_8cpp.html#ad202733584341409fdf5cce4b62bbfd1">ReversingMachineStop</a> ()</td></tr>
<tr class="memdesc:ad202733584341409fdf5cce4b62bbfd1"><td class="mdescLeft">&#160;</td><td class="mdescRight">Unload the reversing machine driver.  <br /></td></tr>
<tr class="separator:ad202733584341409fdf5cce4b62bbfd1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2ff72ed249e972213ed31fc4a3b93644"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="hprdbgrev_8cpp.html#a2ff72ed249e972213ed31fc4a3b93644">ReversingMachineStart</a> ()</td></tr>
<tr class="memdesc:a2ff72ed249e972213ed31fc4a3b93644"><td class="mdescLeft">&#160;</td><td class="mdescRight">Load the reversing machine driver.  <br /></td></tr>
<tr class="separator:a2ff72ed249e972213ed31fc4a3b93644"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="var-members" name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a2efecbbb09b88ade29f50b2003ad4562"><td class="memItemLeft" align="right" valign="top">HANDLE&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="hprdbgrev_8cpp.html#a2efecbbb09b88ade29f50b2003ad4562">g_DeviceHandleReversingMachine</a></td></tr>
<tr class="memdesc:a2efecbbb09b88ade29f50b2003ad4562"><td class="mdescLeft">&#160;</td><td class="mdescRight">Holds the global handle of device which is used to send the request to the kernel by IOCTL, this handle is not used for IRP Pending of message tracing this handle used in reversing machine.  <br /></td></tr>
<tr class="separator:a2efecbbb09b88ade29f50b2003ad4562"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3f9f07302a64745af9aa15c1defbc798"><td class="memItemLeft" align="right" valign="top">HANDLE&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="hprdbgrev_8cpp.html#a3f9f07302a64745af9aa15c1defbc798">g_IsDriverLoadedSuccessfully</a> = NULL</td></tr>
<tr class="memdesc:a3f9f07302a64745af9aa15c1defbc798"><td class="mdescLeft">&#160;</td><td class="mdescRight">Handle to show that if the debugger is loaded successfully.  <br /></td></tr>
<tr class="separator:a3f9f07302a64745af9aa15c1defbc798"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a04aaf680ede15f5e7ba51ab9f157bfff"><td class="memItemLeft" align="right" valign="top">HANDLE&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="hprdbgrev_8cpp.html#a04aaf680ede15f5e7ba51ab9f157bfff">g_DeviceHandle</a></td></tr>
<tr class="memdesc:a04aaf680ede15f5e7ba51ab9f157bfff"><td class="mdescLeft">&#160;</td><td class="mdescRight">Holds the global handle of device which is used to send the request to the kernel by IOCTL, this handle is not used for IRP Pending of message tracing this handle is used in KD VMM.  <br /></td></tr>
<tr class="separator:a04aaf680ede15f5e7ba51ab9f157bfff"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0a209ec7bc7822ce1f94848c31d87cdd"><td class="memItemLeft" align="right" valign="top"><a class="el" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#a1cb18096b299d23458d3c7b85fd86555">BOOLEAN</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="hprdbgrev_8cpp.html#a0a209ec7bc7822ce1f94848c31d87cdd">g_IsReversingMachineModulesLoaded</a></td></tr>
<tr class="memdesc:a0a209ec7bc7822ce1f94848c31d87cdd"><td class="mdescLeft">&#160;</td><td class="mdescRight">Checks whether the RM module is loaded or not.  <br /></td></tr>
<tr class="separator:a0a209ec7bc7822ce1f94848c31d87cdd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a34d91f14ab8002a6eeab08d76588ae92"><td class="memItemLeft" align="right" valign="top"><a class="el" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#a1cb18096b299d23458d3c7b85fd86555">BOOLEAN</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="hprdbgrev_8cpp.html#a34d91f14ab8002a6eeab08d76588ae92">g_IsVmxOffProcessStart</a></td></tr>
<tr class="memdesc:a34d91f14ab8002a6eeab08d76588ae92"><td class="mdescLeft">&#160;</td><td class="mdescRight">Shows whether the vmxoff process start or not.  <br /></td></tr>
<tr class="separator:a34d91f14ab8002a6eeab08d76588ae92"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Function Documentation</h2>
<a id="ac2c9a7d831c0d9fb7a7331906cc0ee07" name="ac2c9a7d831c0d9fb7a7331906cc0ee07"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac2c9a7d831c0d9fb7a7331906cc0ee07">&#9670;&#160;</a></span>__declspec()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">__declspec </td>
          <td>(</td>
          <td class="paramtype">dllexport&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a0564d081cfcdf97817d77dc998e81034" name="a0564d081cfcdf97817d77dc998e81034"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0564d081cfcdf97817d77dc998e81034">&#9670;&#160;</a></span>IrpBasedBufferThread()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#ad342ac907eb044443153a22f964bf0af">DWORD</a> WINAPI IrpBasedBufferThread </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>data</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Create a thread for pending buffers. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">Data</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>DWORD Device Handle </dd></dl>
<div class="fragment"><div class="line"><span class="lineno">  249</span>{</div>
<div class="line"><span class="lineno">  250</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">  251</span>    <span class="comment">// Do stuff.  This will be the first function called on the new</span></div>
<div class="line"><span class="lineno">  252</span>    <span class="comment">// thread. When this function returns, the thread goes away.  See</span></div>
<div class="line"><span class="lineno">  253</span>    <span class="comment">// MSDN for more details. Test Irp Based Notifications</span></div>
<div class="line"><span class="lineno">  254</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">  255</span>    <a class="code hl_function" href="hprdbgrev_8cpp.html#aa938a4b4c74b96fbb1608d40cd729473">ReadIrpBasedBuffer</a>();</div>
<div class="line"><span class="lineno">  256</span> </div>
<div class="line"><span class="lineno">  257</span>    <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  258</span>}</div>
<div class="ttc" id="ahprdbgrev_8cpp_html_aa938a4b4c74b96fbb1608d40cd729473"><div class="ttname"><a href="hprdbgrev_8cpp.html#aa938a4b4c74b96fbb1608d40cd729473">ReadIrpBasedBuffer</a></div><div class="ttdeci">void ReadIrpBasedBuffer()</div><div class="ttdoc">Read kernel buffers using IRP Pending.</div><div class="ttdef"><b>Definition:</b> hprdbgrev.cpp:83</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="aa938a4b4c74b96fbb1608d40cd729473" name="aa938a4b4c74b96fbb1608d40cd729473"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa938a4b4c74b96fbb1608d40cd729473">&#9670;&#160;</a></span>ReadIrpBasedBuffer()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ReadIrpBasedBuffer </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Read kernel buffers using IRP Pending. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">Device</td><td>Driver handle </td></tr>
  </table>
  </dd>
</dl>
<p>lpSecurityAttirbutes</p>
<p>lpTemplateFile</p>
<div class="fragment"><div class="line"><span class="lineno">   84</span>{</div>
<div class="line"><span class="lineno">   85</span>    <a class="code hl_typedef" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#a050c65e107f0c828f856a231f4b4e788">BOOL</a>                   Status;</div>
<div class="line"><span class="lineno">   86</span>    <a class="code hl_typedef" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#af632da489ebc3708ec3ab6791ee53fa4">ULONG</a>                  ReturnedLength;</div>
<div class="line"><span class="lineno">   87</span>    <a class="code hl_struct" href="struct___r_e_g_i_s_t_e_r___n_o_t_i_f_y___b_u_f_f_e_r.html">REGISTER_NOTIFY_BUFFER</a> RegisterEvent;</div>
<div class="line"><span class="lineno">   88</span>    <a class="code hl_typedef" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#ae1e6edbbc26d6fbc71a90190d0266018">UINT32</a>                 OperationCode;</div>
<div class="line"><span class="lineno">   89</span>    <a class="code hl_typedef" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#ad342ac907eb044443153a22f964bf0af">DWORD</a>                  ErrorNum;</div>
<div class="line"><span class="lineno">   90</span>    HANDLE                 Handle;</div>
<div class="line"><span class="lineno">   91</span>    <a class="code hl_typedef" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#a1cb18096b299d23458d3c7b85fd86555">BOOLEAN</a>                OutputSourceFound;</div>
<div class="line"><span class="lineno">   92</span>    PLIST_ENTRY            TempList;</div>
<div class="line"><span class="lineno">   93</span> </div>
<div class="line"><span class="lineno">   94</span>    RegisterEvent.<a class="code hl_variable" href="struct___r_e_g_i_s_t_e_r___n_o_t_i_f_y___b_u_f_f_e_r.html#a0be90ffe07b5e70e32a2971852f29c8f">hEvent</a> = NULL;</div>
<div class="line"><span class="lineno">   95</span>    RegisterEvent.<a class="code hl_variable" href="struct___r_e_g_i_s_t_e_r___n_o_t_i_f_y___b_u_f_f_e_r.html#a05acd472c7bdb5b620ec76b2ece28dd0">Type</a>   = <a class="code hl_enumvalue" href="build_2bin_2debug_2_s_d_k_2_headers_2_data_types_8h.html#a7df81690e4c6ed5fbbb74547c998e4b6a557243d0c993fb8d9b81a0a0db183c2e">IRP_BASED</a>;</div>
<div class="line"><span class="lineno">   96</span> </div>
<div class="line"><span class="lineno">   97</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">   98</span>    <span class="comment">// Create another handle to be used in for reading kernel messages,</span></div>
<div class="line"><span class="lineno">   99</span>    <span class="comment">// it is because I noticed that if I use a same handle for IRP Pending</span></div>
<div class="line"><span class="lineno">  100</span>    <span class="comment">// and other IOCTLs then if I complete that IOCTL then both of the current</span></div>
<div class="line"><span class="lineno">  101</span>    <span class="comment">// IOCTL and the Pending IRP are completed and return to user mode,</span></div>
<div class="line"><span class="lineno">  102</span>    <span class="comment">// even if it&#39;s odd but that what happens, so this way we can solve it</span></div>
<div class="line"><span class="lineno">  103</span>    <span class="comment">// if you know why this problem happens, then contact me !</span></div>
<div class="line"><span class="lineno">  104</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">  105</span>    Handle = CreateFileA(</div>
<div class="line"><span class="lineno">  106</span>        <span class="stringliteral">&quot;\\\\.\\HyperDbgReversingMachineDevice&quot;</span>,</div>
<div class="line"><span class="lineno">  107</span>        GENERIC_READ | GENERIC_WRITE,</div>
<div class="line"><span class="lineno">  108</span>        FILE_SHARE_READ | FILE_SHARE_WRITE,</div>
<div class="line"><span class="lineno">  109</span>        NULL, </div>
<div class="line"><span class="lineno">  110</span>        OPEN_EXISTING,</div>
<div class="line"><span class="lineno">  111</span>        FILE_ATTRIBUTE_NORMAL | FILE_FLAG_OVERLAPPED,</div>
<div class="line"><span class="lineno">  112</span>        NULL); </div>
<div class="line"><span class="lineno">  113</span> </div>
<div class="line"><span class="lineno">  114</span>    <span class="keywordflow">if</span> (Handle == INVALID_HANDLE_VALUE)</div>
<div class="line"><span class="lineno">  115</span>    {</div>
<div class="line"><span class="lineno">  116</span>        ErrorNum = GetLastError();</div>
<div class="line"><span class="lineno">  117</span>        <span class="keywordflow">if</span> (ErrorNum == ERROR_ACCESS_DENIED)</div>
<div class="line"><span class="lineno">  118</span>        {</div>
<div class="line"><span class="lineno">  119</span>            <a class="code hl_function" href="hprdbgrev_8cpp.html#a21c3c06b34d716c4680695c2b28127da">ShowMessages</a>(<span class="stringliteral">&quot;err, access denied\nare you sure you have administrator &quot;</span></div>
<div class="line"><span class="lineno">  120</span>                         <span class="stringliteral">&quot;rights?\n&quot;</span>);</div>
<div class="line"><span class="lineno">  121</span>        }</div>
<div class="line"><span class="lineno">  122</span>        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ErrorNum == ERROR_GEN_FAILURE)</div>
<div class="line"><span class="lineno">  123</span>        {</div>
<div class="line"><span class="lineno">  124</span>            <a class="code hl_function" href="hprdbgrev_8cpp.html#a21c3c06b34d716c4680695c2b28127da">ShowMessages</a>(<span class="stringliteral">&quot;err, a device attached to the system is not functioning\n&quot;</span></div>
<div class="line"><span class="lineno">  125</span>                         <span class="stringliteral">&quot;vmx feature might be disabled from BIOS or VBS/HVCI is active\n&quot;</span>);</div>
<div class="line"><span class="lineno">  126</span>        }</div>
<div class="line"><span class="lineno">  127</span>        <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno">  128</span>        {</div>
<div class="line"><span class="lineno">  129</span>            <a class="code hl_function" href="hprdbgrev_8cpp.html#a21c3c06b34d716c4680695c2b28127da">ShowMessages</a>(<span class="stringliteral">&quot;err, CreateFile failed with (%x)\n&quot;</span>, ErrorNum);</div>
<div class="line"><span class="lineno">  130</span>        }</div>
<div class="line"><span class="lineno">  131</span> </div>
<div class="line"><span class="lineno">  132</span>        <a class="code hl_variable" href="hprdbgrev_8cpp.html#a04aaf680ede15f5e7ba51ab9f157bfff">g_DeviceHandle</a> = NULL;</div>
<div class="line"><span class="lineno">  133</span>        Handle         = NULL;</div>
<div class="line"><span class="lineno">  134</span> </div>
<div class="line"><span class="lineno">  135</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">  136</span>    }</div>
<div class="line"><span class="lineno">  137</span> </div>
<div class="line"><span class="lineno">  138</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">  139</span>    <span class="comment">// allocate buffer for transfering messages</span></div>
<div class="line"><span class="lineno">  140</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">  141</span>    <span class="keywordtype">char</span> * OutputBuffer = (<span class="keywordtype">char</span> *)malloc(<a class="code hl_define" href="build_2bin_2debug_2_s_d_k_2_headers_2_constants_8h.html#a4e12a0c1a102bb323458f19d591379e5">UsermodeBufferSize</a>);</div>
<div class="line"><span class="lineno">  142</span> </div>
<div class="line"><span class="lineno">  143</span>    <span class="keywordflow">try</span></div>
<div class="line"><span class="lineno">  144</span>    {</div>
<div class="line"><span class="lineno">  145</span>        <span class="keywordflow">while</span> (<a class="code hl_define" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>)</div>
<div class="line"><span class="lineno">  146</span>        {</div>
<div class="line"><span class="lineno">  147</span>            <span class="comment">//</span></div>
<div class="line"><span class="lineno">  148</span>            <span class="comment">// Clear the buffer</span></div>
<div class="line"><span class="lineno">  149</span>            <span class="comment">//</span></div>
<div class="line"><span class="lineno">  150</span>            ZeroMemory(OutputBuffer, <a class="code hl_define" href="build_2bin_2debug_2_s_d_k_2_headers_2_constants_8h.html#a4e12a0c1a102bb323458f19d591379e5">UsermodeBufferSize</a>);</div>
<div class="line"><span class="lineno">  151</span> </div>
<div class="line"><span class="lineno">  152</span>            Sleep(<a class="code hl_define" href="_definition_8h.html#ae587705d649b149ca423cf686550d197">DefaultSpeedOfReadingKernelMessages</a>); <span class="comment">// we&#39;re not trying to eat all of the CPU ;)</span></div>
<div class="line"><span class="lineno">  153</span> </div>
<div class="line"><span class="lineno">  154</span>            Status = DeviceIoControl(</div>
<div class="line"><span class="lineno">  155</span>                Handle,                    <span class="comment">// Handle to device</span></div>
<div class="line"><span class="lineno">  156</span>                <a class="code hl_define" href="build_2bin_2debug_2_s_d_k_2_headers_2_ioctls_8h.html#ace90f6cc998458c046a38d7231989484">IOCTL_REGISTER_EVENT</a>,      <span class="comment">// IO Control code</span></div>
<div class="line"><span class="lineno">  157</span>                &amp;RegisterEvent,            <span class="comment">// Input Buffer to driver.</span></div>
<div class="line"><span class="lineno">  158</span>                <a class="code hl_define" href="build_2bin_2debug_2_s_d_k_2_headers_2_events_8h.html#a45b28ed4e4baa5ca1d2b986967ce8e18">SIZEOF_REGISTER_EVENT</a> * 2, <span class="comment">// Length of input buffer in bytes. (x 2 is bcuz as the</span></div>
<div class="line"><span class="lineno">  159</span>                                           <span class="comment">// driver is x64 and has 64 bit values)</span></div>
<div class="line"><span class="lineno">  160</span>                OutputBuffer,              <span class="comment">// Output Buffer from driver.</span></div>
<div class="line"><span class="lineno">  161</span>                <a class="code hl_define" href="build_2bin_2debug_2_s_d_k_2_headers_2_constants_8h.html#a4e12a0c1a102bb323458f19d591379e5">UsermodeBufferSize</a>,        <span class="comment">// Length of output buffer in bytes.</span></div>
<div class="line"><span class="lineno">  162</span>                &amp;ReturnedLength,           <span class="comment">// Bytes placed in buffer.</span></div>
<div class="line"><span class="lineno">  163</span>                NULL                       <span class="comment">// synchronous call</span></div>
<div class="line"><span class="lineno">  164</span>            );</div>
<div class="line"><span class="lineno">  165</span> </div>
<div class="line"><span class="lineno">  166</span>            <span class="keywordflow">if</span> (!Status)</div>
<div class="line"><span class="lineno">  167</span>            {</div>
<div class="line"><span class="lineno">  168</span>                <span class="comment">//</span></div>
<div class="line"><span class="lineno">  169</span>                <span class="comment">// Error occured for second time, and we show the error message</span></div>
<div class="line"><span class="lineno">  170</span>                <span class="comment">//</span></div>
<div class="line"><span class="lineno">  171</span>                <span class="comment">// ShowMessages(&quot;ioctl failed with code 0x%x\n&quot;, GetLastError());</span></div>
<div class="line"><span class="lineno">  172</span> </div>
<div class="line"><span class="lineno">  173</span>                <span class="comment">//</span></div>
<div class="line"><span class="lineno">  174</span>                <span class="comment">// if we reach here, the packet is probably failed, it might</span></div>
<div class="line"><span class="lineno">  175</span>                <span class="comment">// be because of using flush command</span></div>
<div class="line"><span class="lineno">  176</span>                <span class="comment">//</span></div>
<div class="line"><span class="lineno">  177</span>                <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno">  178</span>            }</div>
<div class="line"><span class="lineno">  179</span> </div>
<div class="line"><span class="lineno">  180</span>            <span class="comment">//</span></div>
<div class="line"><span class="lineno">  181</span>            <span class="comment">// Compute the received buffer&#39;s operation code</span></div>
<div class="line"><span class="lineno">  182</span>            <span class="comment">//</span></div>
<div class="line"><span class="lineno">  183</span>            OperationCode = 0;</div>
<div class="line"><span class="lineno">  184</span>            memcpy(&amp;OperationCode, OutputBuffer, <span class="keyword">sizeof</span>(<a class="code hl_typedef" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#ae1e6edbbc26d6fbc71a90190d0266018">UINT32</a>));</div>
<div class="line"><span class="lineno">  185</span> </div>
<div class="line"><span class="lineno">  186</span>            <span class="keywordflow">switch</span> (OperationCode)</div>
<div class="line"><span class="lineno">  187</span>            {</div>
<div class="line"><span class="lineno">  188</span>            <span class="keywordflow">case</span> <a class="code hl_define" href="build_2bin_2debug_2_s_d_k_2_headers_2_constants_8h.html#adb2ff9235a26370285f86dd92ca438e5">OPERATION_LOG_NON_IMMEDIATE_MESSAGE</a>:</div>
<div class="line"><span class="lineno">  189</span> </div>
<div class="line"><span class="lineno">  190</span>                <a class="code hl_function" href="hprdbgrev_8cpp.html#a21c3c06b34d716c4680695c2b28127da">ShowMessages</a>(<span class="stringliteral">&quot;%s&quot;</span>, OutputBuffer + <span class="keyword">sizeof</span>(<a class="code hl_typedef" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#ae1e6edbbc26d6fbc71a90190d0266018">UINT32</a>));</div>
<div class="line"><span class="lineno">  191</span> </div>
<div class="line"><span class="lineno">  192</span>                <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  193</span>            <span class="keywordflow">case</span> <a class="code hl_define" href="build_2bin_2debug_2_s_d_k_2_headers_2_constants_8h.html#ab45eded32abb2bdaa322ec7f102adf71">OPERATION_LOG_INFO_MESSAGE</a>:</div>
<div class="line"><span class="lineno">  194</span> </div>
<div class="line"><span class="lineno">  195</span>                <a class="code hl_function" href="hprdbgrev_8cpp.html#a21c3c06b34d716c4680695c2b28127da">ShowMessages</a>(<span class="stringliteral">&quot;%s&quot;</span>, OutputBuffer + <span class="keyword">sizeof</span>(<a class="code hl_typedef" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#ae1e6edbbc26d6fbc71a90190d0266018">UINT32</a>));</div>
<div class="line"><span class="lineno">  196</span> </div>
<div class="line"><span class="lineno">  197</span>                <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  198</span>            <span class="keywordflow">case</span> <a class="code hl_define" href="build_2bin_2debug_2_s_d_k_2_headers_2_constants_8h.html#a45f712ca02a53ef234a252d979cbea84">OPERATION_LOG_ERROR_MESSAGE</a>:</div>
<div class="line"><span class="lineno">  199</span> </div>
<div class="line"><span class="lineno">  200</span>                <a class="code hl_function" href="hprdbgrev_8cpp.html#a21c3c06b34d716c4680695c2b28127da">ShowMessages</a>(<span class="stringliteral">&quot;%s&quot;</span>, OutputBuffer + <span class="keyword">sizeof</span>(<a class="code hl_typedef" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#ae1e6edbbc26d6fbc71a90190d0266018">UINT32</a>));</div>
<div class="line"><span class="lineno">  201</span> </div>
<div class="line"><span class="lineno">  202</span>                <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  203</span>            <span class="keywordflow">case</span> <a class="code hl_define" href="build_2bin_2debug_2_s_d_k_2_headers_2_constants_8h.html#a7fe504aedb9b121cc73989a01396de8d">OPERATION_LOG_WARNING_MESSAGE</a>:</div>
<div class="line"><span class="lineno">  204</span> </div>
<div class="line"><span class="lineno">  205</span>                <a class="code hl_function" href="hprdbgrev_8cpp.html#a21c3c06b34d716c4680695c2b28127da">ShowMessages</a>(<span class="stringliteral">&quot;%s&quot;</span>, OutputBuffer + <span class="keyword">sizeof</span>(<a class="code hl_typedef" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#ae1e6edbbc26d6fbc71a90190d0266018">UINT32</a>));</div>
<div class="line"><span class="lineno">  206</span> </div>
<div class="line"><span class="lineno">  207</span>                <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  208</span> </div>
<div class="line"><span class="lineno">  209</span>            <span class="keywordflow">case</span> <a class="code hl_define" href="build_2bin_2debug_2_s_d_k_2_headers_2_constants_8h.html#a9f661f43a2301721d3ce5d0956095a86">OPERATION_HYPERVISOR_DRIVER_IS_SUCCESSFULLY_LOADED</a>:</div>
<div class="line"><span class="lineno">  210</span> </div>
<div class="line"><span class="lineno">  211</span>                <span class="comment">//</span></div>
<div class="line"><span class="lineno">  212</span>                <span class="comment">// Indicate that driver (Hypervisor) is loaded successfully</span></div>
<div class="line"><span class="lineno">  213</span>                <span class="comment">//</span></div>
<div class="line"><span class="lineno">  214</span>                SetEvent(<a class="code hl_variable" href="hprdbgrev_8cpp.html#a3f9f07302a64745af9aa15c1defbc798">g_IsDriverLoadedSuccessfully</a>);</div>
<div class="line"><span class="lineno">  215</span> </div>
<div class="line"><span class="lineno">  216</span>                <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  217</span> </div>
<div class="line"><span class="lineno">  218</span>            <span class="keywordflow">default</span>:</div>
<div class="line"><span class="lineno">  219</span> </div>
<div class="line"><span class="lineno">  220</span>                <a class="code hl_function" href="hprdbgrev_8cpp.html#a21c3c06b34d716c4680695c2b28127da">ShowMessages</a>(<span class="stringliteral">&quot;err, unknown message is received in rev module\n&quot;</span>);</div>
<div class="line"><span class="lineno">  221</span> </div>
<div class="line"><span class="lineno">  222</span>                <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  223</span>            }</div>
<div class="line"><span class="lineno">  224</span>        }</div>
<div class="line"><span class="lineno">  225</span>    }</div>
<div class="line"><span class="lineno">  226</span>    <span class="keywordflow">catch</span> (<span class="keyword">const</span> std::exception &amp;)</div>
<div class="line"><span class="lineno">  227</span>    {</div>
<div class="line"><span class="lineno">  228</span>        <a class="code hl_function" href="hprdbgrev_8cpp.html#a21c3c06b34d716c4680695c2b28127da">ShowMessages</a>(<span class="stringliteral">&quot;err, exception occured in creating handle or parsing buffer\n&quot;</span>);</div>
<div class="line"><span class="lineno">  229</span>    }</div>
<div class="line"><span class="lineno">  230</span>    free(OutputBuffer);</div>
<div class="line"><span class="lineno">  231</span> </div>
<div class="line"><span class="lineno">  232</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">  233</span>    <span class="comment">// closeHandle</span></div>
<div class="line"><span class="lineno">  234</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">  235</span>    <span class="keywordflow">if</span> (!CloseHandle(Handle))</div>
<div class="line"><span class="lineno">  236</span>    {</div>
<div class="line"><span class="lineno">  237</span>        <a class="code hl_function" href="hprdbgrev_8cpp.html#a21c3c06b34d716c4680695c2b28127da">ShowMessages</a>(<span class="stringliteral">&quot;err, closing handle 0x%x\n&quot;</span>, GetLastError());</div>
<div class="line"><span class="lineno">  238</span>    };</div>
<div class="line"><span class="lineno">  239</span>}</div>
<div class="ttc" id="a_definition_8h_html_ae587705d649b149ca423cf686550d197"><div class="ttname"><a href="_definition_8h.html#ae587705d649b149ca423cf686550d197">DefaultSpeedOfReadingKernelMessages</a></div><div class="ttdeci">#define DefaultSpeedOfReadingKernelMessages</div><div class="ttdoc">The speed delay for showing messages from kernel-mode to user-mode in VMI-mode, using a lower value c...</div><div class="ttdef"><b>Definition:</b> Definition.h:82</div></div>
<div class="ttc" id="abuild_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h_html_a050c65e107f0c828f856a231f4b4e788"><div class="ttname"><a href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#a050c65e107f0c828f856a231f4b4e788">BOOL</a></div><div class="ttdeci">int BOOL</div><div class="ttdef"><b>Definition:</b> BasicTypes.h:21</div></div>
<div class="ttc" id="abuild_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h_html_a1cb18096b299d23458d3c7b85fd86555"><div class="ttname"><a href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#a1cb18096b299d23458d3c7b85fd86555">BOOLEAN</a></div><div class="ttdeci">UCHAR BOOLEAN</div><div class="ttdef"><b>Definition:</b> BasicTypes.h:37</div></div>
<div class="ttc" id="abuild_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h_html_aa8cecfc5c5c054d2875c03e77b7be15d"><div class="ttname"><a href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a></div><div class="ttdeci">#define TRUE</div><div class="ttdef"><b>Definition:</b> BasicTypes.h:50</div></div>
<div class="ttc" id="abuild_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h_html_ad342ac907eb044443153a22f964bf0af"><div class="ttname"><a href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#ad342ac907eb044443153a22f964bf0af">DWORD</a></div><div class="ttdeci">unsigned long DWORD</div><div class="ttdef"><b>Definition:</b> BasicTypes.h:20</div></div>
<div class="ttc" id="abuild_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h_html_ae1e6edbbc26d6fbc71a90190d0266018"><div class="ttname"><a href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#ae1e6edbbc26d6fbc71a90190d0266018">UINT32</a></div><div class="ttdeci">unsigned int UINT32</div><div class="ttdef"><b>Definition:</b> BasicTypes.h:46</div></div>
<div class="ttc" id="abuild_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h_html_af632da489ebc3708ec3ab6791ee53fa4"><div class="ttname"><a href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#af632da489ebc3708ec3ab6791ee53fa4">ULONG</a></div><div class="ttdeci">unsigned long ULONG</div><div class="ttdef"><b>Definition:</b> BasicTypes.h:35</div></div>
<div class="ttc" id="abuild_2bin_2debug_2_s_d_k_2_headers_2_constants_8h_html_a45f712ca02a53ef234a252d979cbea84"><div class="ttname"><a href="build_2bin_2debug_2_s_d_k_2_headers_2_constants_8h.html#a45f712ca02a53ef234a252d979cbea84">OPERATION_LOG_ERROR_MESSAGE</a></div><div class="ttdeci">#define OPERATION_LOG_ERROR_MESSAGE</div><div class="ttdef"><b>Definition:</b> Constants.h:338</div></div>
<div class="ttc" id="abuild_2bin_2debug_2_s_d_k_2_headers_2_constants_8h_html_a4e12a0c1a102bb323458f19d591379e5"><div class="ttname"><a href="build_2bin_2debug_2_s_d_k_2_headers_2_constants_8h.html#a4e12a0c1a102bb323458f19d591379e5">UsermodeBufferSize</a></div><div class="ttdeci">#define UsermodeBufferSize</div><div class="ttdoc">size of user-mode buffer</div><div class="ttdef"><b>Definition:</b> Constants.h:219</div></div>
<div class="ttc" id="abuild_2bin_2debug_2_s_d_k_2_headers_2_constants_8h_html_a7fe504aedb9b121cc73989a01396de8d"><div class="ttname"><a href="build_2bin_2debug_2_s_d_k_2_headers_2_constants_8h.html#a7fe504aedb9b121cc73989a01396de8d">OPERATION_LOG_WARNING_MESSAGE</a></div><div class="ttdeci">#define OPERATION_LOG_WARNING_MESSAGE</div><div class="ttdef"><b>Definition:</b> Constants.h:337</div></div>
<div class="ttc" id="abuild_2bin_2debug_2_s_d_k_2_headers_2_constants_8h_html_a9f661f43a2301721d3ce5d0956095a86"><div class="ttname"><a href="build_2bin_2debug_2_s_d_k_2_headers_2_constants_8h.html#a9f661f43a2301721d3ce5d0956095a86">OPERATION_HYPERVISOR_DRIVER_IS_SUCCESSFULLY_LOADED</a></div><div class="ttdeci">#define OPERATION_HYPERVISOR_DRIVER_IS_SUCCESSFULLY_LOADED</div><div class="ttdef"><b>Definition:</b> Constants.h:349</div></div>
<div class="ttc" id="abuild_2bin_2debug_2_s_d_k_2_headers_2_constants_8h_html_ab45eded32abb2bdaa322ec7f102adf71"><div class="ttname"><a href="build_2bin_2debug_2_s_d_k_2_headers_2_constants_8h.html#ab45eded32abb2bdaa322ec7f102adf71">OPERATION_LOG_INFO_MESSAGE</a></div><div class="ttdeci">#define OPERATION_LOG_INFO_MESSAGE</div><div class="ttdoc">Message logs id that comes from kernel-mode to user-mode.</div><div class="ttdef"><b>Definition:</b> Constants.h:336</div></div>
<div class="ttc" id="abuild_2bin_2debug_2_s_d_k_2_headers_2_constants_8h_html_adb2ff9235a26370285f86dd92ca438e5"><div class="ttname"><a href="build_2bin_2debug_2_s_d_k_2_headers_2_constants_8h.html#adb2ff9235a26370285f86dd92ca438e5">OPERATION_LOG_NON_IMMEDIATE_MESSAGE</a></div><div class="ttdeci">#define OPERATION_LOG_NON_IMMEDIATE_MESSAGE</div><div class="ttdef"><b>Definition:</b> Constants.h:339</div></div>
<div class="ttc" id="abuild_2bin_2debug_2_s_d_k_2_headers_2_data_types_8h_html_a7df81690e4c6ed5fbbb74547c998e4b6a557243d0c993fb8d9b81a0a0db183c2e"><div class="ttname"><a href="build_2bin_2debug_2_s_d_k_2_headers_2_data_types_8h.html#a7df81690e4c6ed5fbbb74547c998e4b6a557243d0c993fb8d9b81a0a0db183c2e">IRP_BASED</a></div><div class="ttdeci">@ IRP_BASED</div><div class="ttdef"><b>Definition:</b> DataTypes.h:209</div></div>
<div class="ttc" id="abuild_2bin_2debug_2_s_d_k_2_headers_2_events_8h_html_a45b28ed4e4baa5ca1d2b986967ce8e18"><div class="ttname"><a href="build_2bin_2debug_2_s_d_k_2_headers_2_events_8h.html#a45b28ed4e4baa5ca1d2b986967ce8e18">SIZEOF_REGISTER_EVENT</a></div><div class="ttdeci">#define SIZEOF_REGISTER_EVENT</div><div class="ttdef"><b>Definition:</b> Events.h:367</div></div>
<div class="ttc" id="abuild_2bin_2debug_2_s_d_k_2_headers_2_ioctls_8h_html_ace90f6cc998458c046a38d7231989484"><div class="ttname"><a href="build_2bin_2debug_2_s_d_k_2_headers_2_ioctls_8h.html#ace90f6cc998458c046a38d7231989484">IOCTL_REGISTER_EVENT</a></div><div class="ttdeci">#define IOCTL_REGISTER_EVENT</div><div class="ttdoc">ioctl, register a new event</div><div class="ttdef"><b>Definition:</b> Ioctls.h:64</div></div>
<div class="ttc" id="ahprdbgrev_8cpp_html_a04aaf680ede15f5e7ba51ab9f157bfff"><div class="ttname"><a href="hprdbgrev_8cpp.html#a04aaf680ede15f5e7ba51ab9f157bfff">g_DeviceHandle</a></div><div class="ttdeci">HANDLE g_DeviceHandle</div><div class="ttdoc">Holds the global handle of device which is used to send the request to the kernel by IOCTL,...</div><div class="ttdef"><b>Definition:</b> hprdbgrev.cpp:37</div></div>
<div class="ttc" id="ahprdbgrev_8cpp_html_a21c3c06b34d716c4680695c2b28127da"><div class="ttname"><a href="hprdbgrev_8cpp.html#a21c3c06b34d716c4680695c2b28127da">ShowMessages</a></div><div class="ttdeci">VOID ShowMessages(const char *Fmt,...)</div><div class="ttdoc">Show messages.</div><div class="ttdef"><b>Definition:</b> hprdbgrev.cpp:68</div></div>
<div class="ttc" id="ahprdbgrev_8cpp_html_a3f9f07302a64745af9aa15c1defbc798"><div class="ttname"><a href="hprdbgrev_8cpp.html#a3f9f07302a64745af9aa15c1defbc798">g_IsDriverLoadedSuccessfully</a></div><div class="ttdeci">HANDLE g_IsDriverLoadedSuccessfully</div><div class="ttdoc">Handle to show that if the debugger is loaded successfully.</div><div class="ttdef"><b>Definition:</b> hprdbgrev.cpp:28</div></div>
<div class="ttc" id="astruct___r_e_g_i_s_t_e_r___n_o_t_i_f_y___b_u_f_f_e_r_html"><div class="ttname"><a href="struct___r_e_g_i_s_t_e_r___n_o_t_i_f_y___b_u_f_f_e_r.html">_REGISTER_NOTIFY_BUFFER</a></div><div class="ttdoc">Used to register event for transferring buffer between user-to-kernel.</div><div class="ttdef"><b>Definition:</b> DataTypes.h:233</div></div>
<div class="ttc" id="astruct___r_e_g_i_s_t_e_r___n_o_t_i_f_y___b_u_f_f_e_r_html_a05acd472c7bdb5b620ec76b2ece28dd0"><div class="ttname"><a href="struct___r_e_g_i_s_t_e_r___n_o_t_i_f_y___b_u_f_f_e_r.html#a05acd472c7bdb5b620ec76b2ece28dd0">_REGISTER_NOTIFY_BUFFER::Type</a></div><div class="ttdeci">NOTIFY_TYPE Type</div><div class="ttdef"><b>Definition:</b> DataTypes.h:234</div></div>
<div class="ttc" id="astruct___r_e_g_i_s_t_e_r___n_o_t_i_f_y___b_u_f_f_e_r_html_a0be90ffe07b5e70e32a2971852f29c8f"><div class="ttname"><a href="struct___r_e_g_i_s_t_e_r___n_o_t_i_f_y___b_u_f_f_e_r.html#a0be90ffe07b5e70e32a2971852f29c8f">_REGISTER_NOTIFY_BUFFER::hEvent</a></div><div class="ttdeci">HANDLE hEvent</div><div class="ttdef"><b>Definition:</b> DataTypes.h:235</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a2ff72ed249e972213ed31fc4a3b93644" name="a2ff72ed249e972213ed31fc4a3b93644"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2ff72ed249e972213ed31fc4a3b93644">&#9670;&#160;</a></span>ReversingMachineStart()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ReversingMachineStart </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Load the reversing machine driver. </p>
<dl class="section return"><dt>Returns</dt><dd>int return zero if it was successful or non-zero if there was error </dd></dl>
<p>lpSecurityAttirbutes</p>
<p>lpTemplateFile</p>
<div class="fragment"><div class="line"><span class="lineno">  283</span>{</div>
<div class="line"><span class="lineno">  284</span>    <a class="code hl_typedef" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#ad342ac907eb044443153a22f964bf0af">DWORD</a> ErrorNum;</div>
<div class="line"><span class="lineno">  285</span>    <a class="code hl_typedef" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#ad342ac907eb044443153a22f964bf0af">DWORD</a> ThreadId;</div>
<div class="line"><span class="lineno">  286</span> </div>
<div class="line"><span class="lineno">  287</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="hprdbgrev_8cpp.html#a04aaf680ede15f5e7ba51ab9f157bfff">g_DeviceHandle</a>)</div>
<div class="line"><span class="lineno">  288</span>    {</div>
<div class="line"><span class="lineno">  289</span>        <a class="code hl_function" href="hprdbgrev_8cpp.html#a21c3c06b34d716c4680695c2b28127da">ShowMessages</a>(<span class="stringliteral">&quot;handle of the driver found, if you use &#39;load&#39; before, please &quot;</span></div>
<div class="line"><span class="lineno">  290</span>                     <span class="stringliteral">&quot;unload it using &#39;unload&#39;\n&quot;</span>);</div>
<div class="line"><span class="lineno">  291</span>        <span class="keywordflow">return</span> 1;</div>
<div class="line"><span class="lineno">  292</span>    }</div>
<div class="line"><span class="lineno">  293</span> </div>
<div class="line"><span class="lineno">  294</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">  295</span>    <span class="comment">// Make sure that this variable is false, because it might be set to</span></div>
<div class="line"><span class="lineno">  296</span>    <span class="comment">// true as the result of a previous load</span></div>
<div class="line"><span class="lineno">  297</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">  298</span>    <a class="code hl_variable" href="hprdbgrev_8cpp.html#a34d91f14ab8002a6eeab08d76588ae92">g_IsVmxOffProcessStart</a> = <a class="code hl_define" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div>
<div class="line"><span class="lineno">  299</span> </div>
<div class="line"><span class="lineno">  300</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">  301</span>    <span class="comment">// Init entering vmx</span></div>
<div class="line"><span class="lineno">  302</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">  303</span>    <a class="code hl_variable" href="hprdbgrev_8cpp.html#a04aaf680ede15f5e7ba51ab9f157bfff">g_DeviceHandle</a> = CreateFileA(</div>
<div class="line"><span class="lineno">  304</span>        <span class="stringliteral">&quot;\\\\.\\HyperDbgReversingMachineDevice&quot;</span>,</div>
<div class="line"><span class="lineno">  305</span>        GENERIC_READ | GENERIC_WRITE,</div>
<div class="line"><span class="lineno">  306</span>        FILE_SHARE_READ | FILE_SHARE_WRITE,</div>
<div class="line"><span class="lineno">  307</span>        NULL, </div>
<div class="line"><span class="lineno">  308</span>        OPEN_EXISTING,</div>
<div class="line"><span class="lineno">  309</span>        FILE_ATTRIBUTE_NORMAL | FILE_FLAG_OVERLAPPED,</div>
<div class="line"><span class="lineno">  310</span>        NULL); </div>
<div class="line"><span class="lineno">  311</span> </div>
<div class="line"><span class="lineno">  312</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="hprdbgrev_8cpp.html#a04aaf680ede15f5e7ba51ab9f157bfff">g_DeviceHandle</a> == INVALID_HANDLE_VALUE)</div>
<div class="line"><span class="lineno">  313</span>    {</div>
<div class="line"><span class="lineno">  314</span>        ErrorNum = GetLastError();</div>
<div class="line"><span class="lineno">  315</span> </div>
<div class="line"><span class="lineno">  316</span>        <span class="keywordflow">if</span> (ErrorNum == ERROR_ACCESS_DENIED)</div>
<div class="line"><span class="lineno">  317</span>        {</div>
<div class="line"><span class="lineno">  318</span>            <a class="code hl_function" href="hprdbgrev_8cpp.html#a21c3c06b34d716c4680695c2b28127da">ShowMessages</a>(<span class="stringliteral">&quot;err, access denied\nare you sure you have administrator &quot;</span></div>
<div class="line"><span class="lineno">  319</span>                         <span class="stringliteral">&quot;rights?\n&quot;</span>);</div>
<div class="line"><span class="lineno">  320</span>        }</div>
<div class="line"><span class="lineno">  321</span>        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ErrorNum == ERROR_GEN_FAILURE)</div>
<div class="line"><span class="lineno">  322</span>        {</div>
<div class="line"><span class="lineno">  323</span>            <a class="code hl_function" href="hprdbgrev_8cpp.html#a21c3c06b34d716c4680695c2b28127da">ShowMessages</a>(<span class="stringliteral">&quot;err, a device attached to the system is not functioning\n&quot;</span></div>
<div class="line"><span class="lineno">  324</span>                         <span class="stringliteral">&quot;vmx feature might be disabled from BIOS or VBS/HVCI is active\n&quot;</span>);</div>
<div class="line"><span class="lineno">  325</span>        }</div>
<div class="line"><span class="lineno">  326</span>        <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno">  327</span>        {</div>
<div class="line"><span class="lineno">  328</span>            <a class="code hl_function" href="hprdbgrev_8cpp.html#a21c3c06b34d716c4680695c2b28127da">ShowMessages</a>(<span class="stringliteral">&quot;err, CreateFile failed (%x)\n&quot;</span>, ErrorNum);</div>
<div class="line"><span class="lineno">  329</span>        }</div>
<div class="line"><span class="lineno">  330</span> </div>
<div class="line"><span class="lineno">  331</span>        <a class="code hl_variable" href="hprdbgrev_8cpp.html#a04aaf680ede15f5e7ba51ab9f157bfff">g_DeviceHandle</a> = NULL;</div>
<div class="line"><span class="lineno">  332</span>        <span class="keywordflow">return</span> 1;</div>
<div class="line"><span class="lineno">  333</span>    }</div>
<div class="line"><span class="lineno">  334</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">  335</span>    <span class="comment">// Create event to show if the hypervisor is loaded or not</span></div>
<div class="line"><span class="lineno">  336</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">  337</span>    <a class="code hl_variable" href="hprdbgrev_8cpp.html#a3f9f07302a64745af9aa15c1defbc798">g_IsDriverLoadedSuccessfully</a> = CreateEvent(NULL, <a class="code hl_define" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>, <a class="code hl_define" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>, NULL);</div>
<div class="line"><span class="lineno">  338</span> </div>
<div class="line"><span class="lineno">  339</span>    HANDLE Thread = CreateThread(NULL, 0, <a class="code hl_function" href="hprdbgrev_8cpp.html#a0564d081cfcdf97817d77dc998e81034">IrpBasedBufferThread</a>, NULL, 0, &amp;ThreadId);</div>
<div class="line"><span class="lineno">  340</span> </div>
<div class="line"><span class="lineno">  341</span>    <span class="comment">// if (Thread)</span></div>
<div class="line"><span class="lineno">  342</span>    <span class="comment">// {</span></div>
<div class="line"><span class="lineno">  343</span>    <span class="comment">//    ShowMessages(&quot;thread Created successfully\n&quot;);</span></div>
<div class="line"><span class="lineno">  344</span>    <span class="comment">// }</span></div>
<div class="line"><span class="lineno">  345</span> </div>
<div class="line"><span class="lineno">  346</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">  347</span>    <span class="comment">// We wait for the first message from the kernel debugger to continue</span></div>
<div class="line"><span class="lineno">  348</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">  349</span>    WaitForSingleObject(</div>
<div class="line"><span class="lineno">  350</span>        <a class="code hl_variable" href="hprdbgrev_8cpp.html#a3f9f07302a64745af9aa15c1defbc798">g_IsDriverLoadedSuccessfully</a>,</div>
<div class="line"><span class="lineno">  351</span>        INFINITE);</div>
<div class="line"><span class="lineno">  352</span> </div>
<div class="line"><span class="lineno">  353</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">  354</span>    <span class="comment">// No need to handle anymore</span></div>
<div class="line"><span class="lineno">  355</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">  356</span>    CloseHandle(<a class="code hl_variable" href="hprdbgrev_8cpp.html#a3f9f07302a64745af9aa15c1defbc798">g_IsDriverLoadedSuccessfully</a>);</div>
<div class="line"><span class="lineno">  357</span> </div>
<div class="line"><span class="lineno">  358</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">  359</span>    <span class="comment">// Operation was successful</span></div>
<div class="line"><span class="lineno">  360</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">  361</span>    <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  362</span>}</div>
<div class="ttc" id="abuild_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h_html_aa93f0eb578d23995850d61f7d61c55c1"><div class="ttname"><a href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a></div><div class="ttdeci">#define FALSE</div><div class="ttdef"><b>Definition:</b> BasicTypes.h:49</div></div>
<div class="ttc" id="ahprdbgrev_8cpp_html_a0564d081cfcdf97817d77dc998e81034"><div class="ttname"><a href="hprdbgrev_8cpp.html#a0564d081cfcdf97817d77dc998e81034">IrpBasedBufferThread</a></div><div class="ttdeci">DWORD WINAPI IrpBasedBufferThread(void *data)</div><div class="ttdoc">Create a thread for pending buffers.</div><div class="ttdef"><b>Definition:</b> hprdbgrev.cpp:248</div></div>
<div class="ttc" id="ahprdbgrev_8cpp_html_a34d91f14ab8002a6eeab08d76588ae92"><div class="ttname"><a href="hprdbgrev_8cpp.html#a34d91f14ab8002a6eeab08d76588ae92">g_IsVmxOffProcessStart</a></div><div class="ttdeci">BOOLEAN g_IsVmxOffProcessStart</div><div class="ttdoc">Shows whether the vmxoff process start or not.</div><div class="ttdef"><b>Definition:</b> hprdbgrev.cpp:49</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ad202733584341409fdf5cce4b62bbfd1" name="ad202733584341409fdf5cce4b62bbfd1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad202733584341409fdf5cce4b62bbfd1">&#9670;&#160;</a></span>ReversingMachineStop()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ReversingMachineStop </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Unload the reversing machine driver. </p>
<dl class="section return"><dt>Returns</dt><dd>int return zero if it was successful or non-zero if there was error </dd></dl>
<div class="fragment"><div class="line"><span class="lineno">  268</span>{</div>
<div class="line"><span class="lineno">  269</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">  270</span>    <span class="comment">// Not implemented</span></div>
<div class="line"><span class="lineno">  271</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">  272</span>    <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  273</span>}</div>
</div><!-- fragment -->
</div>
</div>
<a id="a21c3c06b34d716c4680695c2b28127da" name="a21c3c06b34d716c4680695c2b28127da"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a21c3c06b34d716c4680695c2b28127da">&#9670;&#160;</a></span>ShowMessages()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#a7f319bfc2492a2136964194204e7a8cf">VOID</a> ShowMessages </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>Fmt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>...</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Show messages. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">Fmt</td><td>format string message </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><span class="lineno">   69</span>{</div>
<div class="line"><span class="lineno">   70</span>    va_list ArgList;</div>
<div class="line"><span class="lineno">   71</span> </div>
<div class="line"><span class="lineno">   72</span>    va_start(ArgList, Fmt);</div>
<div class="line"><span class="lineno">   73</span>    vprintf(Fmt, ArgList);</div>
<div class="line"><span class="lineno">   74</span>    va_end(ArgList);</div>
<div class="line"><span class="lineno">   75</span>}</div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a id="a04aaf680ede15f5e7ba51ab9f157bfff" name="a04aaf680ede15f5e7ba51ab9f157bfff"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a04aaf680ede15f5e7ba51ab9f157bfff">&#9670;&#160;</a></span>g_DeviceHandle</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">HANDLE g_DeviceHandle</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Holds the global handle of device which is used to send the request to the kernel by IOCTL, this handle is not used for IRP Pending of message tracing this handle is used in KD VMM. </p>

</div>
</div>
<a id="a2efecbbb09b88ade29f50b2003ad4562" name="a2efecbbb09b88ade29f50b2003ad4562"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2efecbbb09b88ade29f50b2003ad4562">&#9670;&#160;</a></span>g_DeviceHandleReversingMachine</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">HANDLE g_DeviceHandleReversingMachine</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Holds the global handle of device which is used to send the request to the kernel by IOCTL, this handle is not used for IRP Pending of message tracing this handle used in reversing machine. </p>

</div>
</div>
<a id="a3f9f07302a64745af9aa15c1defbc798" name="a3f9f07302a64745af9aa15c1defbc798"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3f9f07302a64745af9aa15c1defbc798">&#9670;&#160;</a></span>g_IsDriverLoadedSuccessfully</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">HANDLE g_IsDriverLoadedSuccessfully = NULL</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Handle to show that if the debugger is loaded successfully. </p>

</div>
</div>
<a id="a0a209ec7bc7822ce1f94848c31d87cdd" name="a0a209ec7bc7822ce1f94848c31d87cdd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0a209ec7bc7822ce1f94848c31d87cdd">&#9670;&#160;</a></span>g_IsReversingMachineModulesLoaded</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#a1cb18096b299d23458d3c7b85fd86555">BOOLEAN</a> g_IsReversingMachineModulesLoaded</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Checks whether the RM module is loaded or not. </p>
<p>this variable is used to indicate that modules are loaded so we make sure to later use a trace of loading in 'unload' command (used in reversing machine)</p>

</div>
</div>
<a id="a34d91f14ab8002a6eeab08d76588ae92" name="a34d91f14ab8002a6eeab08d76588ae92"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a34d91f14ab8002a6eeab08d76588ae92">&#9670;&#160;</a></span>g_IsVmxOffProcessStart</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#a1cb18096b299d23458d3c7b85fd86555">BOOLEAN</a> g_IsVmxOffProcessStart</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Shows whether the vmxoff process start or not. </p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_53a6cdbae347618e9ee76d4be5c6ea96.html">hyperdbg</a></li><li class="navelem"><a class="el" href="dir_7f6350833cdadc66191f7c909dafbf65.html">hprdbgrev</a></li><li class="navelem"><a class="el" href="dir_a89a2f1c179883af85985d203baa379f.html">code</a></li><li class="navelem"><a class="el" href="hprdbgrev_8cpp.html">hprdbgrev.cpp</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.6 </li>
  </ul>
</div>
</body>
</html>
