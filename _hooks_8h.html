<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.6"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>HyperDbg: hyperdbg/hprdbghv/header/hooks/Hooks.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">HyperDbg
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.6 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('_hooks_8h.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#define-members">Macros</a> &#124;
<a href="#typedef-members">Typedefs</a> &#124;
<a href="#enum-members">Enumerations</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle"><div class="title">Hooks.h File Reference</div></div>
</div><!--header-->
<div class="contents">

<p>Hook headers.  
<a href="#details">More...</a></p>

<p><a href="_hooks_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="nested-classes" name="nested-classes"></a>
Classes</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="struct___s_s_d_t_struct.html">_SSDTStruct</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">SSDT structure.  <a href="struct___s_s_d_t_struct.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="struct___h_i_d_d_e_n___h_o_o_k_s___d_e_t_o_u_r___d_e_t_a_i_l_s.html">_HIDDEN_HOOKS_DETOUR_DETAILS</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Details of detours style EPT hooks.  <a href="struct___h_i_d_d_e_n___h_o_o_k_s___d_e_t_o_u_r___d_e_t_a_i_l_s.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="struct___s_y_s_t_e_m___m_o_d_u_l_e___e_n_t_r_y.html">_SYSTEM_MODULE_ENTRY</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Module entry.  <a href="struct___s_y_s_t_e_m___m_o_d_u_l_e___e_n_t_r_y.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="struct___s_y_s_t_e_m___m_o_d_u_l_e___i_n_f_o_r_m_a_t_i_o_n.html">_SYSTEM_MODULE_INFORMATION</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">System Information for modules.  <a href="struct___s_y_s_t_e_m___m_o_d_u_l_e___i_n_f_o_r_m_a_t_i_o_n.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="define-members" name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:a2633e7e4b97712c8a9924648d48b63f6"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_hooks_8h.html#a2633e7e4b97712c8a9924648d48b63f6">IS_SYSRET_INSTRUCTION</a>(Code)</td></tr>
<tr class="memdesc:a2633e7e4b97712c8a9924648d48b63f6"><td class="mdescLeft">&#160;</td><td class="mdescRight">As we have just on sysret in all the Windows, we use the following variable to hold its address this way, we're not force to check for the instruction so we remove the memory access to check for sysret in this case.  <br /></td></tr>
<tr class="separator:a2633e7e4b97712c8a9924648d48b63f6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a765571d13192493adf4e7baa5a9e9468"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_hooks_8h.html#a765571d13192493adf4e7baa5a9e9468">IS_SYSCALL_INSTRUCTION</a>(Code)</td></tr>
<tr class="separator:a765571d13192493adf4e7baa5a9e9468"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acde26d24b0ff46215cbd029d8ae87e4d"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_hooks_8h.html#acde26d24b0ff46215cbd029d8ae87e4d">IMAGE_DOS_SIGNATURE</a>&#160;&#160;&#160;0x5A4D</td></tr>
<tr class="memdesc:acde26d24b0ff46215cbd029d8ae87e4d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Special signatures.  <br /></td></tr>
<tr class="separator:acde26d24b0ff46215cbd029d8ae87e4d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9d186034e0a154cfc3bcc5ec8e977564"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_hooks_8h.html#a9d186034e0a154cfc3bcc5ec8e977564">IMAGE_OS2_SIGNATURE</a>&#160;&#160;&#160;0x454E</td></tr>
<tr class="separator:a9d186034e0a154cfc3bcc5ec8e977564"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a41ddf3f83e5c119216c43a3cd98deba4"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_hooks_8h.html#a41ddf3f83e5c119216c43a3cd98deba4">IMAGE_OS2_SIGNATURE_LE</a>&#160;&#160;&#160;0x454C</td></tr>
<tr class="separator:a41ddf3f83e5c119216c43a3cd98deba4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0d59e625e438a014184cfc9e892553c3"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_hooks_8h.html#a0d59e625e438a014184cfc9e892553c3">IMAGE_VXD_SIGNATURE</a>&#160;&#160;&#160;0x454C</td></tr>
<tr class="separator:a0d59e625e438a014184cfc9e892553c3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a83570e3e2fba8cb7c2abc8b3eee47d48"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_hooks_8h.html#a83570e3e2fba8cb7c2abc8b3eee47d48">IMAGE_NT_SIGNATURE</a>&#160;&#160;&#160;0x00004550</td></tr>
<tr class="separator:a83570e3e2fba8cb7c2abc8b3eee47d48"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9b5b17233c5031bc6d520227b440e01a"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_hooks_8h.html#a9b5b17233c5031bc6d520227b440e01a">MAX_EXEC_TRAMPOLINE_SIZE</a>&#160;&#160;&#160;100</td></tr>
<tr class="memdesc:a9b5b17233c5031bc6d520227b440e01a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Maximum number of supported execution trampoline.  <br /></td></tr>
<tr class="separator:a9b5b17233c5031bc6d520227b440e01a"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="typedef-members" name="typedef-members"></a>
Typedefs</h2></td></tr>
<tr class="memitem:a7ef67836bf52e4d218108fb05855a5ee"><td class="memItemLeft" align="right" valign="top">typedef struct <a class="el" href="struct___s_s_d_t_struct.html">_SSDTStruct</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_hooks_8h.html#a7ef67836bf52e4d218108fb05855a5ee">SSDTStruct</a></td></tr>
<tr class="memdesc:a7ef67836bf52e4d218108fb05855a5ee"><td class="mdescLeft">&#160;</td><td class="mdescRight">SSDT structure.  <br /></td></tr>
<tr class="separator:a7ef67836bf52e4d218108fb05855a5ee"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:affb3200da2e6d1088947739169dfcfba"><td class="memItemLeft" align="right" valign="top">typedef struct <a class="el" href="struct___s_s_d_t_struct.html">_SSDTStruct</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_hooks_8h.html#affb3200da2e6d1088947739169dfcfba">PSSDTStruct</a></td></tr>
<tr class="separator:affb3200da2e6d1088947739169dfcfba"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afca3bba3357dab1c3380e4b9772f04da"><td class="memItemLeft" align="right" valign="top">typedef struct <a class="el" href="struct___h_i_d_d_e_n___h_o_o_k_s___d_e_t_o_u_r___d_e_t_a_i_l_s.html">_HIDDEN_HOOKS_DETOUR_DETAILS</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_hooks_8h.html#afca3bba3357dab1c3380e4b9772f04da">HIDDEN_HOOKS_DETOUR_DETAILS</a></td></tr>
<tr class="memdesc:afca3bba3357dab1c3380e4b9772f04da"><td class="mdescLeft">&#160;</td><td class="mdescRight">Details of detours style EPT hooks.  <br /></td></tr>
<tr class="separator:afca3bba3357dab1c3380e4b9772f04da"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0dd75bc2892ba7c908ee7f1da6f8c760"><td class="memItemLeft" align="right" valign="top">typedef struct <a class="el" href="struct___h_i_d_d_e_n___h_o_o_k_s___d_e_t_o_u_r___d_e_t_a_i_l_s.html">_HIDDEN_HOOKS_DETOUR_DETAILS</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_hooks_8h.html#a0dd75bc2892ba7c908ee7f1da6f8c760">PHIDDEN_HOOKS_DETOUR_DETAILS</a></td></tr>
<tr class="separator:a0dd75bc2892ba7c908ee7f1da6f8c760"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6874334f705ea54c18fe8e417b192bcf"><td class="memItemLeft" align="right" valign="top">typedef struct <a class="el" href="struct___s_y_s_t_e_m___m_o_d_u_l_e___e_n_t_r_y.html">_SYSTEM_MODULE_ENTRY</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_hooks_8h.html#a6874334f705ea54c18fe8e417b192bcf">SYSTEM_MODULE_ENTRY</a></td></tr>
<tr class="memdesc:a6874334f705ea54c18fe8e417b192bcf"><td class="mdescLeft">&#160;</td><td class="mdescRight">Module entry.  <br /></td></tr>
<tr class="separator:a6874334f705ea54c18fe8e417b192bcf"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a01b72f04cfe7a055417c2d21f548bb44"><td class="memItemLeft" align="right" valign="top">typedef struct <a class="el" href="struct___s_y_s_t_e_m___m_o_d_u_l_e___e_n_t_r_y.html">_SYSTEM_MODULE_ENTRY</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_hooks_8h.html#a01b72f04cfe7a055417c2d21f548bb44">PSYSTEM_MODULE_ENTRY</a></td></tr>
<tr class="separator:a01b72f04cfe7a055417c2d21f548bb44"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab544297b0d5c1d52d774046be13f483d"><td class="memItemLeft" align="right" valign="top">typedef struct <a class="el" href="struct___s_y_s_t_e_m___m_o_d_u_l_e___i_n_f_o_r_m_a_t_i_o_n.html">_SYSTEM_MODULE_INFORMATION</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_hooks_8h.html#ab544297b0d5c1d52d774046be13f483d">SYSTEM_MODULE_INFORMATION</a></td></tr>
<tr class="memdesc:ab544297b0d5c1d52d774046be13f483d"><td class="mdescLeft">&#160;</td><td class="mdescRight">System Information for modules.  <br /></td></tr>
<tr class="separator:ab544297b0d5c1d52d774046be13f483d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0f259ebddf952a9e0ccfa9c7e7693795"><td class="memItemLeft" align="right" valign="top">typedef struct <a class="el" href="struct___s_y_s_t_e_m___m_o_d_u_l_e___i_n_f_o_r_m_a_t_i_o_n.html">_SYSTEM_MODULE_INFORMATION</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_hooks_8h.html#a0f259ebddf952a9e0ccfa9c7e7693795">PSYSTEM_MODULE_INFORMATION</a></td></tr>
<tr class="separator:a0f259ebddf952a9e0ccfa9c7e7693795"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae75edb0a85f69b42a96960e023f58c47"><td class="memItemLeft" align="right" valign="top">typedef enum <a class="el" href="_hooks_8h.html#ad5d815b48e8f4da1ef2eb7a2f18a54e0">_SYSTEM_INFORMATION_CLASS</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_hooks_8h.html#ae75edb0a85f69b42a96960e023f58c47">SYSTEM_INFORMATION_CLASS</a></td></tr>
<tr class="memdesc:ae75edb0a85f69b42a96960e023f58c47"><td class="mdescLeft">&#160;</td><td class="mdescRight">System information class.  <br /></td></tr>
<tr class="separator:ae75edb0a85f69b42a96960e023f58c47"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aef74275b90a76319745df6047d624096"><td class="memItemLeft" align="right" valign="top">typedef enum <a class="el" href="_hooks_8h.html#ad5d815b48e8f4da1ef2eb7a2f18a54e0">_SYSTEM_INFORMATION_CLASS</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_hooks_8h.html#aef74275b90a76319745df6047d624096">PSYSTEM_INFORMATION_CLASS</a></td></tr>
<tr class="separator:aef74275b90a76319745df6047d624096"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a017811c2b939ab5a3ced279a946f990c"><td class="memItemLeft" align="right" valign="top">typedef NTSTATUS(NTAPI *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_hooks_8h.html#a017811c2b939ab5a3ced279a946f990c">ZWQUERYSYSTEMINFORMATION</a>) (IN <a class="el" href="_hooks_8h.html#ae75edb0a85f69b42a96960e023f58c47">SYSTEM_INFORMATION_CLASS</a> SystemInformationClass, OUT PVOID SystemInformation, IN <a class="el" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#af632da489ebc3708ec3ab6791ee53fa4">ULONG</a> SystemInformationLength, OUT PULONG ReturnLength OPTIONAL)</td></tr>
<tr class="separator:a017811c2b939ab5a3ced279a946f990c"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="enum-members" name="enum-members"></a>
Enumerations</h2></td></tr>
<tr class="memitem:ad5d815b48e8f4da1ef2eb7a2f18a54e0"><td class="memItemLeft" align="right" valign="top">enum &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_hooks_8h.html#ad5d815b48e8f4da1ef2eb7a2f18a54e0">_SYSTEM_INFORMATION_CLASS</a> { <a class="el" href="_hooks_8h.html#ad5d815b48e8f4da1ef2eb7a2f18a54e0a38627594543f01525bf40aa8e09607bd">SystemModuleInformation</a> = 11
, <a class="el" href="_hooks_8h.html#ad5d815b48e8f4da1ef2eb7a2f18a54e0a18e658a754e39d6e6c1b653248b8aa78">SystemKernelDebuggerInformation</a> = 35
 }</td></tr>
<tr class="memdesc:ad5d815b48e8f4da1ef2eb7a2f18a54e0"><td class="mdescLeft">&#160;</td><td class="mdescRight">System information class.  <a href="_hooks_8h.html#ad5d815b48e8f4da1ef2eb7a2f18a54e0">More...</a><br /></td></tr>
<tr class="separator:ad5d815b48e8f4da1ef2eb7a2f18a54e0"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a2252d8f31a2a6826928c9a192ef59193"><td class="memItemLeft" align="right" valign="top"><a class="el" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#a7f319bfc2492a2136964194204e7a8cf">VOID</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_hooks_8h.html#a2252d8f31a2a6826928c9a192ef59193">SyscallHookTest</a> ()</td></tr>
<tr class="memdesc:a2252d8f31a2a6826928c9a192ef59193"><td class="mdescLeft">&#160;</td><td class="mdescRight">Make examples for testing hidden hooks.  <br /></td></tr>
<tr class="separator:a2252d8f31a2a6826928c9a192ef59193"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a018ba30cbafd5ebc786414637eb7b8f3"><td class="memItemLeft" align="right" valign="top"><a class="el" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#a7f319bfc2492a2136964194204e7a8cf">VOID</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_hooks_8h.html#a018ba30cbafd5ebc786414637eb7b8f3">SyscallHookConfigureEFER</a> (<a class="el" href="hprdbghv_2header_2common_2_state_8h.html#ac81d4d9bd1e8dd24918e667b56b67b7e">VIRTUAL_MACHINE_STATE</a> *VCpu, <a class="el" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#a1cb18096b299d23458d3c7b85fd86555">BOOLEAN</a> EnableEFERSyscallHook)</td></tr>
<tr class="memdesc:a018ba30cbafd5ebc786414637eb7b8f3"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function enables or disables EFER syscall hoo.  <br /></td></tr>
<tr class="separator:a018ba30cbafd5ebc786414637eb7b8f3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5ad0a606e7e2961614ad11e934585718"><td class="memItemLeft" align="right" valign="top"><a class="el" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#a1cb18096b299d23458d3c7b85fd86555">BOOLEAN</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_hooks_8h.html#a5ad0a606e7e2961614ad11e934585718">SyscallHookHandleUD</a> (_Inout_ <a class="el" href="hprdbghv_2header_2common_2_state_8h.html#ac81d4d9bd1e8dd24918e667b56b67b7e">VIRTUAL_MACHINE_STATE</a> *VCpu)</td></tr>
<tr class="separator:a5ad0a606e7e2961614ad11e934585718"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a714c210615d12747427523057db721d1"><td class="memItemLeft" align="right" valign="top"><a class="el" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#a1cb18096b299d23458d3c7b85fd86555">BOOLEAN</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_hooks_8h.html#a714c210615d12747427523057db721d1">SyscallHookEmulateSYSRET</a> (_Inout_ <a class="el" href="hprdbghv_2header_2common_2_state_8h.html#ac81d4d9bd1e8dd24918e667b56b67b7e">VIRTUAL_MACHINE_STATE</a> *VCpu)</td></tr>
<tr class="separator:a714c210615d12747427523057db721d1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a09cacb271b340e0c85aa1ccbd0c5d327"><td class="memItemLeft" align="right" valign="top"><a class="el" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#a1cb18096b299d23458d3c7b85fd86555">BOOLEAN</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_hooks_8h.html#a09cacb271b340e0c85aa1ccbd0c5d327">SyscallHookEmulateSYSCALL</a> (_Inout_ <a class="el" href="hprdbghv_2header_2common_2_state_8h.html#ac81d4d9bd1e8dd24918e667b56b67b7e">VIRTUAL_MACHINE_STATE</a> *VCpu)</td></tr>
<tr class="separator:a09cacb271b340e0c85aa1ccbd0c5d327"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a194622a3ba05a449923eb105cdb37405"><td class="memItemLeft" align="right" valign="top"><a class="el" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#a1cb18096b299d23458d3c7b85fd86555">BOOLEAN</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_hooks_8h.html#a194622a3ba05a449923eb105cdb37405">EptHookPerformPageHook</a> (PVOID TargetAddress, <a class="el" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#aaeec30724d8f0c9d2acd894f41ee06fe">CR3_TYPE</a> ProcessCr3)</td></tr>
<tr class="memdesc:a194622a3ba05a449923eb105cdb37405"><td class="mdescLeft">&#160;</td><td class="mdescRight">Hook in VMX Root Mode with hidden breakpoints (A pre-allocated buffer should be available)  <br /></td></tr>
<tr class="separator:a194622a3ba05a449923eb105cdb37405"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a77e3785963c79b3ff0efdf13efe0be13"><td class="memItemLeft" align="right" valign="top"><a class="el" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#a1cb18096b299d23458d3c7b85fd86555">BOOLEAN</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_hooks_8h.html#a77e3785963c79b3ff0efdf13efe0be13">EptHookPerformPageHook2</a> (PVOID TargetAddress, PVOID HookFunction, <a class="el" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#aaeec30724d8f0c9d2acd894f41ee06fe">CR3_TYPE</a> ProcessCr3, <a class="el" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#a1cb18096b299d23458d3c7b85fd86555">BOOLEAN</a> UnsetRead, <a class="el" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#a1cb18096b299d23458d3c7b85fd86555">BOOLEAN</a> UnsetWrite, <a class="el" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#a1cb18096b299d23458d3c7b85fd86555">BOOLEAN</a> UnsetExecute)</td></tr>
<tr class="memdesc:a77e3785963c79b3ff0efdf13efe0be13"><td class="mdescLeft">&#160;</td><td class="mdescRight">Hook in VMX Root Mode with hidden detours and monitor (A pre-allocated buffer should be available)  <br /></td></tr>
<tr class="separator:a77e3785963c79b3ff0efdf13efe0be13"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abcbdb9cd3dbdf238b8b5d484522855e3"><td class="memItemLeft" align="right" valign="top"><a class="el" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#a1cb18096b299d23458d3c7b85fd86555">BOOLEAN</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_hooks_8h.html#abcbdb9cd3dbdf238b8b5d484522855e3">EptHook</a> (PVOID TargetAddress, <a class="el" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#ae1e6edbbc26d6fbc71a90190d0266018">UINT32</a> ProcessId)</td></tr>
<tr class="memdesc:abcbdb9cd3dbdf238b8b5d484522855e3"><td class="mdescLeft">&#160;</td><td class="mdescRight">Hook in VMX Non Root Mode (hidden breakpoint)  <br /></td></tr>
<tr class="separator:abcbdb9cd3dbdf238b8b5d484522855e3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3c5eb45ffb3514149f329aeb0cf04071"><td class="memItemLeft" align="right" valign="top"><a class="el" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#a1cb18096b299d23458d3c7b85fd86555">BOOLEAN</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_hooks_8h.html#a3c5eb45ffb3514149f329aeb0cf04071">EptHook2</a> (PVOID TargetAddress, PVOID HookFunction, <a class="el" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#ae1e6edbbc26d6fbc71a90190d0266018">UINT32</a> ProcessId, <a class="el" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#a1cb18096b299d23458d3c7b85fd86555">BOOLEAN</a> SetHookForRead, <a class="el" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#a1cb18096b299d23458d3c7b85fd86555">BOOLEAN</a> SetHookForWrite, <a class="el" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#a1cb18096b299d23458d3c7b85fd86555">BOOLEAN</a> SetHookForExec)</td></tr>
<tr class="memdesc:a3c5eb45ffb3514149f329aeb0cf04071"><td class="mdescLeft">&#160;</td><td class="mdescRight">Hook in VMX Non Root Mode (hidden detours)  <br /></td></tr>
<tr class="separator:a3c5eb45ffb3514149f329aeb0cf04071"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3d7fb010ec1756aa2f27e861271fc0f0"><td class="memItemLeft" align="right" valign="top"><a class="el" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#a1cb18096b299d23458d3c7b85fd86555">BOOLEAN</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_hooks_8h.html#a3d7fb010ec1756aa2f27e861271fc0f0">EptHookHandleHookedPage</a> (<a class="el" href="hprdbghv_2header_2common_2_state_8h.html#ac81d4d9bd1e8dd24918e667b56b67b7e">VIRTUAL_MACHINE_STATE</a> *VCpu, <a class="el" href="hprdbghv_2header_2common_2_state_8h.html#a2ef230620f7c5617f62c8022159293fb">EPT_HOOKED_PAGE_DETAIL</a> *HookedEntryDetails, VMX_EXIT_QUALIFICATION_EPT_VIOLATION ViolationQualification, SIZE_T PhysicalAddress, <a class="el" href="build_2bin_2debug_2_s_d_k_2_headers_2_data_types_8h.html#a732f5fb65b66d5b23321a9b1c69e64d1">EPT_HOOKS_CONTEXT</a> *LastContext, <a class="el" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#a1cb18096b299d23458d3c7b85fd86555">BOOLEAN</a> *IgnoreReadOrWrite, <a class="el" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#a1cb18096b299d23458d3c7b85fd86555">BOOLEAN</a> *IsTriggeringPostEventAllowed)</td></tr>
<tr class="memdesc:a3d7fb010ec1756aa2f27e861271fc0f0"><td class="mdescLeft">&#160;</td><td class="mdescRight">Handle hooked pages in Vmx-root mode.  <br /></td></tr>
<tr class="separator:a3d7fb010ec1756aa2f27e861271fc0f0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aba59e4d31f5cf37d9436d73933e8158c"><td class="memItemLeft" align="right" valign="top"><a class="el" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#a1cb18096b299d23458d3c7b85fd86555">BOOLEAN</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_hooks_8h.html#aba59e4d31f5cf37d9436d73933e8158c">EptHookRestoreSingleHookToOrginalEntry</a> (SIZE_T PhysicalAddress)</td></tr>
<tr class="memdesc:aba59e4d31f5cf37d9436d73933e8158c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Remove a special hook from the hooked pages lists.  <br /></td></tr>
<tr class="separator:aba59e4d31f5cf37d9436d73933e8158c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acd59638727980bbd58fb4665ffce9091"><td class="memItemLeft" align="right" valign="top"><a class="el" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#a7f319bfc2492a2136964194204e7a8cf">VOID</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_hooks_8h.html#acd59638727980bbd58fb4665ffce9091">EptHookRestoreAllHooksToOrginalEntry</a> ()</td></tr>
<tr class="memdesc:acd59638727980bbd58fb4665ffce9091"><td class="mdescLeft">&#160;</td><td class="mdescRight">Remove all hooks from the hooked pages lists (Should be called in vmx-root)  <br /></td></tr>
<tr class="separator:acd59638727980bbd58fb4665ffce9091"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac8845ca75f3b4c267d3542d20621f547"><td class="memItemLeft" align="right" valign="top"><a class="el" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#a7f319bfc2492a2136964194204e7a8cf">VOID</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_hooks_8h.html#ac8845ca75f3b4c267d3542d20621f547">EptHookUnHookAll</a> ()</td></tr>
<tr class="memdesc:ac8845ca75f3b4c267d3542d20621f547"><td class="mdescLeft">&#160;</td><td class="mdescRight">Remove all hooks from the hooked pages lists.  <br /></td></tr>
<tr class="separator:ac8845ca75f3b4c267d3542d20621f547"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a24ce2115ab4514ec8eed08d0911b64d6"><td class="memItemLeft" align="right" valign="top"><a class="el" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#a1cb18096b299d23458d3c7b85fd86555">BOOLEAN</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_hooks_8h.html#a24ce2115ab4514ec8eed08d0911b64d6">EptHookUnHookSingleAddress</a> (<a class="el" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#aae17ebb9ef7279d026817fb22f8aebe9">UINT64</a> VirtualAddress, <a class="el" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#aae17ebb9ef7279d026817fb22f8aebe9">UINT64</a> PhysAddress, <a class="el" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#ae1e6edbbc26d6fbc71a90190d0266018">UINT32</a> ProcessId)</td></tr>
<tr class="memdesc:a24ce2115ab4514ec8eed08d0911b64d6"><td class="mdescLeft">&#160;</td><td class="mdescRight">Remove single hook from the hooked pages list and invalidate TLB.  <br /></td></tr>
<tr class="separator:a24ce2115ab4514ec8eed08d0911b64d6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acd0179b7c5730f636141dfea2afcdc5a"><td class="memItemLeft" align="right" valign="top"><a class="el" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#ae1e6edbbc26d6fbc71a90190d0266018">UINT32</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_hooks_8h.html#acd0179b7c5730f636141dfea2afcdc5a">EptHookGetCountOfEpthooks</a> (<a class="el" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#a1cb18096b299d23458d3c7b85fd86555">BOOLEAN</a> IsEptHook2)</td></tr>
<tr class="memdesc:acd0179b7c5730f636141dfea2afcdc5a"><td class="mdescLeft">&#160;</td><td class="mdescRight">get the length of active EPT hooks (!epthook and !epthook2)  <br /></td></tr>
<tr class="separator:acd0179b7c5730f636141dfea2afcdc5a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acac4eff03b2197ae43e4c13f382e20b5"><td class="memItemLeft" align="right" valign="top"><a class="el" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#a1cb18096b299d23458d3c7b85fd86555">BOOLEAN</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_hooks_8h.html#acac4eff03b2197ae43e4c13f382e20b5">EptHookRemoveEntryAndFreePoolFromEptHook2sDetourList</a> (<a class="el" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#aae17ebb9ef7279d026817fb22f8aebe9">UINT64</a> <a class="el" href="build_2bin_2debug_2_s_d_k_2_imports_2_hyper_dbg_script_imports_8h.html#a3f7c5b71d899e923be0a80d4ac7902fe">Address</a>)</td></tr>
<tr class="memdesc:acac4eff03b2197ae43e4c13f382e20b5"><td class="mdescLeft">&#160;</td><td class="mdescRight">Remove an entry from g_EptHook2sDetourListHead.  <br /></td></tr>
<tr class="separator:acac4eff03b2197ae43e4c13f382e20b5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2d6894b9430a2758f65c2a646ee6c872"><td class="memItemLeft" align="right" valign="top">PVOID&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_hooks_8h.html#a2d6894b9430a2758f65c2a646ee6c872">EptHook2GeneralDetourEventHandler</a> (<a class="el" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#a2bd4673df5e6e2fb371d770f3f2886d9">PGUEST_REGS</a> Regs, PVOID CalledFrom)</td></tr>
<tr class="memdesc:a2d6894b9430a2758f65c2a646ee6c872"><td class="mdescLeft">&#160;</td><td class="mdescRight">routines to generally handle breakpoint hit for detour  <br /></td></tr>
<tr class="separator:a2d6894b9430a2758f65c2a646ee6c872"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a568ee71ca657b5e7f5d613288be096b9"><td class="memItemLeft" align="right" valign="top"><a class="el" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#a7f319bfc2492a2136964194204e7a8cf">VOID</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_hooks_8h.html#a568ee71ca657b5e7f5d613288be096b9">EptHookAllocateExtraHookingPages</a> (<a class="el" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#ae1e6edbbc26d6fbc71a90190d0266018">UINT32</a> Count)</td></tr>
<tr class="memdesc:a568ee71ca657b5e7f5d613288be096b9"><td class="mdescLeft">&#160;</td><td class="mdescRight">Allocate (reserve) extra pages for storing details of page hooks.  <br /></td></tr>
<tr class="separator:a568ee71ca657b5e7f5d613288be096b9"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="var-members" name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a74bc6881ecc918d83da9c92e3b2bcc04"><td class="memItemLeft" align="right" valign="top">PHANDLE&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_hooks_8h.html#a74bc6881ecc918d83da9c92e3b2bcc04">FileHandle</a></td></tr>
<tr class="separator:a74bc6881ecc918d83da9c92e3b2bcc04"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac648ae3c24d5148a8ef42128d6bab501"><td class="memItemLeft" align="right" valign="top">PHANDLE ACCESS_MASK&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_hooks_8h.html#ac648ae3c24d5148a8ef42128d6bab501">DesiredAccess</a></td></tr>
<tr class="separator:ac648ae3c24d5148a8ef42128d6bab501"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a22e2a9ce1ada928965365e448fd91e10"><td class="memItemLeft" align="right" valign="top">PHANDLE ACCESS_MASK POBJECT_ATTRIBUTES&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_hooks_8h.html#a22e2a9ce1ada928965365e448fd91e10">ObjectAttributes</a></td></tr>
<tr class="separator:a22e2a9ce1ada928965365e448fd91e10"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a24ff958436c219a33ff5b86019874568"><td class="memItemLeft" align="right" valign="top">PHANDLE ACCESS_MASK POBJECT_ATTRIBUTES PIO_STATUS_BLOCK&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_hooks_8h.html#a24ff958436c219a33ff5b86019874568">IoStatusBlock</a></td></tr>
<tr class="separator:a24ff958436c219a33ff5b86019874568"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a708148b18a52f70ef6c1e92504f29e92"><td class="memItemLeft" align="right" valign="top">PHANDLE ACCESS_MASK POBJECT_ATTRIBUTES PIO_STATUS_BLOCK PLARGE_INTEGER&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_hooks_8h.html#a708148b18a52f70ef6c1e92504f29e92">AllocationSize</a></td></tr>
<tr class="separator:a708148b18a52f70ef6c1e92504f29e92"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a54b337d004f8bae1638fab9180d83d08"><td class="memItemLeft" align="right" valign="top">PHANDLE ACCESS_MASK POBJECT_ATTRIBUTES PIO_STATUS_BLOCK PLARGE_INTEGER <a class="el" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#af632da489ebc3708ec3ab6791ee53fa4">ULONG</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_hooks_8h.html#a54b337d004f8bae1638fab9180d83d08">FileAttributes</a></td></tr>
<tr class="separator:a54b337d004f8bae1638fab9180d83d08"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9ae311c2ebc03cc38ee69edaac2f6e12"><td class="memItemLeft" align="right" valign="top">PHANDLE ACCESS_MASK POBJECT_ATTRIBUTES PIO_STATUS_BLOCK PLARGE_INTEGER <a class="el" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#af632da489ebc3708ec3ab6791ee53fa4">ULONG</a> <a class="el" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#af632da489ebc3708ec3ab6791ee53fa4">ULONG</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_hooks_8h.html#a9ae311c2ebc03cc38ee69edaac2f6e12">ShareAccess</a></td></tr>
<tr class="separator:a9ae311c2ebc03cc38ee69edaac2f6e12"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab40749908b174e4a58a46b6bb9a8899f"><td class="memItemLeft" align="right" valign="top">PHANDLE ACCESS_MASK POBJECT_ATTRIBUTES PIO_STATUS_BLOCK PLARGE_INTEGER <a class="el" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#af632da489ebc3708ec3ab6791ee53fa4">ULONG</a> <a class="el" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#af632da489ebc3708ec3ab6791ee53fa4">ULONG</a> <a class="el" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#af632da489ebc3708ec3ab6791ee53fa4">ULONG</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_hooks_8h.html#ab40749908b174e4a58a46b6bb9a8899f">CreateDisposition</a></td></tr>
<tr class="separator:ab40749908b174e4a58a46b6bb9a8899f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad07b47eb97df97ce6120a6ff17e9c6e2"><td class="memItemLeft" align="right" valign="top">PHANDLE ACCESS_MASK POBJECT_ATTRIBUTES PIO_STATUS_BLOCK PLARGE_INTEGER <a class="el" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#af632da489ebc3708ec3ab6791ee53fa4">ULONG</a> <a class="el" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#af632da489ebc3708ec3ab6791ee53fa4">ULONG</a> <a class="el" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#af632da489ebc3708ec3ab6791ee53fa4">ULONG</a> <a class="el" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#af632da489ebc3708ec3ab6791ee53fa4">ULONG</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_hooks_8h.html#ad07b47eb97df97ce6120a6ff17e9c6e2">CreateOptions</a></td></tr>
<tr class="separator:ad07b47eb97df97ce6120a6ff17e9c6e2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9e7d4ea496b0d33e07d6813b22aac212"><td class="memItemLeft" align="right" valign="top">PHANDLE ACCESS_MASK POBJECT_ATTRIBUTES PIO_STATUS_BLOCK PLARGE_INTEGER <a class="el" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#af632da489ebc3708ec3ab6791ee53fa4">ULONG</a> <a class="el" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#af632da489ebc3708ec3ab6791ee53fa4">ULONG</a> <a class="el" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#af632da489ebc3708ec3ab6791ee53fa4">ULONG</a> <a class="el" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#af632da489ebc3708ec3ab6791ee53fa4">ULONG</a> PVOID&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_hooks_8h.html#a9e7d4ea496b0d33e07d6813b22aac212">EaBuffer</a></td></tr>
<tr class="separator:a9e7d4ea496b0d33e07d6813b22aac212"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aec301946a43309ef0f6da81995361efb"><td class="memItemLeft" align="right" valign="top">PHANDLE ACCESS_MASK POBJECT_ATTRIBUTES PIO_STATUS_BLOCK PLARGE_INTEGER <a class="el" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#af632da489ebc3708ec3ab6791ee53fa4">ULONG</a> <a class="el" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#af632da489ebc3708ec3ab6791ee53fa4">ULONG</a> <a class="el" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#af632da489ebc3708ec3ab6791ee53fa4">ULONG</a> <a class="el" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#af632da489ebc3708ec3ab6791ee53fa4">ULONG</a> PVOID <a class="el" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#af632da489ebc3708ec3ab6791ee53fa4">ULONG</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_hooks_8h.html#aec301946a43309ef0f6da81995361efb">EaLength</a></td></tr>
<tr class="separator:aec301946a43309ef0f6da81995361efb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5d405dff9ba7e6c73d78857f415965f4"><td class="memItemLeft" align="right" valign="top">POOL_TYPE&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_hooks_8h.html#a5d405dff9ba7e6c73d78857f415965f4">PoolType</a></td></tr>
<tr class="separator:a5d405dff9ba7e6c73d78857f415965f4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a61083d5dde730c2afd10a336322aaaac"><td class="memItemLeft" align="right" valign="top">POOL_TYPE SIZE_T&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_hooks_8h.html#a61083d5dde730c2afd10a336322aaaac">NumberOfBytes</a></td></tr>
<tr class="separator:a61083d5dde730c2afd10a336322aaaac"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aba7c9f3767dcc5232354d3d17ceedb61"><td class="memItemLeft" align="right" valign="top">POOL_TYPE SIZE_T <a class="el" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#af632da489ebc3708ec3ab6791ee53fa4">ULONG</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_hooks_8h.html#aba7c9f3767dcc5232354d3d17ceedb61">Tag</a></td></tr>
<tr class="separator:aba7c9f3767dcc5232354d3d17ceedb61"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Hook headers. </p>
<dl class="section author"><dt>Author</dt><dd>Sina Karvandi (<a href="#" onclick="location.href='mai'+'lto:'+'sin'+'a@'+'hyp'+'er'+'dbg'+'.o'+'rg'; return false;">sina@<span class="obfuscator">.nosp@m.</span>hype<span class="obfuscator">.nosp@m.</span>rdbg.<span class="obfuscator">.nosp@m.</span>org</a>)</dd></dl>
<dl class="section version"><dt>Version</dt><dd>0.1 </dd></dl>
<dl class="section date"><dt>Date</dt><dd>2020-04-11</dd></dl>
<dl class="section copyright"><dt>Copyright</dt><dd>This project is released under the GNU Public License v3. </dd></dl>
</div><h2 class="groupheader">Macro Definition Documentation</h2>
<a id="acde26d24b0ff46215cbd029d8ae87e4d" name="acde26d24b0ff46215cbd029d8ae87e4d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#acde26d24b0ff46215cbd029d8ae87e4d">&#9670;&#160;</a></span>IMAGE_DOS_SIGNATURE</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define IMAGE_DOS_SIGNATURE&#160;&#160;&#160;0x5A4D</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Special signatures. </p>

</div>
</div>
<a id="a83570e3e2fba8cb7c2abc8b3eee47d48" name="a83570e3e2fba8cb7c2abc8b3eee47d48"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a83570e3e2fba8cb7c2abc8b3eee47d48">&#9670;&#160;</a></span>IMAGE_NT_SIGNATURE</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define IMAGE_NT_SIGNATURE&#160;&#160;&#160;0x00004550</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a9d186034e0a154cfc3bcc5ec8e977564" name="a9d186034e0a154cfc3bcc5ec8e977564"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9d186034e0a154cfc3bcc5ec8e977564">&#9670;&#160;</a></span>IMAGE_OS2_SIGNATURE</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define IMAGE_OS2_SIGNATURE&#160;&#160;&#160;0x454E</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a41ddf3f83e5c119216c43a3cd98deba4" name="a41ddf3f83e5c119216c43a3cd98deba4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a41ddf3f83e5c119216c43a3cd98deba4">&#9670;&#160;</a></span>IMAGE_OS2_SIGNATURE_LE</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define IMAGE_OS2_SIGNATURE_LE&#160;&#160;&#160;0x454C</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a0d59e625e438a014184cfc9e892553c3" name="a0d59e625e438a014184cfc9e892553c3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0d59e625e438a014184cfc9e892553c3">&#9670;&#160;</a></span>IMAGE_VXD_SIGNATURE</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define IMAGE_VXD_SIGNATURE&#160;&#160;&#160;0x454C</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a765571d13192493adf4e7baa5a9e9468" name="a765571d13192493adf4e7baa5a9e9468"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a765571d13192493adf4e7baa5a9e9468">&#9670;&#160;</a></span>IS_SYSCALL_INSTRUCTION</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define IS_SYSCALL_INSTRUCTION</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">Code</td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<b>Value:</b><div class="fragment"><div class="line">    (*((<a class="code hl_typedef" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#a02fb353482a88d8a031abe77a38375ea">PUINT8</a>)(Code) + 0) == 0x0F &amp;&amp; \</div>
<div class="line">     *((<a class="code hl_typedef" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#a02fb353482a88d8a031abe77a38375ea">PUINT8</a>)(Code) + 1) == 0x05)</div>
<div class="ttc" id="abuild_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h_html_a02fb353482a88d8a031abe77a38375ea"><div class="ttname"><a href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#a02fb353482a88d8a031abe77a38375ea">PUINT8</a></div><div class="ttdeci">unsigned char * PUINT8</div><div class="ttdef"><b>Definition:</b> BasicTypes.h:44</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a2633e7e4b97712c8a9924648d48b63f6" name="a2633e7e4b97712c8a9924648d48b63f6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2633e7e4b97712c8a9924648d48b63f6">&#9670;&#160;</a></span>IS_SYSRET_INSTRUCTION</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define IS_SYSRET_INSTRUCTION</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">Code</td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<b>Value:</b><div class="fragment"><div class="line">    (*((<a class="code hl_typedef" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#a02fb353482a88d8a031abe77a38375ea">PUINT8</a>)(Code) + 0) == 0x48 &amp;&amp; \</div>
<div class="line">     *((<a class="code hl_typedef" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#a02fb353482a88d8a031abe77a38375ea">PUINT8</a>)(Code) + 1) == 0x0F &amp;&amp; \</div>
<div class="line">     *((<a class="code hl_typedef" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#a02fb353482a88d8a031abe77a38375ea">PUINT8</a>)(Code) + 2) == 0x07)</div>
</div><!-- fragment -->
<p>As we have just on sysret in all the Windows, we use the following variable to hold its address this way, we're not force to check for the instruction so we remove the memory access to check for sysret in this case. </p>
<p>Check for instruction sysret and syscall </p>

</div>
</div>
<a id="a9b5b17233c5031bc6d520227b440e01a" name="a9b5b17233c5031bc6d520227b440e01a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9b5b17233c5031bc6d520227b440e01a">&#9670;&#160;</a></span>MAX_EXEC_TRAMPOLINE_SIZE</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define MAX_EXEC_TRAMPOLINE_SIZE&#160;&#160;&#160;100</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Maximum number of supported execution trampoline. </p>

</div>
</div>
<h2 class="groupheader">Typedef Documentation</h2>
<a id="afca3bba3357dab1c3380e4b9772f04da" name="afca3bba3357dab1c3380e4b9772f04da"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afca3bba3357dab1c3380e4b9772f04da">&#9670;&#160;</a></span>HIDDEN_HOOKS_DETOUR_DETAILS</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef struct <a class="el" href="struct___h_i_d_d_e_n___h_o_o_k_s___d_e_t_o_u_r___d_e_t_a_i_l_s.html">_HIDDEN_HOOKS_DETOUR_DETAILS</a> <a class="el" href="_hooks_8h.html#afca3bba3357dab1c3380e4b9772f04da">HIDDEN_HOOKS_DETOUR_DETAILS</a></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Details of detours style EPT hooks. </p>

</div>
</div>
<a id="a0dd75bc2892ba7c908ee7f1da6f8c760" name="a0dd75bc2892ba7c908ee7f1da6f8c760"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0dd75bc2892ba7c908ee7f1da6f8c760">&#9670;&#160;</a></span>PHIDDEN_HOOKS_DETOUR_DETAILS</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef struct <a class="el" href="struct___h_i_d_d_e_n___h_o_o_k_s___d_e_t_o_u_r___d_e_t_a_i_l_s.html">_HIDDEN_HOOKS_DETOUR_DETAILS</a> * <a class="el" href="_hooks_8h.html#a0dd75bc2892ba7c908ee7f1da6f8c760">PHIDDEN_HOOKS_DETOUR_DETAILS</a></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="affb3200da2e6d1088947739169dfcfba" name="affb3200da2e6d1088947739169dfcfba"></a>
<h2 class="memtitle"><span class="permalink"><a href="#affb3200da2e6d1088947739169dfcfba">&#9670;&#160;</a></span>PSSDTStruct</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef struct <a class="el" href="struct___s_s_d_t_struct.html">_SSDTStruct</a> * <a class="el" href="_hooks_8h.html#affb3200da2e6d1088947739169dfcfba">PSSDTStruct</a></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="aef74275b90a76319745df6047d624096" name="aef74275b90a76319745df6047d624096"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aef74275b90a76319745df6047d624096">&#9670;&#160;</a></span>PSYSTEM_INFORMATION_CLASS</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef enum <a class="el" href="_hooks_8h.html#ad5d815b48e8f4da1ef2eb7a2f18a54e0">_SYSTEM_INFORMATION_CLASS</a>
    * <a class="el" href="_hooks_8h.html#aef74275b90a76319745df6047d624096">PSYSTEM_INFORMATION_CLASS</a></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a01b72f04cfe7a055417c2d21f548bb44" name="a01b72f04cfe7a055417c2d21f548bb44"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a01b72f04cfe7a055417c2d21f548bb44">&#9670;&#160;</a></span>PSYSTEM_MODULE_ENTRY</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef struct <a class="el" href="struct___s_y_s_t_e_m___m_o_d_u_l_e___e_n_t_r_y.html">_SYSTEM_MODULE_ENTRY</a> * <a class="el" href="_hooks_8h.html#a01b72f04cfe7a055417c2d21f548bb44">PSYSTEM_MODULE_ENTRY</a></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a0f259ebddf952a9e0ccfa9c7e7693795" name="a0f259ebddf952a9e0ccfa9c7e7693795"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0f259ebddf952a9e0ccfa9c7e7693795">&#9670;&#160;</a></span>PSYSTEM_MODULE_INFORMATION</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef struct <a class="el" href="struct___s_y_s_t_e_m___m_o_d_u_l_e___i_n_f_o_r_m_a_t_i_o_n.html">_SYSTEM_MODULE_INFORMATION</a> * <a class="el" href="_hooks_8h.html#a0f259ebddf952a9e0ccfa9c7e7693795">PSYSTEM_MODULE_INFORMATION</a></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a7ef67836bf52e4d218108fb05855a5ee" name="a7ef67836bf52e4d218108fb05855a5ee"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7ef67836bf52e4d218108fb05855a5ee">&#9670;&#160;</a></span>SSDTStruct</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef struct <a class="el" href="struct___s_s_d_t_struct.html">_SSDTStruct</a> <a class="el" href="_hooks_8h.html#a7ef67836bf52e4d218108fb05855a5ee">SSDTStruct</a></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>SSDT structure. </p>

</div>
</div>
<a id="ae75edb0a85f69b42a96960e023f58c47" name="ae75edb0a85f69b42a96960e023f58c47"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae75edb0a85f69b42a96960e023f58c47">&#9670;&#160;</a></span>SYSTEM_INFORMATION_CLASS</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef enum <a class="el" href="_hooks_8h.html#ad5d815b48e8f4da1ef2eb7a2f18a54e0">_SYSTEM_INFORMATION_CLASS</a> <a class="el" href="_hooks_8h.html#ae75edb0a85f69b42a96960e023f58c47">SYSTEM_INFORMATION_CLASS</a></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>System information class. </p>

</div>
</div>
<a id="a6874334f705ea54c18fe8e417b192bcf" name="a6874334f705ea54c18fe8e417b192bcf"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6874334f705ea54c18fe8e417b192bcf">&#9670;&#160;</a></span>SYSTEM_MODULE_ENTRY</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef struct <a class="el" href="struct___s_y_s_t_e_m___m_o_d_u_l_e___e_n_t_r_y.html">_SYSTEM_MODULE_ENTRY</a> <a class="el" href="_hooks_8h.html#a6874334f705ea54c18fe8e417b192bcf">SYSTEM_MODULE_ENTRY</a></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Module entry. </p>

</div>
</div>
<a id="ab544297b0d5c1d52d774046be13f483d" name="ab544297b0d5c1d52d774046be13f483d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab544297b0d5c1d52d774046be13f483d">&#9670;&#160;</a></span>SYSTEM_MODULE_INFORMATION</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef struct <a class="el" href="struct___s_y_s_t_e_m___m_o_d_u_l_e___i_n_f_o_r_m_a_t_i_o_n.html">_SYSTEM_MODULE_INFORMATION</a> <a class="el" href="_hooks_8h.html#ab544297b0d5c1d52d774046be13f483d">SYSTEM_MODULE_INFORMATION</a></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>System Information for modules. </p>

</div>
</div>
<a id="a017811c2b939ab5a3ced279a946f990c" name="a017811c2b939ab5a3ced279a946f990c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a017811c2b939ab5a3ced279a946f990c">&#9670;&#160;</a></span>ZWQUERYSYSTEMINFORMATION</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef NTSTATUS(NTAPI * ZWQUERYSYSTEMINFORMATION) (IN <a class="el" href="_hooks_8h.html#ae75edb0a85f69b42a96960e023f58c47">SYSTEM_INFORMATION_CLASS</a> SystemInformationClass, OUT PVOID SystemInformation, IN <a class="el" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#af632da489ebc3708ec3ab6791ee53fa4">ULONG</a> SystemInformationLength, OUT PULONG ReturnLength OPTIONAL)</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<h2 class="groupheader">Enumeration Type Documentation</h2>
<a id="ad5d815b48e8f4da1ef2eb7a2f18a54e0" name="ad5d815b48e8f4da1ef2eb7a2f18a54e0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad5d815b48e8f4da1ef2eb7a2f18a54e0">&#9670;&#160;</a></span>_SYSTEM_INFORMATION_CLASS</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="_hooks_8h.html#ad5d815b48e8f4da1ef2eb7a2f18a54e0">_SYSTEM_INFORMATION_CLASS</a></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>System information class. </p>
<table class="fieldtable">
<tr><th colspan="2">Enumerator</th></tr><tr><td class="fieldname"><a id="ad5d815b48e8f4da1ef2eb7a2f18a54e0a38627594543f01525bf40aa8e09607bd" name="ad5d815b48e8f4da1ef2eb7a2f18a54e0a38627594543f01525bf40aa8e09607bd"></a>SystemModuleInformation&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="ad5d815b48e8f4da1ef2eb7a2f18a54e0a18e658a754e39d6e6c1b653248b8aa78" name="ad5d815b48e8f4da1ef2eb7a2f18a54e0a18e658a754e39d6e6c1b653248b8aa78"></a>SystemKernelDebuggerInformation&#160;</td><td class="fielddoc"></td></tr>
</table>
<div class="fragment"><div class="line"><span class="lineno">  114</span>{</div>
<div class="line"><span class="lineno">  115</span>    <a class="code hl_enumvalue" href="_hooks_8h.html#ad5d815b48e8f4da1ef2eb7a2f18a54e0a38627594543f01525bf40aa8e09607bd">SystemModuleInformation</a>         = 11,</div>
<div class="line"><span class="lineno">  116</span>    <a class="code hl_enumvalue" href="_hooks_8h.html#ad5d815b48e8f4da1ef2eb7a2f18a54e0a18e658a754e39d6e6c1b653248b8aa78">SystemKernelDebuggerInformation</a> = 35</div>
<div class="line"><span class="lineno">  117</span>} <a class="code hl_typedef" href="_hooks_8h.html#ae75edb0a85f69b42a96960e023f58c47">SYSTEM_INFORMATION_CLASS</a>,</div>
<div class="ttc" id="a_hooks_8h_html_ad5d815b48e8f4da1ef2eb7a2f18a54e0a18e658a754e39d6e6c1b653248b8aa78"><div class="ttname"><a href="_hooks_8h.html#ad5d815b48e8f4da1ef2eb7a2f18a54e0a18e658a754e39d6e6c1b653248b8aa78">SystemKernelDebuggerInformation</a></div><div class="ttdeci">@ SystemKernelDebuggerInformation</div><div class="ttdef"><b>Definition:</b> Hooks.h:116</div></div>
<div class="ttc" id="a_hooks_8h_html_ad5d815b48e8f4da1ef2eb7a2f18a54e0a38627594543f01525bf40aa8e09607bd"><div class="ttname"><a href="_hooks_8h.html#ad5d815b48e8f4da1ef2eb7a2f18a54e0a38627594543f01525bf40aa8e09607bd">SystemModuleInformation</a></div><div class="ttdeci">@ SystemModuleInformation</div><div class="ttdef"><b>Definition:</b> Hooks.h:115</div></div>
<div class="ttc" id="a_hooks_8h_html_ae75edb0a85f69b42a96960e023f58c47"><div class="ttname"><a href="_hooks_8h.html#ae75edb0a85f69b42a96960e023f58c47">SYSTEM_INFORMATION_CLASS</a></div><div class="ttdeci">enum _SYSTEM_INFORMATION_CLASS SYSTEM_INFORMATION_CLASS</div><div class="ttdoc">System information class.</div></div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="abcbdb9cd3dbdf238b8b5d484522855e3" name="abcbdb9cd3dbdf238b8b5d484522855e3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abcbdb9cd3dbdf238b8b5d484522855e3">&#9670;&#160;</a></span>EptHook()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#a1cb18096b299d23458d3c7b85fd86555">BOOLEAN</a> EptHook </td>
          <td>(</td>
          <td class="paramtype">PVOID&#160;</td>
          <td class="paramname"><em>TargetAddress</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#ae1e6edbbc26d6fbc71a90190d0266018">UINT32</a>&#160;</td>
          <td class="paramname"><em>ProcessId</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Hook in VMX Non Root Mode (hidden breakpoint) </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">TargetAddress</td><td></td></tr>
    <tr><td class="paramname">ProcessId</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>BOOLEAN</dd></dl>
<p>Hook in VMX Non Root Mode (hidden breakpoint)</p>
<p>this command uses hidden breakpoints (0xcc) to hook, THIS FUNCTION SHOULD BE CALLED WHEN THE VMLAUNCH ALREADY EXECUTED, it is because, broadcasting to enable exception bitmap for breakpoint is not clear here, if we want to broadcast to enable exception bitmaps on all cores when vmlaunch is not executed then that's ok but a user might call this function when we didn't configure the vmcs, it's a problem! we can solve it by giving a hint to vmcs configure function to make it ok for future configuration but that sounds stupid, I think it's better to not support this feature. Btw, debugger won't use this function in the above mentioned method, so we won't have any problem with this :)</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">TargetAddress</td><td>The address of function or memory address to be hooked </td></tr>
    <tr><td class="paramname">ProcessId</td><td>The process id to translate based on that process's cr3 </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>BOOLEAN Returns true if the hook was successful or false if there was an error </dd></dl>
<div class="fragment"><div class="line"><span class="lineno">  444</span>{</div>
<div class="line"><span class="lineno">  445</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">  446</span>    <span class="comment">// Broadcast to all cores to enable vm-exit for breakpoints (exception bitmaps)</span></div>
<div class="line"><span class="lineno">  447</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">  448</span>    <a class="code hl_function" href="build_2bin_2debug_2_s_d_k_2_imports_2_hyper_dbg_vmm_imports_8h.html#a66dc34365f51b2131a229c6975df3029">BroadcastEnableBreakpointExitingOnExceptionBitmapAllCores</a>();</div>
<div class="line"><span class="lineno">  449</span> </div>
<div class="line"><span class="lineno">  450</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="_inline_asm_8h.html#a0fd87b88c03b3c10883f0ad70239bf6c">AsmVmxVmcall</a>(<a class="code hl_define" href="_vmcall_8h.html#aa23cf4e06f34a78d1efc1049c0c7c9a3">VMCALL_SET_HIDDEN_CC_BREAKPOINT</a>, TargetAddress, <a class="code hl_function" href="_layout_8c.html#aba0911b8d51a6f7b74dd2bb70845c4b2">LayoutGetCr3ByProcessId</a>(ProcessId).Flags, NULL) == STATUS_SUCCESS)</div>
<div class="line"><span class="lineno">  451</span>    {</div>
<div class="line"><span class="lineno">  452</span>        <a class="code hl_define" href="build_2bin_2debug_2_s_d_k_2_imports_2_hyper_dbg_hyper_log_intrinsics_8h.html#a108126279e46f4d46d25abe24da43fdc">LogDebugInfo</a>(<span class="stringliteral">&quot;Hidden breakpoint hook applied from VMX Root Mode&quot;</span>);</div>
<div class="line"><span class="lineno">  453</span> </div>
<div class="line"><span class="lineno">  454</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno">  455</span>        <span class="comment">// Now we have to notify all the core to invalidate their EPT</span></div>
<div class="line"><span class="lineno">  456</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno">  457</span>        <a class="code hl_function" href="_broadcast_8c.html#a5be99a073a6003a06347aa85b832060f">BroadcastNotifyAllToInvalidateEptAllCores</a>();</div>
<div class="line"><span class="lineno">  458</span> </div>
<div class="line"><span class="lineno">  459</span>        <span class="keywordflow">return</span> <a class="code hl_define" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;</div>
<div class="line"><span class="lineno">  460</span>    }</div>
<div class="line"><span class="lineno">  461</span> </div>
<div class="line"><span class="lineno">  462</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">  463</span>    <span class="comment">// sth went wrong as we&#39;re here</span></div>
<div class="line"><span class="lineno">  464</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">  465</span>    <span class="keywordflow">return</span> <a class="code hl_define" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div>
<div class="line"><span class="lineno">  466</span>}</div>
<div class="ttc" id="a_broadcast_8c_html_a5be99a073a6003a06347aa85b832060f"><div class="ttname"><a href="_broadcast_8c.html#a5be99a073a6003a06347aa85b832060f">BroadcastNotifyAllToInvalidateEptAllCores</a></div><div class="ttdeci">VOID BroadcastNotifyAllToInvalidateEptAllCores()</div><div class="ttdoc">routines to notify to invalidate their ept on all cores</div><div class="ttdef"><b>Definition:</b> Broadcast.c:119</div></div>
<div class="ttc" id="a_inline_asm_8h_html_a0fd87b88c03b3c10883f0ad70239bf6c"><div class="ttname"><a href="_inline_asm_8h.html#a0fd87b88c03b3c10883f0ad70239bf6c">AsmVmxVmcall</a></div><div class="ttdeci">NTSTATUS AsmVmxVmcall(unsigned long long VmcallNumber, unsigned long long OptionalParam1, unsigned long long OptionalParam2, long long OptionalParam3)</div><div class="ttdoc">Request Vmcall.</div></div>
<div class="ttc" id="a_layout_8c_html_aba0911b8d51a6f7b74dd2bb70845c4b2"><div class="ttname"><a href="_layout_8c.html#aba0911b8d51a6f7b74dd2bb70845c4b2">LayoutGetCr3ByProcessId</a></div><div class="ttdeci">_Use_decl_annotations_ CR3_TYPE LayoutGetCr3ByProcessId(UINT32 ProcessId)</div><div class="ttdoc">Converts pid to kernel cr3.</div><div class="ttdef"><b>Definition:</b> Layout.c:24</div></div>
<div class="ttc" id="a_vmcall_8h_html_aa23cf4e06f34a78d1efc1049c0c7c9a3"><div class="ttname"><a href="_vmcall_8h.html#aa23cf4e06f34a78d1efc1049c0c7c9a3">VMCALL_SET_HIDDEN_CC_BREAKPOINT</a></div><div class="ttdeci">#define VMCALL_SET_HIDDEN_CC_BREAKPOINT</div><div class="ttdoc">VMCALL to put hidden breakpoints (using EPT)</div><div class="ttdef"><b>Definition:</b> Vmcall.h:124</div></div>
<div class="ttc" id="abuild_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h_html_aa8cecfc5c5c054d2875c03e77b7be15d"><div class="ttname"><a href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a></div><div class="ttdeci">#define TRUE</div><div class="ttdef"><b>Definition:</b> BasicTypes.h:50</div></div>
<div class="ttc" id="abuild_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h_html_aa93f0eb578d23995850d61f7d61c55c1"><div class="ttname"><a href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a></div><div class="ttdeci">#define FALSE</div><div class="ttdef"><b>Definition:</b> BasicTypes.h:49</div></div>
<div class="ttc" id="abuild_2bin_2debug_2_s_d_k_2_imports_2_hyper_dbg_hyper_log_intrinsics_8h_html_a108126279e46f4d46d25abe24da43fdc"><div class="ttname"><a href="build_2bin_2debug_2_s_d_k_2_imports_2_hyper_dbg_hyper_log_intrinsics_8h.html#a108126279e46f4d46d25abe24da43fdc">LogDebugInfo</a></div><div class="ttdeci">#define LogDebugInfo(format,...)</div><div class="ttdoc">Log, initilize boot information and debug information.</div><div class="ttdef"><b>Definition:</b> HyperDbgHyperLogIntrinsics.h:155</div></div>
<div class="ttc" id="abuild_2bin_2debug_2_s_d_k_2_imports_2_hyper_dbg_vmm_imports_8h_html_a66dc34365f51b2131a229c6975df3029"><div class="ttname"><a href="build_2bin_2debug_2_s_d_k_2_imports_2_hyper_dbg_vmm_imports_8h.html#a66dc34365f51b2131a229c6975df3029">BroadcastEnableBreakpointExitingOnExceptionBitmapAllCores</a></div><div class="ttdeci">IMPORT_EXPORT_VMM VOID BroadcastEnableBreakpointExitingOnExceptionBitmapAllCores()</div><div class="ttdoc">routines to enable vm-exit for breakpoints (exception bitmap)</div><div class="ttdef"><b>Definition:</b> Broadcast.c:63</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a3c5eb45ffb3514149f329aeb0cf04071" name="a3c5eb45ffb3514149f329aeb0cf04071"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3c5eb45ffb3514149f329aeb0cf04071">&#9670;&#160;</a></span>EptHook2()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#a1cb18096b299d23458d3c7b85fd86555">BOOLEAN</a> EptHook2 </td>
          <td>(</td>
          <td class="paramtype">PVOID&#160;</td>
          <td class="paramname"><em>TargetAddress</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PVOID&#160;</td>
          <td class="paramname"><em>HookFunction</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#ae1e6edbbc26d6fbc71a90190d0266018">UINT32</a>&#160;</td>
          <td class="paramname"><em>ProcessId</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#a1cb18096b299d23458d3c7b85fd86555">BOOLEAN</a>&#160;</td>
          <td class="paramname"><em>SetHookForRead</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#a1cb18096b299d23458d3c7b85fd86555">BOOLEAN</a>&#160;</td>
          <td class="paramname"><em>SetHookForWrite</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#a1cb18096b299d23458d3c7b85fd86555">BOOLEAN</a>&#160;</td>
          <td class="paramname"><em>SetHookForExec</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Hook in VMX Non Root Mode (hidden detours) </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">TargetAddress</td><td></td></tr>
    <tr><td class="paramname">HookFunction</td><td></td></tr>
    <tr><td class="paramname">ProcessId</td><td></td></tr>
    <tr><td class="paramname">SetHookForRead</td><td></td></tr>
    <tr><td class="paramname">SetHookForWrite</td><td></td></tr>
    <tr><td class="paramname">SetHookForExec</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>BOOLEAN</dd></dl>
<p>Hook in VMX Non Root Mode (hidden detours)</p>
<p>this command uses hidden detours, this NOT be called from vmx-root mode</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">TargetAddress</td><td>The address of function or memory address to be hooked </td></tr>
    <tr><td class="paramname">HookFunction</td><td>The function that will be called when hook triggered </td></tr>
    <tr><td class="paramname">ProcessId</td><td>The process id to translate based on that process's cr3 </td></tr>
    <tr><td class="paramname">SetHookForRead</td><td>Hook READ Access </td></tr>
    <tr><td class="paramname">SetHookForWrite</td><td>Hook WRITE Access </td></tr>
    <tr><td class="paramname">SetHookForExec</td><td>Hook EXECUTE Access </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>BOOLEAN Returns true if the hook was successful or false if there was an error </dd></dl>
<div class="fragment"><div class="line"><span class="lineno"> 1061</span>{</div>
<div class="line"><span class="lineno"> 1062</span>    <a class="code hl_typedef" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#ae1e6edbbc26d6fbc71a90190d0266018">UINT32</a> PageHookMask = 0;</div>
<div class="line"><span class="lineno"> 1063</span>    <a class="code hl_typedef" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#af632da489ebc3708ec3ab6791ee53fa4">ULONG</a>  LogicalCoreIndex;</div>
<div class="line"><span class="lineno"> 1064</span> </div>
<div class="line"><span class="lineno"> 1065</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1066</span>    <span class="comment">// Check for the features to avoid EPT Violation problems</span></div>
<div class="line"><span class="lineno"> 1067</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1068</span>    <span class="keywordflow">if</span> (SetHookForExec &amp;&amp; !<a class="code hl_variable" href="_global_variables_8h.html#a3c92f787270f29f40a4fb1b3440a3baa">g_CompatibilityCheck</a>.<a class="code hl_variable" href="struct___c_o_m_p_a_t_i_b_i_l_i_t_y___c_h_e_c_k_s___s_t_a_t_u_s.html#af68dba0dd8b9469e42d344f82fca8417">ExecuteOnlySupport</a>)</div>
<div class="line"><span class="lineno"> 1069</span>    {</div>
<div class="line"><span class="lineno"> 1070</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1071</span>        <span class="comment">// In the current design of hyperdbg we use execute-only pages</span></div>
<div class="line"><span class="lineno"> 1072</span>        <span class="comment">// to implement hidden hooks for exec page, so your processor doesn&#39;t</span></div>
<div class="line"><span class="lineno"> 1073</span>        <span class="comment">// have this feature and you have to implment it in other ways :(</span></div>
<div class="line"><span class="lineno"> 1074</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1075</span>        <span class="keywordflow">return</span> <a class="code hl_define" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div>
<div class="line"><span class="lineno"> 1076</span>    }</div>
<div class="line"><span class="lineno"> 1077</span> </div>
<div class="line"><span class="lineno"> 1078</span>    <span class="keywordflow">if</span> (!SetHookForWrite &amp;&amp; SetHookForRead)</div>
<div class="line"><span class="lineno"> 1079</span>    {</div>
<div class="line"><span class="lineno"> 1080</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1081</span>        <span class="comment">// The hidden hook with Write Enable and Read Disabled will cause EPT violation!</span></div>
<div class="line"><span class="lineno"> 1082</span>        <span class="comment">// fixed</span></div>
<div class="line"><span class="lineno"> 1083</span>        <span class="keywordflow">return</span> <a class="code hl_define" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div>
<div class="line"><span class="lineno"> 1084</span>    }</div>
<div class="line"><span class="lineno"> 1085</span> </div>
<div class="line"><span class="lineno"> 1086</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1087</span>    <span class="comment">// Initialize the list of ept hook detours if it&#39;s not already initialized</span></div>
<div class="line"><span class="lineno"> 1088</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1089</span>    <span class="keywordflow">if</span> (!<a class="code hl_variable" href="_global_variables_8h.html#a6e5074e59b6770a1b187d7e2d50f00bb">g_IsEptHook2sDetourListInitialized</a>)</div>
<div class="line"><span class="lineno"> 1090</span>    {</div>
<div class="line"><span class="lineno"> 1091</span>        <a class="code hl_variable" href="_global_variables_8h.html#a6e5074e59b6770a1b187d7e2d50f00bb">g_IsEptHook2sDetourListInitialized</a> = <a class="code hl_define" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;</div>
<div class="line"><span class="lineno"> 1092</span> </div>
<div class="line"><span class="lineno"> 1093</span>        <a class="code hl_function" href="list_8h.html#a71fd97aa8bac50a2f3a1d98cf680b2f4">InitializeListHead</a>(&amp;<a class="code hl_variable" href="_global_variables_8h.html#a90f5a18f43567010690d8d7927619fa0">g_EptHook2sDetourListHead</a>);</div>
<div class="line"><span class="lineno"> 1094</span>    }</div>
<div class="line"><span class="lineno"> 1095</span> </div>
<div class="line"><span class="lineno"> 1096</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1097</span>    <span class="comment">// Check whether we are in VMX Root Mode or Not</span></div>
<div class="line"><span class="lineno"> 1098</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1099</span>    LogicalCoreIndex = KeGetCurrentProcessorIndex();</div>
<div class="line"><span class="lineno"> 1100</span> </div>
<div class="line"><span class="lineno"> 1101</span>    <span class="keywordflow">if</span> (SetHookForRead)</div>
<div class="line"><span class="lineno"> 1102</span>    {</div>
<div class="line"><span class="lineno"> 1103</span>        PageHookMask |= <a class="code hl_define" href="_ept_8h.html#a57f919b94c67edb76b752a2ca83b534a">PAGE_ATTRIB_READ</a>;</div>
<div class="line"><span class="lineno"> 1104</span>    }</div>
<div class="line"><span class="lineno"> 1105</span>    <span class="keywordflow">if</span> (SetHookForWrite)</div>
<div class="line"><span class="lineno"> 1106</span>    {</div>
<div class="line"><span class="lineno"> 1107</span>        PageHookMask |= <a class="code hl_define" href="_ept_8h.html#a6a23c222f617b62cc621b5482a378d8a">PAGE_ATTRIB_WRITE</a>;</div>
<div class="line"><span class="lineno"> 1108</span>    }</div>
<div class="line"><span class="lineno"> 1109</span>    <span class="keywordflow">if</span> (SetHookForExec)</div>
<div class="line"><span class="lineno"> 1110</span>    {</div>
<div class="line"><span class="lineno"> 1111</span>        PageHookMask |= <a class="code hl_define" href="_ept_8h.html#a31b07aec49a907dc08696d9595c08e5f">PAGE_ATTRIB_EXEC</a>;</div>
<div class="line"><span class="lineno"> 1112</span>    }</div>
<div class="line"><span class="lineno"> 1113</span> </div>
<div class="line"><span class="lineno"> 1114</span>    <span class="keywordflow">if</span> (PageHookMask == 0)</div>
<div class="line"><span class="lineno"> 1115</span>    {</div>
<div class="line"><span class="lineno"> 1116</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1117</span>        <span class="comment">// nothing to hook</span></div>
<div class="line"><span class="lineno"> 1118</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1119</span>        <span class="keywordflow">return</span> <a class="code hl_define" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div>
<div class="line"><span class="lineno"> 1120</span>    }</div>
<div class="line"><span class="lineno"> 1121</span> </div>
<div class="line"><span class="lineno"> 1122</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="_vmx_8c.html#a54291454c7d99c90bf5e19a939825634">VmxGetCurrentLaunchState</a>())</div>
<div class="line"><span class="lineno"> 1123</span>    {</div>
<div class="line"><span class="lineno"> 1124</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1125</span>        <span class="comment">// Move Attribute Mask to the upper 32 bits of the VMCALL Number</span></div>
<div class="line"><span class="lineno"> 1126</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1127</span>        <a class="code hl_typedef" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#aae17ebb9ef7279d026817fb22f8aebe9">UINT64</a> VmcallNumber = ((<a class="code hl_typedef" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#aae17ebb9ef7279d026817fb22f8aebe9">UINT64</a>)PageHookMask) &lt;&lt; 32 | <a class="code hl_define" href="_vmcall_8h.html#a2f893b27a9a2cedec9f4c499011dce0a">VMCALL_CHANGE_PAGE_ATTRIB</a>;</div>
<div class="line"><span class="lineno"> 1128</span> </div>
<div class="line"><span class="lineno"> 1129</span>        <span class="keywordflow">if</span> (<a class="code hl_function" href="_inline_asm_8h.html#a0fd87b88c03b3c10883f0ad70239bf6c">AsmVmxVmcall</a>(VmcallNumber, TargetAddress, HookFunction, <a class="code hl_function" href="_layout_8c.html#aba0911b8d51a6f7b74dd2bb70845c4b2">LayoutGetCr3ByProcessId</a>(ProcessId).<a class="code hl_variable" href="struct___c_r3___t_y_p_e.html#a04eb96cc99b0458be739bcc9c640e08b">Flags</a>) == STATUS_SUCCESS)</div>
<div class="line"><span class="lineno"> 1130</span>        {</div>
<div class="line"><span class="lineno"> 1131</span>            <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1132</span>            <span class="comment">// Test log</span></div>
<div class="line"><span class="lineno"> 1133</span>            <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1134</span>            <span class="comment">// LogInfo(&quot;Hook applied from VMX Root Mode&quot;);</span></div>
<div class="line"><span class="lineno"> 1135</span>            <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1136</span> </div>
<div class="line"><span class="lineno"> 1137</span>            <span class="keywordflow">if</span> (<a class="code hl_function" href="_vmx_8c.html#a21a5facaf10e8fbeb70dd00942e51ef1">VmxGetCurrentExecutionMode</a>() == <a class="code hl_define" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>)</div>
<div class="line"><span class="lineno"> 1138</span>            {</div>
<div class="line"><span class="lineno"> 1139</span>                <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1140</span>                <span class="comment">// Now we have to notify all the core to invalidate their EPT</span></div>
<div class="line"><span class="lineno"> 1141</span>                <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1142</span>                <a class="code hl_function" href="_broadcast_8c.html#a5be99a073a6003a06347aa85b832060f">BroadcastNotifyAllToInvalidateEptAllCores</a>();</div>
<div class="line"><span class="lineno"> 1143</span>            }</div>
<div class="line"><span class="lineno"> 1144</span>            <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno"> 1145</span>            {</div>
<div class="line"><span class="lineno"> 1146</span>                <a class="code hl_define" href="build_2bin_2debug_2_s_d_k_2_imports_2_hyper_dbg_hyper_log_intrinsics_8h.html#a97b0adbd65790fb90734daa8e5245a04">LogInfo</a>(<span class="stringliteral">&quot;Err, unable to notify all cores to invalidate their TLB &quot;</span></div>
<div class="line"><span class="lineno"> 1147</span>                        <span class="stringliteral">&quot;caches as you called hook on vmx-root mode, however, the &quot;</span></div>
<div class="line"><span class="lineno"> 1148</span>                        <span class="stringliteral">&quot;hook is still works&quot;</span>);</div>
<div class="line"><span class="lineno"> 1149</span>            }</div>
<div class="line"><span class="lineno"> 1150</span> </div>
<div class="line"><span class="lineno"> 1151</span>            <span class="keywordflow">return</span> <a class="code hl_define" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;</div>
<div class="line"><span class="lineno"> 1152</span>        }</div>
<div class="line"><span class="lineno"> 1153</span>        <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno"> 1154</span>        {</div>
<div class="line"><span class="lineno"> 1155</span>            <span class="keywordflow">return</span> <a class="code hl_define" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div>
<div class="line"><span class="lineno"> 1156</span>        }</div>
<div class="line"><span class="lineno"> 1157</span>    }</div>
<div class="line"><span class="lineno"> 1158</span>    <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno"> 1159</span>    {</div>
<div class="line"><span class="lineno"> 1160</span>        <span class="keywordflow">if</span> (<a class="code hl_function" href="_ept_hook_8c.html#a77e3785963c79b3ff0efdf13efe0be13">EptHookPerformPageHook2</a>(TargetAddress,</div>
<div class="line"><span class="lineno"> 1161</span>                                    HookFunction,</div>
<div class="line"><span class="lineno"> 1162</span>                                    <a class="code hl_function" href="_layout_8c.html#aba0911b8d51a6f7b74dd2bb70845c4b2">LayoutGetCr3ByProcessId</a>(ProcessId),</div>
<div class="line"><span class="lineno"> 1163</span>                                    SetHookForRead,</div>
<div class="line"><span class="lineno"> 1164</span>                                    SetHookForWrite,</div>
<div class="line"><span class="lineno"> 1165</span>                                    SetHookForExec) == <a class="code hl_define" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>)</div>
<div class="line"><span class="lineno"> 1166</span>        {</div>
<div class="line"><span class="lineno"> 1167</span>            <a class="code hl_define" href="build_2bin_2debug_2_s_d_k_2_imports_2_hyper_dbg_hyper_log_intrinsics_8h.html#a97b0adbd65790fb90734daa8e5245a04">LogInfo</a>(<span class="stringliteral">&quot;Hook applied (VM has not launched)&quot;</span>);</div>
<div class="line"><span class="lineno"> 1168</span>            <span class="keywordflow">return</span> <a class="code hl_define" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;</div>
<div class="line"><span class="lineno"> 1169</span>        }</div>
<div class="line"><span class="lineno"> 1170</span>    }</div>
<div class="line"><span class="lineno"> 1171</span> </div>
<div class="line"><span class="lineno"> 1172</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1173</span>    <span class="comment">// There was a error, we shouldn&#39;t reach here</span></div>
<div class="line"><span class="lineno"> 1174</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1175</span>    <a class="code hl_define" href="build_2bin_2debug_2_s_d_k_2_imports_2_hyper_dbg_hyper_log_intrinsics_8h.html#abf506c814a6f717a87b5d808b828ef56">LogWarning</a>(<span class="stringliteral">&quot;Err, hook was not applied&quot;</span>);</div>
<div class="line"><span class="lineno"> 1176</span> </div>
<div class="line"><span class="lineno"> 1177</span>    <span class="keywordflow">return</span> <a class="code hl_define" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div>
<div class="line"><span class="lineno"> 1178</span>}</div>
<div class="ttc" id="a_ept_8h_html_a31b07aec49a907dc08696d9595c08e5f"><div class="ttname"><a href="_ept_8h.html#a31b07aec49a907dc08696d9595c08e5f">PAGE_ATTRIB_EXEC</a></div><div class="ttdeci">#define PAGE_ATTRIB_EXEC</div><div class="ttdef"><b>Definition:</b> Ept.h:24</div></div>
<div class="ttc" id="a_ept_8h_html_a57f919b94c67edb76b752a2ca83b534a"><div class="ttname"><a href="_ept_8h.html#a57f919b94c67edb76b752a2ca83b534a">PAGE_ATTRIB_READ</a></div><div class="ttdeci">#define PAGE_ATTRIB_READ</div><div class="ttdoc">Page attributes for internal use.</div><div class="ttdef"><b>Definition:</b> Ept.h:22</div></div>
<div class="ttc" id="a_ept_8h_html_a6a23c222f617b62cc621b5482a378d8a"><div class="ttname"><a href="_ept_8h.html#a6a23c222f617b62cc621b5482a378d8a">PAGE_ATTRIB_WRITE</a></div><div class="ttdeci">#define PAGE_ATTRIB_WRITE</div><div class="ttdef"><b>Definition:</b> Ept.h:23</div></div>
<div class="ttc" id="a_ept_hook_8c_html_a77e3785963c79b3ff0efdf13efe0be13"><div class="ttname"><a href="_ept_hook_8c.html#a77e3785963c79b3ff0efdf13efe0be13">EptHookPerformPageHook2</a></div><div class="ttdeci">BOOLEAN EptHookPerformPageHook2(PVOID TargetAddress, PVOID HookFunction, CR3_TYPE ProcessCr3, BOOLEAN UnsetRead, BOOLEAN UnsetWrite, BOOLEAN UnsetExecute)</div><div class="ttdoc">The main function that performs EPT page hook with hidden detours and monitor.</div><div class="ttdef"><b>Definition:</b> EptHook.c:775</div></div>
<div class="ttc" id="a_global_variables_8h_html_a3c92f787270f29f40a4fb1b3440a3baa"><div class="ttname"><a href="_global_variables_8h.html#a3c92f787270f29f40a4fb1b3440a3baa">g_CompatibilityCheck</a></div><div class="ttdeci">COMPATIBILITY_CHECKS_STATUS g_CompatibilityCheck</div><div class="ttdoc">Different attributes and compatibility checks of the current processor.</div><div class="ttdef"><b>Definition:</b> GlobalVariables.h:26</div></div>
<div class="ttc" id="a_global_variables_8h_html_a6e5074e59b6770a1b187d7e2d50f00bb"><div class="ttname"><a href="_global_variables_8h.html#a6e5074e59b6770a1b187d7e2d50f00bb">g_IsEptHook2sDetourListInitialized</a></div><div class="ttdeci">BOOLEAN g_IsEptHook2sDetourListInitialized</div><div class="ttdoc">List header of hidden hooks detour.</div><div class="ttdef"><b>Definition:</b> GlobalVariables.h:68</div></div>
<div class="ttc" id="a_global_variables_8h_html_a90f5a18f43567010690d8d7927619fa0"><div class="ttname"><a href="_global_variables_8h.html#a90f5a18f43567010690d8d7927619fa0">g_EptHook2sDetourListHead</a></div><div class="ttdeci">LIST_ENTRY g_EptHook2sDetourListHead</div><div class="ttdoc">List header of hidden hooks detour.</div><div class="ttdef"><b>Definition:</b> GlobalVariables.h:62</div></div>
<div class="ttc" id="a_vmcall_8h_html_a2f893b27a9a2cedec9f4c499011dce0a"><div class="ttname"><a href="_vmcall_8h.html#a2f893b27a9a2cedec9f4c499011dce0a">VMCALL_CHANGE_PAGE_ATTRIB</a></div><div class="ttdeci">#define VMCALL_CHANGE_PAGE_ATTRIB</div><div class="ttdoc">VMCALL to Hook Change the attribute bits of the EPT Table.</div><div class="ttdef"><b>Definition:</b> Vmcall.h:34</div></div>
<div class="ttc" id="a_vmx_8c_html_a21a5facaf10e8fbeb70dd00942e51ef1"><div class="ttname"><a href="_vmx_8c.html#a21a5facaf10e8fbeb70dd00942e51ef1">VmxGetCurrentExecutionMode</a></div><div class="ttdeci">BOOLEAN VmxGetCurrentExecutionMode()</div><div class="ttdoc">Check current execution mode (vmx-root and non-root)</div><div class="ttdef"><b>Definition:</b> Vmx.c:76</div></div>
<div class="ttc" id="a_vmx_8c_html_a54291454c7d99c90bf5e19a939825634"><div class="ttname"><a href="_vmx_8c.html#a54291454c7d99c90bf5e19a939825634">VmxGetCurrentLaunchState</a></div><div class="ttdeci">BOOLEAN VmxGetCurrentLaunchState()</div><div class="ttdoc">Check if the VMX is launched or not.</div><div class="ttdef"><b>Definition:</b> Vmx.c:100</div></div>
<div class="ttc" id="abuild_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h_html_aae17ebb9ef7279d026817fb22f8aebe9"><div class="ttname"><a href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#aae17ebb9ef7279d026817fb22f8aebe9">UINT64</a></div><div class="ttdeci">unsigned __int64 UINT64</div><div class="ttdef"><b>Definition:</b> BasicTypes.h:19</div></div>
<div class="ttc" id="abuild_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h_html_ae1e6edbbc26d6fbc71a90190d0266018"><div class="ttname"><a href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#ae1e6edbbc26d6fbc71a90190d0266018">UINT32</a></div><div class="ttdeci">unsigned int UINT32</div><div class="ttdef"><b>Definition:</b> BasicTypes.h:46</div></div>
<div class="ttc" id="abuild_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h_html_af632da489ebc3708ec3ab6791ee53fa4"><div class="ttname"><a href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#af632da489ebc3708ec3ab6791ee53fa4">ULONG</a></div><div class="ttdeci">unsigned long ULONG</div><div class="ttdef"><b>Definition:</b> BasicTypes.h:35</div></div>
<div class="ttc" id="abuild_2bin_2debug_2_s_d_k_2_imports_2_hyper_dbg_hyper_log_intrinsics_8h_html_a97b0adbd65790fb90734daa8e5245a04"><div class="ttname"><a href="build_2bin_2debug_2_s_d_k_2_imports_2_hyper_dbg_hyper_log_intrinsics_8h.html#a97b0adbd65790fb90734daa8e5245a04">LogInfo</a></div><div class="ttdeci">#define LogInfo(format,...)</div><div class="ttdoc">Define log variables.</div><div class="ttdef"><b>Definition:</b> HyperDbgHyperLogIntrinsics.h:71</div></div>
<div class="ttc" id="abuild_2bin_2debug_2_s_d_k_2_imports_2_hyper_dbg_hyper_log_intrinsics_8h_html_abf506c814a6f717a87b5d808b828ef56"><div class="ttname"><a href="build_2bin_2debug_2_s_d_k_2_imports_2_hyper_dbg_hyper_log_intrinsics_8h.html#abf506c814a6f717a87b5d808b828ef56">LogWarning</a></div><div class="ttdeci">#define LogWarning(format,...)</div><div class="ttdoc">Log in the case of warning.</div><div class="ttdef"><b>Definition:</b> HyperDbgHyperLogIntrinsics.h:99</div></div>
<div class="ttc" id="alist_8h_html_a71fd97aa8bac50a2f3a1d98cf680b2f4"><div class="ttname"><a href="list_8h.html#a71fd97aa8bac50a2f3a1d98cf680b2f4">InitializeListHead</a></div><div class="ttdeci">void InitializeListHead(PLIST_ENTRY ListHead)</div></div>
<div class="ttc" id="astruct___c_o_m_p_a_t_i_b_i_l_i_t_y___c_h_e_c_k_s___s_t_a_t_u_s_html_af68dba0dd8b9469e42d344f82fca8417"><div class="ttname"><a href="struct___c_o_m_p_a_t_i_b_i_l_i_t_y___c_h_e_c_k_s___s_t_a_t_u_s.html#af68dba0dd8b9469e42d344f82fca8417">_COMPATIBILITY_CHECKS_STATUS::ExecuteOnlySupport</a></div><div class="ttdeci">BOOLEAN ExecuteOnlySupport</div><div class="ttdef"><b>Definition:</b> CompatibilityChecks.h:29</div></div>
<div class="ttc" id="astruct___c_r3___t_y_p_e_html_a04eb96cc99b0458be739bcc9c640e08b"><div class="ttname"><a href="struct___c_r3___t_y_p_e.html#a04eb96cc99b0458be739bcc9c640e08b">_CR3_TYPE::Flags</a></div><div class="ttdeci">UINT64 Flags</div><div class="ttdef"><b>Definition:</b> BasicTypes.h:139</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a2d6894b9430a2758f65c2a646ee6c872" name="a2d6894b9430a2758f65c2a646ee6c872"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2d6894b9430a2758f65c2a646ee6c872">&#9670;&#160;</a></span>EptHook2GeneralDetourEventHandler()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">PVOID EptHook2GeneralDetourEventHandler </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#a2bd4673df5e6e2fb371d770f3f2886d9">PGUEST_REGS</a>&#160;</td>
          <td class="paramname"><em>Regs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PVOID&#160;</td>
          <td class="paramname"><em>CalledFrom</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>routines to generally handle breakpoint hit for detour </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">Regs</td><td></td></tr>
    <tr><td class="paramname">CalledFrom</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>PVOID </dd></dl>
<div class="fragment"><div class="line"><span class="lineno"> 1656</span>{</div>
<div class="line"><span class="lineno"> 1657</span>    PLIST_ENTRY       TempList    = 0;</div>
<div class="line"><span class="lineno"> 1658</span>    <a class="code hl_struct" href="struct___e_p_t___h_o_o_k_s___c_o_n_t_e_x_t.html">EPT_HOOKS_CONTEXT</a> TempContext = {0};</div>
<div class="line"><span class="lineno"> 1659</span> </div>
<div class="line"><span class="lineno"> 1660</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1661</span>    <span class="comment">// The RSP register is the at the RCX and we just added (reverse by stack) to it&#39;s</span></div>
<div class="line"><span class="lineno"> 1662</span>    <span class="comment">// values by the size of the GUEST_REGS</span></div>
<div class="line"><span class="lineno"> 1663</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1664</span>    Regs-&gt;<a class="code hl_variable" href="struct_g_u_e_s_t___r_e_g_s.html#a04918d3fe8010c01a6bd3f1ba4e11bc2">rsp</a> = (<a class="code hl_typedef" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#aae17ebb9ef7279d026817fb22f8aebe9">UINT64</a>)Regs - <span class="keyword">sizeof</span>(<a class="code hl_struct" href="struct_g_u_e_s_t___r_e_g_s.html">GUEST_REGS</a>);</div>
<div class="line"><span class="lineno"> 1665</span> </div>
<div class="line"><span class="lineno"> 1666</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1667</span>    <span class="comment">// test</span></div>
<div class="line"><span class="lineno"> 1668</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1669</span> </div>
<div class="line"><span class="lineno"> 1670</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1671</span>    <span class="comment">// LogInfo(&quot;Hidden Hooked function Called with : rcx = 0x%llx , rdx = 0x%llx , r8 = 0x%llx ,  r9 = 0x%llx&quot;,</span></div>
<div class="line"><span class="lineno"> 1672</span>    <span class="comment">//        Regs-&gt;rcx,</span></div>
<div class="line"><span class="lineno"> 1673</span>    <span class="comment">//        Regs-&gt;rdx,</span></div>
<div class="line"><span class="lineno"> 1674</span>    <span class="comment">//        Regs-&gt;r8,</span></div>
<div class="line"><span class="lineno"> 1675</span>    <span class="comment">//        Regs-&gt;r9);</span></div>
<div class="line"><span class="lineno"> 1676</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1677</span> </div>
<div class="line"><span class="lineno"> 1678</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1679</span>    <span class="comment">// Create temporary context</span></div>
<div class="line"><span class="lineno"> 1680</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1681</span>    TempContext.<a class="code hl_variable" href="struct___e_p_t___h_o_o_k_s___c_o_n_t_e_x_t.html#a2f5080d315f72646f57eda6e61e1aff1">VirtualAddress</a>  = CalledFrom;</div>
<div class="line"><span class="lineno"> 1682</span>    TempContext.<a class="code hl_variable" href="struct___e_p_t___h_o_o_k_s___c_o_n_t_e_x_t.html#afc81b90725dc9bc78a4a7b0cdf5a314b">PhysicalAddress</a> = <a class="code hl_function" href="build_2bin_2debug_2_s_d_k_2_imports_2_hyper_dbg_vmm_imports_8h.html#a9c177c471eaf6be292a94d8112fa3f36">VirtualAddressToPhysicalAddress</a>(CalledFrom);</div>
<div class="line"><span class="lineno"> 1683</span> </div>
<div class="line"><span class="lineno"> 1684</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1685</span>    <span class="comment">// Create a temporary VCpu</span></div>
<div class="line"><span class="lineno"> 1686</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1687</span>    <a class="code hl_struct" href="struct___v_i_r_t_u_a_l___m_a_c_h_i_n_e___s_t_a_t_e.html">VIRTUAL_MACHINE_STATE</a> * VCpu = &amp;<a class="code hl_variable" href="_global_variables_8h.html#a04bac1f4beef0dcf1ce1a4d9ce72ea76">g_GuestState</a>[KeGetCurrentProcessorNumber()];</div>
<div class="line"><span class="lineno"> 1688</span> </div>
<div class="line"><span class="lineno"> 1689</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1690</span>    <span class="comment">// Set the register for the temporary VCpu</span></div>
<div class="line"><span class="lineno"> 1691</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1692</span>    VCpu-&gt;<a class="code hl_variable" href="struct___v_i_r_t_u_a_l___m_a_c_h_i_n_e___s_t_a_t_e.html#aae00ab92fdce5f90e65edb3bd10ae696">Regs</a> = Regs;</div>
<div class="line"><span class="lineno"> 1693</span> </div>
<div class="line"><span class="lineno"> 1694</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1695</span>    <span class="comment">// As the context to event trigger, we send the address of function</span></div>
<div class="line"><span class="lineno"> 1696</span>    <span class="comment">// which is current hidden hook is triggered for it</span></div>
<div class="line"><span class="lineno"> 1697</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1698</span>    <a class="code hl_function" href="_dispatch_8c.html#abdd5d2cff9ea39a842046b1af7a72c51">DispatchEventHiddenHookExecDetours</a>(VCpu, &amp;TempContext);</div>
<div class="line"><span class="lineno"> 1699</span> </div>
<div class="line"><span class="lineno"> 1700</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1701</span>    <span class="comment">// Iterate through the list of hooked pages details to find</span></div>
<div class="line"><span class="lineno"> 1702</span>    <span class="comment">// and return where want to jump after this functions</span></div>
<div class="line"><span class="lineno"> 1703</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1704</span>    TempList = &amp;<a class="code hl_variable" href="_global_variables_8h.html#a90f5a18f43567010690d8d7927619fa0">g_EptHook2sDetourListHead</a>;</div>
<div class="line"><span class="lineno"> 1705</span> </div>
<div class="line"><span class="lineno"> 1706</span>    <span class="keywordflow">while</span> (&amp;<a class="code hl_variable" href="_global_variables_8h.html#a90f5a18f43567010690d8d7927619fa0">g_EptHook2sDetourListHead</a> != TempList-&gt;Flink)</div>
<div class="line"><span class="lineno"> 1707</span>    {</div>
<div class="line"><span class="lineno"> 1708</span>        TempList                                          = TempList-&gt;Flink;</div>
<div class="line"><span class="lineno"> 1709</span>        <a class="code hl_struct" href="struct___h_i_d_d_e_n___h_o_o_k_s___d_e_t_o_u_r___d_e_t_a_i_l_s.html">PHIDDEN_HOOKS_DETOUR_DETAILS</a> CurrentHookedDetails = <a class="code hl_define" href="list_8h.html#adec42d53dc3b3e16ab7a1cd98af1c5fc">CONTAINING_RECORD</a>(TempList, <a class="code hl_struct" href="struct___h_i_d_d_e_n___h_o_o_k_s___d_e_t_o_u_r___d_e_t_a_i_l_s.html">HIDDEN_HOOKS_DETOUR_DETAILS</a>, OtherHooksList);</div>
<div class="line"><span class="lineno"> 1710</span> </div>
<div class="line"><span class="lineno"> 1711</span>        <span class="keywordflow">if</span> (CurrentHookedDetails-&gt;<a class="code hl_variable" href="struct___h_i_d_d_e_n___h_o_o_k_s___d_e_t_o_u_r___d_e_t_a_i_l_s.html#a5b7e945d9dd258586acd7e0268c8f11a">HookedFunctionAddress</a> == CalledFrom)</div>
<div class="line"><span class="lineno"> 1712</span>        {</div>
<div class="line"><span class="lineno"> 1713</span>            <span class="keywordflow">return</span> CurrentHookedDetails-&gt;<a class="code hl_variable" href="struct___h_i_d_d_e_n___h_o_o_k_s___d_e_t_o_u_r___d_e_t_a_i_l_s.html#a89757e40877fd300bf09ab3b45642f28">ReturnAddress</a>;</div>
<div class="line"><span class="lineno"> 1714</span>        }</div>
<div class="line"><span class="lineno"> 1715</span>    }</div>
<div class="line"><span class="lineno"> 1716</span> </div>
<div class="line"><span class="lineno"> 1717</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1718</span>    <span class="comment">// If we reach here, means that we didn&#39;t find the return address</span></div>
<div class="line"><span class="lineno"> 1719</span>    <span class="comment">// that&#39;s an error, generally we can&#39;t do anything but as the user</span></div>
<div class="line"><span class="lineno"> 1720</span>    <span class="comment">// might already cleaned the hook and the structures are removed</span></div>
<div class="line"><span class="lineno"> 1721</span>    <span class="comment">// so we just return the original caller address and continue the</span></div>
<div class="line"><span class="lineno"> 1722</span>    <span class="comment">// guest normally</span></div>
<div class="line"><span class="lineno"> 1723</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1724</span>    <span class="keywordflow">return</span> CalledFrom;</div>
<div class="line"><span class="lineno"> 1725</span>}</div>
<div class="ttc" id="a_dispatch_8c_html_abdd5d2cff9ea39a842046b1af7a72c51"><div class="ttname"><a href="_dispatch_8c.html#abdd5d2cff9ea39a842046b1af7a72c51">DispatchEventHiddenHookExecDetours</a></div><div class="ttdeci">VOID DispatchEventHiddenHookExecDetours(VIRTUAL_MACHINE_STATE *VCpu, PVOID Context)</div><div class="ttdoc">Handling debugger functions related to hidden hook exec detours events.</div><div class="ttdef"><b>Definition:</b> Dispatch.c:875</div></div>
<div class="ttc" id="a_global_variables_8h_html_a04bac1f4beef0dcf1ce1a4d9ce72ea76"><div class="ttname"><a href="_global_variables_8h.html#a04bac1f4beef0dcf1ce1a4d9ce72ea76">g_GuestState</a></div><div class="ttdeci">VIRTUAL_MACHINE_STATE * g_GuestState</div><div class="ttdoc">Save the state and variables related to virtualization on each to logical core.</div><div class="ttdef"><b>Definition:</b> GlobalVariables.h:38</div></div>
<div class="ttc" id="abuild_2bin_2debug_2_s_d_k_2_imports_2_hyper_dbg_vmm_imports_8h_html_a9c177c471eaf6be292a94d8112fa3f36"><div class="ttname"><a href="build_2bin_2debug_2_s_d_k_2_imports_2_hyper_dbg_vmm_imports_8h.html#a9c177c471eaf6be292a94d8112fa3f36">VirtualAddressToPhysicalAddress</a></div><div class="ttdeci">IMPORT_EXPORT_VMM UINT64 VirtualAddressToPhysicalAddress(_In_ PVOID VirtualAddress)</div><div class="ttdoc">Converts Virtual Address to Physical Address.</div><div class="ttdef"><b>Definition:</b> Conversion.c:156</div></div>
<div class="ttc" id="alist_8h_html_adec42d53dc3b3e16ab7a1cd98af1c5fc"><div class="ttname"><a href="list_8h.html#adec42d53dc3b3e16ab7a1cd98af1c5fc">CONTAINING_RECORD</a></div><div class="ttdeci">#define CONTAINING_RECORD(address, type, field)</div><div class="ttdef"><b>Definition:</b> list.h:14</div></div>
<div class="ttc" id="astruct___e_p_t___h_o_o_k_s___c_o_n_t_e_x_t_html"><div class="ttname"><a href="struct___e_p_t___h_o_o_k_s___c_o_n_t_e_x_t.html">_EPT_HOOKS_CONTEXT</a></div><div class="ttdoc">Temporary $context used in some EPT hook commands.</div><div class="ttdef"><b>Definition:</b> DataTypes.h:248</div></div>
<div class="ttc" id="astruct___e_p_t___h_o_o_k_s___c_o_n_t_e_x_t_html_a2f5080d315f72646f57eda6e61e1aff1"><div class="ttname"><a href="struct___e_p_t___h_o_o_k_s___c_o_n_t_e_x_t.html#a2f5080d315f72646f57eda6e61e1aff1">_EPT_HOOKS_CONTEXT::VirtualAddress</a></div><div class="ttdeci">UINT64 VirtualAddress</div><div class="ttdef"><b>Definition:</b> DataTypes.h:250</div></div>
<div class="ttc" id="astruct___e_p_t___h_o_o_k_s___c_o_n_t_e_x_t_html_afc81b90725dc9bc78a4a7b0cdf5a314b"><div class="ttname"><a href="struct___e_p_t___h_o_o_k_s___c_o_n_t_e_x_t.html#afc81b90725dc9bc78a4a7b0cdf5a314b">_EPT_HOOKS_CONTEXT::PhysicalAddress</a></div><div class="ttdeci">UINT64 PhysicalAddress</div><div class="ttdef"><b>Definition:</b> DataTypes.h:249</div></div>
<div class="ttc" id="astruct___h_i_d_d_e_n___h_o_o_k_s___d_e_t_o_u_r___d_e_t_a_i_l_s_html"><div class="ttname"><a href="struct___h_i_d_d_e_n___h_o_o_k_s___d_e_t_o_u_r___d_e_t_a_i_l_s.html">_HIDDEN_HOOKS_DETOUR_DETAILS</a></div><div class="ttdoc">Details of detours style EPT hooks.</div><div class="ttdef"><b>Definition:</b> Hooks.h:74</div></div>
<div class="ttc" id="astruct___h_i_d_d_e_n___h_o_o_k_s___d_e_t_o_u_r___d_e_t_a_i_l_s_html_a5b7e945d9dd258586acd7e0268c8f11a"><div class="ttname"><a href="struct___h_i_d_d_e_n___h_o_o_k_s___d_e_t_o_u_r___d_e_t_a_i_l_s.html#a5b7e945d9dd258586acd7e0268c8f11a">_HIDDEN_HOOKS_DETOUR_DETAILS::HookedFunctionAddress</a></div><div class="ttdeci">PVOID HookedFunctionAddress</div><div class="ttdef"><b>Definition:</b> Hooks.h:76</div></div>
<div class="ttc" id="astruct___h_i_d_d_e_n___h_o_o_k_s___d_e_t_o_u_r___d_e_t_a_i_l_s_html_a89757e40877fd300bf09ab3b45642f28"><div class="ttname"><a href="struct___h_i_d_d_e_n___h_o_o_k_s___d_e_t_o_u_r___d_e_t_a_i_l_s.html#a89757e40877fd300bf09ab3b45642f28">_HIDDEN_HOOKS_DETOUR_DETAILS::ReturnAddress</a></div><div class="ttdeci">PVOID ReturnAddress</div><div class="ttdef"><b>Definition:</b> Hooks.h:77</div></div>
<div class="ttc" id="astruct___v_i_r_t_u_a_l___m_a_c_h_i_n_e___s_t_a_t_e_html"><div class="ttname"><a href="struct___v_i_r_t_u_a_l___m_a_c_h_i_n_e___s_t_a_t_e.html">_VIRTUAL_MACHINE_STATE</a></div><div class="ttdoc">The status of each core after and before VMX.</div><div class="ttdef"><b>Definition:</b> State.h:208</div></div>
<div class="ttc" id="astruct___v_i_r_t_u_a_l___m_a_c_h_i_n_e___s_t_a_t_e_html_aae00ab92fdce5f90e65edb3bd10ae696"><div class="ttname"><a href="struct___v_i_r_t_u_a_l___m_a_c_h_i_n_e___s_t_a_t_e.html#aae00ab92fdce5f90e65edb3bd10ae696">_VIRTUAL_MACHINE_STATE::Regs</a></div><div class="ttdeci">GUEST_REGS * Regs</div><div class="ttdef"><b>Definition:</b> State.h:223</div></div>
<div class="ttc" id="astruct_g_u_e_s_t___r_e_g_s_html"><div class="ttname"><a href="struct_g_u_e_s_t___r_e_g_s.html">GUEST_REGS</a></div><div class="ttdef"><b>Definition:</b> BasicTypes.h:65</div></div>
<div class="ttc" id="astruct_g_u_e_s_t___r_e_g_s_html_a04918d3fe8010c01a6bd3f1ba4e11bc2"><div class="ttname"><a href="struct_g_u_e_s_t___r_e_g_s.html#a04918d3fe8010c01a6bd3f1ba4e11bc2">GUEST_REGS::rsp</a></div><div class="ttdeci">UINT64 rsp</div><div class="ttdef"><b>Definition:</b> BasicTypes.h:74</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a568ee71ca657b5e7f5d613288be096b9" name="a568ee71ca657b5e7f5d613288be096b9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a568ee71ca657b5e7f5d613288be096b9">&#9670;&#160;</a></span>EptHookAllocateExtraHookingPages()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#a7f319bfc2492a2136964194204e7a8cf">VOID</a> EptHookAllocateExtraHookingPages </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#ae1e6edbbc26d6fbc71a90190d0266018">UINT32</a>&#160;</td>
          <td class="paramname"><em>Count</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Allocate (reserve) extra pages for storing details of page hooks. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">Count</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>VOID </dd></dl>
<div class="fragment"><div class="line"><span class="lineno"> 1735</span>{</div>
<div class="line"><span class="lineno"> 1736</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1737</span>    <span class="comment">// Request pages to be allocated for converting 2MB to 4KB pages</span></div>
<div class="line"><span class="lineno"> 1738</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1739</span>    <a class="code hl_function" href="build_2bin_2debug_2_s_d_k_2_imports_2_hyper_dbg_vmm_imports_8h.html#aea915a9cf9f226a53f538d496ea7fa40">PoolManagerRequestAllocation</a>(<span class="keyword">sizeof</span>(<a class="code hl_struct" href="struct___v_m_m___e_p_t___d_y_n_a_m_i_c___s_p_l_i_t.html">VMM_EPT_DYNAMIC_SPLIT</a>),</div>
<div class="line"><span class="lineno"> 1740</span>                                 Count,</div>
<div class="line"><span class="lineno"> 1741</span>                                 <a class="code hl_enumvalue" href="build_2bin_2debug_2_s_d_k_2_headers_2_data_types_8h.html#ad130f0bae4db97169873223d0aad9a63a09f33e69ad8e184c21efd29fa2fe7380">SPLIT_2MB_PAGING_TO_4KB_PAGE</a>);</div>
<div class="line"><span class="lineno"> 1742</span> </div>
<div class="line"><span class="lineno"> 1743</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1744</span>    <span class="comment">// Request pages to be allocated for paged hook details</span></div>
<div class="line"><span class="lineno"> 1745</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1746</span>    <a class="code hl_function" href="build_2bin_2debug_2_s_d_k_2_imports_2_hyper_dbg_vmm_imports_8h.html#aea915a9cf9f226a53f538d496ea7fa40">PoolManagerRequestAllocation</a>(<span class="keyword">sizeof</span>(<a class="code hl_struct" href="struct___e_p_t___h_o_o_k_e_d___p_a_g_e___d_e_t_a_i_l.html">EPT_HOOKED_PAGE_DETAIL</a>),</div>
<div class="line"><span class="lineno"> 1747</span>                                 Count,</div>
<div class="line"><span class="lineno"> 1748</span>                                 <a class="code hl_enumvalue" href="build_2bin_2debug_2_s_d_k_2_headers_2_data_types_8h.html#ad130f0bae4db97169873223d0aad9a63a1c4249f84cf779cd4cdd72ee27de08c1">TRACKING_HOOKED_PAGES</a>);</div>
<div class="line"><span class="lineno"> 1749</span>}</div>
<div class="ttc" id="abuild_2bin_2debug_2_s_d_k_2_headers_2_data_types_8h_html_ad130f0bae4db97169873223d0aad9a63a09f33e69ad8e184c21efd29fa2fe7380"><div class="ttname"><a href="build_2bin_2debug_2_s_d_k_2_headers_2_data_types_8h.html#ad130f0bae4db97169873223d0aad9a63a09f33e69ad8e184c21efd29fa2fe7380">SPLIT_2MB_PAGING_TO_4KB_PAGE</a></div><div class="ttdeci">@ SPLIT_2MB_PAGING_TO_4KB_PAGE</div><div class="ttdef"><b>Definition:</b> DataTypes.h:43</div></div>
<div class="ttc" id="abuild_2bin_2debug_2_s_d_k_2_headers_2_data_types_8h_html_ad130f0bae4db97169873223d0aad9a63a1c4249f84cf779cd4cdd72ee27de08c1"><div class="ttname"><a href="build_2bin_2debug_2_s_d_k_2_headers_2_data_types_8h.html#ad130f0bae4db97169873223d0aad9a63a1c4249f84cf779cd4cdd72ee27de08c1">TRACKING_HOOKED_PAGES</a></div><div class="ttdeci">@ TRACKING_HOOKED_PAGES</div><div class="ttdef"><b>Definition:</b> DataTypes.h:41</div></div>
<div class="ttc" id="abuild_2bin_2debug_2_s_d_k_2_imports_2_hyper_dbg_vmm_imports_8h_html_aea915a9cf9f226a53f538d496ea7fa40"><div class="ttname"><a href="build_2bin_2debug_2_s_d_k_2_imports_2_hyper_dbg_vmm_imports_8h.html#aea915a9cf9f226a53f538d496ea7fa40">PoolManagerRequestAllocation</a></div><div class="ttdeci">IMPORT_EXPORT_VMM BOOLEAN PoolManagerRequestAllocation(SIZE_T Size, UINT32 Count, POOL_ALLOCATION_INTENTION Intention)</div><div class="ttdoc">Request to allocate new buffers.</div><div class="ttdef"><b>Definition:</b> PoolManager.c:442</div></div>
<div class="ttc" id="astruct___e_p_t___h_o_o_k_e_d___p_a_g_e___d_e_t_a_i_l_html"><div class="ttname"><a href="struct___e_p_t___h_o_o_k_e_d___p_a_g_e___d_e_t_a_i_l.html">_EPT_HOOKED_PAGE_DETAIL</a></div><div class="ttdoc">Structure to save the state of each hooked pages.</div><div class="ttdef"><b>Definition:</b> State.h:91</div></div>
<div class="ttc" id="astruct___v_m_m___e_p_t___d_y_n_a_m_i_c___s_p_l_i_t_html"><div class="ttname"><a href="struct___v_m_m___e_p_t___d_y_n_a_m_i_c___s_p_l_i_t.html">_VMM_EPT_DYNAMIC_SPLIT</a></div><div class="ttdoc">Split 2MB granularity to 4 KB granularity.</div><div class="ttdef"><b>Definition:</b> Ept.h:167</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="acd0179b7c5730f636141dfea2afcdc5a" name="acd0179b7c5730f636141dfea2afcdc5a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#acd0179b7c5730f636141dfea2afcdc5a">&#9670;&#160;</a></span>EptHookGetCountOfEpthooks()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#ae1e6edbbc26d6fbc71a90190d0266018">UINT32</a> EptHookGetCountOfEpthooks </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#a1cb18096b299d23458d3c7b85fd86555">BOOLEAN</a>&#160;</td>
          <td class="paramname"><em>IsEptHook2</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>get the length of active EPT hooks (!epthook and !epthook2) </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname"></td><td></td></tr>
  </table>
  </dd>
</dl>
<p>return UINT32</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">IsEptHook2</td><td>Whether the length should be for !epthook or !epthook2</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>UINT32 Count of remained breakpoints </dd></dl>
<div class="fragment"><div class="line"><span class="lineno"> 1330</span>{</div>
<div class="line"><span class="lineno"> 1331</span>    <a class="code hl_typedef" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#ae1e6edbbc26d6fbc71a90190d0266018">UINT32</a> Count = 0;</div>
<div class="line"><span class="lineno"> 1332</span> </div>
<div class="line"><span class="lineno"> 1333</span>    <a class="code hl_define" href="_meta_macros_8h.html#ae6305b9ffbb1d946674b7b98431a67e9">LIST_FOR_EACH_LINK</a>(<a class="code hl_variable" href="_global_variables_8h.html#a302f00c62e7ad092a9f44a3aa7452d99">g_EptState</a>-&gt;<a class="code hl_variable" href="struct___e_p_t___s_t_a_t_e.html#a2503c5862b1bb2b779e2185b4097aa15">HookedPagesList</a>, <a class="code hl_struct" href="struct___e_p_t___h_o_o_k_e_d___p_a_g_e___d_e_t_a_i_l.html">EPT_HOOKED_PAGE_DETAIL</a>, PageHookList, HookedEntry)</div>
<div class="line"><span class="lineno"> 1334</span>    {</div>
<div class="line"><span class="lineno"> 1335</span>        <span class="keywordflow">if</span> (IsEptHook2)</div>
<div class="line"><span class="lineno"> 1336</span>        {</div>
<div class="line"><span class="lineno"> 1337</span>            <span class="keywordflow">if</span> (HookedEntry-&gt;IsHiddenBreakpoint == <a class="code hl_define" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>)</div>
<div class="line"><span class="lineno"> 1338</span>            {</div>
<div class="line"><span class="lineno"> 1339</span>                Count++;</div>
<div class="line"><span class="lineno"> 1340</span>            }</div>
<div class="line"><span class="lineno"> 1341</span>        }</div>
<div class="line"><span class="lineno"> 1342</span>        <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno"> 1343</span>        {</div>
<div class="line"><span class="lineno"> 1344</span>            <span class="keywordflow">if</span> (HookedEntry-&gt;IsHiddenBreakpoint == <a class="code hl_define" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>)</div>
<div class="line"><span class="lineno"> 1345</span>            {</div>
<div class="line"><span class="lineno"> 1346</span>                Count++;</div>
<div class="line"><span class="lineno"> 1347</span>            }</div>
<div class="line"><span class="lineno"> 1348</span>        }</div>
<div class="line"><span class="lineno"> 1349</span>    }</div>
<div class="line"><span class="lineno"> 1350</span> </div>
<div class="line"><span class="lineno"> 1351</span>    <span class="keywordflow">return</span> Count;</div>
<div class="line"><span class="lineno"> 1352</span>}</div>
<div class="ttc" id="a_global_variables_8h_html_a302f00c62e7ad092a9f44a3aa7452d99"><div class="ttname"><a href="_global_variables_8h.html#a302f00c62e7ad092a9f44a3aa7452d99">g_EptState</a></div><div class="ttdeci">EPT_STATE * g_EptState</div><div class="ttdoc">Save the state and variables related to EPT.</div><div class="ttdef"><b>Definition:</b> GlobalVariables.h:50</div></div>
<div class="ttc" id="a_meta_macros_8h_html_ae6305b9ffbb1d946674b7b98431a67e9"><div class="ttname"><a href="_meta_macros_8h.html#ae6305b9ffbb1d946674b7b98431a67e9">LIST_FOR_EACH_LINK</a></div><div class="ttdeci">#define LIST_FOR_EACH_LINK(_head, _struct_type, _member, _var)</div><div class="ttdef"><b>Definition:</b> MetaMacros.h:34</div></div>
<div class="ttc" id="astruct___e_p_t___s_t_a_t_e_html_a2503c5862b1bb2b779e2185b4097aa15"><div class="ttname"><a href="struct___e_p_t___s_t_a_t_e.html#a2503c5862b1bb2b779e2185b4097aa15">_EPT_STATE::HookedPagesList</a></div><div class="ttdeci">LIST_ENTRY HookedPagesList</div><div class="ttdef"><b>Definition:</b> Ept.h:148</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a3d7fb010ec1756aa2f27e861271fc0f0" name="a3d7fb010ec1756aa2f27e861271fc0f0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3d7fb010ec1756aa2f27e861271fc0f0">&#9670;&#160;</a></span>EptHookHandleHookedPage()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#a1cb18096b299d23458d3c7b85fd86555">BOOLEAN</a> EptHookHandleHookedPage </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="hprdbghv_2header_2common_2_state_8h.html#ac81d4d9bd1e8dd24918e667b56b67b7e">VIRTUAL_MACHINE_STATE</a> *&#160;</td>
          <td class="paramname"><em>VCpu</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="hprdbghv_2header_2common_2_state_8h.html#a2ef230620f7c5617f62c8022159293fb">EPT_HOOKED_PAGE_DETAIL</a> *&#160;</td>
          <td class="paramname"><em>HookedEntryDetails</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">VMX_EXIT_QUALIFICATION_EPT_VIOLATION&#160;</td>
          <td class="paramname"><em>ViolationQualification</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">SIZE_T&#160;</td>
          <td class="paramname"><em>PhysicalAddress</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="build_2bin_2debug_2_s_d_k_2_headers_2_data_types_8h.html#a732f5fb65b66d5b23321a9b1c69e64d1">EPT_HOOKS_CONTEXT</a> *&#160;</td>
          <td class="paramname"><em>LastContext</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#a1cb18096b299d23458d3c7b85fd86555">BOOLEAN</a> *&#160;</td>
          <td class="paramname"><em>IgnoreReadOrWrite</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#a1cb18096b299d23458d3c7b85fd86555">BOOLEAN</a> *&#160;</td>
          <td class="paramname"><em>IsTriggeringPostEventAllowed</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Handle hooked pages in Vmx-root mode. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">VCpu</td><td></td></tr>
    <tr><td class="paramname">HookedEntryDetails</td><td></td></tr>
    <tr><td class="paramname">ViolationQualification</td><td></td></tr>
    <tr><td class="paramname">PhysicalAddress</td><td></td></tr>
    <tr><td class="paramname">LastContext</td><td></td></tr>
    <tr><td class="paramname">IgnoreReadOrWrite</td><td></td></tr>
    <tr><td class="paramname">IsTriggeringPostEventAllowed</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>BOOLEAN</dd></dl>
<p>Handle hooked pages in Vmx-root mode.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">VCpu</td><td>The virtual processor's state </td></tr>
    <tr><td class="paramname">HookedEntryDetails</td><td>The entry that describes the hooked page </td></tr>
    <tr><td class="paramname">ViolationQualification</td><td>The exit qualification of vm-exit </td></tr>
    <tr><td class="paramname">PhysicalAddress</td><td>The physical address that cause this vm-exit </td></tr>
    <tr><td class="paramname">LastContext</td><td>The last (current) context of the execution </td></tr>
    <tr><td class="paramname">IgnoreReadOrWrite</td><td>Whether to ignore the event effects or not </td></tr>
    <tr><td class="paramname">IsTriggeringPostEventAllowed</td><td>Whether the caller should consider executing the post triggering of the event or not</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>BOOLEAN Returns TRUE if the function was hook was handled or returns false if there was an unexpected ept violation </dd></dl>
<div class="fragment"><div class="line"><span class="lineno"> 1203</span>{</div>
<div class="line"><span class="lineno"> 1204</span>    <a class="code hl_typedef" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#aae17ebb9ef7279d026817fb22f8aebe9">UINT64</a> GuestRip;</div>
<div class="line"><span class="lineno"> 1205</span>    <a class="code hl_typedef" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#aae17ebb9ef7279d026817fb22f8aebe9">UINT64</a> ExactAccessedVirtualAddress;</div>
<div class="line"><span class="lineno"> 1206</span>    <a class="code hl_typedef" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#aae17ebb9ef7279d026817fb22f8aebe9">UINT64</a> AlignedVirtualAddress;</div>
<div class="line"><span class="lineno"> 1207</span>    <a class="code hl_typedef" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#aae17ebb9ef7279d026817fb22f8aebe9">UINT64</a> AlignedPhysicalAddress;</div>
<div class="line"><span class="lineno"> 1208</span> </div>
<div class="line"><span class="lineno"> 1209</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1210</span>    <span class="comment">// Get alignment</span></div>
<div class="line"><span class="lineno"> 1211</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1212</span>    AlignedVirtualAddress  = <a class="code hl_define" href="hprdbgctrl_2header_2common_8h.html#aa02188de52b66a3aa5e1aecc6bd963ae">PAGE_ALIGN</a>(HookedEntryDetails-&gt;<a class="code hl_variable" href="struct___e_p_t___h_o_o_k_e_d___p_a_g_e___d_e_t_a_i_l.html#a3464acbaf76a38d67558d8ff3bee342f">VirtualAddress</a>);</div>
<div class="line"><span class="lineno"> 1213</span>    AlignedPhysicalAddress = <a class="code hl_define" href="hprdbgctrl_2header_2common_8h.html#aa02188de52b66a3aa5e1aecc6bd963ae">PAGE_ALIGN</a>(PhysicalAddress);</div>
<div class="line"><span class="lineno"> 1214</span> </div>
<div class="line"><span class="lineno"> 1215</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1216</span>    <span class="comment">// Let&#39;s read the exact address that was accessed</span></div>
<div class="line"><span class="lineno"> 1217</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1218</span>    ExactAccessedVirtualAddress = AlignedVirtualAddress + PhysicalAddress - AlignedPhysicalAddress;</div>
<div class="line"><span class="lineno"> 1219</span> </div>
<div class="line"><span class="lineno"> 1220</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1221</span>    <span class="comment">// Set the last context</span></div>
<div class="line"><span class="lineno"> 1222</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1223</span>    LastContext-&gt;<a class="code hl_variable" href="struct___e_p_t___h_o_o_k_s___c_o_n_t_e_x_t.html#afc81b90725dc9bc78a4a7b0cdf5a314b">PhysicalAddress</a> = PhysicalAddress;</div>
<div class="line"><span class="lineno"> 1224</span>    LastContext-&gt;<a class="code hl_variable" href="struct___e_p_t___h_o_o_k_s___c_o_n_t_e_x_t.html#a2f5080d315f72646f57eda6e61e1aff1">VirtualAddress</a>  = ExactAccessedVirtualAddress;</div>
<div class="line"><span class="lineno"> 1225</span> </div>
<div class="line"><span class="lineno"> 1226</span>    <span class="keywordflow">if</span> (!ViolationQualification.EptExecutable &amp;&amp; ViolationQualification.ExecuteAccess)</div>
<div class="line"><span class="lineno"> 1227</span>    {</div>
<div class="line"><span class="lineno"> 1228</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1229</span>        <span class="comment">// Reading guest&#39;s RIP</span></div>
<div class="line"><span class="lineno"> 1230</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1231</span>        __vmx_vmread(VMCS_GUEST_RIP, &amp;GuestRip);</div>
<div class="line"><span class="lineno"> 1232</span> </div>
<div class="line"><span class="lineno"> 1233</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1234</span>        <span class="comment">// Generally, we should never reach here, we didn&#39;t implement HyperDbg like this ;)</span></div>
<div class="line"><span class="lineno"> 1235</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1236</span>        <a class="code hl_define" href="build_2bin_2debug_2_s_d_k_2_imports_2_hyper_dbg_hyper_log_intrinsics_8h.html#a459b19922fecfbb9438dd56b66930d16">LogError</a>(<span class="stringliteral">&quot;Err, Guest RIP : 0x%llx tries to execute the page at : 0x%llx&quot;</span>, GuestRip, ExactAccessedVirtualAddress);</div>
<div class="line"><span class="lineno"> 1237</span>    }</div>
<div class="line"><span class="lineno"> 1238</span>    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!ViolationQualification.EptWriteable &amp;&amp; ViolationQualification.WriteAccess)</div>
<div class="line"><span class="lineno"> 1239</span>    {</div>
<div class="line"><span class="lineno"> 1240</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1241</span>        <span class="comment">// Test</span></div>
<div class="line"><span class="lineno"> 1242</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1243</span> </div>
<div class="line"><span class="lineno"> 1244</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1245</span>        <span class="comment">// LogInfo(&quot;Guest RIP : 0x%llx tries to write on the page at :0x%llx&quot;, GuestRip, ExactAccessedAddress);</span></div>
<div class="line"><span class="lineno"> 1246</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1247</span> </div>
<div class="line"><span class="lineno"> 1248</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1249</span>        <span class="comment">// Trigger the event related to Monitor Write and Monitor Read &amp; Write</span></div>
<div class="line"><span class="lineno"> 1250</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1251</span>        *IgnoreReadOrWrite = <a class="code hl_function" href="_dispatch_8c.html#ac6048cec3cc762c6c25a7a4c56f1c9e7">DispatchEventHiddenHookPageReadWriteWritePreEvent</a>(VCpu, LastContext, IsTriggeringPostEventAllowed);</div>
<div class="line"><span class="lineno"> 1252</span>    }</div>
<div class="line"><span class="lineno"> 1253</span>    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!ViolationQualification.EptReadable &amp;&amp; ViolationQualification.ReadAccess)</div>
<div class="line"><span class="lineno"> 1254</span>    {</div>
<div class="line"><span class="lineno"> 1255</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1256</span>        <span class="comment">// Test</span></div>
<div class="line"><span class="lineno"> 1257</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1258</span> </div>
<div class="line"><span class="lineno"> 1259</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1260</span>        <span class="comment">// LogInfo(&quot;Guest RIP : 0x%llx tries to read the page at :0x%llx&quot;, GuestRip, ExactAccessedAddress);</span></div>
<div class="line"><span class="lineno"> 1261</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1262</span> </div>
<div class="line"><span class="lineno"> 1263</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1264</span>        <span class="comment">// Trigger the event related to Monitor Read and Monitor Read &amp; Write</span></div>
<div class="line"><span class="lineno"> 1265</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1266</span>        *IgnoreReadOrWrite = <a class="code hl_function" href="_dispatch_8c.html#abf10d45341868fb3378f123b59fc99ec">DispatchEventHiddenHookPageReadWriteReadPreEvent</a>(VCpu, LastContext, IsTriggeringPostEventAllowed);</div>
<div class="line"><span class="lineno"> 1267</span>    }</div>
<div class="line"><span class="lineno"> 1268</span>    <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno"> 1269</span>    {</div>
<div class="line"><span class="lineno"> 1270</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1271</span>        <span class="comment">// there was an unexpected ept violation</span></div>
<div class="line"><span class="lineno"> 1272</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1273</span>        <span class="keywordflow">return</span> <a class="code hl_define" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div>
<div class="line"><span class="lineno"> 1274</span>    }</div>
<div class="line"><span class="lineno"> 1275</span> </div>
<div class="line"><span class="lineno"> 1276</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1277</span>    <span class="comment">// Means that restore the Entry to the previous state after current</span></div>
<div class="line"><span class="lineno"> 1278</span>    <span class="comment">// instruction executed in the guest</span></div>
<div class="line"><span class="lineno"> 1279</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1280</span>    <span class="keywordflow">return</span> <a class="code hl_define" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;</div>
<div class="line"><span class="lineno"> 1281</span>}</div>
<div class="ttc" id="a_dispatch_8c_html_abf10d45341868fb3378f123b59fc99ec"><div class="ttname"><a href="_dispatch_8c.html#abf10d45341868fb3378f123b59fc99ec">DispatchEventHiddenHookPageReadWriteReadPreEvent</a></div><div class="ttdeci">BOOLEAN DispatchEventHiddenHookPageReadWriteReadPreEvent(VIRTUAL_MACHINE_STATE *VCpu, PVOID Context, BOOLEAN *IsTriggeringPostEventAllowed)</div><div class="ttdoc">Handling debugger functions related to read &amp; write, read events (pre)</div><div class="ttdef"><b>Definition:</b> Dispatch.c:955</div></div>
<div class="ttc" id="a_dispatch_8c_html_ac6048cec3cc762c6c25a7a4c56f1c9e7"><div class="ttname"><a href="_dispatch_8c.html#ac6048cec3cc762c6c25a7a4c56f1c9e7">DispatchEventHiddenHookPageReadWriteWritePreEvent</a></div><div class="ttdeci">BOOLEAN DispatchEventHiddenHookPageReadWriteWritePreEvent(VIRTUAL_MACHINE_STATE *VCpu, PVOID Context, BOOLEAN *IsTriggeringPostEventAllowed)</div><div class="ttdoc">Handling debugger functions related to read &amp; write, write events (pre)</div><div class="ttdef"><b>Definition:</b> Dispatch.c:899</div></div>
<div class="ttc" id="abuild_2bin_2debug_2_s_d_k_2_imports_2_hyper_dbg_hyper_log_intrinsics_8h_html_a459b19922fecfbb9438dd56b66930d16"><div class="ttname"><a href="build_2bin_2debug_2_s_d_k_2_imports_2_hyper_dbg_hyper_log_intrinsics_8h.html#a459b19922fecfbb9438dd56b66930d16">LogError</a></div><div class="ttdeci">#define LogError(format,...)</div><div class="ttdoc">Log in the case of error.</div><div class="ttdef"><b>Definition:</b> HyperDbgHyperLogIntrinsics.h:113</div></div>
<div class="ttc" id="ahprdbgctrl_2header_2common_8h_html_aa02188de52b66a3aa5e1aecc6bd963ae"><div class="ttname"><a href="hprdbgctrl_2header_2common_8h.html#aa02188de52b66a3aa5e1aecc6bd963ae">PAGE_ALIGN</a></div><div class="ttdeci">#define PAGE_ALIGN(Va)</div><div class="ttdoc">Aligning a page.</div><div class="ttdef"><b>Definition:</b> common.h:65</div></div>
<div class="ttc" id="astruct___e_p_t___h_o_o_k_e_d___p_a_g_e___d_e_t_a_i_l_html_a3464acbaf76a38d67558d8ff3bee342f"><div class="ttname"><a href="struct___e_p_t___h_o_o_k_e_d___p_a_g_e___d_e_t_a_i_l.html#a3464acbaf76a38d67558d8ff3bee342f">_EPT_HOOKED_PAGE_DETAIL::VirtualAddress</a></div><div class="ttdeci">UINT64 VirtualAddress</div><div class="ttdoc">The virtual address from the caller prespective view (cr3)</div><div class="ttdef"><b>Definition:</b> State.h:103</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a194622a3ba05a449923eb105cdb37405" name="a194622a3ba05a449923eb105cdb37405"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a194622a3ba05a449923eb105cdb37405">&#9670;&#160;</a></span>EptHookPerformPageHook()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#a1cb18096b299d23458d3c7b85fd86555">BOOLEAN</a> EptHookPerformPageHook </td>
          <td>(</td>
          <td class="paramtype">PVOID&#160;</td>
          <td class="paramname"><em>TargetAddress</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#aaeec30724d8f0c9d2acd894f41ee06fe">CR3_TYPE</a>&#160;</td>
          <td class="paramname"><em>ProcessCr3</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Hook in VMX Root Mode with hidden breakpoints (A pre-allocated buffer should be available) </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">TargetAddress</td><td></td></tr>
    <tr><td class="paramname">ProcessCr3</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>BOOLEAN</dd></dl>
<p>Hook in VMX Root Mode with hidden breakpoints (A pre-allocated buffer should be available)</p>
<p>This function returns false in VMX Non-Root Mode if the VM is already initialized This function have to be called through a VMCALL in VMX Root Mode</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">TargetAddress</td><td>The address of function or memory address to be hooked </td></tr>
    <tr><td class="paramname">ProcessCr3</td><td>The process cr3 to translate based on that process's cr3 </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>BOOLEAN Returns true if the hook was successful or false if there was an error </dd></dl>
<div class="fragment"><div class="line"><span class="lineno">  372</span>{</div>
<div class="line"><span class="lineno">  373</span>    <a class="code hl_typedef" href="hprdbghv_2header_2common_2_state_8h.html#a7f2689338799db6564d2b9cb35d7d596">EPT_PML1_ENTRY</a>          ChangedEntry;</div>
<div class="line"><span class="lineno">  374</span>    INVEPT_DESCRIPTOR       Descriptor;</div>
<div class="line"><span class="lineno">  375</span>    SIZE_T                  PhysicalBaseAddress;</div>
<div class="line"><span class="lineno">  376</span>    PVOID                   VirtualTarget;</div>
<div class="line"><span class="lineno">  377</span>    PVOID                   TargetBuffer;</div>
<div class="line"><span class="lineno">  378</span>    <a class="code hl_typedef" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#aae17ebb9ef7279d026817fb22f8aebe9">UINT64</a>                  TargetAddressInFakePageContent;</div>
<div class="line"><span class="lineno">  379</span>    <a class="code hl_typedef" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#aae17ebb9ef7279d026817fb22f8aebe9">UINT64</a>                  PageOffset;</div>
<div class="line"><span class="lineno">  380</span>    <a class="code hl_typedef" href="hprdbghv_2header_2common_2_state_8h.html#a03c563d9799bc8f374809f48c73c7175">PEPT_PML1_ENTRY</a>         TargetPage;</div>
<div class="line"><span class="lineno">  381</span>    <a class="code hl_struct" href="struct___e_p_t___h_o_o_k_e_d___p_a_g_e___d_e_t_a_i_l.html">PEPT_HOOKED_PAGE_DETAIL</a> HookedPage;</div>
<div class="line"><span class="lineno">  382</span> </div>
<div class="line"><span class="lineno">  383</span>    <a class="code hl_struct" href="struct___c_r3___t_y_p_e.html">CR3_TYPE</a> Cr3OfCurrentProcess;</div>
<div class="line"><span class="lineno">  384</span>    <a class="code hl_typedef" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#a4ae1dab0fb4b072a66584546209e7d58">BYTE</a>     OriginalByte;</div>
<div class="line"><span class="lineno">  385</span>    <a class="code hl_typedef" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#a1cb18096b299d23458d3c7b85fd86555">BOOLEAN</a>  HookedEntryFound = <a class="code hl_define" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div>
<div class="line"><span class="lineno">  386</span> </div>
<div class="line"><span class="lineno">  387</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">  388</span>    <span class="comment">// Translate the page from a physical address to virtual so we can read its memory.</span></div>
<div class="line"><span class="lineno">  389</span>    <span class="comment">// This function will return NULL if the physical address was not already mapped in</span></div>
<div class="line"><span class="lineno">  390</span>    <span class="comment">// virtual memory.</span></div>
<div class="line"><span class="lineno">  391</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">  392</span>    VirtualTarget = <a class="code hl_define" href="hprdbgctrl_2header_2common_8h.html#aa02188de52b66a3aa5e1aecc6bd963ae">PAGE_ALIGN</a>(TargetAddress);</div>
<div class="line"><span class="lineno">  393</span> </div>
<div class="line"><span class="lineno">  394</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">  395</span>    <span class="comment">// Here we have to change the CR3, it is because we are in SYSTEM process</span></div>
<div class="line"><span class="lineno">  396</span>    <span class="comment">// and if the target address is not mapped in SYSTEM address space (e.g</span></div>
<div class="line"><span class="lineno">  397</span>    <span class="comment">// user mode address of another process) then the translation is invalid</span></div>
<div class="line"><span class="lineno">  398</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">  399</span> </div>
<div class="line"><span class="lineno">  400</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">  401</span>    <span class="comment">// Find cr3 of target core</span></div>
<div class="line"><span class="lineno">  402</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">  403</span>    PhysicalBaseAddress = (SIZE_T)<a class="code hl_function" href="build_2bin_2debug_2_s_d_k_2_imports_2_hyper_dbg_vmm_imports_8h.html#aa4c6128ae9e5d96a297990bf5d3e7c5d">VirtualAddressToPhysicalAddressByProcessCr3</a>(VirtualTarget, ProcessCr3);</div>
<div class="line"><span class="lineno">  404</span> </div>
<div class="line"><span class="lineno">  405</span>    <span class="keywordflow">if</span> (!PhysicalBaseAddress)</div>
<div class="line"><span class="lineno">  406</span>    {</div>
<div class="line"><span class="lineno">  407</span>        <a class="code hl_function" href="_callback_8c.html#a68d4847c16adb5d0d6f8a5513a299029">VmmCallbackSetLastError</a>(<a class="code hl_define" href="build_2bin_2debug_2_s_d_k_2_headers_2_error_codes_8h.html#ac1b8dbae6748b88abe05844e42c29952">DEBUGGER_ERROR_INVALID_ADDRESS</a>);</div>
<div class="line"><span class="lineno">  408</span>        <span class="keywordflow">return</span> <a class="code hl_define" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div>
<div class="line"><span class="lineno">  409</span>    }</div>
<div class="line"><span class="lineno">  410</span> </div>
<div class="line"><span class="lineno">  411</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">  412</span>    <span class="comment">// try to see if we can find the address</span></div>
<div class="line"><span class="lineno">  413</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">  414</span> </div>
<div class="line"><span class="lineno">  415</span>    <a class="code hl_struct" href="struct___e_p_t___h_o_o_k_e_d___p_a_g_e___d_e_t_a_i_l.html">EPT_HOOKED_PAGE_DETAIL</a> * HookedEntry = {0};</div>
<div class="line"><span class="lineno">  416</span> </div>
<div class="line"><span class="lineno">  417</span>    <span class="keywordflow">if</span> (EptHookFindByPhysAddress(PhysicalBaseAddress, HookedEntry) == <a class="code hl_define" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a> &amp;&amp; HookedEntry != NULL)</div>
<div class="line"><span class="lineno">  418</span>    {</div>
<div class="line"><span class="lineno">  419</span>        <span class="keywordflow">return</span> EptHookUpdateHookPage(TargetAddress, HookedEntry);</div>
<div class="line"><span class="lineno">  420</span>    }</div>
<div class="line"><span class="lineno">  421</span>    <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno">  422</span>    {</div>
<div class="line"><span class="lineno">  423</span>        <span class="keywordflow">return</span> EptHookCreateHookPage(TargetAddress, ProcessCr3);</div>
<div class="line"><span class="lineno">  424</span>    }</div>
<div class="line"><span class="lineno">  425</span>}</div>
<div class="ttc" id="a_callback_8c_html_a68d4847c16adb5d0d6f8a5513a299029"><div class="ttname"><a href="_callback_8c.html#a68d4847c16adb5d0d6f8a5513a299029">VmmCallbackSetLastError</a></div><div class="ttdeci">VOID VmmCallbackSetLastError(UINT32 LastError)</div><div class="ttdoc">routine callback to set last error</div><div class="ttdef"><b>Definition:</b> Callback.c:154</div></div>
<div class="ttc" id="abuild_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h_html_a1cb18096b299d23458d3c7b85fd86555"><div class="ttname"><a href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#a1cb18096b299d23458d3c7b85fd86555">BOOLEAN</a></div><div class="ttdeci">UCHAR BOOLEAN</div><div class="ttdef"><b>Definition:</b> BasicTypes.h:37</div></div>
<div class="ttc" id="abuild_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h_html_a4ae1dab0fb4b072a66584546209e7d58"><div class="ttname"><a href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#a4ae1dab0fb4b072a66584546209e7d58">BYTE</a></div><div class="ttdeci">unsigned char BYTE</div><div class="ttdef"><b>Definition:</b> BasicTypes.h:22</div></div>
<div class="ttc" id="abuild_2bin_2debug_2_s_d_k_2_headers_2_error_codes_8h_html_ac1b8dbae6748b88abe05844e42c29952"><div class="ttname"><a href="build_2bin_2debug_2_s_d_k_2_headers_2_error_codes_8h.html#ac1b8dbae6748b88abe05844e42c29952">DEBUGGER_ERROR_INVALID_ADDRESS</a></div><div class="ttdeci">#define DEBUGGER_ERROR_INVALID_ADDRESS</div><div class="ttdoc">error, invalid address specified for debugger</div><div class="ttdef"><b>Definition:</b> ErrorCodes.h:63</div></div>
<div class="ttc" id="abuild_2bin_2debug_2_s_d_k_2_imports_2_hyper_dbg_vmm_imports_8h_html_aa4c6128ae9e5d96a297990bf5d3e7c5d"><div class="ttname"><a href="build_2bin_2debug_2_s_d_k_2_imports_2_hyper_dbg_vmm_imports_8h.html#aa4c6128ae9e5d96a297990bf5d3e7c5d">VirtualAddressToPhysicalAddressByProcessCr3</a></div><div class="ttdeci">IMPORT_EXPORT_VMM UINT64 VirtualAddressToPhysicalAddressByProcessCr3(_In_ PVOID VirtualAddress, _In_ CR3_TYPE TargetCr3)</div></div>
<div class="ttc" id="ahprdbghv_2header_2common_2_state_8h_html_a03c563d9799bc8f374809f48c73c7175"><div class="ttname"><a href="hprdbghv_2header_2common_2_state_8h.html#a03c563d9799bc8f374809f48c73c7175">PEPT_PML1_ENTRY</a></div><div class="ttdeci">EPT_PTE * PEPT_PML1_ENTRY</div><div class="ttdef"><b>Definition:</b> State.h:22</div></div>
<div class="ttc" id="ahprdbghv_2header_2common_2_state_8h_html_a7f2689338799db6564d2b9cb35d7d596"><div class="ttname"><a href="hprdbghv_2header_2common_2_state_8h.html#a7f2689338799db6564d2b9cb35d7d596">EPT_PML1_ENTRY</a></div><div class="ttdeci">EPT_PTE EPT_PML1_ENTRY</div><div class="ttdef"><b>Definition:</b> State.h:22</div></div>
<div class="ttc" id="astruct___c_r3___t_y_p_e_html"><div class="ttname"><a href="struct___c_r3___t_y_p_e.html">_CR3_TYPE</a></div><div class="ttdoc">CR3 Structure.</div><div class="ttdef"><b>Definition:</b> BasicTypes.h:136</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a77e3785963c79b3ff0efdf13efe0be13" name="a77e3785963c79b3ff0efdf13efe0be13"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a77e3785963c79b3ff0efdf13efe0be13">&#9670;&#160;</a></span>EptHookPerformPageHook2()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#a1cb18096b299d23458d3c7b85fd86555">BOOLEAN</a> EptHookPerformPageHook2 </td>
          <td>(</td>
          <td class="paramtype">PVOID&#160;</td>
          <td class="paramname"><em>TargetAddress</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PVOID&#160;</td>
          <td class="paramname"><em>HookFunction</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#aaeec30724d8f0c9d2acd894f41ee06fe">CR3_TYPE</a>&#160;</td>
          <td class="paramname"><em>ProcessCr3</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#a1cb18096b299d23458d3c7b85fd86555">BOOLEAN</a>&#160;</td>
          <td class="paramname"><em>UnsetRead</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#a1cb18096b299d23458d3c7b85fd86555">BOOLEAN</a>&#160;</td>
          <td class="paramname"><em>UnsetWrite</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#a1cb18096b299d23458d3c7b85fd86555">BOOLEAN</a>&#160;</td>
          <td class="paramname"><em>UnsetExecute</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Hook in VMX Root Mode with hidden detours and monitor (A pre-allocated buffer should be available) </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">TargetAddress</td><td></td></tr>
    <tr><td class="paramname">HookFunction</td><td></td></tr>
    <tr><td class="paramname">ProcessCr3</td><td></td></tr>
    <tr><td class="paramname">UnsetRead</td><td></td></tr>
    <tr><td class="paramname">UnsetWrite</td><td></td></tr>
    <tr><td class="paramname">UnsetExecute</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>BOOLEAN</dd></dl>
<p>Hook in VMX Root Mode with hidden detours and monitor (A pre-allocated buffer should be available)</p>
<p>This function returns false in VMX Non-Root Mode if the VM is already initialized This function have to be called through a VMCALL in VMX Root Mode</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">TargetAddress</td><td>The address of function or memory address to be hooked </td></tr>
    <tr><td class="paramname">HookFunction</td><td>The function that will be called when hook triggered </td></tr>
    <tr><td class="paramname">ProcessCr3</td><td>The process cr3 to translate based on that process's cr3 </td></tr>
    <tr><td class="paramname">UnsetRead</td><td>Hook READ Access </td></tr>
    <tr><td class="paramname">UnsetWrite</td><td>Hook WRITE Access </td></tr>
    <tr><td class="paramname">UnsetExecute</td><td>Hook EXECUTE Access </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>BOOLEAN Returns true if the hook was successful or false if there was an error </dd></dl>
<div class="fragment"><div class="line"><span class="lineno">  781</span>{</div>
<div class="line"><span class="lineno">  782</span>    <a class="code hl_typedef" href="hprdbghv_2header_2common_2_state_8h.html#a7f2689338799db6564d2b9cb35d7d596">EPT_PML1_ENTRY</a>          ChangedEntry;</div>
<div class="line"><span class="lineno">  783</span>    INVEPT_DESCRIPTOR       Descriptor;</div>
<div class="line"><span class="lineno">  784</span>    SIZE_T                  PhysicalBaseAddress;</div>
<div class="line"><span class="lineno">  785</span>    PVOID                   VirtualTarget;</div>
<div class="line"><span class="lineno">  786</span>    PVOID                   TargetBuffer;</div>
<div class="line"><span class="lineno">  787</span>    <a class="code hl_typedef" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#aae17ebb9ef7279d026817fb22f8aebe9">UINT64</a>                  TargetAddressInSafeMemory;</div>
<div class="line"><span class="lineno">  788</span>    <a class="code hl_typedef" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#aae17ebb9ef7279d026817fb22f8aebe9">UINT64</a>                  PageOffset;</div>
<div class="line"><span class="lineno">  789</span>    <a class="code hl_typedef" href="hprdbghv_2header_2common_2_state_8h.html#a03c563d9799bc8f374809f48c73c7175">PEPT_PML1_ENTRY</a>         TargetPage;</div>
<div class="line"><span class="lineno">  790</span>    <a class="code hl_struct" href="struct___e_p_t___h_o_o_k_e_d___p_a_g_e___d_e_t_a_i_l.html">PEPT_HOOKED_PAGE_DETAIL</a> HookedPage;</div>
<div class="line"><span class="lineno">  791</span>    <a class="code hl_struct" href="struct___c_r3___t_y_p_e.html">CR3_TYPE</a>                Cr3OfCurrentProcess;</div>
<div class="line"><span class="lineno">  792</span>    PLIST_ENTRY             TempList    = 0;</div>
<div class="line"><span class="lineno">  793</span>    <a class="code hl_struct" href="struct___e_p_t___h_o_o_k_e_d___p_a_g_e___d_e_t_a_i_l.html">PEPT_HOOKED_PAGE_DETAIL</a> HookedEntry = NULL;</div>
<div class="line"><span class="lineno">  794</span> </div>
<div class="line"><span class="lineno">  795</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">  796</span>    <span class="comment">// Translate the page from a physical address to virtual so we can read its memory.</span></div>
<div class="line"><span class="lineno">  797</span>    <span class="comment">// This function will return NULL if the physical address was not already mapped in</span></div>
<div class="line"><span class="lineno">  798</span>    <span class="comment">// virtual memory.</span></div>
<div class="line"><span class="lineno">  799</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">  800</span>    VirtualTarget = <a class="code hl_define" href="hprdbgctrl_2header_2common_8h.html#aa02188de52b66a3aa5e1aecc6bd963ae">PAGE_ALIGN</a>(TargetAddress);</div>
<div class="line"><span class="lineno">  801</span> </div>
<div class="line"><span class="lineno">  802</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">  803</span>    <span class="comment">// Here we have to change the CR3, it is because we are in SYSTEM process</span></div>
<div class="line"><span class="lineno">  804</span>    <span class="comment">// and if the target address is not mapped in SYSTEM address space (e.g</span></div>
<div class="line"><span class="lineno">  805</span>    <span class="comment">// user mode address of another process) then the translation is invalid</span></div>
<div class="line"><span class="lineno">  806</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">  807</span> </div>
<div class="line"><span class="lineno">  808</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">  809</span>    <span class="comment">// Find cr3 of target core</span></div>
<div class="line"><span class="lineno">  810</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">  811</span>    PhysicalBaseAddress = (SIZE_T)<a class="code hl_function" href="build_2bin_2debug_2_s_d_k_2_imports_2_hyper_dbg_vmm_imports_8h.html#aa4c6128ae9e5d96a297990bf5d3e7c5d">VirtualAddressToPhysicalAddressByProcessCr3</a>(VirtualTarget, ProcessCr3);</div>
<div class="line"><span class="lineno">  812</span> </div>
<div class="line"><span class="lineno">  813</span>    <span class="keywordflow">if</span> (!PhysicalBaseAddress)</div>
<div class="line"><span class="lineno">  814</span>    {</div>
<div class="line"><span class="lineno">  815</span>        <a class="code hl_function" href="_callback_8c.html#a68d4847c16adb5d0d6f8a5513a299029">VmmCallbackSetLastError</a>(<a class="code hl_define" href="build_2bin_2debug_2_s_d_k_2_headers_2_error_codes_8h.html#ac1b8dbae6748b88abe05844e42c29952">DEBUGGER_ERROR_INVALID_ADDRESS</a>);</div>
<div class="line"><span class="lineno">  816</span>        <span class="keywordflow">return</span> <a class="code hl_define" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div>
<div class="line"><span class="lineno">  817</span>    }</div>
<div class="line"><span class="lineno">  818</span> </div>
<div class="line"><span class="lineno">  819</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">  820</span>    <span class="comment">// try to see if we can find the address</span></div>
<div class="line"><span class="lineno">  821</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">  822</span>    TempList = &amp;<a class="code hl_variable" href="_global_variables_8h.html#a302f00c62e7ad092a9f44a3aa7452d99">g_EptState</a>-&gt;<a class="code hl_variable" href="struct___e_p_t___s_t_a_t_e.html#a2503c5862b1bb2b779e2185b4097aa15">HookedPagesList</a>;</div>
<div class="line"><span class="lineno">  823</span> </div>
<div class="line"><span class="lineno">  824</span>    <span class="keywordflow">while</span> (&amp;<a class="code hl_variable" href="_global_variables_8h.html#a302f00c62e7ad092a9f44a3aa7452d99">g_EptState</a>-&gt;<a class="code hl_variable" href="struct___e_p_t___s_t_a_t_e.html#a2503c5862b1bb2b779e2185b4097aa15">HookedPagesList</a> != TempList-&gt;Flink)</div>
<div class="line"><span class="lineno">  825</span>    {</div>
<div class="line"><span class="lineno">  826</span>        TempList    = TempList-&gt;Flink;</div>
<div class="line"><span class="lineno">  827</span>        HookedEntry = <a class="code hl_define" href="list_8h.html#adec42d53dc3b3e16ab7a1cd98af1c5fc">CONTAINING_RECORD</a>(TempList, <a class="code hl_struct" href="struct___e_p_t___h_o_o_k_e_d___p_a_g_e___d_e_t_a_i_l.html">EPT_HOOKED_PAGE_DETAIL</a>, PageHookList);</div>
<div class="line"><span class="lineno">  828</span> </div>
<div class="line"><span class="lineno">  829</span>        <span class="keywordflow">if</span> (HookedEntry-&gt;<a class="code hl_variable" href="struct___e_p_t___h_o_o_k_e_d___p_a_g_e___d_e_t_a_i_l.html#afb78ebcdb15c9df1fc20831d93203019">PhysicalBaseAddress</a> == PhysicalBaseAddress)</div>
<div class="line"><span class="lineno">  830</span>        {</div>
<div class="line"><span class="lineno">  831</span>            <span class="comment">//</span></div>
<div class="line"><span class="lineno">  832</span>            <span class="comment">// Means that we find the address and !epthook2 doesn&#39;t support</span></div>
<div class="line"><span class="lineno">  833</span>            <span class="comment">// multiple breakpoints in on page</span></div>
<div class="line"><span class="lineno">  834</span>            <span class="comment">//</span></div>
<div class="line"><span class="lineno">  835</span>            <a class="code hl_function" href="_callback_8c.html#a68d4847c16adb5d0d6f8a5513a299029">VmmCallbackSetLastError</a>(<a class="code hl_define" href="build_2bin_2debug_2_s_d_k_2_headers_2_error_codes_8h.html#a9697a726e353b61b5e02c10395f3f382">DEBUGGER_ERROR_EPT_MULTIPLE_HOOKS_IN_A_SINGLE_PAGE</a>);</div>
<div class="line"><span class="lineno">  836</span>            <span class="keywordflow">return</span> <a class="code hl_define" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div>
<div class="line"><span class="lineno">  837</span>        }</div>
<div class="line"><span class="lineno">  838</span>    }</div>
<div class="line"><span class="lineno">  839</span> </div>
<div class="line"><span class="lineno">  840</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">  841</span>    <span class="comment">// Set target buffer, request buffer from pool manager,</span></div>
<div class="line"><span class="lineno">  842</span>    <span class="comment">// we also need to allocate new page to replace the current page ASAP</span></div>
<div class="line"><span class="lineno">  843</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">  844</span>    TargetBuffer = <a class="code hl_function" href="build_2bin_2debug_2_s_d_k_2_imports_2_hyper_dbg_vmm_imports_8h.html#a7f3b17763776a06c42601f8da4cad5ec">PoolManagerRequestPool</a>(<a class="code hl_enumvalue" href="build_2bin_2debug_2_s_d_k_2_headers_2_data_types_8h.html#ad130f0bae4db97169873223d0aad9a63a09f33e69ad8e184c21efd29fa2fe7380">SPLIT_2MB_PAGING_TO_4KB_PAGE</a>, <a class="code hl_define" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>, <span class="keyword">sizeof</span>(<a class="code hl_struct" href="struct___v_m_m___e_p_t___d_y_n_a_m_i_c___s_p_l_i_t.html">VMM_EPT_DYNAMIC_SPLIT</a>));</div>
<div class="line"><span class="lineno">  845</span> </div>
<div class="line"><span class="lineno">  846</span>    <span class="keywordflow">if</span> (!TargetBuffer)</div>
<div class="line"><span class="lineno">  847</span>    {</div>
<div class="line"><span class="lineno">  848</span>        <a class="code hl_function" href="_callback_8c.html#a68d4847c16adb5d0d6f8a5513a299029">VmmCallbackSetLastError</a>(<a class="code hl_define" href="build_2bin_2debug_2_s_d_k_2_headers_2_error_codes_8h.html#a35966c13fc80dc6d9055d5b7f46f6ef6">DEBUGGER_ERROR_PRE_ALLOCATED_BUFFER_IS_EMPTY</a>);</div>
<div class="line"><span class="lineno">  849</span>        <span class="keywordflow">return</span> <a class="code hl_define" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div>
<div class="line"><span class="lineno">  850</span>    }</div>
<div class="line"><span class="lineno">  851</span> </div>
<div class="line"><span class="lineno">  852</span>    <span class="keywordflow">if</span> (!<a class="code hl_function" href="_ept_8c.html#a186f8a530e93e585a153269cdc103f45">EptSplitLargePage</a>(<a class="code hl_variable" href="_global_variables_8h.html#a302f00c62e7ad092a9f44a3aa7452d99">g_EptState</a>-&gt;<a class="code hl_variable" href="struct___e_p_t___s_t_a_t_e.html#a63cb7b9ebbfafeb6f69caa76f755c7bd">EptPageTable</a>, TargetBuffer, PhysicalBaseAddress))</div>
<div class="line"><span class="lineno">  853</span>    {</div>
<div class="line"><span class="lineno">  854</span>        <a class="code hl_function" href="build_2bin_2debug_2_s_d_k_2_imports_2_hyper_dbg_vmm_imports_8h.html#a959d3b71e4d867f6a1499abc90cb6023">PoolManagerFreePool</a>(TargetBuffer);</div>
<div class="line"><span class="lineno">  855</span> </div>
<div class="line"><span class="lineno">  856</span>        <a class="code hl_define" href="build_2bin_2debug_2_s_d_k_2_imports_2_hyper_dbg_hyper_log_intrinsics_8h.html#a108126279e46f4d46d25abe24da43fdc">LogDebugInfo</a>(<span class="stringliteral">&quot;Err, could not split page for the address : 0x%llx&quot;</span>, PhysicalBaseAddress);</div>
<div class="line"><span class="lineno">  857</span>        <a class="code hl_function" href="_callback_8c.html#a68d4847c16adb5d0d6f8a5513a299029">VmmCallbackSetLastError</a>(<a class="code hl_define" href="build_2bin_2debug_2_s_d_k_2_headers_2_error_codes_8h.html#afa580b4ad142ec96cadfdc5cec58b1b7">DEBUGGER_ERROR_EPT_COULD_NOT_SPLIT_THE_LARGE_PAGE_TO_4KB_PAGES</a>);</div>
<div class="line"><span class="lineno">  858</span>        <span class="keywordflow">return</span> <a class="code hl_define" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div>
<div class="line"><span class="lineno">  859</span>    }</div>
<div class="line"><span class="lineno">  860</span> </div>
<div class="line"><span class="lineno">  861</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">  862</span>    <span class="comment">// Pointer to the page entry in the page table</span></div>
<div class="line"><span class="lineno">  863</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">  864</span>    TargetPage = <a class="code hl_function" href="_ept_8c.html#aca998ecbfe4b433dbb307e5ab1fbcc41">EptGetPml1Entry</a>(<a class="code hl_variable" href="_global_variables_8h.html#a302f00c62e7ad092a9f44a3aa7452d99">g_EptState</a>-&gt;<a class="code hl_variable" href="struct___e_p_t___s_t_a_t_e.html#a63cb7b9ebbfafeb6f69caa76f755c7bd">EptPageTable</a>, PhysicalBaseAddress);</div>
<div class="line"><span class="lineno">  865</span> </div>
<div class="line"><span class="lineno">  866</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">  867</span>    <span class="comment">// Ensure the target is valid</span></div>
<div class="line"><span class="lineno">  868</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">  869</span>    <span class="keywordflow">if</span> (!TargetPage)</div>
<div class="line"><span class="lineno">  870</span>    {</div>
<div class="line"><span class="lineno">  871</span>        <a class="code hl_function" href="build_2bin_2debug_2_s_d_k_2_imports_2_hyper_dbg_vmm_imports_8h.html#a959d3b71e4d867f6a1499abc90cb6023">PoolManagerFreePool</a>(TargetBuffer);</div>
<div class="line"><span class="lineno">  872</span> </div>
<div class="line"><span class="lineno">  873</span>        <a class="code hl_function" href="_callback_8c.html#a68d4847c16adb5d0d6f8a5513a299029">VmmCallbackSetLastError</a>(<a class="code hl_define" href="build_2bin_2debug_2_s_d_k_2_headers_2_error_codes_8h.html#a06398ba01fbfbb3e3acb44a6cd97002c">DEBUGGER_ERROR_EPT_FAILED_TO_GET_PML1_ENTRY_OF_TARGET_ADDRESS</a>);</div>
<div class="line"><span class="lineno">  874</span>        <span class="keywordflow">return</span> <a class="code hl_define" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div>
<div class="line"><span class="lineno">  875</span>    }</div>
<div class="line"><span class="lineno">  876</span> </div>
<div class="line"><span class="lineno">  877</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">  878</span>    <span class="comment">// Save the original permissions of the page</span></div>
<div class="line"><span class="lineno">  879</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">  880</span>    ChangedEntry = *TargetPage;</div>
<div class="line"><span class="lineno">  881</span> </div>
<div class="line"><span class="lineno">  882</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">  883</span>    <span class="comment">// Execution is treated differently</span></div>
<div class="line"><span class="lineno">  884</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">  885</span>    <span class="keywordflow">if</span> (UnsetRead)</div>
<div class="line"><span class="lineno">  886</span>        ChangedEntry.ReadAccess = 0;</div>
<div class="line"><span class="lineno">  887</span>    <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno">  888</span>        ChangedEntry.ReadAccess = 1;</div>
<div class="line"><span class="lineno">  889</span> </div>
<div class="line"><span class="lineno">  890</span>    <span class="keywordflow">if</span> (UnsetWrite)</div>
<div class="line"><span class="lineno">  891</span>        ChangedEntry.WriteAccess = 0;</div>
<div class="line"><span class="lineno">  892</span>    <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno">  893</span>        ChangedEntry.WriteAccess = 1;</div>
<div class="line"><span class="lineno">  894</span> </div>
<div class="line"><span class="lineno">  895</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">  896</span>    <span class="comment">// Save the detail of hooked page to keep track of it</span></div>
<div class="line"><span class="lineno">  897</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">  898</span>    HookedPage = <a class="code hl_function" href="build_2bin_2debug_2_s_d_k_2_imports_2_hyper_dbg_vmm_imports_8h.html#a7f3b17763776a06c42601f8da4cad5ec">PoolManagerRequestPool</a>(<a class="code hl_enumvalue" href="build_2bin_2debug_2_s_d_k_2_headers_2_data_types_8h.html#ad130f0bae4db97169873223d0aad9a63a1c4249f84cf779cd4cdd72ee27de08c1">TRACKING_HOOKED_PAGES</a>, <a class="code hl_define" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>, <span class="keyword">sizeof</span>(<a class="code hl_struct" href="struct___e_p_t___h_o_o_k_e_d___p_a_g_e___d_e_t_a_i_l.html">EPT_HOOKED_PAGE_DETAIL</a>));</div>
<div class="line"><span class="lineno">  899</span> </div>
<div class="line"><span class="lineno">  900</span>    <span class="keywordflow">if</span> (!HookedPage)</div>
<div class="line"><span class="lineno">  901</span>    {</div>
<div class="line"><span class="lineno">  902</span>        <a class="code hl_function" href="build_2bin_2debug_2_s_d_k_2_imports_2_hyper_dbg_vmm_imports_8h.html#a959d3b71e4d867f6a1499abc90cb6023">PoolManagerFreePool</a>(TargetBuffer);</div>
<div class="line"><span class="lineno">  903</span> </div>
<div class="line"><span class="lineno">  904</span>        <a class="code hl_function" href="_callback_8c.html#a68d4847c16adb5d0d6f8a5513a299029">VmmCallbackSetLastError</a>(<a class="code hl_define" href="build_2bin_2debug_2_s_d_k_2_headers_2_error_codes_8h.html#a35966c13fc80dc6d9055d5b7f46f6ef6">DEBUGGER_ERROR_PRE_ALLOCATED_BUFFER_IS_EMPTY</a>);</div>
<div class="line"><span class="lineno">  905</span>        <span class="keywordflow">return</span> <a class="code hl_define" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div>
<div class="line"><span class="lineno">  906</span>    }</div>
<div class="line"><span class="lineno">  907</span> </div>
<div class="line"><span class="lineno">  908</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">  909</span>    <span class="comment">// Save the virtual address</span></div>
<div class="line"><span class="lineno">  910</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">  911</span>    HookedPage-&gt;<a class="code hl_variable" href="struct___e_p_t___h_o_o_k_e_d___p_a_g_e___d_e_t_a_i_l.html#a3464acbaf76a38d67558d8ff3bee342f">VirtualAddress</a> = TargetAddress;</div>
<div class="line"><span class="lineno">  912</span> </div>
<div class="line"><span class="lineno">  913</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">  914</span>    <span class="comment">// Save the physical address</span></div>
<div class="line"><span class="lineno">  915</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">  916</span>    HookedPage-&gt;<a class="code hl_variable" href="struct___e_p_t___h_o_o_k_e_d___p_a_g_e___d_e_t_a_i_l.html#afb78ebcdb15c9df1fc20831d93203019">PhysicalBaseAddress</a> = PhysicalBaseAddress;</div>
<div class="line"><span class="lineno">  917</span> </div>
<div class="line"><span class="lineno">  918</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">  919</span>    <span class="comment">// Fake page content physical address</span></div>
<div class="line"><span class="lineno">  920</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">  921</span>    HookedPage-&gt;<a class="code hl_variable" href="struct___e_p_t___h_o_o_k_e_d___p_a_g_e___d_e_t_a_i_l.html#a325edda9c8d49c2f44319627d86d4a88">PhysicalBaseAddressOfFakePageContents</a> = (SIZE_T)<a class="code hl_function" href="build_2bin_2debug_2_s_d_k_2_imports_2_hyper_dbg_vmm_imports_8h.html#a9c177c471eaf6be292a94d8112fa3f36">VirtualAddressToPhysicalAddress</a>(&amp;HookedPage-&gt;<a class="code hl_variable" href="struct___e_p_t___h_o_o_k_e_d___p_a_g_e___d_e_t_a_i_l.html#a4c523ca3a1b46bf34681abfec4fef75e">FakePageContents</a>[0]) / <a class="code hl_define" href="hprdbgctrl_2header_2common_8h.html#a7d467c1d283fdfa1f2081ba1e0d01b6e">PAGE_SIZE</a>;</div>
<div class="line"><span class="lineno">  922</span> </div>
<div class="line"><span class="lineno">  923</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">  924</span>    <span class="comment">// Save the entry address</span></div>
<div class="line"><span class="lineno">  925</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">  926</span>    HookedPage-&gt;<a class="code hl_variable" href="struct___e_p_t___h_o_o_k_e_d___p_a_g_e___d_e_t_a_i_l.html#ac7782253bd8fa0ff92bce2b0f5ff269d">EntryAddress</a> = TargetPage;</div>
<div class="line"><span class="lineno">  927</span> </div>
<div class="line"><span class="lineno">  928</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">  929</span>    <span class="comment">// Save the original entry</span></div>
<div class="line"><span class="lineno">  930</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">  931</span>    HookedPage-&gt;<a class="code hl_variable" href="struct___e_p_t___h_o_o_k_e_d___p_a_g_e___d_e_t_a_i_l.html#acacf76428d2801be17ffb3e8b05e9374">OriginalEntry</a> = *TargetPage;</div>
<div class="line"><span class="lineno">  932</span> </div>
<div class="line"><span class="lineno">  933</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">  934</span>    <span class="comment">// Check if the hook relates to the write condition</span></div>
<div class="line"><span class="lineno">  935</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">  936</span>    <span class="keywordflow">if</span> (UnsetWrite)</div>
<div class="line"><span class="lineno">  937</span>    {</div>
<div class="line"><span class="lineno">  938</span>        HookedPage-&gt;<a class="code hl_variable" href="struct___e_p_t___h_o_o_k_e_d___p_a_g_e___d_e_t_a_i_l.html#a5db4424bb300aec4ffabd7bfc5964417">IsMonitorToWriteOnPages</a> = <a class="code hl_define" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;</div>
<div class="line"><span class="lineno">  939</span>    }</div>
<div class="line"><span class="lineno">  940</span> </div>
<div class="line"><span class="lineno">  941</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">  942</span>    <span class="comment">// If it&#39;s Execution hook then we have to set extra fields</span></div>
<div class="line"><span class="lineno">  943</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">  944</span>    <span class="keywordflow">if</span> (UnsetExecute)</div>
<div class="line"><span class="lineno">  945</span>    {</div>
<div class="line"><span class="lineno">  946</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno">  947</span>        <span class="comment">// Show that entry has hidden hooks for execution</span></div>
<div class="line"><span class="lineno">  948</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno">  949</span>        HookedPage-&gt;<a class="code hl_variable" href="struct___e_p_t___h_o_o_k_e_d___p_a_g_e___d_e_t_a_i_l.html#a40f5606fe57295d12c430ce08421e544">IsExecutionHook</a> = <a class="code hl_define" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;</div>
<div class="line"><span class="lineno">  950</span> </div>
<div class="line"><span class="lineno">  951</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno">  952</span>        <span class="comment">// In execution hook, we have to make sure to unset read, write because</span></div>
<div class="line"><span class="lineno">  953</span>        <span class="comment">// an EPT violation should occur for these cases and we can swap the original page</span></div>
<div class="line"><span class="lineno">  954</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno">  955</span>        ChangedEntry.ReadAccess    = 0;</div>
<div class="line"><span class="lineno">  956</span>        ChangedEntry.WriteAccess   = 0;</div>
<div class="line"><span class="lineno">  957</span>        ChangedEntry.ExecuteAccess = 1;</div>
<div class="line"><span class="lineno">  958</span> </div>
<div class="line"><span class="lineno">  959</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno">  960</span>        <span class="comment">// Also set the current pfn to fake page</span></div>
<div class="line"><span class="lineno">  961</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno">  962</span>        ChangedEntry.PageFrameNumber = HookedPage-&gt;<a class="code hl_variable" href="struct___e_p_t___h_o_o_k_e_d___p_a_g_e___d_e_t_a_i_l.html#a325edda9c8d49c2f44319627d86d4a88">PhysicalBaseAddressOfFakePageContents</a>;</div>
<div class="line"><span class="lineno">  963</span> </div>
<div class="line"><span class="lineno">  964</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno">  965</span>        <span class="comment">// Switch to target process</span></div>
<div class="line"><span class="lineno">  966</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno">  967</span>        Cr3OfCurrentProcess = <a class="code hl_function" href="build_2bin_2debug_2_s_d_k_2_imports_2_hyper_dbg_vmm_imports_8h.html#ad711f252793324cdb878442d74d9098f">SwitchToProcessMemoryLayoutByCr3</a>(ProcessCr3);</div>
<div class="line"><span class="lineno">  968</span> </div>
<div class="line"><span class="lineno">  969</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno">  970</span>        <span class="comment">// Copy the content to the fake page</span></div>
<div class="line"><span class="lineno">  971</span>        <span class="comment">// The following line can&#39;t be used in user mode addresses</span></div>
<div class="line"><span class="lineno">  972</span>        <span class="comment">// RtlCopyBytes(&amp;HookedPage-&gt;FakePageContents, VirtualTarget, PAGE_SIZE);</span></div>
<div class="line"><span class="lineno">  973</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno">  974</span>        <a class="code hl_function" href="build_2bin_2debug_2_s_d_k_2_imports_2_hyper_dbg_vmm_imports_8h.html#a2f6df53976f17e73cc27e73ebcc8156a">MemoryMapperReadMemorySafe</a>(VirtualTarget, &amp;HookedPage-&gt;<a class="code hl_variable" href="struct___e_p_t___h_o_o_k_e_d___p_a_g_e___d_e_t_a_i_l.html#a4c523ca3a1b46bf34681abfec4fef75e">FakePageContents</a>, <a class="code hl_define" href="hprdbgctrl_2header_2common_8h.html#a7d467c1d283fdfa1f2081ba1e0d01b6e">PAGE_SIZE</a>);</div>
<div class="line"><span class="lineno">  975</span> </div>
<div class="line"><span class="lineno">  976</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno">  977</span>        <span class="comment">// Restore to original process</span></div>
<div class="line"><span class="lineno">  978</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno">  979</span>        <a class="code hl_function" href="build_2bin_2debug_2_s_d_k_2_imports_2_hyper_dbg_vmm_imports_8h.html#a271e5e657ab23c69e078979359903d94">SwitchToPreviousProcess</a>(Cr3OfCurrentProcess);</div>
<div class="line"><span class="lineno">  980</span> </div>
<div class="line"><span class="lineno">  981</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno">  982</span>        <span class="comment">// Compute new offset of target offset into a safe bufferr</span></div>
<div class="line"><span class="lineno">  983</span>        <span class="comment">// It will be used to compute the length of the detours</span></div>
<div class="line"><span class="lineno">  984</span>        <span class="comment">// address because we might have a user mode code</span></div>
<div class="line"><span class="lineno">  985</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno">  986</span>        TargetAddressInSafeMemory = &amp;HookedPage-&gt;<a class="code hl_variable" href="struct___e_p_t___h_o_o_k_e_d___p_a_g_e___d_e_t_a_i_l.html#a4c523ca3a1b46bf34681abfec4fef75e">FakePageContents</a>;</div>
<div class="line"><span class="lineno">  987</span>        TargetAddressInSafeMemory = <a class="code hl_define" href="hprdbgctrl_2header_2common_8h.html#aa02188de52b66a3aa5e1aecc6bd963ae">PAGE_ALIGN</a>(TargetAddressInSafeMemory);</div>
<div class="line"><span class="lineno">  988</span>        PageOffset                = <a class="code hl_define" href="hprdbghv_2header_2common_2common_8h.html#a1ebb2ec82baedeecf55e15778b8dd0aa">PAGE_OFFSET</a>(TargetAddress);</div>
<div class="line"><span class="lineno">  989</span>        TargetAddressInSafeMemory = TargetAddressInSafeMemory + PageOffset;</div>
<div class="line"><span class="lineno">  990</span> </div>
<div class="line"><span class="lineno">  991</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno">  992</span>        <span class="comment">// Make sure if handler function is valid or if it&#39;s default</span></div>
<div class="line"><span class="lineno">  993</span>        <span class="comment">// then we set it to the default hanlder</span></div>
<div class="line"><span class="lineno">  994</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno">  995</span>        <span class="keywordflow">if</span> (HookFunction == NULL)</div>
<div class="line"><span class="lineno">  996</span>        {</div>
<div class="line"><span class="lineno">  997</span>            HookFunction = <a class="code hl_function" href="_inline_asm_8h.html#ab0e909131196cbec54246cc925e89251">AsmGeneralDetourHook</a>;</div>
<div class="line"><span class="lineno">  998</span>        }</div>
<div class="line"><span class="lineno">  999</span> </div>
<div class="line"><span class="lineno"> 1000</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1001</span>        <span class="comment">// Create Hook</span></div>
<div class="line"><span class="lineno"> 1002</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1003</span>        <span class="keywordflow">if</span> (!<a class="code hl_function" href="_ept_hook_8c.html#a1a97cf8a3d1243edf02539139bbfb617">EptHookInstructionMemory</a>(HookedPage, ProcessCr3, TargetAddress, TargetAddressInSafeMemory, HookFunction))</div>
<div class="line"><span class="lineno"> 1004</span>        {</div>
<div class="line"><span class="lineno"> 1005</span>            <a class="code hl_function" href="build_2bin_2debug_2_s_d_k_2_imports_2_hyper_dbg_vmm_imports_8h.html#a959d3b71e4d867f6a1499abc90cb6023">PoolManagerFreePool</a>(TargetBuffer);</div>
<div class="line"><span class="lineno"> 1006</span>            <a class="code hl_function" href="build_2bin_2debug_2_s_d_k_2_imports_2_hyper_dbg_vmm_imports_8h.html#a959d3b71e4d867f6a1499abc90cb6023">PoolManagerFreePool</a>(HookedPage);</div>
<div class="line"><span class="lineno"> 1007</span> </div>
<div class="line"><span class="lineno"> 1008</span>            <a class="code hl_function" href="_callback_8c.html#a68d4847c16adb5d0d6f8a5513a299029">VmmCallbackSetLastError</a>(<a class="code hl_define" href="build_2bin_2debug_2_s_d_k_2_headers_2_error_codes_8h.html#aa080da83ab0982e6d13150d580e7387b">DEBUGGER_ERROR_COULD_NOT_BUILD_THE_EPT_HOOK</a>);</div>
<div class="line"><span class="lineno"> 1009</span>            <span class="keywordflow">return</span> <a class="code hl_define" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div>
<div class="line"><span class="lineno"> 1010</span>        }</div>
<div class="line"><span class="lineno"> 1011</span>    }</div>
<div class="line"><span class="lineno"> 1012</span> </div>
<div class="line"><span class="lineno"> 1013</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1014</span>    <span class="comment">// Save the modified entry</span></div>
<div class="line"><span class="lineno"> 1015</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1016</span>    HookedPage-&gt;<a class="code hl_variable" href="struct___e_p_t___h_o_o_k_e_d___p_a_g_e___d_e_t_a_i_l.html#a87563a62e848638473d980314b01d28b">ChangedEntry</a> = ChangedEntry;</div>
<div class="line"><span class="lineno"> 1017</span> </div>
<div class="line"><span class="lineno"> 1018</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1019</span>    <span class="comment">// Add it to the list</span></div>
<div class="line"><span class="lineno"> 1020</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1021</span>    <a class="code hl_function" href="list_8h.html#a77df31a5e6a1be59d08b93e9cb028f22">InsertHeadList</a>(&amp;<a class="code hl_variable" href="_global_variables_8h.html#a302f00c62e7ad092a9f44a3aa7452d99">g_EptState</a>-&gt;<a class="code hl_variable" href="struct___e_p_t___s_t_a_t_e.html#a2503c5862b1bb2b779e2185b4097aa15">HookedPagesList</a>, &amp;(HookedPage-&gt;<a class="code hl_variable" href="struct___e_p_t___h_o_o_k_e_d___p_a_g_e___d_e_t_a_i_l.html#a4450bd220c3bce95443a102aa90fc93b">PageHookList</a>));</div>
<div class="line"><span class="lineno"> 1022</span> </div>
<div class="line"><span class="lineno"> 1023</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1024</span>    <span class="comment">// if not launched, there is no need to modify it on a safe environment</span></div>
<div class="line"><span class="lineno"> 1025</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1026</span>    <span class="comment">/*</span></div>
<div class="line"><span class="lineno"> 1027</span><span class="comment">    if (!g_GuestState[LogicalCoreIndex].HasLaunched)</span></div>
<div class="line"><span class="lineno"> 1028</span><span class="comment">    {</span></div>
<div class="line"><span class="lineno"> 1029</span><span class="comment">        //</span></div>
<div class="line"><span class="lineno"> 1030</span><span class="comment">        // Apply the hook to EPT</span></div>
<div class="line"><span class="lineno"> 1031</span><span class="comment">        //</span></div>
<div class="line"><span class="lineno"> 1032</span><span class="comment">        TargetPage-&gt;AsUInt = ChangedEntry.AsUInt;</span></div>
<div class="line"><span class="lineno"> 1033</span><span class="comment">    }</span></div>
<div class="line"><span class="lineno"> 1034</span><span class="comment">    else</span></div>
<div class="line"><span class="lineno"> 1035</span><span class="comment">    {*/</span></div>
<div class="line"><span class="lineno"> 1036</span> </div>
<div class="line"><span class="lineno"> 1037</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1038</span>    <span class="comment">// Apply the hook to EPT</span></div>
<div class="line"><span class="lineno"> 1039</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1040</span>    <a class="code hl_function" href="_ept_8c.html#aad64c2c08fba48ccdb0a34d5c1dee97f">EptSetPML1AndInvalidateTLB</a>(TargetPage, ChangedEntry, InveptSingleContext);</div>
<div class="line"><span class="lineno"> 1041</span>    <span class="comment">//}</span></div>
<div class="line"><span class="lineno"> 1042</span> </div>
<div class="line"><span class="lineno"> 1043</span>    <span class="keywordflow">return</span> <a class="code hl_define" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;</div>
<div class="line"><span class="lineno"> 1044</span>}</div>
<div class="ttc" id="a_ept_8c_html_a186f8a530e93e585a153269cdc103f45"><div class="ttname"><a href="_ept_8c.html#a186f8a530e93e585a153269cdc103f45">EptSplitLargePage</a></div><div class="ttdeci">BOOLEAN EptSplitLargePage(PVMM_EPT_PAGE_TABLE EptPageTable, PVOID PreAllocatedBuffer, SIZE_T PhysicalAddress)</div><div class="ttdoc">Split 2MB (LargePage) into 4kb pages.</div><div class="ttdef"><b>Definition:</b> Ept.c:299</div></div>
<div class="ttc" id="a_ept_8c_html_aad64c2c08fba48ccdb0a34d5c1dee97f"><div class="ttname"><a href="_ept_8c.html#aad64c2c08fba48ccdb0a34d5c1dee97f">EptSetPML1AndInvalidateTLB</a></div><div class="ttdeci">_Use_decl_annotations_ VOID EptSetPML1AndInvalidateTLB(PEPT_PML1_ENTRY EntryAddress, EPT_PML1_ENTRY EntryValue, INVEPT_TYPE InvalidationType)</div><div class="ttdoc">This function set the specific PML1 entry in a spinlock protected area then invalidate the TLB.</div><div class="ttdef"><b>Definition:</b> Ept.c:904</div></div>
<div class="ttc" id="a_ept_8c_html_aca998ecbfe4b433dbb307e5ab1fbcc41"><div class="ttname"><a href="_ept_8c.html#aca998ecbfe4b433dbb307e5ab1fbcc41">EptGetPml1Entry</a></div><div class="ttdeci">PEPT_PML1_ENTRY EptGetPml1Entry(PVMM_EPT_PAGE_TABLE EptPageTable, SIZE_T PhysicalAddress)</div><div class="ttdoc">Get the PML1 entry for this physical address if the page is split.</div><div class="ttdef"><b>Definition:</b> Ept.c:142</div></div>
<div class="ttc" id="a_ept_hook_8c_html_a1a97cf8a3d1243edf02539139bbfb617"><div class="ttname"><a href="_ept_hook_8c.html#a1a97cf8a3d1243edf02539139bbfb617">EptHookInstructionMemory</a></div><div class="ttdeci">BOOLEAN EptHookInstructionMemory(PEPT_HOOKED_PAGE_DETAIL Hook, CR3_TYPE ProcessCr3, PVOID TargetFunction, PVOID TargetFunctionInSafeMemory, PVOID HookFunction)</div><div class="ttdoc">Hook ins.</div><div class="ttdef"><b>Definition:</b> EptHook.c:631</div></div>
<div class="ttc" id="a_inline_asm_8h_html_ab0e909131196cbec54246cc925e89251"><div class="ttname"><a href="_inline_asm_8h.html#ab0e909131196cbec54246cc925e89251">AsmGeneralDetourHook</a></div><div class="ttdeci">void AsmGeneralDetourHook(void)</div><div class="ttdoc">Detour hook handler.</div></div>
<div class="ttc" id="abuild_2bin_2debug_2_s_d_k_2_headers_2_error_codes_8h_html_a06398ba01fbfbb3e3acb44a6cd97002c"><div class="ttname"><a href="build_2bin_2debug_2_s_d_k_2_headers_2_error_codes_8h.html#a06398ba01fbfbb3e3acb44a6cd97002c">DEBUGGER_ERROR_EPT_FAILED_TO_GET_PML1_ENTRY_OF_TARGET_ADDRESS</a></div><div class="ttdeci">#define DEBUGGER_ERROR_EPT_FAILED_TO_GET_PML1_ENTRY_OF_TARGET_ADDRESS</div><div class="ttdoc">error, failed to get PML1 entry of the target address</div><div class="ttdef"><b>Definition:</b> ErrorCodes.h:264</div></div>
<div class="ttc" id="abuild_2bin_2debug_2_s_d_k_2_headers_2_error_codes_8h_html_a35966c13fc80dc6d9055d5b7f46f6ef6"><div class="ttname"><a href="build_2bin_2debug_2_s_d_k_2_headers_2_error_codes_8h.html#a35966c13fc80dc6d9055d5b7f46f6ef6">DEBUGGER_ERROR_PRE_ALLOCATED_BUFFER_IS_EMPTY</a></div><div class="ttdeci">#define DEBUGGER_ERROR_PRE_ALLOCATED_BUFFER_IS_EMPTY</div><div class="ttdoc">error, there is no pre-allocated buffer</div><div class="ttdef"><b>Definition:</b> ErrorCodes.h:251</div></div>
<div class="ttc" id="abuild_2bin_2debug_2_s_d_k_2_headers_2_error_codes_8h_html_a9697a726e353b61b5e02c10395f3f382"><div class="ttname"><a href="build_2bin_2debug_2_s_d_k_2_headers_2_error_codes_8h.html#a9697a726e353b61b5e02c10395f3f382">DEBUGGER_ERROR_EPT_MULTIPLE_HOOKS_IN_A_SINGLE_PAGE</a></div><div class="ttdeci">#define DEBUGGER_ERROR_EPT_MULTIPLE_HOOKS_IN_A_SINGLE_PAGE</div><div class="ttdoc">error, multiple EPT Hooks or Monitors are applied on a single page</div><div class="ttdef"><b>Definition:</b> ErrorCodes.h:270</div></div>
<div class="ttc" id="abuild_2bin_2debug_2_s_d_k_2_headers_2_error_codes_8h_html_aa080da83ab0982e6d13150d580e7387b"><div class="ttname"><a href="build_2bin_2debug_2_s_d_k_2_headers_2_error_codes_8h.html#aa080da83ab0982e6d13150d580e7387b">DEBUGGER_ERROR_COULD_NOT_BUILD_THE_EPT_HOOK</a></div><div class="ttdeci">#define DEBUGGER_ERROR_COULD_NOT_BUILD_THE_EPT_HOOK</div><div class="ttdoc">error, could not build the EPT Hook</div><div class="ttdef"><b>Definition:</b> ErrorCodes.h:276</div></div>
<div class="ttc" id="abuild_2bin_2debug_2_s_d_k_2_headers_2_error_codes_8h_html_afa580b4ad142ec96cadfdc5cec58b1b7"><div class="ttname"><a href="build_2bin_2debug_2_s_d_k_2_headers_2_error_codes_8h.html#afa580b4ad142ec96cadfdc5cec58b1b7">DEBUGGER_ERROR_EPT_COULD_NOT_SPLIT_THE_LARGE_PAGE_TO_4KB_PAGES</a></div><div class="ttdeci">#define DEBUGGER_ERROR_EPT_COULD_NOT_SPLIT_THE_LARGE_PAGE_TO_4KB_PAGES</div><div class="ttdoc">error, in the EPT handler, it could not split the 2MB pages to 512 entries of 4 KB pages</div><div class="ttdef"><b>Definition:</b> ErrorCodes.h:258</div></div>
<div class="ttc" id="abuild_2bin_2debug_2_s_d_k_2_imports_2_hyper_dbg_vmm_imports_8h_html_a271e5e657ab23c69e078979359903d94"><div class="ttname"><a href="build_2bin_2debug_2_s_d_k_2_imports_2_hyper_dbg_vmm_imports_8h.html#a271e5e657ab23c69e078979359903d94">SwitchToPreviousProcess</a></div><div class="ttdeci">IMPORT_EXPORT_VMM VOID SwitchToPreviousProcess(_In_ CR3_TYPE PreviousProcess)</div></div>
<div class="ttc" id="abuild_2bin_2debug_2_s_d_k_2_imports_2_hyper_dbg_vmm_imports_8h_html_a2f6df53976f17e73cc27e73ebcc8156a"><div class="ttname"><a href="build_2bin_2debug_2_s_d_k_2_imports_2_hyper_dbg_vmm_imports_8h.html#a2f6df53976f17e73cc27e73ebcc8156a">MemoryMapperReadMemorySafe</a></div><div class="ttdeci">IMPORT_EXPORT_VMM BOOLEAN MemoryMapperReadMemorySafe(_In_ UINT64 VaAddressToRead, _Inout_ PVOID BufferToSaveMemory, _In_ SIZE_T SizeToRead)</div></div>
<div class="ttc" id="abuild_2bin_2debug_2_s_d_k_2_imports_2_hyper_dbg_vmm_imports_8h_html_a7f3b17763776a06c42601f8da4cad5ec"><div class="ttname"><a href="build_2bin_2debug_2_s_d_k_2_imports_2_hyper_dbg_vmm_imports_8h.html#a7f3b17763776a06c42601f8da4cad5ec">PoolManagerRequestPool</a></div><div class="ttdeci">IMPORT_EXPORT_VMM UINT64 PoolManagerRequestPool(POOL_ALLOCATION_INTENTION Intention, BOOLEAN RequestNewPool, UINT32 Size)</div><div class="ttdoc">This function should be called from vmx-root in order to get a pool from the list.</div><div class="ttdef"><b>Definition:</b> PoolManager.c:234</div></div>
<div class="ttc" id="abuild_2bin_2debug_2_s_d_k_2_imports_2_hyper_dbg_vmm_imports_8h_html_a959d3b71e4d867f6a1499abc90cb6023"><div class="ttname"><a href="build_2bin_2debug_2_s_d_k_2_imports_2_hyper_dbg_vmm_imports_8h.html#a959d3b71e4d867f6a1499abc90cb6023">PoolManagerFreePool</a></div><div class="ttdeci">IMPORT_EXPORT_VMM BOOLEAN PoolManagerFreePool(UINT64 AddressToFree)</div><div class="ttdoc">This function set a pool flag to be freed, and it will be freed on the next IOCTL when it's safe to r...</div><div class="ttdef"><b>Definition:</b> PoolManager.c:157</div></div>
<div class="ttc" id="abuild_2bin_2debug_2_s_d_k_2_imports_2_hyper_dbg_vmm_imports_8h_html_ad711f252793324cdb878442d74d9098f"><div class="ttname"><a href="build_2bin_2debug_2_s_d_k_2_imports_2_hyper_dbg_vmm_imports_8h.html#ad711f252793324cdb878442d74d9098f">SwitchToProcessMemoryLayoutByCr3</a></div><div class="ttdeci">IMPORT_EXPORT_VMM CR3_TYPE SwitchToProcessMemoryLayoutByCr3(_In_ CR3_TYPE TargetCr3)</div></div>
<div class="ttc" id="ahprdbgctrl_2header_2common_8h_html_a7d467c1d283fdfa1f2081ba1e0d01b6e"><div class="ttname"><a href="hprdbgctrl_2header_2common_8h.html#a7d467c1d283fdfa1f2081ba1e0d01b6e">PAGE_SIZE</a></div><div class="ttdeci">#define PAGE_SIZE</div><div class="ttdoc">Size of each page (4096 bytes)</div><div class="ttdef"><b>Definition:</b> common.h:59</div></div>
<div class="ttc" id="ahprdbghv_2header_2common_2common_8h_html_a1ebb2ec82baedeecf55e15778b8dd0aa"><div class="ttname"><a href="hprdbghv_2header_2common_2common_8h.html#a1ebb2ec82baedeecf55e15778b8dd0aa">PAGE_OFFSET</a></div><div class="ttdeci">#define PAGE_OFFSET(Va)</div><div class="ttdoc">Offset from a page's 4096 bytes.</div><div class="ttdef"><b>Definition:</b> Common.h:207</div></div>
<div class="ttc" id="alist_8h_html_a77df31a5e6a1be59d08b93e9cb028f22"><div class="ttname"><a href="list_8h.html#a77df31a5e6a1be59d08b93e9cb028f22">InsertHeadList</a></div><div class="ttdeci">void InsertHeadList(PLIST_ENTRY ListHead, PLIST_ENTRY Entry)</div></div>
<div class="ttc" id="astruct___e_p_t___h_o_o_k_e_d___p_a_g_e___d_e_t_a_i_l_html_a325edda9c8d49c2f44319627d86d4a88"><div class="ttname"><a href="struct___e_p_t___h_o_o_k_e_d___p_a_g_e___d_e_t_a_i_l.html#a325edda9c8d49c2f44319627d86d4a88">_EPT_HOOKED_PAGE_DETAIL::PhysicalBaseAddressOfFakePageContents</a></div><div class="ttdeci">SIZE_T PhysicalBaseAddressOfFakePageContents</div><div class="ttdoc">The base address of the page with fake contents. Used to swap page with fake contents when a hook is ...</div><div class="ttdef"><b>Definition:</b> State.h:121</div></div>
<div class="ttc" id="astruct___e_p_t___h_o_o_k_e_d___p_a_g_e___d_e_t_a_i_l_html_a40f5606fe57295d12c430ce08421e544"><div class="ttname"><a href="struct___e_p_t___h_o_o_k_e_d___p_a_g_e___d_e_t_a_i_l.html#a40f5606fe57295d12c430ce08421e544">_EPT_HOOKED_PAGE_DETAIL::IsExecutionHook</a></div><div class="ttdeci">BOOLEAN IsExecutionHook</div><div class="ttdoc">This field shows whether the hook contains a hidden hook for execution or not.</div><div class="ttdef"><b>Definition:</b> State.h:147</div></div>
<div class="ttc" id="astruct___e_p_t___h_o_o_k_e_d___p_a_g_e___d_e_t_a_i_l_html_a4450bd220c3bce95443a102aa90fc93b"><div class="ttname"><a href="struct___e_p_t___h_o_o_k_e_d___p_a_g_e___d_e_t_a_i_l.html#a4450bd220c3bce95443a102aa90fc93b">_EPT_HOOKED_PAGE_DETAIL::PageHookList</a></div><div class="ttdeci">LIST_ENTRY PageHookList</div><div class="ttdoc">Linked list entires for each page hook.</div><div class="ttdef"><b>Definition:</b> State.h:98</div></div>
<div class="ttc" id="astruct___e_p_t___h_o_o_k_e_d___p_a_g_e___d_e_t_a_i_l_html_a4c523ca3a1b46bf34681abfec4fef75e"><div class="ttname"><a href="struct___e_p_t___h_o_o_k_e_d___p_a_g_e___d_e_t_a_i_l.html#a4c523ca3a1b46bf34681abfec4fef75e">_EPT_HOOKED_PAGE_DETAIL::FakePageContents</a></div><div class="ttdeci">CHAR FakePageContents[PAGE_SIZE]</div><div class="ttdef"><b>Definition:</b> State.h:93</div></div>
<div class="ttc" id="astruct___e_p_t___h_o_o_k_e_d___p_a_g_e___d_e_t_a_i_l_html_a5db4424bb300aec4ffabd7bfc5964417"><div class="ttname"><a href="struct___e_p_t___h_o_o_k_e_d___p_a_g_e___d_e_t_a_i_l.html#a5db4424bb300aec4ffabd7bfc5964417">_EPT_HOOKED_PAGE_DETAIL::IsMonitorToWriteOnPages</a></div><div class="ttdeci">BOOLEAN IsMonitorToWriteOnPages</div><div class="ttdoc">If TRUE, this hook relates to the write violation of the events.</div><div class="ttdef"><b>Definition:</b> State.h:158</div></div>
<div class="ttc" id="astruct___e_p_t___h_o_o_k_e_d___p_a_g_e___d_e_t_a_i_l_html_a87563a62e848638473d980314b01d28b"><div class="ttname"><a href="struct___e_p_t___h_o_o_k_e_d___p_a_g_e___d_e_t_a_i_l.html#a87563a62e848638473d980314b01d28b">_EPT_HOOKED_PAGE_DETAIL::ChangedEntry</a></div><div class="ttdeci">EPT_PML1_ENTRY ChangedEntry</div><div class="ttdoc">The original page entry. Will be copied back when the hook is remove from the page.</div><div class="ttdef"><b>Definition:</b> State.h:137</div></div>
<div class="ttc" id="astruct___e_p_t___h_o_o_k_e_d___p_a_g_e___d_e_t_a_i_l_html_ac7782253bd8fa0ff92bce2b0f5ff269d"><div class="ttname"><a href="struct___e_p_t___h_o_o_k_e_d___p_a_g_e___d_e_t_a_i_l.html#ac7782253bd8fa0ff92bce2b0f5ff269d">_EPT_HOOKED_PAGE_DETAIL::EntryAddress</a></div><div class="ttdeci">PEPT_PML1_ENTRY EntryAddress</div><div class="ttdef"><b>Definition:</b> State.h:126</div></div>
<div class="ttc" id="astruct___e_p_t___h_o_o_k_e_d___p_a_g_e___d_e_t_a_i_l_html_acacf76428d2801be17ffb3e8b05e9374"><div class="ttname"><a href="struct___e_p_t___h_o_o_k_e_d___p_a_g_e___d_e_t_a_i_l.html#acacf76428d2801be17ffb3e8b05e9374">_EPT_HOOKED_PAGE_DETAIL::OriginalEntry</a></div><div class="ttdeci">EPT_PML1_ENTRY OriginalEntry</div><div class="ttdoc">The original page entry. Will be copied back when the hook is removed from the page.</div><div class="ttdef"><b>Definition:</b> State.h:132</div></div>
<div class="ttc" id="astruct___e_p_t___h_o_o_k_e_d___p_a_g_e___d_e_t_a_i_l_html_afb78ebcdb15c9df1fc20831d93203019"><div class="ttname"><a href="struct___e_p_t___h_o_o_k_e_d___p_a_g_e___d_e_t_a_i_l.html#afb78ebcdb15c9df1fc20831d93203019">_EPT_HOOKED_PAGE_DETAIL::PhysicalBaseAddress</a></div><div class="ttdeci">SIZE_T PhysicalBaseAddress</div><div class="ttdoc">The base address of the page. Used to find this structure in the list of page hooks when a hook is hi...</div><div class="ttdef"><b>Definition:</b> State.h:115</div></div>
<div class="ttc" id="astruct___e_p_t___s_t_a_t_e_html_a63cb7b9ebbfafeb6f69caa76f755c7bd"><div class="ttname"><a href="struct___e_p_t___s_t_a_t_e.html#a63cb7b9ebbfafeb6f69caa76f755c7bd">_EPT_STATE::EptPageTable</a></div><div class="ttdeci">PVMM_EPT_PAGE_TABLE EptPageTable</div><div class="ttdef"><b>Definition:</b> Ept.h:151</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="acac4eff03b2197ae43e4c13f382e20b5" name="acac4eff03b2197ae43e4c13f382e20b5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#acac4eff03b2197ae43e4c13f382e20b5">&#9670;&#160;</a></span>EptHookRemoveEntryAndFreePoolFromEptHook2sDetourList()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#a1cb18096b299d23458d3c7b85fd86555">BOOLEAN</a> EptHookRemoveEntryAndFreePoolFromEptHook2sDetourList </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#aae17ebb9ef7279d026817fb22f8aebe9">UINT64</a>&#160;</td>
          <td class="paramname"><em>Address</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Remove an entry from g_EptHook2sDetourListHead. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">Address</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>BOOLEAN</dd></dl>
<p>Remove an entry from g_EptHook2sDetourListHead.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">Address</td><td>Address to remove </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>BOOLEAN TRUE if successfully removed and false if not found </dd></dl>
<div class="fragment"><div class="line"><span class="lineno"> 1291</span>{</div>
<div class="line"><span class="lineno"> 1292</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1293</span>    <span class="comment">// Iterate through the list of hooked pages details to find</span></div>
<div class="line"><span class="lineno"> 1294</span>    <span class="comment">// the entry in the list</span></div>
<div class="line"><span class="lineno"> 1295</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1296</span>    <a class="code hl_define" href="_meta_macros_8h.html#ae6305b9ffbb1d946674b7b98431a67e9">LIST_FOR_EACH_LINK</a>(<a class="code hl_variable" href="_global_variables_8h.html#a90f5a18f43567010690d8d7927619fa0">g_EptHook2sDetourListHead</a>, <a class="code hl_struct" href="struct___h_i_d_d_e_n___h_o_o_k_s___d_e_t_o_u_r___d_e_t_a_i_l_s.html">HIDDEN_HOOKS_DETOUR_DETAILS</a>, OtherHooksList, CurrentHookedDetails)</div>
<div class="line"><span class="lineno"> 1297</span>    {</div>
<div class="line"><span class="lineno"> 1298</span>        <span class="keywordflow">if</span> (CurrentHookedDetails-&gt;HookedFunctionAddress == <a class="code hl_variable" href="build_2bin_2debug_2_s_d_k_2_imports_2_hyper_dbg_script_imports_8h.html#a3f7c5b71d899e923be0a80d4ac7902fe">Address</a>)</div>
<div class="line"><span class="lineno"> 1299</span>        {</div>
<div class="line"><span class="lineno"> 1300</span>            <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1301</span>            <span class="comment">// We found the address, we should remove it and add it for</span></div>
<div class="line"><span class="lineno"> 1302</span>            <span class="comment">// future deallocation</span></div>
<div class="line"><span class="lineno"> 1303</span>            <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1304</span>            <a class="code hl_function" href="list_8h.html#a1384c9ab335080c2fdc01fc7eca7673c">RemoveEntryList</a>(&amp;CurrentHookedDetails-&gt;OtherHooksList);</div>
<div class="line"><span class="lineno"> 1305</span> </div>
<div class="line"><span class="lineno"> 1306</span>            <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1307</span>            <span class="comment">// Free the pool in next ioctl</span></div>
<div class="line"><span class="lineno"> 1308</span>            <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1309</span>            <span class="keywordflow">if</span> (!<a class="code hl_function" href="build_2bin_2debug_2_s_d_k_2_imports_2_hyper_dbg_vmm_imports_8h.html#a959d3b71e4d867f6a1499abc90cb6023">PoolManagerFreePool</a>(CurrentHookedDetails))</div>
<div class="line"><span class="lineno"> 1310</span>            {</div>
<div class="line"><span class="lineno"> 1311</span>                <a class="code hl_define" href="build_2bin_2debug_2_s_d_k_2_imports_2_hyper_dbg_hyper_log_intrinsics_8h.html#a459b19922fecfbb9438dd56b66930d16">LogError</a>(<span class="stringliteral">&quot;Err, something goes wrong, the pool not found in the list of previously allocated pools by pool manager&quot;</span>);</div>
<div class="line"><span class="lineno"> 1312</span>            }</div>
<div class="line"><span class="lineno"> 1313</span>            <span class="keywordflow">return</span> <a class="code hl_define" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;</div>
<div class="line"><span class="lineno"> 1314</span>        }</div>
<div class="line"><span class="lineno"> 1315</span>    }</div>
<div class="line"><span class="lineno"> 1316</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1317</span>    <span class="comment">// No entry found !</span></div>
<div class="line"><span class="lineno"> 1318</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1319</span>    <span class="keywordflow">return</span> <a class="code hl_define" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div>
<div class="line"><span class="lineno"> 1320</span>}</div>
<div class="ttc" id="abuild_2bin_2debug_2_s_d_k_2_imports_2_hyper_dbg_script_imports_8h_html_a3f7c5b71d899e923be0a80d4ac7902fe"><div class="ttname"><a href="build_2bin_2debug_2_s_d_k_2_imports_2_hyper_dbg_script_imports_8h.html#a3f7c5b71d899e923be0a80d4ac7902fe">Address</a></div><div class="ttdeci">UINT64 Address</div><div class="ttdef"><b>Definition:</b> HyperDbgScriptImports.h:56</div></div>
<div class="ttc" id="alist_8h_html_a1384c9ab335080c2fdc01fc7eca7673c"><div class="ttname"><a href="list_8h.html#a1384c9ab335080c2fdc01fc7eca7673c">RemoveEntryList</a></div><div class="ttdeci">BOOLEAN RemoveEntryList(PLIST_ENTRY Entry)</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="acd59638727980bbd58fb4665ffce9091" name="acd59638727980bbd58fb4665ffce9091"></a>
<h2 class="memtitle"><span class="permalink"><a href="#acd59638727980bbd58fb4665ffce9091">&#9670;&#160;</a></span>EptHookRestoreAllHooksToOrginalEntry()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#a7f319bfc2492a2136964194204e7a8cf">VOID</a> EptHookRestoreAllHooksToOrginalEntry </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Remove all hooks from the hooked pages lists (Should be called in vmx-root) </p>
<dl class="section return"><dt>Returns</dt><dd>VOID</dd></dl>
<p>Remove all hooks from the hooked pages lists (Should be called in vmx-root)</p>
<dl class="section warning"><dt>Warning</dt><dd>This function won't remove entries from LIST_ENTRY, just invalidate the paging, use EptHookUnHookAll instead</dd></dl>
<dl class="section return"><dt>Returns</dt><dd>VOID </dd></dl>
<div class="fragment"><div class="line"><span class="lineno">  514</span>{</div>
<div class="line"><span class="lineno">  515</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">  516</span>    <span class="comment">// Should be called from vmx-root, for calling from vmx non-root use the corresponding VMCALL</span></div>
<div class="line"><span class="lineno">  517</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">  518</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="_vmx_8c.html#a21a5facaf10e8fbeb70dd00942e51ef1">VmxGetCurrentExecutionMode</a>() == <a class="code hl_define" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>)</div>
<div class="line"><span class="lineno">  519</span>    {</div>
<div class="line"><span class="lineno">  520</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">  521</span>    }</div>
<div class="line"><span class="lineno">  522</span> </div>
<div class="line"><span class="lineno">  523</span>    <a class="code hl_define" href="_meta_macros_8h.html#ae6305b9ffbb1d946674b7b98431a67e9">LIST_FOR_EACH_LINK</a>(<a class="code hl_variable" href="_global_variables_8h.html#a302f00c62e7ad092a9f44a3aa7452d99">g_EptState</a>-&gt;<a class="code hl_variable" href="struct___e_p_t___s_t_a_t_e.html#a2503c5862b1bb2b779e2185b4097aa15">HookedPagesList</a>, <a class="code hl_struct" href="struct___e_p_t___h_o_o_k_e_d___p_a_g_e___d_e_t_a_i_l.html">EPT_HOOKED_PAGE_DETAIL</a>, PageHookList, CurrEntity)</div>
<div class="line"><span class="lineno">  524</span>    {</div>
<div class="line"><span class="lineno">  525</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno">  526</span>        <span class="comment">// Undo the hook on the EPT table</span></div>
<div class="line"><span class="lineno">  527</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno">  528</span>        <a class="code hl_function" href="_ept_8c.html#aad64c2c08fba48ccdb0a34d5c1dee97f">EptSetPML1AndInvalidateTLB</a>(CurrEntity-&gt;EntryAddress, CurrEntity-&gt;OriginalEntry, InveptSingleContext);</div>
<div class="line"><span class="lineno">  529</span>    }</div>
<div class="line"><span class="lineno">  530</span>}</div>
</div><!-- fragment -->
</div>
</div>
<a id="aba59e4d31f5cf37d9436d73933e8158c" name="aba59e4d31f5cf37d9436d73933e8158c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aba59e4d31f5cf37d9436d73933e8158c">&#9670;&#160;</a></span>EptHookRestoreSingleHookToOrginalEntry()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#a1cb18096b299d23458d3c7b85fd86555">BOOLEAN</a> EptHookRestoreSingleHookToOrginalEntry </td>
          <td>(</td>
          <td class="paramtype">SIZE_T&#160;</td>
          <td class="paramname"><em>PhysicalAddress</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Remove a special hook from the hooked pages lists. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">PhysicalAddress</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>BOOLEAN</dd></dl>
<p>Remove a special hook from the hooked pages lists.</p>
<dl class="section warning"><dt>Warning</dt><dd>This function won't remove entries from LIST_ENTRY, just invalidate the paging, use EptHookUnHookSingleAddress instead</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">PhysicalAddress</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>BOOLEAN Return false if there was an error or returns true if it was successfull </dd></dl>
<div class="fragment"><div class="line"><span class="lineno">  479</span>{</div>
<div class="line"><span class="lineno">  480</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">  481</span>    <span class="comment">// Should be called from vmx-root, for calling from vmx non-root use the corresponding VMCALL</span></div>
<div class="line"><span class="lineno">  482</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">  483</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="_vmx_8c.html#a21a5facaf10e8fbeb70dd00942e51ef1">VmxGetCurrentExecutionMode</a>() == <a class="code hl_define" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>)</div>
<div class="line"><span class="lineno">  484</span>    {</div>
<div class="line"><span class="lineno">  485</span>        <span class="keywordflow">return</span> <a class="code hl_define" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div>
<div class="line"><span class="lineno">  486</span>    }</div>
<div class="line"><span class="lineno">  487</span> </div>
<div class="line"><span class="lineno">  488</span>    <a class="code hl_struct" href="struct___e_p_t___h_o_o_k_e_d___p_a_g_e___d_e_t_a_i_l.html">EPT_HOOKED_PAGE_DETAIL</a> * HookedEntry = {0};</div>
<div class="line"><span class="lineno">  489</span> </div>
<div class="line"><span class="lineno">  490</span>    <span class="keywordflow">if</span> (EptHookFindByPhysAddress(<a class="code hl_define" href="hprdbgctrl_2header_2common_8h.html#aa02188de52b66a3aa5e1aecc6bd963ae">PAGE_ALIGN</a>(PhysicalAddress), HookedEntry) == <a class="code hl_define" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a> &amp;&amp; HookedEntry != NULL)</div>
<div class="line"><span class="lineno">  491</span>    {</div>
<div class="line"><span class="lineno">  492</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno">  493</span>        <span class="comment">// Undo the hook on the EPT table</span></div>
<div class="line"><span class="lineno">  494</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno">  495</span>        <a class="code hl_function" href="_ept_8c.html#aad64c2c08fba48ccdb0a34d5c1dee97f">EptSetPML1AndInvalidateTLB</a>(HookedEntry-&gt;<a class="code hl_variable" href="struct___e_p_t___h_o_o_k_e_d___p_a_g_e___d_e_t_a_i_l.html#ac7782253bd8fa0ff92bce2b0f5ff269d">EntryAddress</a>, HookedEntry-&gt;<a class="code hl_variable" href="struct___e_p_t___h_o_o_k_e_d___p_a_g_e___d_e_t_a_i_l.html#acacf76428d2801be17ffb3e8b05e9374">OriginalEntry</a>, InveptSingleContext);</div>
<div class="line"><span class="lineno">  496</span> </div>
<div class="line"><span class="lineno">  497</span>        <span class="keywordflow">return</span> <a class="code hl_define" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;</div>
<div class="line"><span class="lineno">  498</span>    }</div>
<div class="line"><span class="lineno">  499</span> </div>
<div class="line"><span class="lineno">  500</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">  501</span>    <span class="comment">// Nothing found, probably the list is not found</span></div>
<div class="line"><span class="lineno">  502</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">  503</span>    <span class="keywordflow">return</span> <a class="code hl_define" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div>
<div class="line"><span class="lineno">  504</span>}</div>
</div><!-- fragment -->
</div>
</div>
<a id="ac8845ca75f3b4c267d3542d20621f547" name="ac8845ca75f3b4c267d3542d20621f547"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac8845ca75f3b4c267d3542d20621f547">&#9670;&#160;</a></span>EptHookUnHookAll()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#a7f319bfc2492a2136964194204e7a8cf">VOID</a> EptHookUnHookAll </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Remove all hooks from the hooked pages lists. </p>
<dl class="section return"><dt>Returns</dt><dd>VOID</dd></dl>
<p>Remove all hooks from the hooked pages lists.</p>
<dl class="section return"><dt>Returns</dt><dd>VOID </dd></dl>
<div class="fragment"><div class="line"><span class="lineno"> 1604</span>{</div>
<div class="line"><span class="lineno"> 1605</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1606</span>    <span class="comment">// Should be called from vmx non-root</span></div>
<div class="line"><span class="lineno"> 1607</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1608</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="_vmx_8c.html#a21a5facaf10e8fbeb70dd00942e51ef1">VmxGetCurrentExecutionMode</a>() == <a class="code hl_define" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>)</div>
<div class="line"><span class="lineno"> 1609</span>    {</div>
<div class="line"><span class="lineno"> 1610</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno"> 1611</span>    }</div>
<div class="line"><span class="lineno"> 1612</span> </div>
<div class="line"><span class="lineno"> 1613</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1614</span>    <span class="comment">// Remove it in all the cores</span></div>
<div class="line"><span class="lineno"> 1615</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1616</span>    KeGenericCallDpc(<a class="code hl_function" href="hprdbghv_2code_2broadcast_2_dpc_routines_8c.html#ac0df5b089250515279b8c348e0817977">DpcRoutineRemoveHookAndInvalidateAllEntriesOnAllCores</a>, 0x0);</div>
<div class="line"><span class="lineno"> 1617</span> </div>
<div class="line"><span class="lineno"> 1618</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1619</span>    <span class="comment">// In the case of unhooking all pages, we remove the hooked</span></div>
<div class="line"><span class="lineno"> 1620</span>    <span class="comment">// from EPT table in vmx-root and at last, we need to deallocate</span></div>
<div class="line"><span class="lineno"> 1621</span>    <span class="comment">// it from the buffers</span></div>
<div class="line"><span class="lineno"> 1622</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1623</span> </div>
<div class="line"><span class="lineno"> 1624</span>    <a class="code hl_define" href="_meta_macros_8h.html#ae6305b9ffbb1d946674b7b98431a67e9">LIST_FOR_EACH_LINK</a>(<a class="code hl_variable" href="_global_variables_8h.html#a302f00c62e7ad092a9f44a3aa7452d99">g_EptState</a>-&gt;<a class="code hl_variable" href="struct___e_p_t___s_t_a_t_e.html#a2503c5862b1bb2b779e2185b4097aa15">HookedPagesList</a>, <a class="code hl_struct" href="struct___e_p_t___h_o_o_k_e_d___p_a_g_e___d_e_t_a_i_l.html">EPT_HOOKED_PAGE_DETAIL</a>, PageHookList, CurrEntity)</div>
<div class="line"><span class="lineno"> 1625</span>    {</div>
<div class="line"><span class="lineno"> 1626</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1627</span>        <span class="comment">// Now that we removed this hidden detours hook, it is</span></div>
<div class="line"><span class="lineno"> 1628</span>        <span class="comment">// time to remove it from g_EptHook2sDetourListHead</span></div>
<div class="line"><span class="lineno"> 1629</span>        <span class="comment">// if the hook is detours</span></div>
<div class="line"><span class="lineno"> 1630</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1631</span>        <span class="keywordflow">if</span> (!CurrEntity-&gt;IsHiddenBreakpoint)</div>
<div class="line"><span class="lineno"> 1632</span>        {</div>
<div class="line"><span class="lineno"> 1633</span>            <a class="code hl_function" href="_ept_hook_8c.html#acac4eff03b2197ae43e4c13f382e20b5">EptHookRemoveEntryAndFreePoolFromEptHook2sDetourList</a>(CurrEntity-&gt;VirtualAddress);</div>
<div class="line"><span class="lineno"> 1634</span>        }</div>
<div class="line"><span class="lineno"> 1635</span> </div>
<div class="line"><span class="lineno"> 1636</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1637</span>        <span class="comment">// As we are in vmx-root here, we add the hooked entry to the list</span></div>
<div class="line"><span class="lineno"> 1638</span>        <span class="comment">// of pools that will be deallocated on next IOCTL</span></div>
<div class="line"><span class="lineno"> 1639</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1640</span>        <span class="keywordflow">if</span> (!<a class="code hl_function" href="build_2bin_2debug_2_s_d_k_2_imports_2_hyper_dbg_vmm_imports_8h.html#a959d3b71e4d867f6a1499abc90cb6023">PoolManagerFreePool</a>(CurrEntity))</div>
<div class="line"><span class="lineno"> 1641</span>        {</div>
<div class="line"><span class="lineno"> 1642</span>            <a class="code hl_define" href="build_2bin_2debug_2_s_d_k_2_imports_2_hyper_dbg_hyper_log_intrinsics_8h.html#a459b19922fecfbb9438dd56b66930d16">LogError</a>(<span class="stringliteral">&quot;Err, something goes wrong, the pool not found in the list of previously allocated pools by pool manager&quot;</span>);</div>
<div class="line"><span class="lineno"> 1643</span>        }</div>
<div class="line"><span class="lineno"> 1644</span>    }</div>
<div class="line"><span class="lineno"> 1645</span>}</div>
<div class="ttc" id="a_ept_hook_8c_html_acac4eff03b2197ae43e4c13f382e20b5"><div class="ttname"><a href="_ept_hook_8c.html#acac4eff03b2197ae43e4c13f382e20b5">EptHookRemoveEntryAndFreePoolFromEptHook2sDetourList</a></div><div class="ttdeci">BOOLEAN EptHookRemoveEntryAndFreePoolFromEptHook2sDetourList(UINT64 Address)</div><div class="ttdoc">Remove the enrty from g_EptHook2sDetourListHead in the case of !epthook2 details.</div><div class="ttdef"><b>Definition:</b> EptHook.c:1290</div></div>
<div class="ttc" id="ahprdbghv_2code_2broadcast_2_dpc_routines_8c_html_ac0df5b089250515279b8c348e0817977"><div class="ttname"><a href="hprdbghv_2code_2broadcast_2_dpc_routines_8c.html#ac0df5b089250515279b8c348e0817977">DpcRoutineRemoveHookAndInvalidateAllEntriesOnAllCores</a></div><div class="ttdeci">VOID DpcRoutineRemoveHookAndInvalidateAllEntriesOnAllCores(KDPC *Dpc, PVOID DeferredContext, PVOID SystemArgument1, PVOID SystemArgument2)</div><div class="ttdoc">The broadcast function which removes all the hooks and invalidate TLB.</div><div class="ttdef"><b>Definition:</b> DpcRoutines.c:1572</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a24ce2115ab4514ec8eed08d0911b64d6" name="a24ce2115ab4514ec8eed08d0911b64d6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a24ce2115ab4514ec8eed08d0911b64d6">&#9670;&#160;</a></span>EptHookUnHookSingleAddress()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#a1cb18096b299d23458d3c7b85fd86555">BOOLEAN</a> EptHookUnHookSingleAddress </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#aae17ebb9ef7279d026817fb22f8aebe9">UINT64</a>&#160;</td>
          <td class="paramname"><em>VirtualAddress</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#aae17ebb9ef7279d026817fb22f8aebe9">UINT64</a>&#160;</td>
          <td class="paramname"><em>PhysAddress</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#ae1e6edbbc26d6fbc71a90190d0266018">UINT32</a>&#160;</td>
          <td class="paramname"><em>ProcessId</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Remove single hook from the hooked pages list and invalidate TLB. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">VirtualAddress</td><td></td></tr>
    <tr><td class="paramname">PhysAddress</td><td></td></tr>
    <tr><td class="paramname">ProcessId</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>BOOLEAN</dd></dl>
<p>Should be called from vmx non-root</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">VirtualAddress</td><td>Virtual address to unhook </td></tr>
    <tr><td class="paramname">PhysAddress</td><td>Physical address to unhook (optional) </td></tr>
    <tr><td class="paramname">ProcessId</td><td>The process id of target process</td></tr>
  </table>
  </dd>
</dl>
<p>in unhooking for some hooks only physical address is availables</p>
<dl class="section return"><dt>Returns</dt><dd>BOOLEAN If unhook was successful it returns true or if it was not successful returns false </dd></dl>
<div class="fragment"><div class="line"><span class="lineno"> 1538</span>{</div>
<div class="line"><span class="lineno"> 1539</span>    SIZE_T PhysicalAddress;</div>
<div class="line"><span class="lineno"> 1540</span> </div>
<div class="line"><span class="lineno"> 1541</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1542</span>    <span class="comment">// Should be called from vmx non-root</span></div>
<div class="line"><span class="lineno"> 1543</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1544</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="_vmx_8c.html#a21a5facaf10e8fbeb70dd00942e51ef1">VmxGetCurrentExecutionMode</a>() == <a class="code hl_define" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>)</div>
<div class="line"><span class="lineno"> 1545</span>    {</div>
<div class="line"><span class="lineno"> 1546</span>        <span class="keywordflow">return</span> <a class="code hl_define" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div>
<div class="line"><span class="lineno"> 1547</span>    }</div>
<div class="line"><span class="lineno"> 1548</span> </div>
<div class="line"><span class="lineno"> 1549</span>    <span class="keywordflow">if</span> (ProcessId == <a class="code hl_define" href="build_2bin_2debug_2_s_d_k_2_headers_2_constants_8h.html#ab3bb4c0d2a847e96e2988afd99c82074">DEBUGGER_EVENT_APPLY_TO_ALL_PROCESSES</a> || ProcessId == 0)</div>
<div class="line"><span class="lineno"> 1550</span>    {</div>
<div class="line"><span class="lineno"> 1551</span>        ProcessId = PsGetCurrentProcessId();</div>
<div class="line"><span class="lineno"> 1552</span>    }</div>
<div class="line"><span class="lineno"> 1553</span> </div>
<div class="line"><span class="lineno"> 1554</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1555</span>    <span class="comment">// Check if the physical address is available or not</span></div>
<div class="line"><span class="lineno"> 1556</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1557</span>    <span class="keywordflow">if</span> (PhysAddress == NULL)</div>
<div class="line"><span class="lineno"> 1558</span>    {</div>
<div class="line"><span class="lineno"> 1559</span>        PhysicalAddress = <a class="code hl_define" href="hprdbgctrl_2header_2common_8h.html#aa02188de52b66a3aa5e1aecc6bd963ae">PAGE_ALIGN</a>(<a class="code hl_function" href="build_2bin_2debug_2_s_d_k_2_imports_2_hyper_dbg_vmm_imports_8h.html#adb0d4df682039d23559162b1aa2bd1a2">VirtualAddressToPhysicalAddressByProcessId</a>(VirtualAddress, ProcessId));</div>
<div class="line"><span class="lineno"> 1560</span>    }</div>
<div class="line"><span class="lineno"> 1561</span>    <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno"> 1562</span>    {</div>
<div class="line"><span class="lineno"> 1563</span>        PhysicalAddress = <a class="code hl_define" href="hprdbgctrl_2header_2common_8h.html#aa02188de52b66a3aa5e1aecc6bd963ae">PAGE_ALIGN</a>(PhysAddress);</div>
<div class="line"><span class="lineno"> 1564</span>    }</div>
<div class="line"><span class="lineno"> 1565</span> </div>
<div class="line"><span class="lineno"> 1566</span>    <a class="code hl_define" href="_meta_macros_8h.html#ae6305b9ffbb1d946674b7b98431a67e9">LIST_FOR_EACH_LINK</a>(<a class="code hl_variable" href="_global_variables_8h.html#a302f00c62e7ad092a9f44a3aa7452d99">g_EptState</a>-&gt;<a class="code hl_variable" href="struct___e_p_t___s_t_a_t_e.html#a2503c5862b1bb2b779e2185b4097aa15">HookedPagesList</a>, <a class="code hl_struct" href="struct___e_p_t___h_o_o_k_e_d___p_a_g_e___d_e_t_a_i_l.html">EPT_HOOKED_PAGE_DETAIL</a>, PageHookList, CurrEntity)</div>
<div class="line"><span class="lineno"> 1567</span>    {</div>
<div class="line"><span class="lineno"> 1568</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1569</span>        <span class="comment">// Check if it&#39;s a hidden breakpoint or hidden detours</span></div>
<div class="line"><span class="lineno"> 1570</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1571</span>        <span class="keywordflow">if</span> (CurrEntity-&gt;IsHiddenBreakpoint)</div>
<div class="line"><span class="lineno"> 1572</span>        {</div>
<div class="line"><span class="lineno"> 1573</span>            <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1574</span>            <span class="comment">// It&#39;s a hidden breakpoint</span></div>
<div class="line"><span class="lineno"> 1575</span>            <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1576</span>            <span class="keywordflow">return</span> <a class="code hl_function" href="_ept_hook_8c.html#a306251376f5053ae69db0b13c3628b4e">EptHookUnHookSingleAddressHiddenBreakpoint</a>(CurrEntity, VirtualAddress);</div>
<div class="line"><span class="lineno"> 1577</span>        }</div>
<div class="line"><span class="lineno"> 1578</span>        <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno"> 1579</span>        {</div>
<div class="line"><span class="lineno"> 1580</span>            <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1581</span>            <span class="comment">// It&#39;s either a hidden detours or a monitor (read/write) entry</span></div>
<div class="line"><span class="lineno"> 1582</span>            <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1583</span>            <span class="keywordflow">if</span> (CurrEntity-&gt;PhysicalBaseAddress == PhysicalAddress)</div>
<div class="line"><span class="lineno"> 1584</span>            {</div>
<div class="line"><span class="lineno"> 1585</span>                <span class="keywordflow">return</span> <a class="code hl_function" href="_ept_hook_8c.html#adb9948249f757e97fea745b0c0d8f9b0">EptHookUnHookSingleAddressDetours</a>(CurrEntity);</div>
<div class="line"><span class="lineno"> 1586</span>            }</div>
<div class="line"><span class="lineno"> 1587</span>        }</div>
<div class="line"><span class="lineno"> 1588</span>    }</div>
<div class="line"><span class="lineno"> 1589</span> </div>
<div class="line"><span class="lineno"> 1590</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1591</span>    <span class="comment">// Nothing found , probably the list is not found</span></div>
<div class="line"><span class="lineno"> 1592</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1593</span>    <span class="keywordflow">return</span> <a class="code hl_define" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div>
<div class="line"><span class="lineno"> 1594</span>}</div>
<div class="ttc" id="a_ept_hook_8c_html_a306251376f5053ae69db0b13c3628b4e"><div class="ttname"><a href="_ept_hook_8c.html#a306251376f5053ae69db0b13c3628b4e">EptHookUnHookSingleAddressHiddenBreakpoint</a></div><div class="ttdeci">BOOLEAN EptHookUnHookSingleAddressHiddenBreakpoint(PEPT_HOOKED_PAGE_DETAIL HookedEntry, UINT64 VirtualAddress)</div><div class="ttdoc">Remove single hook of hidden breakpoint type.</div><div class="ttdef"><b>Definition:</b> EptHook.c:1404</div></div>
<div class="ttc" id="a_ept_hook_8c_html_adb9948249f757e97fea745b0c0d8f9b0"><div class="ttname"><a href="_ept_hook_8c.html#adb9948249f757e97fea745b0c0d8f9b0">EptHookUnHookSingleAddressDetours</a></div><div class="ttdeci">BOOLEAN EptHookUnHookSingleAddressDetours(PEPT_HOOKED_PAGE_DETAIL HookedEntry)</div><div class="ttdoc">Remove single hook of detours type.</div><div class="ttdef"><b>Definition:</b> EptHook.c:1363</div></div>
<div class="ttc" id="abuild_2bin_2debug_2_s_d_k_2_headers_2_constants_8h_html_ab3bb4c0d2a847e96e2988afd99c82074"><div class="ttname"><a href="build_2bin_2debug_2_s_d_k_2_headers_2_constants_8h.html#ab3bb4c0d2a847e96e2988afd99c82074">DEBUGGER_EVENT_APPLY_TO_ALL_PROCESSES</a></div><div class="ttdeci">#define DEBUGGER_EVENT_APPLY_TO_ALL_PROCESSES</div><div class="ttdoc">Apply the event to all the processes.</div><div class="ttdef"><b>Definition:</b> Constants.h:557</div></div>
<div class="ttc" id="abuild_2bin_2debug_2_s_d_k_2_imports_2_hyper_dbg_vmm_imports_8h_html_adb0d4df682039d23559162b1aa2bd1a2"><div class="ttname"><a href="build_2bin_2debug_2_s_d_k_2_imports_2_hyper_dbg_vmm_imports_8h.html#adb0d4df682039d23559162b1aa2bd1a2">VirtualAddressToPhysicalAddressByProcessId</a></div><div class="ttdeci">IMPORT_EXPORT_VMM UINT64 VirtualAddressToPhysicalAddressByProcessId(_In_ PVOID VirtualAddress, _In_ UINT32 ProcessId)</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a018ba30cbafd5ebc786414637eb7b8f3" name="a018ba30cbafd5ebc786414637eb7b8f3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a018ba30cbafd5ebc786414637eb7b8f3">&#9670;&#160;</a></span>SyscallHookConfigureEFER()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#a7f319bfc2492a2136964194204e7a8cf">VOID</a> SyscallHookConfigureEFER </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="hprdbghv_2header_2common_2_state_8h.html#ac81d4d9bd1e8dd24918e667b56b67b7e">VIRTUAL_MACHINE_STATE</a> *&#160;</td>
          <td class="paramname"><em>VCpu</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#a1cb18096b299d23458d3c7b85fd86555">BOOLEAN</a>&#160;</td>
          <td class="paramname"><em>EnableEFERSyscallHook</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function enables or disables EFER syscall hoo. </p>
<p>This function should be called for the first time that we want to enable EFER hook because after calling this function EFER MSR is loaded from GUEST_EFER instead of loading from the regular EFER MSR.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">VCpu</td><td>The virtual processor's state </td></tr>
    <tr><td class="paramname">EnableEFERSyscallHook</td><td>Determines whether we want to enable syscall hook or disable syscall hook </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>VOID </dd></dl>
<div class="fragment"><div class="line"><span class="lineno">   32</span>{</div>
<div class="line"><span class="lineno">   33</span>    IA32_EFER_REGISTER      MsrValue;</div>
<div class="line"><span class="lineno">   34</span>    IA32_VMX_BASIC_REGISTER VmxBasicMsr     = {0};</div>
<div class="line"><span class="lineno">   35</span>    <a class="code hl_typedef" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#ae1e6edbbc26d6fbc71a90190d0266018">UINT32</a>                  VmEntryControls = 0;</div>
<div class="line"><span class="lineno">   36</span>    <a class="code hl_typedef" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#ae1e6edbbc26d6fbc71a90190d0266018">UINT32</a>                  VmExitControls  = 0;</div>
<div class="line"><span class="lineno">   37</span> </div>
<div class="line"><span class="lineno">   38</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">   39</span>    <span class="comment">// Reading IA32_VMX_BASIC_MSR</span></div>
<div class="line"><span class="lineno">   40</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">   41</span>    VmxBasicMsr.AsUInt = __readmsr(IA32_VMX_BASIC);</div>
<div class="line"><span class="lineno">   42</span> </div>
<div class="line"><span class="lineno">   43</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">   44</span>    <span class="comment">// Read previous VM-Entry and VM-Exit controls</span></div>
<div class="line"><span class="lineno">   45</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">   46</span>    __vmx_vmread(VMCS_CTRL_VMENTRY_CONTROLS, &amp;VmEntryControls);</div>
<div class="line"><span class="lineno">   47</span>    __vmx_vmread(VMCS_CTRL_PRIMARY_VMEXIT_CONTROLS, &amp;VmExitControls);</div>
<div class="line"><span class="lineno">   48</span> </div>
<div class="line"><span class="lineno">   49</span>    MsrValue.AsUInt = __readmsr(IA32_EFER);</div>
<div class="line"><span class="lineno">   50</span> </div>
<div class="line"><span class="lineno">   51</span>    <span class="keywordflow">if</span> (EnableEFERSyscallHook)</div>
<div class="line"><span class="lineno">   52</span>    {</div>
<div class="line"><span class="lineno">   53</span>        MsrValue.SyscallEnable = <a class="code hl_define" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div>
<div class="line"><span class="lineno">   54</span> </div>
<div class="line"><span class="lineno">   55</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno">   56</span>        <span class="comment">// Set VM-Entry controls to load EFER</span></div>
<div class="line"><span class="lineno">   57</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno">   58</span>        __vmx_vmwrite(VMCS_CTRL_VMENTRY_CONTROLS, <a class="code hl_function" href="_hv_8c.html#af4b5fbb4d7aab890383c5ea30789e265">HvAdjustControls</a>(VmEntryControls | <a class="code hl_define" href="_vmx_8h.html#a92eb09bb4e3344efcdb3616970da1cf4">VM_ENTRY_LOAD_IA32_EFER</a>, VmxBasicMsr.VmxControls ? IA32_VMX_TRUE_ENTRY_CTLS : IA32_VMX_ENTRY_CTLS));</div>
<div class="line"><span class="lineno">   59</span> </div>
<div class="line"><span class="lineno">   60</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno">   61</span>        <span class="comment">// Set VM-Exit controls to save EFER</span></div>
<div class="line"><span class="lineno">   62</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno">   63</span>        __vmx_vmwrite(VMCS_CTRL_PRIMARY_VMEXIT_CONTROLS, <a class="code hl_function" href="_hv_8c.html#af4b5fbb4d7aab890383c5ea30789e265">HvAdjustControls</a>(VmExitControls | <a class="code hl_define" href="_vmx_8h.html#a90a6b8fc528e099c6f0c614d09ad9931">VM_EXIT_SAVE_IA32_EFER</a>, VmxBasicMsr.VmxControls ? IA32_VMX_TRUE_EXIT_CTLS : IA32_VMX_EXIT_CTLS));</div>
<div class="line"><span class="lineno">   64</span> </div>
<div class="line"><span class="lineno">   65</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno">   66</span>        <span class="comment">// Set the GUEST EFER to use this value as the EFER</span></div>
<div class="line"><span class="lineno">   67</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno">   68</span>        __vmx_vmwrite(VMCS_GUEST_EFER, MsrValue.AsUInt);</div>
<div class="line"><span class="lineno">   69</span> </div>
<div class="line"><span class="lineno">   70</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno">   71</span>        <span class="comment">// also, we have to set exception bitmap to cause vm-exit on #UDs</span></div>
<div class="line"><span class="lineno">   72</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno">   73</span>        <a class="code hl_function" href="_hv_8c.html#ad9fc64fae8bbc000a6e8949e78547027">HvSetExceptionBitmap</a>(VCpu, <a class="code hl_enumvalue" href="build_2bin_2debug_2_s_d_k_2_headers_2_events_8h.html#af9640e4f7e36f7a6bf7c56e30a860349a33fbb650006f5fc9e3080438e80de36c">EXCEPTION_VECTOR_UNDEFINED_OPCODE</a>);</div>
<div class="line"><span class="lineno">   74</span>    }</div>
<div class="line"><span class="lineno">   75</span>    <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno">   76</span>    {</div>
<div class="line"><span class="lineno">   77</span>        MsrValue.SyscallEnable = <a class="code hl_define" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;</div>
<div class="line"><span class="lineno">   78</span> </div>
<div class="line"><span class="lineno">   79</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno">   80</span>        <span class="comment">// Set VM-Entry controls to load EFER</span></div>
<div class="line"><span class="lineno">   81</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno">   82</span>        __vmx_vmwrite(VMCS_CTRL_VMENTRY_CONTROLS, <a class="code hl_function" href="_hv_8c.html#af4b5fbb4d7aab890383c5ea30789e265">HvAdjustControls</a>(VmEntryControls &amp; ~<a class="code hl_define" href="_vmx_8h.html#a92eb09bb4e3344efcdb3616970da1cf4">VM_ENTRY_LOAD_IA32_EFER</a>, VmxBasicMsr.VmxControls ? IA32_VMX_TRUE_ENTRY_CTLS : IA32_VMX_ENTRY_CTLS));</div>
<div class="line"><span class="lineno">   83</span> </div>
<div class="line"><span class="lineno">   84</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno">   85</span>        <span class="comment">// Set VM-Exit controls to save EFER</span></div>
<div class="line"><span class="lineno">   86</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno">   87</span>        __vmx_vmwrite(VMCS_CTRL_PRIMARY_VMEXIT_CONTROLS, <a class="code hl_function" href="_hv_8c.html#af4b5fbb4d7aab890383c5ea30789e265">HvAdjustControls</a>(VmExitControls &amp; ~<a class="code hl_define" href="_vmx_8h.html#a90a6b8fc528e099c6f0c614d09ad9931">VM_EXIT_SAVE_IA32_EFER</a>, VmxBasicMsr.VmxControls ? IA32_VMX_TRUE_EXIT_CTLS : IA32_VMX_EXIT_CTLS));</div>
<div class="line"><span class="lineno">   88</span> </div>
<div class="line"><span class="lineno">   89</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno">   90</span>        <span class="comment">// Set the GUEST EFER to use this value as the EFER</span></div>
<div class="line"><span class="lineno">   91</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno">   92</span>        __vmx_vmwrite(VMCS_GUEST_EFER, MsrValue.AsUInt);</div>
<div class="line"><span class="lineno">   93</span> </div>
<div class="line"><span class="lineno">   94</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno">   95</span>        <span class="comment">// Because we&#39;re not save or load EFER on vm-exits so</span></div>
<div class="line"><span class="lineno">   96</span>        <span class="comment">// we have to set it manually</span></div>
<div class="line"><span class="lineno">   97</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno">   98</span>        __writemsr(IA32_EFER, MsrValue.AsUInt);</div>
<div class="line"><span class="lineno">   99</span> </div>
<div class="line"><span class="lineno">  100</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno">  101</span>        <span class="comment">// unset the exception to not cause vm-exit on #UDs</span></div>
<div class="line"><span class="lineno">  102</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno">  103</span>        <a class="code hl_function" href="_protected_hv_8c.html#a83728a3a3d82025543670d10b2c0d53f">ProtectedHvRemoveUndefinedInstructionForDisablingSyscallSysretCommands</a>(VCpu);</div>
<div class="line"><span class="lineno">  104</span>    }</div>
<div class="line"><span class="lineno">  105</span>}</div>
<div class="ttc" id="a_hv_8c_html_ad9fc64fae8bbc000a6e8949e78547027"><div class="ttname"><a href="_hv_8c.html#ad9fc64fae8bbc000a6e8949e78547027">HvSetExceptionBitmap</a></div><div class="ttdeci">VOID HvSetExceptionBitmap(VIRTUAL_MACHINE_STATE *VCpu, UINT32 IdtIndex)</div><div class="ttdoc">Set exception bitmap in VMCS.</div><div class="ttdef"><b>Definition:</b> Hv.c:999</div></div>
<div class="ttc" id="a_hv_8c_html_af4b5fbb4d7aab890383c5ea30789e265"><div class="ttname"><a href="_hv_8c.html#af4b5fbb4d7aab890383c5ea30789e265">HvAdjustControls</a></div><div class="ttdeci">ULONG HvAdjustControls(ULONG Ctl, ULONG Msr)</div><div class="ttdoc">Adjust controls for VMCS based on processor capability.</div><div class="ttdef"><b>Definition:</b> Hv.c:23</div></div>
<div class="ttc" id="a_protected_hv_8c_html_a83728a3a3d82025543670d10b2c0d53f"><div class="ttname"><a href="_protected_hv_8c.html#a83728a3a3d82025543670d10b2c0d53f">ProtectedHvRemoveUndefinedInstructionForDisablingSyscallSysretCommands</a></div><div class="ttdeci">VOID ProtectedHvRemoveUndefinedInstructionForDisablingSyscallSysretCommands(VIRTUAL_MACHINE_STATE *VCpu)</div><div class="ttdoc">Reset exception bitmap in VMCS because of clearing !exception commands.</div><div class="ttdef"><b>Definition:</b> ProtectedHv.c:160</div></div>
<div class="ttc" id="a_vmx_8h_html_a90a6b8fc528e099c6f0c614d09ad9931"><div class="ttname"><a href="_vmx_8h.html#a90a6b8fc528e099c6f0c614d09ad9931">VM_EXIT_SAVE_IA32_EFER</a></div><div class="ttdeci">#define VM_EXIT_SAVE_IA32_EFER</div><div class="ttdef"><b>Definition:</b> Vmx.h:89</div></div>
<div class="ttc" id="a_vmx_8h_html_a92eb09bb4e3344efcdb3616970da1cf4"><div class="ttname"><a href="_vmx_8h.html#a92eb09bb4e3344efcdb3616970da1cf4">VM_ENTRY_LOAD_IA32_EFER</a></div><div class="ttdeci">#define VM_ENTRY_LOAD_IA32_EFER</div><div class="ttdef"><b>Definition:</b> Vmx.h:103</div></div>
<div class="ttc" id="abuild_2bin_2debug_2_s_d_k_2_headers_2_events_8h_html_af9640e4f7e36f7a6bf7c56e30a860349a33fbb650006f5fc9e3080438e80de36c"><div class="ttname"><a href="build_2bin_2debug_2_s_d_k_2_headers_2_events_8h.html#af9640e4f7e36f7a6bf7c56e30a860349a33fbb650006f5fc9e3080438e80de36c">EXCEPTION_VECTOR_UNDEFINED_OPCODE</a></div><div class="ttdeci">@ EXCEPTION_VECTOR_UNDEFINED_OPCODE</div><div class="ttdef"><b>Definition:</b> Events.h:30</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a09cacb271b340e0c85aa1ccbd0c5d327" name="a09cacb271b340e0c85aa1ccbd0c5d327"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a09cacb271b340e0c85aa1ccbd0c5d327">&#9670;&#160;</a></span>SyscallHookEmulateSYSCALL()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#a1cb18096b299d23458d3c7b85fd86555">BOOLEAN</a> SyscallHookEmulateSYSCALL </td>
          <td>(</td>
          <td class="paramtype">_Inout_ <a class="el" href="hprdbghv_2header_2common_2_state_8h.html#ac81d4d9bd1e8dd24918e667b56b67b7e">VIRTUAL_MACHINE_STATE</a> *&#160;</td>
          <td class="paramname"><em>VCpu</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a714c210615d12747427523057db721d1" name="a714c210615d12747427523057db721d1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a714c210615d12747427523057db721d1">&#9670;&#160;</a></span>SyscallHookEmulateSYSRET()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#a1cb18096b299d23458d3c7b85fd86555">BOOLEAN</a> SyscallHookEmulateSYSRET </td>
          <td>(</td>
          <td class="paramtype">_Inout_ <a class="el" href="hprdbghv_2header_2common_2_state_8h.html#ac81d4d9bd1e8dd24918e667b56b67b7e">VIRTUAL_MACHINE_STATE</a> *&#160;</td>
          <td class="paramname"><em>VCpu</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a5ad0a606e7e2961614ad11e934585718" name="a5ad0a606e7e2961614ad11e934585718"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5ad0a606e7e2961614ad11e934585718">&#9670;&#160;</a></span>SyscallHookHandleUD()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#a1cb18096b299d23458d3c7b85fd86555">BOOLEAN</a> SyscallHookHandleUD </td>
          <td>(</td>
          <td class="paramtype">_Inout_ <a class="el" href="hprdbghv_2header_2common_2_state_8h.html#ac81d4d9bd1e8dd24918e667b56b67b7e">VIRTUAL_MACHINE_STATE</a> *&#160;</td>
          <td class="paramname"><em>VCpu</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a2252d8f31a2a6826928c9a192ef59193" name="a2252d8f31a2a6826928c9a192ef59193"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2252d8f31a2a6826928c9a192ef59193">&#9670;&#160;</a></span>SyscallHookTest()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#a7f319bfc2492a2136964194204e7a8cf">VOID</a> SyscallHookTest </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Make examples for testing hidden hooks. </p>
<p>THIS EXAMPLE IS NOT VALID ANYMORE, PLEASE USE !syscall OR !epthook2 COMMANDS</p>
<dl class="section return"><dt>Returns</dt><dd>VOID </dd></dl>
<div class="fragment"><div class="line"><span class="lineno">  274</span>{</div>
<div class="line"><span class="lineno">  275</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">  276</span>    <span class="comment">// THIS EXAMPLE IS NOT VALID ANYMORE, PLEASE USE !syscall OR !epthook2 COMMANDS</span></div>
<div class="line"><span class="lineno">  277</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">  278</span> </div>
<div class="line"><span class="lineno">  279</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">  280</span>    <span class="comment">// Note that this syscall number is only valid for Windows 10 1909,</span></div>
<div class="line"><span class="lineno">  281</span>    <span class="comment">// you have to find the syscall number of NtCreateFile based on</span></div>
<div class="line"><span class="lineno">  282</span>    <span class="comment">// Your Windows version, please visit https://j00ru.vexillium.org/syscalls/nt/64/</span></div>
<div class="line"><span class="lineno">  283</span>    <span class="comment">// for finding NtCreateFile&#39;s Syscall number for your Windows</span></div>
<div class="line"><span class="lineno">  284</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">  285</span> </div>
<div class="line"><span class="lineno">  286</span>    <a class="code hl_typedef" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#a1137216524060afd426c34677fed058b">INT32</a> ApiNumberOfNtCreateFile           = 0x0055;</div>
<div class="line"><span class="lineno">  287</span>    PVOID ApiLocationFromSSDTOfNtCreateFile = <a class="code hl_function" href="_ssdt_hook_8c.html#a2cee7539dff420e2623ac40dd9bd8628">SyscallHookGetFunctionAddress</a>(ApiNumberOfNtCreateFile, <a class="code hl_define" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>);</div>
<div class="line"><span class="lineno">  288</span> </div>
<div class="line"><span class="lineno">  289</span>    <span class="keywordflow">if</span> (!ApiLocationFromSSDTOfNtCreateFile)</div>
<div class="line"><span class="lineno">  290</span>    {</div>
<div class="line"><span class="lineno">  291</span>        <a class="code hl_define" href="build_2bin_2debug_2_s_d_k_2_imports_2_hyper_dbg_hyper_log_intrinsics_8h.html#a459b19922fecfbb9438dd56b66930d16">LogError</a>(<span class="stringliteral">&quot;Err, address finding for syscall base address&quot;</span>);</div>
<div class="line"><span class="lineno">  292</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">  293</span>    }</div>
<div class="line"><span class="lineno">  294</span> </div>
<div class="line"><span class="lineno">  295</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">  296</span>    <span class="comment">// THIS EXAMPLE IS NOT VALID ANYMORE, PLEASE USE !syscall OR !epthook2 COMMANDS</span></div>
<div class="line"><span class="lineno">  297</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">  298</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="_ept_hook_8c.html#a3c5eb45ffb3514149f329aeb0cf04071">EptHook2</a>(ApiLocationFromSSDTOfNtCreateFile, <a class="code hl_function" href="_ssdt_hook_8c.html#a5618dcffed93218174d1dd96430a6045">NtCreateFileHook</a>, PsGetCurrentProcessId(), <a class="code hl_define" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>, <a class="code hl_define" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>, <a class="code hl_define" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>))</div>
<div class="line"><span class="lineno">  299</span>    {</div>
<div class="line"><span class="lineno">  300</span>        <a class="code hl_define" href="build_2bin_2debug_2_s_d_k_2_imports_2_hyper_dbg_hyper_log_intrinsics_8h.html#a97b0adbd65790fb90734daa8e5245a04">LogInfo</a>(<span class="stringliteral">&quot;Hook appkied to address of API Number : 0x%x at %llx\n&quot;</span>, ApiNumberOfNtCreateFile, ApiLocationFromSSDTOfNtCreateFile);</div>
<div class="line"><span class="lineno">  301</span>    }</div>
<div class="line"><span class="lineno">  302</span>}</div>
<div class="ttc" id="a_ept_hook_8c_html_a3c5eb45ffb3514149f329aeb0cf04071"><div class="ttname"><a href="_ept_hook_8c.html#a3c5eb45ffb3514149f329aeb0cf04071">EptHook2</a></div><div class="ttdeci">BOOLEAN EptHook2(PVOID TargetAddress, PVOID HookFunction, UINT32 ProcessId, BOOLEAN SetHookForRead, BOOLEAN SetHookForWrite, BOOLEAN SetHookForExec)</div><div class="ttdoc">This function allocates a buffer in VMX Non Root Mode and then invokes a VMCALL to set the hook.</div><div class="ttdef"><b>Definition:</b> EptHook.c:1060</div></div>
<div class="ttc" id="a_ssdt_hook_8c_html_a2cee7539dff420e2623ac40dd9bd8628"><div class="ttname"><a href="_ssdt_hook_8c.html#a2cee7539dff420e2623ac40dd9bd8628">SyscallHookGetFunctionAddress</a></div><div class="ttdeci">PVOID SyscallHookGetFunctionAddress(INT32 ApiNumber, BOOLEAN GetFromWin32k)</div><div class="ttdoc">Find entry from SSDT table of Nt fucntions and W32Table syscalls.</div><div class="ttdef"><b>Definition:</b> SsdtHook.c:159</div></div>
<div class="ttc" id="a_ssdt_hook_8c_html_a5618dcffed93218174d1dd96430a6045"><div class="ttname"><a href="_ssdt_hook_8c.html#a5618dcffed93218174d1dd96430a6045">NtCreateFileHook</a></div><div class="ttdeci">NTSTATUS NtCreateFileHook(PHANDLE FileHandle, ACCESS_MASK DesiredAccess, POBJECT_ATTRIBUTES ObjectAttributes, PIO_STATUS_BLOCK IoStatusBlock, PLARGE_INTEGER AllocationSize, ULONG FileAttributes, ULONG ShareAccess, ULONG CreateDisposition, ULONG CreateOptions, PVOID EaBuffer, ULONG EaLength)</div><div class="ttdoc">Hook function that hooks NtCreateFile.</div><div class="ttdef"><b>Definition:</b> SsdtHook.c:218</div></div>
<div class="ttc" id="abuild_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h_html_a1137216524060afd426c34677fed058b"><div class="ttname"><a href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#a1137216524060afd426c34677fed058b">INT32</a></div><div class="ttdeci">signed int INT32</div><div class="ttdef"><b>Definition:</b> BasicTypes.h:42</div></div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a id="a708148b18a52f70ef6c1e92504f29e92" name="a708148b18a52f70ef6c1e92504f29e92"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a708148b18a52f70ef6c1e92504f29e92">&#9670;&#160;</a></span>AllocationSize</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">PHANDLE ACCESS_MASK POBJECT_ATTRIBUTES PIO_STATUS_BLOCK PLARGE_INTEGER AllocationSize</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="ab40749908b174e4a58a46b6bb9a8899f" name="ab40749908b174e4a58a46b6bb9a8899f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab40749908b174e4a58a46b6bb9a8899f">&#9670;&#160;</a></span>CreateDisposition</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">PHANDLE ACCESS_MASK POBJECT_ATTRIBUTES PIO_STATUS_BLOCK PLARGE_INTEGER <a class="el" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#af632da489ebc3708ec3ab6791ee53fa4">ULONG</a> <a class="el" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#af632da489ebc3708ec3ab6791ee53fa4">ULONG</a> <a class="el" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#af632da489ebc3708ec3ab6791ee53fa4">ULONG</a> CreateDisposition</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="ad07b47eb97df97ce6120a6ff17e9c6e2" name="ad07b47eb97df97ce6120a6ff17e9c6e2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad07b47eb97df97ce6120a6ff17e9c6e2">&#9670;&#160;</a></span>CreateOptions</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">PHANDLE ACCESS_MASK POBJECT_ATTRIBUTES PIO_STATUS_BLOCK PLARGE_INTEGER <a class="el" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#af632da489ebc3708ec3ab6791ee53fa4">ULONG</a> <a class="el" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#af632da489ebc3708ec3ab6791ee53fa4">ULONG</a> <a class="el" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#af632da489ebc3708ec3ab6791ee53fa4">ULONG</a> <a class="el" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#af632da489ebc3708ec3ab6791ee53fa4">ULONG</a> CreateOptions</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="ac648ae3c24d5148a8ef42128d6bab501" name="ac648ae3c24d5148a8ef42128d6bab501"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac648ae3c24d5148a8ef42128d6bab501">&#9670;&#160;</a></span>DesiredAccess</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">PHANDLE ACCESS_MASK DesiredAccess</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a9e7d4ea496b0d33e07d6813b22aac212" name="a9e7d4ea496b0d33e07d6813b22aac212"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9e7d4ea496b0d33e07d6813b22aac212">&#9670;&#160;</a></span>EaBuffer</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">PHANDLE ACCESS_MASK POBJECT_ATTRIBUTES PIO_STATUS_BLOCK PLARGE_INTEGER <a class="el" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#af632da489ebc3708ec3ab6791ee53fa4">ULONG</a> <a class="el" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#af632da489ebc3708ec3ab6791ee53fa4">ULONG</a> <a class="el" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#af632da489ebc3708ec3ab6791ee53fa4">ULONG</a> <a class="el" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#af632da489ebc3708ec3ab6791ee53fa4">ULONG</a> PVOID EaBuffer</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="aec301946a43309ef0f6da81995361efb" name="aec301946a43309ef0f6da81995361efb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aec301946a43309ef0f6da81995361efb">&#9670;&#160;</a></span>EaLength</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">PHANDLE ACCESS_MASK POBJECT_ATTRIBUTES PIO_STATUS_BLOCK PLARGE_INTEGER <a class="el" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#af632da489ebc3708ec3ab6791ee53fa4">ULONG</a> <a class="el" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#af632da489ebc3708ec3ab6791ee53fa4">ULONG</a> <a class="el" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#af632da489ebc3708ec3ab6791ee53fa4">ULONG</a> <a class="el" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#af632da489ebc3708ec3ab6791ee53fa4">ULONG</a> PVOID <a class="el" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#af632da489ebc3708ec3ab6791ee53fa4">ULONG</a> EaLength</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a54b337d004f8bae1638fab9180d83d08" name="a54b337d004f8bae1638fab9180d83d08"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a54b337d004f8bae1638fab9180d83d08">&#9670;&#160;</a></span>FileAttributes</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">PHANDLE ACCESS_MASK POBJECT_ATTRIBUTES PIO_STATUS_BLOCK PLARGE_INTEGER <a class="el" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#af632da489ebc3708ec3ab6791ee53fa4">ULONG</a> FileAttributes</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a74bc6881ecc918d83da9c92e3b2bcc04" name="a74bc6881ecc918d83da9c92e3b2bcc04"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a74bc6881ecc918d83da9c92e3b2bcc04">&#9670;&#160;</a></span>FileHandle</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">PHANDLE FileHandle</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a24ff958436c219a33ff5b86019874568" name="a24ff958436c219a33ff5b86019874568"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a24ff958436c219a33ff5b86019874568">&#9670;&#160;</a></span>IoStatusBlock</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">PHANDLE ACCESS_MASK POBJECT_ATTRIBUTES PIO_STATUS_BLOCK IoStatusBlock</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a61083d5dde730c2afd10a336322aaaac" name="a61083d5dde730c2afd10a336322aaaac"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a61083d5dde730c2afd10a336322aaaac">&#9670;&#160;</a></span>NumberOfBytes</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">POOL_TYPE SIZE_T NumberOfBytes</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a22e2a9ce1ada928965365e448fd91e10" name="a22e2a9ce1ada928965365e448fd91e10"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a22e2a9ce1ada928965365e448fd91e10">&#9670;&#160;</a></span>ObjectAttributes</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">PHANDLE ACCESS_MASK POBJECT_ATTRIBUTES ObjectAttributes</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a5d405dff9ba7e6c73d78857f415965f4" name="a5d405dff9ba7e6c73d78857f415965f4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5d405dff9ba7e6c73d78857f415965f4">&#9670;&#160;</a></span>PoolType</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">POOL_TYPE PoolType</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a9ae311c2ebc03cc38ee69edaac2f6e12" name="a9ae311c2ebc03cc38ee69edaac2f6e12"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9ae311c2ebc03cc38ee69edaac2f6e12">&#9670;&#160;</a></span>ShareAccess</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">PHANDLE ACCESS_MASK POBJECT_ATTRIBUTES PIO_STATUS_BLOCK PLARGE_INTEGER <a class="el" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#af632da489ebc3708ec3ab6791ee53fa4">ULONG</a> <a class="el" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#af632da489ebc3708ec3ab6791ee53fa4">ULONG</a> ShareAccess</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="aba7c9f3767dcc5232354d3d17ceedb61" name="aba7c9f3767dcc5232354d3d17ceedb61"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aba7c9f3767dcc5232354d3d17ceedb61">&#9670;&#160;</a></span>Tag</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">POOL_TYPE SIZE_T <a class="el" href="build_2bin_2debug_2_s_d_k_2_headers_2_basic_types_8h.html#af632da489ebc3708ec3ab6791ee53fa4">ULONG</a> Tag</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_53a6cdbae347618e9ee76d4be5c6ea96.html">hyperdbg</a></li><li class="navelem"><a class="el" href="dir_19054a674c4bd5cb8fceb6542228579c.html">hprdbghv</a></li><li class="navelem"><a class="el" href="dir_d89c7c13509e82280948b201a87328be.html">header</a></li><li class="navelem"><a class="el" href="dir_584057b210a4a6621768405fa497fe97.html">hooks</a></li><li class="navelem"><a class="el" href="_hooks_8h.html">Hooks.h</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.6 </li>
  </ul>
</div>
</body>
</html>
